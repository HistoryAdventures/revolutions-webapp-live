!function(e){function t(t){for(var r,i,s=t[0],c=t[1],l=t[2],u=0,p=[];u<s.length;u++)i=s[u],o[i]&&p.push(o[i][0]),o[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(d&&d(t);p.length;)p.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(r=!1)}r&&(a.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},o={0:0},a=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/js/";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var d=c;a.push([163,1]),n()}([function(e,t){e.exports=window.$},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=n(199).default;e.exports=function(e,t){var n={},a=t.Deferred();function i(e){return function e(n,o){if("string"==typeof n)return n.replace(/\$RESOURCEDIR/g,o);if(t.isArray(n)){for(var a=[],i=0;i<n.length;++i)a.push(e(n[i],o));return a}if("object"===r(n)){var s={};for(var c in n)n.hasOwnProperty(c)&&(s[c]=e(n[c],o));return s}return n}(e,(n="",0===window.location.pathname.indexOf("/_ah/gcs/bookwidgets-eu--widgets/")?n=window.location.origin+"/_ah/gcs/bookwidgets-eu--widget-assets":"widgets-eu.bookwidgets.com"===window.location.host&&(n="//widget-assets-eu.bookwidgets.com"),n));var n}return o().then(function(o){var s=function(e){var n=function e(n){if("string"==typeof n)return function(e){for(var t="",n=0;n<e.length;++n)2*n<e.length?t+=e.charAt(2*n):t+=e.charAt(2*(e.length-n)-1);return t}(n);if(t.isArray(n)){for(var o=[],a=0;a<n.length;++a)o.push(e(n[a]));return o}if("object"===r(n)){var i={};for(var s in n)n.hasOwnProperty(s)&&(i[s]=e(n[s]));return i}return n}(e);return n=i(n)}(o);for(var c in s)n[c]=s[c];e(n),a.resolve(n)}),{fixResourcePaths:i,getConfig:function(){return a},getConfigSync:function(){return n}}}(n(203),n(0))},function(e,t,n){e.exports=function(e){function t(){var e=window.navigator.userAgent,t=e.indexOf("OS ");return(e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1)&&t>-1?window.Number(e.substr(t+3,3).replace("_",".")):0}function n(){return window.BW_PLATFORM_HACK?window.BW_PLATFORM_HACK:"iPad"===navigator.platform||"iPhone"===navigator.platform?void 0!==navigator.epubReadingSystem&&"iBooks"===navigator.epubReadingSystem.name?"ibw-platform-ipad-ibooks-epub":-1!==navigator.userAgent.indexOf("Safari")?"ibw-platform-ipad-safari":-1!==navigator.userAgent.indexOf("BookWidgets")?"ibw-platform-ipad-bookwidgets":"http:"!==window.location.protocol&&"https:"!==window.location.protocol?"ibw-platform-ipad-ibooks":"ibw-platform-ipad":"MacIntel"===navigator.platform?void 0!==navigator.epubReadingSystem&&"iBooks"===navigator.epubReadingSystem.name?"ibw-platform-osx-ibooks-epub":-1!==navigator.userAgent.indexOf("PhantomJS")?"ibw-platform-osx-phantomjs":-1!==navigator.userAgent.indexOf("HeadlessChrome")?"ibw-platform-osx-headlesschrome":-1!==navigator.userAgent.indexOf("ibookwidgets")?"ibw-platform-osx-preview":-1!==navigator.userAgent.indexOf("Chrome")?"ibw-platform-osx-chrome":-1!==navigator.userAgent.indexOf("Safari")?"ibw-platform-osx-safari":-1!==navigator.userAgent.indexOf("Firefox")?"ibw-platform-osx-firefox":"http:"!==window.location.protocol&&"https:"!==window.location.protocol?"ibw-platform-osx-ibooks":"ibw-platform-osx":"Win32"===navigator.platform?-1!==navigator.userAgent.indexOf("BookWidgets")?"ibw-platform-win32-preview":"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&-1!==navigator.userAgent.indexOf("Trident")||"Netscape"===navigator.appName&&-1!==navigator.userAgent.indexOf("Edge")?"ibw-platform-win32-ie":-1!==navigator.userAgent.indexOf("Chrome")?"ibw-platform-win32-chrome":"Microsoft Internet Explorer"===navigator.appName?"ibw-platform-win32-ie":-1!==navigator.userAgent.indexOf("Firefox")?"ibw-platform-win32-firefox":"ibw-platform-win32":"iPad Simulator"===navigator.platform||"iPhone Simulator"===navigator.platform?"ibw-platform-ipad-bookwidgets":-1!==navigator.userAgent.indexOf("Android")?-1!==navigator.userAgent.indexOf("Chrome")?"ibw-platform-android-chrome":"ibw-platform-android":-1!==navigator.userAgent.indexOf("CrOS")?-1!==navigator.userAgent.indexOf("Chrome")?"ibw-platform-chromebook-chrome":"ibw-platform-chromebook":"ibw-platform-unknown"}return{getPlatform:n,supportsAppFeature:function(e){var t=/BookWidgets\/([0-9]+)\.([0-9]+)\.([0-9]+)/g.exec(navigator.userAgent),n=t&&4===t.length?1e4*parseInt(t[1])+100*parseInt(t[2])+parseInt(t[3]):0;return console.log(e+" "+n),"audiorecording"===e&&n>=20800},isToolPreview:function(){return-1!==this.getPlatform().indexOf("preview")},isWebPreview:function(){return"1"===e.getUrlParams(window.location.href).preview},isPreview:function(){return this.isToolPreview()||this.isWebPreview()},isTopLevelPlay:function(){return"1"===e.getUrlParams(window.location.href).toplevel},usesCredentialProxy:function(){return-1!==window.location.search.substring(1).indexOf("bwds-secure-proxy")},isAndroidIosDevice:function(){var e=n(),t=0===e.indexOf("ibw-platform-ipad")||0===e.indexOf("ibw-platform-android");return console.log("IsAndroidIos",t),t},isTouchDevice:function(){return this.isAndroidIosDevice()||(t=" -webkit- -moz- -o- -ms- ".split(" "),"ontouchstart"in window||(e=["(",t.join("touch-enabled),("),"heartz",")"].join(""),window.matchMedia(e).matches));var e,t},isIOS:function(){return"iPad"===navigator.platform||"iPhone"===navigator.platform},isInternetExplorer:function(){return-1!==window.navigator.userAgent.indexOf("MSIE ")||/rv:11.0/i.test(window.navigator.userAgent)},getIOSIBooksRestartInfo:function(){return t()>=7?'To close iBooks:<ol style="text-align: left;"><li>Double-click the Home button.</li><li>Swipe left or right until you have located iBooks.</li><li>Swipe the app\'s preview up to close it.</li></ol>':t()>=5?"To close iBooks:<ol style=\"text-align: left;\"><li>Double-click the Home button.</li><li>Touch-and-hold the iBooks icon to put it into 'jiggly mode'.</li><li>Tap the red minus-sign icon that appears at the top left corner of iBooks.</li><li>Click the Home button to exit 'jiggly mode'.</li></ol>":""},inIframe:function(){try{return window.self!==window.top}catch(e){return!0}}}}(n(11))},function(e,t,n){var r,o,a;e.exports=(r=n(1),o=n(0),a={},window.BWAUDIO=a,a.loaded=!1,a.queue=[],a.elementqueue=[],a.process=function(e){!0===a.loaded?0===e.find(".mejs-container.mejs-audio").length&&e.mediaelementplayer({enableKeyboard:!1}):a.queue.push(e)},a.createElement=function(e){var t={play:function(e){if(void 0===this.element)return!1;var t;try{return e&&(t=this.element,this.element.addEventListener("playing",function n(){t.removeEventListener("playing",n),e()})),this.element.play(),!0}catch(e){return!1}},pause:function(){if(void 0===this.element)return!1;try{return this.element.pause(),!0}catch(e){return!1}},paused:function(){return void 0!==this.element&&this.element.paused},toggle:function(){void 0!==this.paused()&&!0===this.paused()?this.play():this.pause()},rewind:function(){if(void 0===this.element)return!1;try{return this.element.setCurrentTime(0),!0}catch(e){return!1}},setVolume:function(e){if(void 0===this.element)return!1;try{return this.element.setVolume(e),!0}catch(e){return!1}},on:function(e,t){if(void 0===this.element)return!1;try{return this.element.addEventListener(e,t),!0}catch(e){return!1}},onLoaded:function(e){this.element?e():this.onLoadedCB=e}};return t.obj=e,!0===a.loaded?t.element=new window.MediaElement(e,{startVolume:1}):a.elementqueue.push(t),t},a.createPlayer=function(e,t){if(t){var n=o('<div class="audiowrapper">&nbsp;</div>');return o('<div class="audio-placeholder" data-src="'+e+'"></div>').appendTo(n),n}n=o('<div class="audiowrapper">&nbsp;</div>');var r=o('<audio controls><source src="'+e+'"></audio>').appendTo(n);return a.process(r),n},a.replaceAudioByPlaceholder=function(e){var t=this;o(e).find(":not(.audiowrapper) > audio:not(.no-audio-wrap)").each(function(){var e=o(this),n=e.find("source").attr("src");e.replaceWith(t.createPlayer(n,!0))})},a.processAudioTags=function(e){e instanceof o?a.process(e.find(":not(.mejs-mediaelement) > audio:not(.no-audio-wrap)")):a.process(o(e+" audio"))},a.replacePlaceholders=function(e){o(e).find("div.audio-placeholder").each(function(){var e=o('<audio controls><source src="'+o(this).attr("data-src")+'"></audio>').insertAfter(o(this));a.process(e)})},a.removeAudioElements=function(){o("audio:not(.no-audio-wrap), .mejs-container.mejs-audio").remove()},a.processqueue=function(){for(a.loaded=!0;a.queue.length>0;){var e=a.queue.shift();a.process(e)}for(;a.elementqueue.length>0;){var t=a.elementqueue.shift();t.element=new window.MediaElement(t.obj,{startVolume:1}),t.onLoadedCB&&t.onLoadedCB(t)}},a.loadMediaElement=function(){var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href","external/mediaelement/css/mediaelementplayer.min.css"),document.getElementsByTagName("head")[0].appendChild(e);var t=document.createElement("script");t.type="text/javascript",t.src="external/mediaelement/js/mediaelement-and-player.min.js",t.onload=a.processqueue,document.getElementsByTagName("head")[0].appendChild(t)},a.addElement=function(e,t){var n=o('<audio><source src="'+e+'"></audio>').appendTo(t);return a.createElement(n[0])},r.getConfig().then(function(e){e.hasOwnProperty("modules")&&-1!==e.modules.indexOf("bwaudio")&&a.loadMediaElement()}),a)},function(e,t,n){var r,o,a,i,s;e.exports=(r=n(1),o=n(2),a=n(0),i=n(61),s={},window.BWMATH=s,s.disabled=!1,s.nextUniqueId=1,s.queue=[],s.customCssClasses=[],s.initialized=!1,s.initialize=function(){if(!1===this.initialized&&-1!==o.getPlatform().indexOf("chrome")){var e=a('<div id="chromemathjaxhack" style="position: absolute; pointer-events: none;";></div>').prependTo(a("body"));e.html('<canvas width="300" height="300"></canvas>');var t=e.find("canvas")[0];t.getContext("2d").clearRect(0,0,t.width,t.height),this.initialized=!0}},s.prepare=function(e){if(this.disabled)return e;var t="",n=0,r=e.indexOf("$$"),o=0;for(r>=0&&this.initialize();r>=0&&!(++o>100);){t+=e.substring(n,r);var a=e.indexOf("$$",r+2);if(a<0){n=r;break}t+='<span class="bwmathquill" style="direction:ltr; visibility: hidden">\\('+e.substring(r+2,a)+"\\)</span>",n=a+2,r=e.indexOf("$$",n)}return t+=e.substring(n)},s._createCssClass=function(e,t){var n=document.createElement("style");n.type="text/css",document.getElementsByTagName("head")[0].appendChild(n),(n.sheet||{}).insertRule?n.sheet.insertRule("."+e+"{"+t+"}",0):(n.styleSheet||n.sheet).addRule(e,t),s.customCssClasses.push(e)},s._copyColorToStrokeAndFill=function(e){var t=e.css("color");e.find("g[stroke]").attr("stroke",null).attr("fill",null);var n="bw-math-jax-expression-"+s.nextUniqueId++,r="stroke: "+t+"; fill: "+t+";";s._createCssClass(n,r),e.addClass(n)},s.schedule=function(e){void 0!==window.MathJax&&window.MathJax.hasOwnProperty("Hub")&&window.MathJax.Hub.hasOwnProperty("Queue")?window.MathJax.Hub.Queue(e):s.queue.push({cb:e})},s.process=function(e){this.disabled||e.each(function(){if(void 0!==window.MathJax&&window.MathJax.hasOwnProperty("Hub")&&window.MathJax.Hub.hasOwnProperty("Queue")){var e=this;window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub,e],function(){s._copyColorToStrokeAndFill(a(e)),a(e).css("visibility","")})}else s.queue.push({obj:a(this)})})},s.processqueue=function(){for(;s.queue.length>0;){var e=s.queue.shift();e.obj&&s.process(e.obj),e.cb&&s.schedule(e.cb)}},window.MathJax={showMathMenu:!1,skipStartupTypeset:!0},"ibw-platform-win32-preview"==o.getPlatform()&&(window.MathJax.SVG={scale:200}),s.loadMathJax=function(){var e=document.createElement("script");e.type="text/javascript",e.src="external/MathJax24/MathJax.js?config=TeX-AMS-MML_SVG",e.onload=s.processqueue,document.getElementsByTagName("head")[0].appendChild(e)},r.getConfig().then(function(e){e.hasOwnProperty("modules")&&-1!==e.modules.indexOf("MathJax24")?s.loadMathJax():s.disabled=!0}),s.redraw=function(e){},i.CssUpdateCallbacks&&i.CssUpdateCallbacks.push(function(){var e=s.customCssClasses;s.customCssClasses=[];for(var t=0;t<e.length;++t){var n=e[t],r=a("."+n);r.removeClass(n),s._copyColorToStrokeAndFill(r)}}),s.isOnlyMath=function(e){var t=e.trim();return t.startsWith("$$")&&t.endsWith("$$")&&-1===t.substring(2,e.length-4).indexOf("$$")},s)},function(module,exports,__webpack_require__){(function(module){function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var _require=__webpack_require__(21),map=_require.map,each=_require.each,fill=_require.fill,cloneDeep=_require.cloneDeep,indexOf=_require.indexOf,stringify=__webpack_require__(136),factory;factory=function(chemistryparser){function getWeight(e){return e?parseFloat(e.replace(",",".")):e}function zipWith(e,t,n){for(var r=Math.max(e.length,t.length),o=[],a=0;a<r;a++)o[a]=n(e[a],t[a]);return o}function trimAll(e){for(var t=0;t<e.length;++t)e[t]=e[t].trim();return e}function mergeCorrectness(e,t){return null==t?e:e instanceof Array?zipWith(e,t,function(e,t){return null!=t?t:e}):t}function checkTextDescription(e,t){return null}function checkTextMultipleChoice(e,t,n){r=null===t?-1:parseInt(t)===parseInt(e.Valid)?1:0;var r,o=getWeight(e["scoring-weight"]),a=r;return{correctness:r=mergeCorrectness(a,n),autoCorrectness:a,score:1===r?o:0,outof:o}}function checkRatedMultipleChoice(e,t){for(var n=0,r=e.Answers?e.Answers:[],o=0;o<r.length;++o)parseFloat(r[o].value)>n&&(n=parseFloat(r[o].value));if(null===t)return{correctness:-1,autoCorrectness:-1,score:0,outof:n+""};var a=parseFloat(r[t].value);return{correctness:0===a?0:1,autoCorrectness:0===a?0:1,score:a+"",outof:n+""}}function removeNonNumbers(e){return e.replace(/\D/g," ")}function arrayContains(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1}function arrayCount(e,t){for(var n=0,r=0;r<e.length;++r)e[r]===t&&++n;return n}function scoreForPolicyAndWeight(e,t,n){return"each"===t?arrayCount(e,1)*n:arrayCount(e,1)===e.length?n:0}function maxForPolicyAndWeight(e,t,n){return"each"===t?e.length*n:n}function scoreForValidPolicyAndWeight(e,t,n,r){if("each"===n){for(var o=0,a=0;a<e.length;++a)e[a]&&1===t[a]?++o:e[a]||0!==t[a]||--o;return Math.max(o,0)*r}return"eachcorrect"===n?arrayCount(t,1)*r:arrayCount(t,1)===t.length?r:0}function maxForValidPolicyAndWeight(e,t,n,r){return"each"===n?arrayCount(e,!0)*r:"eachcorrect"===n?e.length*r:r}function checkTextMultiSelect(e,t,n){for(var r=e.policy,o=arrayContains(t,!0)||"eachcorrect"===r,a=e.hasOwnProperty("Valid")?removeNonNumbers(e.Valid).split(" "):"",i=[],s=0;s<a.length;++s)i.push(parseInt(a[s],10));var c=[];for(s=0;s<t.length;++s)c.push(arrayContains(a,s+1+""));var l=[];for(s=0;s<t.length;++s)o?!arrayContains(a,s+1+"")^!t[s]?l.push(0):l.push(1):l.push(-1);var d=getWeight(e["scoring-weight"]),u=l;return{correctness:l=mergeCorrectness(u,n),autoCorrectness:u,correctAnswers:i,score:scoreForValidPolicyAndWeight(c,l,r,d),outof:maxForValidPolicyAndWeight(c,l,r,d)}}function checkQuestionTable(e,t,n){function r(e,t){var n=e.rows[t].split(/\|\||##/);return n.length>1?n[1].trim():null}function o(e,t){var n=e.rows[t].split(/\|\||##/);return n.length>1?n[0]:n}for(var a={},i=e.columns?e.columns:[],s=0;s<i.length;++s)a[i[s].trim()]=s;for(var c=[],l=[],d=[],u=0;u<t.length;++u){var p=parseInt(t[u]),f=r(e,u);d.push(o(e,u)),null!=a[f]?l.push(a[f]):l.push(null),isNaN(p)?c.push(-1):null!==f&&a.hasOwnProperty(f)?a[f]===p?c.push(1):c.push(0):c.push(-2)}var h=getWeight(e["scoring-weight"]),g=c;return{correctness:c=mergeCorrectness(g,n),autoCorrectness:g,score:arrayCount(c,1)*h,outof:c.length*h,correctAnswers:l,questions:d}}var checkPictureMultipleChoice=checkTextMultipleChoice,checkPictureMultiSelect=checkTextMultiSelect;function replaceBadQuotes(e){return e.replace(/[\u2018\u2019]/g,"'")}for(var defaultDiacriticsRemovalMap=[{base:"A",letters:"AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"BⒷＢḂḄḆɃƂƁ"},{base:"C",letters:"CⒸＣĆĈĊČÇḈƇȻꜾ"},{base:"D",letters:"DⒹＤḊĎḌḐḒḎĐƋƊƉꝹÐ"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ"},{base:"F",letters:"FⒻＦḞƑꝻ"},{base:"G",letters:"GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ"},{base:"H",letters:"HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"JⒿＪĴɈ"},{base:"K",letters:"KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"MⓂＭḾṀṂⱮƜ"},{base:"N",letters:"NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"OE",letters:"Œ"},{base:"oe",letters:"œ"},{base:"P",letters:"PⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"QⓆＱꝖꝘɊ"},{base:"R",letters:"RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"VⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"WⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"XⓍＸẊẌ"},{base:"Y",letters:"YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"bⓑｂḃḅḇƀƃɓ"},{base:"c",letters:"cⓒｃćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"dⓓｄḋďḍḑḓḏđƌɖɗꝺ"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"},{base:"f",letters:"fⓕｆḟƒꝼ"},{base:"g",letters:"gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ"},{base:"h",letters:"hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"jⓙｊĵǰɉ"},{base:"k",letters:"kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"mⓜｍḿṁṃɱɯ"},{base:"n",letters:"nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"},{base:"oi",letters:"ƣ"},{base:"ou",letters:"ȣ"},{base:"oo",letters:"ꝏ"},{base:"p",letters:"pⓟｐṕṗƥᵽꝑꝓꝕ"},{base:"q",letters:"qⓠｑɋꝗꝙ"},{base:"r",letters:"rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ"},{base:"t",letters:"tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"vⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"wⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"xⓧｘẋẍ"},{base:"y",letters:"yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"zⓩｚźẑżžẓẕƶȥɀⱬꝣ"}],diacriticsMap={},i=0;i<defaultDiacriticsRemovalMap.length;i++)for(var letters=defaultDiacriticsRemovalMap[i].letters,j=0;j<letters.length;j++)diacriticsMap[letters[j]]=defaultDiacriticsRemovalMap[i].base;function removeDiacritics(e){return e.replace(/[\u0301\u0060]/gi,"").replace(/[^\u0000-\u007E]/g,function(e){return diacriticsMap[e]||e})}function prepareForCompare(e,t){if(!e)return"";if(t){if("no"===t)return e.toLowerCase();if("no_ignore_accents"===t)return removeDiacritics(e.toLowerCase());if("yes_ignore_accents"===t)return removeDiacritics(e)}return e}function removeNonPrintable(e){return e.replace(/[\x00-\x09\x0B-\x0C\x0E-\x1F\x7F-\x9F\u200B]/g,"")}function matchesOneOfAnswers(e,t,n){e=prepareForCompare(e,n),t=prepareForCompare(t,n),e=replaceBadQuotes(e);for(var r=(t=replaceBadQuotes(t)).split(/\|\||##/),o=0;o<r.length;++o)if(removeNonPrintable(e.trim())===removeNonPrintable(r[o].trim()))return!0;return!1}function checkMultiLine(e,t,n){var r=getWeight(e["scoring-weight"]);if(null==t||""===t)return{correctness:mergeCorrectness(i=-1,n),autoCorrectness:i,score:0,outof:r,keywords:[]};if(!e.hasOwnProperty("Keywords")||0===e.Keywords.length)return{correctness:mergeCorrectness(i=-2,n),autoCorrectness:i,score:0,outof:r,keywords:[]};var o=e.Keywords,a=e["case-sensitive"];t=replaceBadQuotes(t=prepareForCompare(t,a));for(var i,s=0,c=0,l=0,d=0,u=[],p=0;p<o.length;++p){for(var f=trimAll(o[p].split(/\|\||##/)),h=[],g=f.length>1&&!1===isNaN(f[f.length-1]),v=0;v<(g?f.length-1:f.length);++v)h[v]=prepareForCompare(f[v],a);var m,w=function(e,t,n,r){for(var o=0;o<r;++o)if(-1!==e.indexOf(replaceBadQuotes(n[o])))return t[o];return null};if(g)++s,null!=(m=w(t,f,h,f.length-1))?(c+=getWeight(f[f.length-1]),++d,u.push({keyword:m,match:!0,points:f[f.length-1]})):u.push({keyword:f[0],match:!1});else++l,null!=(m=w(t,f,h,f.length))?(++d,u.push({keyword:m,match:!0})):u.push({keyword:f[0],match:!1})}return s>0&&l>0&&console.error("Info: multiline question with keywords with and without points, keywords without points don't contribute to score."),s>0?c>=r?{correctness:mergeCorrectness(i=1,n),autoCorrectness:i,score:r,outof:r,keywords:u}:{correctness:mergeCorrectness(i=0,n),autoCorrectness:i,score:c,outof:r,keywords:u}:d===o.length?{correctness:mergeCorrectness(i=1,n),autoCorrectness:i,score:r,outof:r,keywords:u}:{correctness:mergeCorrectness(i=0,n),autoCorrectness:i,score:c,outof:r,keywords:u}}function checkRichText(e,t,n){var r=getWeight(e["scoring-weight"]),o=""!==t?-2:-1;return{correctness:mergeCorrectness(o,n),autoCorrectness:o,score:0,outof:r}}function checkExtraMultiLine(e,t,n){return null}function checkExtracheckbox(e,t,n){return null}function parseFitItem(e){var t,n,r=trimAll(e.split(":"));r.length>=2?0===(t=r[0]).indexOf("text")||0===t.indexOf("select")?(r.shift(),n=r.join(":")):(t="text",n=e):r.length<2&&(t="text",n=e);var o=t.match(/(.+)\((.*)\)/),a=[],i=[];if(o&&3===o.length){t=o[1].trim(),a=trimAll(o[2].split(";")).map(function(e,t){return trimAll(e.split("="))});for(var s=0;s<a.length;++s){var c=a[s];"width"===c[0]?i.push(c.join(":")):console.error("FIT: Ignoring unsupported parameter "+c[0])}}return{type:t,typeconfig:n,style:i}}function processMarkedHtmlText(e,t,n){for(var r,o=0,a=e.indexOf("&lt;&lt;"),i="",s=0;a>=0;){var c=e.substring(o,a),l=e.indexOf("&gt;&gt;",a);if(l<0){o=e.length;break}i+=null!=(r=t(c,n(e.substring(a+8,l)),s))?c+r:e.substring(o,l+8),o=l+8,a=e.indexOf("&lt;&lt;",l),s+=1}return i+=null!=(r=t(e.substring(o),null,s))?r:e.substring(o)}function processFillInText(e,t){return processMarkedHtmlText(e,t,parseFitItem)}function toText(e){return"undefined"!=typeof window&&window.$?window.$(document.createElement("div")).html(e).text():__webpack_require__(301).default(e)}function isLegacyFITStyle(e){return!e.hasOwnProperty("Sentence")||null==e.Sentence||""===e.Sentence.trim()}function getFITText(e){return isLegacyFITStyle(e)?e.Question:e.Sentence}function checkFillInText(e,t,n){var r=e["case-sensitive"];function o(e,t){return"text"===e.type?function(e,t){if(""===t)return-1;var n=toText(e.typeconfig);return""===n?-2:matchesOneOfAnswers(t,n,r)?1:0}(e,t):"select"===e.type?function(e,t){return null==t||"-"===t?-1:""!==t||function(e){for(var t=e.split(/\|\||##/,1),n=0;n<t.length;++n)if(""===t[n])return!0;return!1}(e.typeconfig)?t===toText((n=e.typeconfig,(r=n.split(/\|\||##/,1)).length>0?r[0].trim():""))?1:0:-1;var n,r}(e,t):null}var a=0,i=[];processFillInText(getFITText(e),function(e,n){if(null!==n)if(a<t.length){var r=o(n,t[a++].trim());null!==r&&i.push(r)}else console.error("Error: FIT has more input fields than answers")});var s=getWeight(e["scoring-weight"]),c=i;return{correctness:i=mergeCorrectness(c,n),autoCorrectness:c,score:arrayCount(i,1)*s,outof:i.length*s}}function parseDragWordsInSentenceItem(e){return e}function processDragWordsInSentence(e,t){return processMarkedHtmlText(e,t,parseDragWordsInSentenceItem)}function checkDragWordsInSentence(e,t,n){var r=0,o=[];processDragWordsInSentence(e.Sentence,function(e,n){if(null!==n)if(r<t.length){var a=function(e,t){return""===t?-1:t.trim()===e.trim()?1:0}(n,t[r++].trim());null!==a&&o.push(a)}else console.error("Error: DWIS has more input fields than answers")});var a=getWeight(e["scoring-weight"]),i=o;return{correctness:o=mergeCorrectness(i,n),autoCorrectness:i,score:arrayCount(o,1)*a,outof:o.length*a}}function stripGroupElemPath(e){var t=e.lastIndexOf("/");if(-1===t)return e;var n=e.lastIndexOf("/",t-1);return-1===n?e.substr(t):e.substr(n)}function cleanGroupElemPaths(e){var t=cloneDeep(e);return"Image"===e.Type?each(e.image.sources,function(e,n){t.image.sources[n].src=stripGroupElemPath(e.src)}):"Audio"===e.Type&&(t.audio=stripGroupElemPath(e.audio)),t}function groupKey(e){return JSON.stringify(map(e,function(e){return stringify(cleanGroupElemPaths(e))}).sort())}function checkGroup(e,t,n){var r=[],o=[];if(Math.max.apply(0,map(t,function(e){return e.length}))<=1)r=fill(Array(e.groups.length),-1),o=fill(Array(t.length),-1);else{var a=map(e.groups,function(e){return groupKey(e.elements||[])}),i=map(t,function(e){return groupKey(e)});r=map(a,function(e){return-1===i.indexOf(e)?0:1}),o=map(i,function(e){return-1===a.indexOf(e)?0:1})}var s=mergeCorrectness(r,n),c=getWeight(e["scoring-weight"]);return{correctness:s,autoCorrectness:r,score:arrayCount(s,1)*c,outof:s.length*c,answerCorrectness:o}}function parseMarkSentenceItem(e){var t=trimAll(e.split(":"));return{type:""!==t[0]?t[0]:"???",word:t.length>1?t[1]:"???"}}function processText(e,t,n){for(var r="",o=0;o<e.length;++o){var a=e.charAt(o);/[\s]/.test(a)||/[~`!#$%\^&*+=\-\[\]\\;,.\/{}()|\\":<>\?]/.test(a)?(r.length>0&&(t(r),r=""),n(a)):r+=a}r.length>0&&t(r)}function processMarkedNoHtmlText(e,t,n){for(var r=0,o=e.indexOf("<<");o>=0;){t(e.substring(r,o));var a=e.indexOf(">>",o);if(a<0){r=e.length;break}n(e.substring(o+2,a)),r=a+2,o=e.indexOf("<<",a)}t(e.substring(r))}function processMarkSentence(e,t,n,r){processMarkedNoHtmlText(e,function(e){processText(e,n,t)},function(e){r(parseMarkSentenceItem(e))})}function checkMarkSentence(e,t,n,r){n=[];var o=0,a=null,i=0,s=0,c=0,l=arrayCount(t,"")===t.length;processMarkSentence(e.Sentence,function(){},function(){l?n.push(-1):""===t[o]?(n.push(1),a=""):(n.push(0),t[o]!==a&&(++i,a=t[o])),++o},function(e){++c,l?n.push(-1):t[o]===e.type?(++s,n.push(1),a=""):(n.push(0),a=t[o]),++o});var d=getWeight(e["scoring-weight"]),u=n;return{correctness:n=mergeCorrectness(u,r),autoCorrectness:u,score:Math.max(0,s-i)*d,outof:d*c}}function checkFillInTable(e,t,n){function r(e,n){for(var r=0;r<t.length;++r){var o=t[r];if(o.row===e&&o.column===n)return o.value.trim()}return null}for(var o=e["case-sensitive"],a=e.tabledata,i=[],s=[],c=a&&a.values?a.values:[],l=0;l<c.length;++l)for(var d=c[l],u=0;u<d.length;++u){var p=d[u];if(p.hasOwnProperty("CellRole"))if("input"===p.CellRole)null===(f=r(l,u))||""===f?(i.push(-1),s.push({row:l,column:u,answer:"",correctness:-1})):(i.push(-2),s.push({row:l,column:u,answer:f,correctness:-2}));else if("checked"===p.CellRole){var f=r(l,u),h=p.value;if(""===f&&""===h){i.push(1),s.push({row:l,column:u,answer:"",correctness:1});continue}if(null===f||""===f){i.push(-1);var g={row:l,column:u,answer:"",correctness:-1};""!==h&&(g.correct=h),s.push(g);continue}if(""===p.value){i.push(-2),s.push({row:l,column:u,answer:f,correctness:-2});continue}matchesOneOfAnswers(f,p.value,o)?(i.push(1),s.push({row:l,column:u,answer:f,correct:h,correctness:1})):(i.push(0),s.push({row:l,column:u,answer:f,correct:h,correctness:0}))}}var v=getWeight(e["scoring-weight"]),m=i;return{correctness:i=mergeCorrectness(m,n),autoCorrectness:m,correctioninfo:s,score:arrayCount(i,1)*v,outof:i.length*v}}function checkAnnotatePicture(e,t,n){for(var r=[],o=e["case-sensitive"],a=e.EditFields?e.EditFields:[],i=0;i<a.length;++i){var s=a[i],c=t[i].trim();""===c?r.push(-1):s.Valid&&""!==s.Valid?matchesOneOfAnswers(c,s.Valid,o)?r.push(1):r.push(0):r.push(-2)}var l=getWeight(e["scoring-weight"]),d=r;return{correctness:r=mergeCorrectness(d,n),autoCorrectness:d,score:arrayCount(r,1)*l,outof:r.length*l}}function checkSingleLine(e,t,n){t=t.trim();var r,o=getWeight(e["scoring-weight"]);if(""===t)r=-1;else{var a=e.Valid;if(""===a)r=-2;else r=matchesOneOfAnswers(t,a,e["case-sensitive"])?1:0}var i=mergeCorrectness(r,n);return{correctness:i,autoCorrectness:r,score:1===i?o:0,outof:o}}function pictureId(e){var t=e.hasOwnProperty("filename")?e.filename:e;return e.hasOwnProperty("origbase")?e.origbase:t}function wordId(e){return e}function audioId(e,t){return t+""}function allCorrect(e){return arrayCount(e.correctness,1)===e.correctness.length}function checkPictureOrdering(e,t,n){for(var r=getWeight(e["scoring-weight"]),o=[],a=0;a<t.length;++a)null===t[a]?o.push(-1):t[a]===pictureId(e.Pictures[a])?o.push(1):o.push(0);var i=o,s=(o=mergeCorrectness(i,n),e.policy);return{correctness:o,autoCorrectness:i,score:scoreForPolicyAndWeight(o,s,r),outof:maxForPolicyAndWeight(o,s,r)}}function checkWordOrdering(e,t,n){var r=getWeight(e["scoring-weight"]);if("each"===e.policy){for(var o=[],a=0;a<e.Words.length;++a)null===t?o.push(-1):t[a]===e.Words[a]?o.push(1):o.push(0);return{correctness:o=mergeCorrectness(i=o,n),autoCorrectness:i,score:arrayCount(o,1)*r,outof:o.length*r}}if(null===t)return{correctness:o=mergeCorrectness(i=-1,n),autoCorrectness:i,score:0,outof:r};var i,s="Sentences"===e.order_type?"\n":" ",c=e.Words.join(s),l=t.join(s),d=!1;if(l===c)d=!0;else if(e.AlternateAnswers){var u=e.AlternateAnswers;for(a=0;a<u.length;++a)l.replace(/ /g,"")===u[a].replace(/ /g,"")&&(d=!0)}return{correctness:o=mergeCorrectness(i=o=d?1:0,n),autoCorrectness:i,score:o*r,outof:r}}function isDistractor(e){return""===e}function checkMatch(e,t,n,r,o){for(var a=[],i=e.pairs?e.pairs:[],s=0;s<i.length;++s){var c=i[s],l=n(c.source,s);if(!isDistractor(l)){for(var d=r(c.target),u=!1,p=0;p<t.length;++p)if(t[p].source===l){t[p].target===d?a.push(1):a.push(0),u=!0;break}u||(isDistractor(d)?a.push(2):a.push(-1))}}var f=arrayCount(a,1)>0||arrayCount(a,0)>0?1:-1;for(s=0;s<a.length;++s)2===a[s]&&(a[s]=f);var h=getWeight(e["scoring-weight"]),g=a;return{correctness:a=mergeCorrectness(g,o),autoCorrectness:g,score:arrayCount(a,1)*h,outof:a.length*h}}function checkWordMatch(e,t,n){return checkMatch(e,t,wordId,wordId,n)}function checkWordPictureMatch(e,t,n){return checkMatch(e,t,wordId,pictureId,n)}function checkPicturePictureMatch(e,t,n){return checkMatch(e,t,pictureId,pictureId,n)}function checkAudioWordMatch(e,t,n){return checkMatch(e,t,audioId,wordId,n)}function checkAudioPictureMatch(e,t,n){return checkMatch(e,t,audioId,pictureId,n)}function checkDragDrop(e,t,n,r){for(var o=getWeight(e["scoring-weight"]),a=[],i=e.Boxes?e.Boxes:[],s=0;s<i.length;++s){var c=i[s],l=toText(c.name);if(c.Items)for(var d=0;d<c.Items.length;++d){var u=n(c.Items[d]);a.push({pair:[u,l],correct:!1,answer:null})}}var p=[];for(s=0;s<t.length;++s)p.push({pair:t[s],used:!1});for(s=0;s<a.length;++s){var f=a[s];for(d=0;d<p.length;++d){if(!(h=p[d]).used&&(f.pair[0]===h.pair[0]&&f.pair[1]===h.pair[1])){f.correct=!0,f.answer=h.pair[1],h.used=!0;break}}}for(s=0;s<a.length;++s){if(!(f=a[s]).correct)for(d=0;d<p.length;++d){var h;if(!(h=p[d]).used&&f.pair[0]===h.pair[0]){f.answer=h.pair[1],h.used=!0;break}}}var g=!1;for(s=0;s<a.length;++s){if(null!==(f=a[s]).answer){g=!0;break}}if(g)for(s=0;s<a.length;++s){null===(f=a[s]).answer&&""===f.pair[1]&&(f.correct=!0,f.answer="")}var v=[];for(s=0;s<a.length;++s){(f=a[s]).correct?v.push(1):null===f.answer?v.push(-1):v.push(0)}var m=e.policy,w=(o=getWeight(e["scoring-weight"]),v);return{correctness:v=mergeCorrectness(w,r),autoCorrectness:w,items:a,score:scoreForPolicyAndWeight(v,m,o),outof:maxForPolicyAndWeight(v,m,o)}}function checkPictureDragDrop(e,t,n){return checkDragDrop(e,t,pictureId,n)}function checkTextDragDrop(e,t,n){return checkDragDrop(e,t,wordId,n)}function checkWhiteboard(e,t,n){var r,o=getWeight(e["scoring-weight"]);return t?{correctness:mergeCorrectness(r=-2,n),autoCorrectness:r,score:0,outof:o}:{correctness:mergeCorrectness(r=-1,n),autoCorrectness:r,score:0,outof:o}}function checkPhoto(e,t,n){var r=getWeight(e["scoring-weight"]),o=t?-2:-1;return{correctness:mergeCorrectness(o,n),autoCorrectness:o,score:0,outof:r}}function splitNumberAndMetric(e){var t,n=/^ *([0-9.,]+) *(E|P|T|G|M|k|h|da|d|c|m|u|n|p|f|a)?([^\d]+) *$/.exec(e);if(null===n)return null;switch(n[2]){case void 0:t=0;break;case"E":t=18;break;case"P":t=15;break;case"T":t=12;break;case"G":t=9;break;case"M":t=6;break;case"k":t=3;break;case"h":t=2;break;case"da":t=1;break;case"d":t=-1;break;case"c":t=-2;break;case"m":t=-3;break;case"u":t=-6;break;case"n":t=-9;break;case"p":t=-12;break;case"f":t=-15;break;case"a":t=-18}return{value:n[1],prefix:n[2],scale:t,unit:n[3]}}function getMatrixDimensions(e){if(null==e)return null;for(var t=e.length,n=1,r=0;r<t;++r){var o=e[r].split(" ");n=Math.max(n,o.length)}return{rows:t,columns:n}}function checkNumeric(questionconfig,answer,overrideCorrectness){function evalAnswerExpression(expr,val,unit){try{if(void 0!==unit&&""!==unit){var unitinfo=splitNumberAndMetric("0"+unit);if(null!==unitinfo){var valinfo=splitNumberAndMetric(val);if(null===valinfo)return!1;if(valinfo.unit!==unitinfo.unit)return!1;val=valinfo.value*Math.pow(10,valinfo.scale-unitinfo.scale)}}return expr=expr.replace(/NOT/g,"!"),expr=expr.replace(/AND/g,"&&"),expr=expr.replace(/OR/g,"||"),expr=expr.replace(/X/g,val),!0===eval(expr)}catch(e){return console.log("Problem calculating expression, returning false",expr,val),!1}}var answerstyle=questionconfig.answer_style,correctness;if("Single"===answerstyle){var val=answer.single;if(""===val)correctness=-1;else{var compareval=questionconfig.single_number;if(null!=compareval&&(compareval=compareval.trim()),""===compareval)correctness=-2;else if(isNaN(compareval)&&isNaN(compareval.replace(",",".")))correctness=evalAnswerExpression(compareval,val.replace(",","."),questionconfig.unit)?1:0;else if(void 0!==questionconfig.unit&&""===questionconfig.unit){var valinfo=splitNumberAndMetric(val);correctness=null===valinfo&&parseFloat(val.replace(",","."))===parseFloat(compareval.replace(",","."))?1:0}else{var valinfo=splitNumberAndMetric(val),unitinfo=splitNumberAndMetric("0"+questionconfig.unit);correctness=null===valinfo||null===unitinfo||valinfo.unit!==unitinfo.unit||parseFloat(val.replace(",","."))*Math.pow(10,valinfo.scale-unitinfo.scale)!==parseFloat(compareval.replace(",","."))?0:1}}}else{var values=[],comparevals=[];if("Fraction"===answerstyle)values.push(answer.numerator),values.push(answer.denominator),comparevals.push(questionconfig.numerator),comparevals.push(questionconfig.denominator);else if("Mixed"===answerstyle)values.push(answer.wholenumber),values.push(answer.numerator),values.push(answer.denominator),comparevals.push(questionconfig.whole_number),comparevals.push(questionconfig.numerator),comparevals.push(questionconfig.denominator);else if("Exponential"===answerstyle)values.push(answer.base),values.push(answer.exponent),comparevals.push(questionconfig.base),comparevals.push(questionconfig.exponent);else{if("Matrix"!==answerstyle)return console.error("Wrong type for Numeric question type: ",answerstyle),null;var dim=getMatrixDimensions(questionconfig.matrix);if(null!=dim)for(var i=0;i<dim.rows;++i)for(var columns=questionconfig.matrix[i].trim().split(" "),j=0;j<dim.columns;++j)values.push(answer["c_"+i+"_"+j]),comparevals.push(columns[j])}for(var empty=!0,correct=!0,open=!1,i=0;i<values.length;++i){""!==values[i]&&(empty=!1);var compareval=comparevals[i];null!=compareval&&(compareval=compareval.trim()),""===compareval&&(open=!0),compareval!==values[i]&&(correct=!1)}correctness=empty?-1:open?-2:correct?1:0}var weight=getWeight(questionconfig["scoring-weight"]),autoCorrectness=correctness,correctness=mergeCorrectness(autoCorrectness,overrideCorrectness);return{correctness:correctness,autoCorrectness:autoCorrectness,score:1===correctness?weight:0,outof:weight}}function checkBalanceChemicalEquation(e,t,n){var r=[];function o(e,t){for(var n=0;n<e.length;++n){var o=e[n];""===o?r.push(-1):r.push(parseInt(o.value)===t[o.row].qty?1:0)}}switch(e.SubType){case"type1":case"type2":""===t.balanced?r.push(-1):chemistryparser.isBalanced(e.Equation)===("yes"===t.balanced)?r.push(1):r.push(0);var a=chemistryparser.parseEquation(e.Equation),i=chemistryparser.reduceReactantsAndProducts(a);o(t.reactantsTable,i.reactants),o(t.productsTable,i.products);break;case"type3":for(var s=(a=chemistryparser.parseEquation(e.Equation)).reactants.concat(a.products),c=0;c<t.length;++c)r.push(s[c].qty===parseInt(t[c])?1:0)}var l=getWeight(e["scoring-weight"]),d=r;return{correctness:r=mergeCorrectness(d,n),autoCorrectness:d,score:arrayCount(r,1)*l,outof:r.length*l}}function checkIonicCompoundBuilder(e,t,n){var r=chemistryparser.parseFormula(e.Valid),o=t.posIons.concat(t.negIons),a=chemistryparser.joinIonsToFormula(o),i=chemistryparser.totalCharge(o);s=0===a.length?-1:0!==i?0:chemistryparser.equalFormulas(a,r)?1:0;var s,c=getWeight(e["scoring-weight"]),l=s;return{correctness:s=mergeCorrectness(l,n),autoCorrectness:l,score:1===s?c:0,outof:c}}function htmlToString(e){for(var t=[],n=e.split("<br>"),r=0;r<n.length;++r)t.push(toText(n[r]));return t.join("\n")}function processCorrectSentence(e,t,n,r,o){function a(e){t?o(e,e):r(e,e)}processMarkedNoHtmlText(htmlToString(e),function(e){return processText(e,a,n)},function(e){var t=e.split("/");2===t.length?o(t[0],t[1]):o(e,e)})}function checkCorrectSentence(e,t,n){var r=[],o=[],a=[],i=e["case-sensitive"],s="each"===e.policy,c=0;processCorrectSentence(e.Sentence,"yes"===e["all-words-editable"],function(){},function(){},function(e,n){var l=t[c++];s?matchesOneOfAnswers(l,n,i)?(o.push(1),r.push(l),a.push(1)):l===e?(o.push(-1),r.push(l),a.push(1)):(o.push(0),r.push(l),a.push(1)):matchesOneOfAnswers(l,n,i)?n!==e?(a.push(1),o.push(1),r.push(l)):(a.push(-1),o.push(1),r.push(l)):l===e?(a.push(1),o.push(-1),r.push(l)):e!==n?(o.push(0),r.push(l),a.push(1)):(o.push(0),r.push(l),a.push(-1))});var l=getWeight(e["scoring-weight"]),d=o,u=(o=mergeCorrectness(d,n),arrayCount(a,1)),p=0;for(c=0;c<a.length;++c)1===a[c]?1===o[c]&&++p:1!==o[c]&&--p;return p=Math.max(0,p),{correctness:o,autoCorrectness:d,score:p*l,answers:r,outof:u*l}}var check={TextDescription:checkTextDescription,TextMultpleChoice:checkTextMultipleChoice,RatedMultipleChoice:checkRatedMultipleChoice,TextMultiSelect:checkTextMultiSelect,QuestionTable:checkQuestionTable,PictureMultpleChoice:checkPictureMultipleChoice,PictureMultiSelect:checkPictureMultiSelect,MultiLine:checkMultiLine,RichText:checkRichText,ExtraMultiLine:checkExtraMultiLine,ExtraCheckbox:checkExtracheckbox,FillInText:checkFillInText,FillInTable:checkFillInTable,AnnotatePicture:checkAnnotatePicture,SingleLine:checkSingleLine,PictureOrdering:checkPictureOrdering,WordOrdering:checkWordOrdering,Match:checkMatch,WordMatch:checkWordMatch,WordPictureMatch:checkWordPictureMatch,AudioWordMatch:checkAudioWordMatch,AudioPictureMatch:checkAudioPictureMatch,PicturePictureMatch:checkPicturePictureMatch,DragDrop:checkDragDrop,TextDragDrop:checkTextDragDrop,PictureDragDrop:checkPictureDragDrop,Whiteboard:checkWhiteboard,Photo:checkPhoto,Numeric:checkNumeric,BalanceChemicalEquation:checkBalanceChemicalEquation,IonicCompoundBuilder:checkIonicCompoundBuilder,CorrectSentence:checkCorrectSentence,DragWordsInSentence:checkDragWordsInSentence,Group:checkGroup,MarkSentence:checkMarkSentence};function linkifyLinks(e){return e.replace(/\b(?:https?):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,'<a href="$&" target="_blank" class="weblink">$&</a>')}function isNotAutoCorrectingQuestionType(e){return-1!==indexOf(["RichText","Photo","Whiteboard"],e)}return{check:check,linkifyLinks:linkifyLinks,allCorrect:allCorrect,pictureId:pictureId,processFillInText:processFillInText,processCorrectSentence:processCorrectSentence,processDragWordsInSentence:processDragWordsInSentence,processMarkSentence:processMarkSentence,matchesOneOfAnswers:matchesOneOfAnswers,prepareForCompare:prepareForCompare,removeDiacritics:removeDiacritics,getWeight:getWeight,getFITText:getFITText,isLegacyFITStyle:isLegacyFITStyle,getMatrixDimensions:getMatrixDimensions,isNotAutoCorrectingQuestionType:isNotAutoCorrectingQuestionType}},"function"==typeof bwdefine?bwdefine("bw/check_answer",["bw/chemistryparser"],factory):"object"===_typeof(module)&&module.exports&&(module.exports=factory(__webpack_require__(87)))}).call(this,__webpack_require__(12)(module))},function(e,t,n){var r=n(21);e.exports=function(e,t,n,o,a){function i(o,i){var s=e.getParameters();delete s.design,delete s.content,delete s.translation,a.isEmbeddedLTIAuthenticated()&&(s.lti_authenticated=1);var c,l,d,u=n.getProviderId(),p=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search;if(null==s.login_hint&&u&&""!==u&&(window.location.search.length>1?p+="&":p+="?",p+="login_hint="+encodeURIComponent(u)),p+=e.getHash(),""===o||"?"===o.charAt(0))return t.showAlert("The widget is not included.","Broken link"),o;function f(e){return-1===e.indexOf("?")?"?":"&"}if(i&&(o+=f(o)+"backlink="+encodeURIComponent(p),window.bwbackbuttonlabel&&(o+="&backbutton="+encodeURIComponent(window.bwbackbuttonlabel))),o.indexOf("/play/")>=0)s.q&&""!==s.q&&(o+=f(o)+(c=s.q,l="context_id",d=r.isArray(l)?l:[l],r.filter(c.split("&"),function(e){for(var t=0;t<d.length;++t)if(e.startsWith(d[t]+"="))return!1;return!0}).join("&"))),null!=s.toplevel&&(o+=f(o)+"toplevel="+encodeURIComponent(s.toplevel)),u&&""!==u&&(o+=f(o)+"login_hint="+encodeURIComponent(u));else{var h={},g={};for(var v in s)"sid"!==v&&s.hasOwnProperty(v)&&(e.LEGACY_HASH_PARAMETERS.indexOf(v)>=0?h[v]=s[v]:g[v]=s[v]);u&&""!==u&&(h.login_hint=u),Object.keys(g).length>0&&(o+=f(o)+e.urlencode(g)),Object.keys(h).length>0&&(o+="#"+e.urlencode(h))}return o}function s(e,t,n){if(console.log("Widget link: "+e),e=i(e,t),n){var r=o(n.target),a=0===r.length?{left:0,top:0}:r.offset(),s=r.clone();o("body").append(s),s.css({position:"absolute",left:a.left+"px",top:a.top+"px",width:r.width()+"px",height:r.height()+"px","border-left":r.css("border-left"),"border-right":r.css("border-right"),"border-top":r.css("border-top"),"border-bottom":r.css("border-bottom"),"border-top-left-radius":r.css("border-top-left-radius"),"border-top-right-radius":r.css("border-top-right-radius"),"border-bottom-left-radius":r.css("border-bottom-left-radius"),"border-bottom-right-radius":r.css("border-bottom-right-radius"),"-webkit-border-top-left-radius":r.css("-webkit-border-top-left-radius"),"-webkit-border-top-right-radius":r.css("-webkit-border-top-right-radius"),"-webkit-border-bottom-left-radius":r.css("-webkit-border-bottom-left-radius"),"-webkit-border-bottom-right-radius":r.css("-webkit-border-bottom-right-radius"),"box-shadow":r.css("box-shadow"),"-webkit-box-shadow":r.css("-webkit-box-shadow")});s.css({"-webkit-transition":"all .5s linear","-moz-transition":"all .5s linear","-o-transition":"all .5s linear",transition:"all .5s linear","box-sizing":"border-box"});var c=o(document).width(),l=o(document).height(),d=c/r.width(),u=l/r.height(),p=d>u?u:d,f="translate("+(c/2-a.left-r.width()/2)+"px, "+(l/2-a.top-r.height()/2)+"px) scale("+p+")";s.css({"-webkit-transform":f,"-moz-transform":f,"-o-transform":f,transform:f,opacity:.1}),setTimeout(function(){window.location=e},500),r.closest("span[onclick]").attr("onclick","")}else window.location=e}function c(e){return null!=e&&-1!==e.indexOf("bookwidgets.com/play/")}return{isWidgetPlayLink:c,openLinkOrWidgetLink:function(e,t){if(c(e)){var n=-1===e.indexOf("?")?"?":"&";s(e+=n+"noiframe=1",t)}else window.location.href=e},processRichTextWidgetPlayLinks:function(e,t){e.find("a").filter(function(){return c(o(this).attr("href"))}).each(function(){var e=o(this),n=e.attr("href");console.log("make link widget play link",n);var r=-1===n.indexOf("?")?"?":"&";n+=r+"noiframe=1",e.before(o(document.createElement("div")).css("display","inline-block").tapOrClick(function(){return s(n,t),!1}).html(e.html())),e.after("&nbsp;"),e.hide()})},openWidget:s,addLinkIcon:function(e){o(document.createElement("div")).addClass("link-icon").css({width:"24px",height:"24px",position:"absolute",top:"10px",right:"10px",opacity:"0.6",background:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAA+JJREFUeAHlm8tLIzEcx2Nb67M3wZsXb7uw91UPHv0f/AdEEEEEUUQQRBBE0a4PfKJWEV+IiIgUEfHmraxXBa/e3NvCbjbf2oiPTZv5zWRm0gn8GoyTmXw+ySTttGHsc/oqiqZF3Il4FsEtDzCABUxgU6ak+E9axB8RtkOr2g82MIL1XUJBVoSqYrmVg/WdhB8RgpediZHAKkTgvsiJiImIUvorYL/FxcuQiO9RIi+wovN/4wUz5JdCYdSyOwjAMpGKGnmB9xcEYFKIbEpQyJubm1ljY6NW1YoKOKYnav1cLseenzG4Sye5LGjnTU1N/P7+noc5tbW1afGQlr7Hx0fW3t7OHh4eSusN+REkAWAqFwlkAeUiwZWAcpDgWoDtEjwRYLMEzwTYKsFTATZK8FyAbRKMCLBJgjEBtkgwKsAGCcYFhF2CLwLeSnh6esKfxpP4pKp1Dd8EoDUdHR2soaFBq2F+HeSbgK6uLra4uMioDzhMCfFFQHd3N5ufnw8dPKQaF9DT08Pm5uZCCW9cQG9vL5udnTU1ej07r9azM3E1R8f19fUF+siwtbVVt73OwHRE9Pf3BwqPiwcmYGBgIHD4wAQMDg6GAj4QAcPDw6GB913AyMiI5/C3t7dcfO9APq9vc8Do6Ci5kaqKNzc3PJVKcTffQPkiYGxsTMVALr++vub19fWvSxhVgnEB4+PjZEhVxaurK15XV/cKL5dcigSjAiYmJlQM5PLLy0teW1v7CZ4qwZiAyclJMqSqYjabLQpPkdDS0qKUKc9XyPXfCU5NTakYyOUXFxe8pqZGt7HaE6PnAmZmZsiQqorn5+e8urpaG172nM6c4KmAdDqtYiCXn52d8aqqKsfwuhI8ESCe3nDxWZ4Mqap4enrqCl5HgmsBgBePsFQM5PKTkxOeTCbJPS/hZa66HVwJAPzS0hIZUlXx+PjYU/hiElwJ6OzsVDGQy4+OjnhlZaVnPS/hZf5xJLgS4PXwPzg44IlEwhj8/yS4EoATQsLy8jK5x2XFvb09X+A/SnAtQEpYXV2VLI7z3d1dHo/Hjfe8hJc5bgfxY07d6xZ/JxiLxfj6+rpj+O3t7UDgpQQHeXEBOBEkbG5uakvY2tqyBR6jpLQAKSGTyZSUsLGxkReme94QHKcnAA3F/byzs6OUsLa2Zhu8/giQPQUJmNw+ppWVlfzKIY+zKHe+NxBr+v7+/qsDvGvEsmkRtGxr/vf02DIjC7RzSDg8POQLCwu2woP1p4j8jkpt8LeyIMHSnpe809jOEeltcxgBSJHdOPmC/7KNNNJbZyECe2kxEiK5eRoCZMKcEJnt8/8AtqIJGXRoCukAAAAASUVORK5CYII=)","background-size":"cover"}).appendTo(e)},widgetCoverImage:function(e){return e?e.replace("/play/","/cover/"):null}}}(n(11),n(9),n(134),n(0),n(62))},function(e,t,n){e.exports=(n(1),function(e){try{return window.bwlocalizationmap&&window.bwlocalizationmap[e]&&""!==window.bwlocalizationmap[e]?window.bwlocalizationmap[e]:e}catch(t){return e}})},function(e,t,n){e.exports=function(e){return{getImageSize:function(e,t){var n=new Image;n.onload=function(){var e=this.width,n=this.height;t(e,n)},n.onerror=function(){t()},n.src=e},processRichTextImages:function(t){t.find("img").attr({height:"",draggable:"false"}).css("max-width","100%").each(function(){var t=e(this),n=t.css("float");"left"===n?t.css({"margin-right":"10px","margin-bottom":"10px"}):"right"===n&&t.css({"margin-left":"10px","margin-bottom":"10px"})})},calculateScaleAndOffset:function(e,t,n,r,o){var a,i,s,c,l,d;return"Cover entire area, keep aspect ratio"===e?((l=t/r)<(d=n/o)?(a=d,i=d):(a=l,i=l),s=(t-r*a)/2,c=(n-o*i)/2):"Contain entire picture, keep aspect ratio"===e?((l=t/r)>(d=n/o)?(a=d,i=d):(a=l,i=l),s=(t-r*a)/2,c=(n-o*i)/2):"Cover entire area with entire picture"===e?(s=0,c=0,a=t/r,i=n/o):(a=1,i=1,s=(t-r)/2,c=(n-o)/2),{scale_x:a,scale_y:i,offset_x:s,offset_y:c}}}}(n(0))},function(e,t,n){e.exports=function(e,t){function n(n,r,o,a,i){i=i||i+" custom_alert",o=o||e("Ok"),r=r||"Alert",n=n||"No Message to Display";var s=t("<div></div>"),c={};return c[o]=function(){t(this).dialog("close"),t(this).remove(),a&&a()},s.html(n).dialog({title:r,dialogClass:"bw-dialog no-close "+i,resizable:!1,modal:!0,width:"auto",buttons:c}),s}return{showAlert:n,navigateAlert:function(e,r,o,a){var i=n(e,r,o,function(){});return i.parent().find("button").replaceWith(t(document.createElement("a")).html(o).attr({href:a,target:"_top"}).addClass("ui-button")),i},showCriticalAlert:function(e,r){var o={message:e,title:r};function a(){n(o.message,o.title)}0===t("#critical-alert-button").length&&t('<div id="critical-alert-button" class="bw-toolbutton"><div class="bw-icon bw-icon-critical-error"></div></div>').prependTo(t("#title-toolbar")).click(a),a()},showFatalAlert:function(e,n){t("<div></div>").html(e).dialog({title:n,dialogClass:"bw-dialog no-close",resizable:!1,modal:!0,width:"auto"})},showConfirmationDialog:function(e,n,r,o,a,i){n||(n="Please confirm"),e||(e=""),a||(a="OK"),i||(i="Cancel"),t("#BwConfirmationDalog").remove();var s=t('<div id="BwConfirmationDialog"></div>'),c={};return c[a]=function(){t(this).dialog("close"),t(this).remove(),r&&r()},c[i]=function(){t(this).dialog("close"),t(this).remove(),o&&o()},s.html(e).dialog({title:n,dialogClass:"bw-dialog BwConfirmationDialog no-close",resizable:!1,modal:!0,width:500,buttons:c}),s}}}(n(7),n(0))},,function(e,t){e.exports=function(){var e=["context_id","course_id","hide_account","lfq","lti","login_hint","no_logout","q","sso","smartschool_platform","student_class_id","submit_url","teacher_email","teacher_id"];function t(e){var t=[];if("[object Array]"===Object.prototype.toString.call(e))for(var n=0;n<e.length;++n){var r=e[n];r.length>1?t.push(encodeURIComponent(r[0])+"="+encodeURIComponent(r[1])):t.push(encodeURIComponent(r[0]))}else for(var o in e)e.hasOwnProperty(o)&&t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")}function n(e){for(var t={},n=e.split("&"),r=0;r<n.length;r++){var o=n[r].indexOf("=");if(!(o<0)){var a=[n[r].substr(0,o),n[r].substr(o+1)],i=decodeURIComponent(a[0]);if(void 0===t[i])t[i]=decodeURIComponent(a[1]);else if("string"==typeof t[i]){var s=[t[i],decodeURIComponent(a[1])];t[i]=s}else t[i].push(decodeURIComponent(a[1]))}}return t}function r(e){for(var t=[],n=e.split("&"),r=0;r<n.length;r++){var o=n[r].indexOf("=");if(o<0)t.push([n[r]]);else{var a=[n[r].substr(0,o),n[r].substr(o+1)];t.push([decodeURIComponent(a[0]),decodeURIComponent(a[1])])}}return t}function o(e){return!e||e.length<1||"?"!==e[0]?{}:n(e.substr(1))}function a(e){return!e||e.length<1||"?"!==e[0]?[]:r(e.substr(1))}function i(e,t){return e.split("&").filter(function(e){return decodeURIComponent(e.split("=")[0])!==t}).join("&")}function s(e){return(e=e||window.location.href).indexOf("#")>=0?"#"+(e.split("#")[1]||""):""}!function(){var n=a(window.location.search),o=[],i=s();if(i.length>=1&&"#"===i[0])for(var c=r(i.substr(1)),l=0;l<c.length;++l){var d=c[l];e.indexOf(d[0])>=0?n.push(d):o.push(d)}var u=window.location.pathname;n.length>0&&(u+="?"+t(n)),o.length>0&&(u+="#"+t(o)),"undefined"!=typeof history&&history.replaceState("",document.title,u)}();var c=s(),l=window.location.search;return{split:n,splitList:r,getUrlParams:function(e){return-1===e.indexOf("?")?{}:n(e.replace(/[^\?]*\?/,"").replace(/#.*/,""))},getQueryParams:o,getParameters:function(){var e=o(l),t=function(e){return!e||e.length<1||"#"!==e[0]?{}:n(e.substr(1))}(c);for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},removeQueryStringParameter:function(e,t){return e.length>0&&("?"===e[0]||"#"===e[0])?e[0]+i(e.substring(1),t):i(e,t)},updateWindowQueryParameter:function(e,n){for(var r=a(window.location.search),o=!1,i=0;i<r.length;++i)if(r[i][0]===e){r[i].length>1?r[i][1]=n:r[i].push(n),o=!0;break}o||r.push([e,n]),history.replaceState("",document.title,window.location.pathname+"?"+t(r)+s())},urlencode:t,getHash:s,LEGACY_HASH_PARAMETERS:e}}()},,,,,,,,,function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){return"string"==typeof(t=e)||"object"===n(t)&&t.constructor===String?0===e.indexOf("http://")||0===e.indexOf("https://")||0===e.indexOf("//")?e.replace(/\(/g,"_").replace(/\)/g,"_").replace(/'/g,"%27"):encodeURIComponent(e).replace(/%2F/g,"/").replace(/'/g,"%27"):"";var t}},,function(e,t){e.exports=function(){var e={0:"debug",1:"info",2:"error"};function t(t,n,r){return n>=r?function(){!function(t,n,r){var o=Array.prototype.slice.call(r);o.unshift(t+" ("+e[n]+"):"),console.log.apply(console,o)}(t,n,arguments)}:function(){}}return{DEBUG:0,INFO:1,ERROR:2,createLogger:function(e,n){return void 0===n&&(n=1),{debug:t(e,0,n),info:t(e,1,n),error:t(e,2,n)}}}}()},,,function(e,t,n){e.exports=function(e,t){return{createLabeledCheckbox:function(t,n,r){var o=e('<table class="bw-checkbox"></table>').appendTo(t),a=e("<tr></tr>").appendTo(o),i=e('<td class="bw-checkbox-cell"></td>').appendTo(a);return e('<div class="bw-checkbox-checkbox bw-icon bw-icon-accept" ></div>').appendTo(i),e('<td class="bw-button-label-cell"><div class="bw-button-label">'+n+"</div></td>").appendTo(a),o.bind("check",function(){e(this).attr({checked:"checked","aria-checked":"true"})}),o.bind("clear",function(){e(this).attr({checked:null,"aria-checked":"false"})}),o.makeButton({role:"checkbox"}).tapOrClick(function(){var t=e(this);"disabled"!==t.attr("disabled")&&("checked"===t.attr("checked")?(t.trigger("clear"),r&&r.call(t[0],!1)):(t.trigger("check"),r&&r.call(t[0],!0)))}),o.trigger("clear"),o},createProgressBar:function(t,n){var r={};r.parent=t,r.max=n,e('<div class="bw-progress-bar"></div>').css("left","-100%").appendTo(e(t));var o=100/n;return e('<div class="bw-progress-bar-marker"></div>').css({left:"-100%",width:o+"%"}).appendTo(e(t)),r.setProgress=function(n,r,o){r=r||400;var a=100*-(this.max-parseFloat(n))/this.max,i=e(this.parent+"> .bw-progress-bar"),s=e(t).width(),c=-(this.max-parseFloat(n))*s/this.max;i.css("left",i.css("left")),i.animate({left:c},r,"swing",function(){i.css("left",a+"%"),o&&o()})},r.setPosition=function(n,r){r=r||400;var o=e(this.parent+"> .bw-progress-bar-marker"),a=100*parseFloat(n)/this.max,i=e(t).width()*n/this.max;o.css("left",o.css("left")),o.animate({left:i},r,"swing",function(){o.css("left",a+"%")})},r.clear=function(){e(this.parent+" .bw-progress-bar").css("left","-100%"),e(this.parent+" .bw-progress-bar-marker").css("left","-100%")},r},createSimpleCheckbox:function(t,n,r){var o=e('<div class="bw-simple-checkbox bw-icon bw-icon-accept" ></div>').appendTo(e(t)),a={role:"checkbox"};return r&&(a.labelledby=r),o.bind("check",function(){e(this).attr({checked:"checked","aria-checked":"true"})}),o.bind("clear",function(){e(this).attr({checked:null,"aria-checked":"false"})}),o.makeButton(a).tapOrClick(function(){var t=e(this);"disabled"!==t.attr("disabled")&&("checked"===t.attr("checked")?(t.trigger("clear"),n&&n.call(t[0],!1)):(t.trigger("check"),n&&n.call(t[0],!0)))}),o.trigger("clear"),o},createNumberButtons:function(n,r,o,a,i){function s(t){if(e(".buttonslot").removeClass("selected"),r<=9)e("#BS_"+t).addClass("selected");else if(t<5){e("#BS_1").removeClass("hide_number"),e("#BS_7").addClass("hide_number");for(var n=1;n<8;++n)e("#BS_"+n).find(".number-button").html(n+1);e("#BS_"+t).addClass("selected")}else if(r-t<6){e("#BS_1").addClass("hide_number"),e("#BS_7").removeClass("hide_number");for(var o=2;o<8;++o)e("#BS_"+o).find(".number-button").html(r-8+o);e("#BS_"+(9-(r-t))).addClass("selected")}else{e("#BS_1").addClass("hide_number"),e("#BS_7").addClass("hide_number");for(var s=1;s<8;++s)e("#BS_"+s).find(".number-button").html(s+t-3);e("#BS_4").addClass("selected")}0===t?e(a).addClass("hidden"):e(a).removeClass("hidden"),t===r-1?e(i).addClass("hidden"):e(i).removeClass("hidden")}for(var c=0,l=Math.min(r,9),d=e(n),u=0;u<l;++u)e('<div class="buttonslot" id="BS_'+u+'"><div class="number-button bw-button">'+(u+1)+"</div></div>").appendTo(d).find(".number-button").makeButton().tapOrClick(function(){s(c=parseInt(e(this).html())-1),o(c)});function p(){--c<0&&(c=0),s(c),o(c)}function f(){++c>=r&&(c=r-1),s(c),o(c)}return r>9&&(e('<div class="ellipsis"></div>').appendTo(e("#BS_1")),e('<div class="ellipsis"></div>').appendTo(e("#BS_7")),e("#BS_7").addClass("hide_number"),e("#BS_7").find(".number-button").html(r-1),e("#BS_8").find(".number-button").html(r)),e("#BS_0").addClass("selected"),e(a).addClass("hidden"),e(a).makeButton(t("previous")).tapOrClick(p),e(i).makeButton(t("next")).tapOrClick(f),{updateButtons:s,next:f,prev:p}},createSimpleRadiobutton:function(t,n,r){var o=e('<div class="bw-simple-radiobutton bw-icon" ></div>').appendTo(e(t));o.bind("check",function(){e(this).attr({checked:"checked","aria-checked":"true"})}),o.bind("clear",function(){e(this).attr({checked:null,"aria-checked":"false"})});var a={role:"radio"};return r&&(a.labelledby=r),o.makeButton(a).tapOrClick(function(){var t=e(this);"disabled"!==t.attr("disabled")&&("checked"===t.attr("checked")?(t.trigger("clear"),n&&n.call(t[0],!1)):(t.trigger("check"),n&&n.call(t[0],!0)))}),o.trigger("clear"),o},createLabeledRadiobutton:function(t,n,r){var o=e('<table class="bw-radiobutton"></table>').appendTo(t),a=e("<tr></tr>").appendTo(o),i=e('<td class="bw-radiobutton-cell"></td>').appendTo(a);return e('<div class="bw-radiobutton-radiobutton bw-icon bw-icon-largedot" ></div>').appendTo(i),e('<td class="bw-button-label-cell"><div class="bw-button-label">'+n+"</div></td>").appendTo(a),o.bind("check",function(){e(this).attr({checked:"checked","aria-checked":"true"})}),o.bind("clear",function(){e(this).attr({checked:null,"aria-checked":"false"})}),o.makeButton({role:"radio"}).tapOrClick(function(){var t=e(this);"disabled"!==t.attr("disabled")&&("checked"===t.attr("checked")?(t.trigger("clear"),r&&r.call(t[0],!1)):(t.trigger("check"),r&&r.call(t[0],!0)))}),o.trigger("clear"),o},createProgressCircle:function(t,n,r){var o={},a=30,i=40,s=40;o.id=n,o.progress=Array(r);var c=e('<div class="bw-progress-circle bw-centering-container" id="'+n+'"></div>').appendTo(e(t));e('<div class="bw-progress-circle-text bw-centered"></div>').appendTo(c);var l=[];function d(e,t){if(-1===e)return"";var n=2*Math.PI*e/r,o=2*Math.PI*(e+1)/r,a=i+Math.sin(n)*t,c=s-Math.cos(n)*t,l=i+Math.sin(o)*t,d=s-Math.cos(o)*t;return"M X1 Y1 A R R 0 0 1 X2 Y2".replace("X1",a).replace("Y1",c).replace("X2",l).replace("Y2",d).replace("D",n).replace("R",t).replace("R",t)}function u(e){return'<path d="'+d(e,a)+'"/>'}for(var p=0;p<r;++p)l.push(u(p));return e('<svg class="bw-progress-circle-drawing" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 80 80">'+l.join("")+'<path class="the marker"/></svg>').appendTo(c),o.setProgress=function(t,n){e("#"+this.id+" path:nth-child("+(t+1)+")").attr("class",n)},o.setTextAndPosition=function(t,n){var r=e("#"+this.id+" .bw-progress-circle-text");r.animate({opacity:0},200,"swing",function(){r.html(t),r.animate({opacity:1},200)});var o=e("#"+this.id+" path.the.marker");o.animate({opacity:0},200,"swing",function(){o.attr("d",d(n,a)).animate({opacity:1},200)})},o}}}(n(0),n(7))},function(e,t){function n(e){return e.sort(function(){return.5-Math.random()})}var r={};e.exports={shuffleArray:n,randomIndexList:function(e){for(var t=[],r=0;r<e;++r)t.push(r);return n(t)},randomId:function(e){for(;;){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_-",o=0;o<e;o++)t+=n.charAt(Math.floor(Math.random()*n.length));if(!r.hasOwnProperty(t))return r[t]=!0,t}}}},,,,,,,function(e,t,n){e.exports=function(e,t,n,r){function o(e,t){return r('<svg class="'+e+'" xmlns="http://www.w3.org/2000/svg" version="1.1">'+t+"</svg>")}function a(e,t,n,r){return'<line x1="'+e+'" y1="'+t+'" x2="'+n+'" y2="'+r+'" />'}function i(n){var i=r(document.createElement("div")).addClass("bw-popup-zoomable-image"),s=r(document.createElement("div")).addClass("bw-zoomable-image").css({background:"black url("+n.replace(/ /g,"%20")+") no-repeat center center","background-size":"contain"}).appendTo(i);r("<div class='bw-button bw-popup-closebutton'></div>").append(r(document.createElement("div")).addClass("bw-icon-small bw-icon-close")).makeButton(t("close")).click(function(e){setTimeout(i.remove.bind(i),0)}).appendTo(i);var c=o("bw-zoomable-image-zoomin",a(14.5,4,14.5,26)+a(4,14.5,26,14.5)).appendTo(i),l=o("bw-zoomable-image-zoomout",a(4,14.5,26,14.5)).appendTo(i);e.bwMakeDragAndResizable(s,c,l),i.appendTo(r("body"))}return{create:function(e){var t,o,a=e.hasOwnProperty("img")?e.img:e,s=a.sources&&a.sources.length>0?n(a.sources[0].src):"",c=s;e.type&&"img"!==e.type?t=r(document.createElement("div")).attr("role","image").css({background:(e.background||"black")+" url("+s.replace(/ /g,"%20")+") no-repeat center center","background-size":(o=e.resize_policy,o?"Contain entire picture, keep aspect ratio"===o?"contain":"Cover entire area, keep aspect ratio"===o?"cover":"No resize"===o?"":"Cover entire area with entire picture"===o?"100% 100%":"contain":"contain")}):(t=r(document.createElement("img")),e.loadcb&&t.on("load",e.loadcb),t.attr("src",s));var l=a.alttext||e.alttext;return null!=l&&""!==l&&t.attr("alt",l),t.on("zoom",function(){i(c)}),e.disable_click||t.tapOrClick(function(){i(c)}),e.disable_press||t.hammer().on("press",function(){i(c)}),t},showPopup:i}}(n(292),n(7),n(20),n(0))},function(module,exports,__webpack_require__){module.exports=function(platform,qs,cssUpdater,printer,dialog,tr,$,uiComponents,uriEncodeImage,bwTool,adaptToPageProtocol,bwTouchHelpers){function getNakedURL(e){if(-1===e.indexOf("?"))return e;var t=/^([^\?]*)\?/.exec(e);if(t&&2===t.length)return t[1];throw Error("Shoudln't happen")}function setQueryParameters(e,t){if(t==={})return e;var n=getNakedURL(e),r=[];return $.each(t,function(e,t){r.push(e+"="+t)}),n+"?"+r.join("&")}function ShowBacklinkIfRequired(){var e=qs.getUrlParams(window.location.href);if(e.hasOwnProperty("backlink")){var t=e.backlink;(e.hasOwnProperty("backbutton")?$('<div class="widget-backlink widget-backlink-text">&#9664; '+e.backbutton+"</div>").appendTo($("body")):$('<div class="widget-backlink widget-backlink-icon"></div>').appendTo($("body"))).click(function(){var e=platform.getPlatform();if("ibw-platform-osx-preview"===e||"ibw-platform-win32-preview"===e)console.log("Moving back by using history.back()"),window.history.back();else{var n=window.location.origin;t.startsWith(n)&&(t=t.substr(n.length)),console.log("Moving back by setting window.location to: "+t),window.location=t}})}}var block_recurse_guard=!1;function centerWidgetTitle(e){if(!block_recurse_guard){var t=$("#top-container"),n=t.height(),r=t.width(),o=$(".closebutton-container"),a=$("#top-container .bw-toolbar");o.css("min-width",""),a.css("min-width","");var i=o.width(),s=a.width();if(a.css("min-width",i),o.css("min-width",s),$(".title-container").css("max-width",r-2*Math.max(i,s)),!0!==e&&$("#top-container").height()!==n){block_recurse_guard=!0;try{window.onresize&&window.onresize()}catch(e){console.error("Error when calling onResize during centerWidgetTitle"),console.error(e)}block_recurse_guard=!1}}}function hidePopupMenu(){$("#top-container").removeClass("bw-show-popup-menu"),$("#title-toolbar").appendTo($("#top-container .bw-toolbar")),$(".bw-menu-overlay").remove()}function createPopupToolbarIfRequired(){if(!($("#menubutton").length>0)){var e=$("#top-container .bw-toolbar");if(e.children(":not(.outside-popup)").length>1){e.removeClass("bw-toolbar");var t=$(document.createElement("div")).addClass("bw-toolbar").appendTo($(".titlebar-layout"));e.find(".outside-popup").each(function(){$(this).appendTo(t)}),e.appendTo(t).addClass("bw-button-group"),$('<div id="menubutton" class="bw-toolbutton"><div class="bw-icon bw-icon-menu"></div></div>').makeButton(tr("Menu")).tapOrClick(function(){$("#top-container").hasClass("bw-show-popup-menu")?hidePopupMenu():setTimeout(function(){$("#top-container").addClass("bw-show-popup-menu");var e=$(document.createElement("div")).addClass("bw-menu-overlay").appendTo("#container");setTimeout(function(){e.on("click touchend",function(){setTimeout(hidePopupMenu,500)})},350),$("#title-toolbar").appendTo(e)},100)}).appendTo(t)}}}function createTitleLayout(e,t,n){var r=$(e),o=$('<div id="container"></div>').prependTo(r).addClass("top-bottom-layout"),a=$('<div id="top-container"></div>').appendTo(o).addClass("top-container"),i=$("<div></div>").appendTo(a).addClass("titlebar-layout");return $('<div class="closebutton-container"></div>').appendTo(i),$('<div class="title-container"><span id="title"></span></div>').appendTo(i),n?$(n).addClass("bw-toolbar").appendTo(i):$('<div id="title-toolbar"></div>').addClass("bw-toolbar").appendTo(i),createPopupToolbarIfRequired(),$(t).appendTo(o).addClass("bottom-container"),centerWidgetTitle(),o}function prependToTitleToolbar(e){var t=$("#title-toolbar");e.prependTo(t),createPopupToolbarIfRequired(),centerWidgetTitle()}function openDebugWindow(){var debugwindow=$('<div class="bw-debug-window bw-row-container"></div>').appendTo("body"),debugoutput=$('<div class="bw-debug-output bw-row-resizing"></div>').appendTo(debugwindow);function appendOutput(e){e.appendTo(debugoutput),debugoutput[0].scrollTop=debugoutput[0].scrollHeight-debugoutput[0].getBoundingClientRect().height}function argsToString(e){for(var t=[],n=0;n<e.length;++n)t.push(JSON.stringify(e[n]));return t.join(" ")}$('<div class="bw-debug-close">X</div>').tapOrClick(function(){debugwindow.remove(),localStorage.removeItem("bw-debug-enabled")}).appendTo(debugwindow),console.log=function(){appendOutput($("<p></p>").html(argsToString(arguments)))},console.error=function(e,t){appendOutput($('<p style="color: red"></p>').html(argsToString(arguments)))},window.onerror=function(e,t,n){return appendOutput($('<p style="color: red"></p>').html(e+" ("+t+":"+n+")")),!0},console.log(platform.getPlatform(),navigator.platform,navigator.userAgent);var debuginput=$('<input class="bw-debug-input bw-row-fixed">').appendTo(debugwindow),commandlist=[],index=0;function exec(str){var goodstr=str.replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"');console.log(eval(goodstr)),commandlist.push(goodstr),index=commandlist.length}debuginput.keypress(function(e){13===(e.keyCode?e.keyCode:e.which)&&(exec(debuginput.val()),debuginput.val(""))}),debuginput.keydown(function(e){var t=e.keyCode?e.keyCode:e.which;38===t?index>0&&(--index,debuginput.val(commandlist[index])):40===t&&index<commandlist.length&&(++index===commandlist.length?debuginput.val(""):debuginput.val(commandlist[index]))});try{debugwindow.draggable()}catch(e){console.error("No drag support")}}function showDebugDialog(){if(!($(".bw-debug-window").length>0)){var e=$('<div class="bw-debug-wrapper"></div>').appendTo("body"),t=$('<div class="bw-debug-dialog"></div>').appendTo(e);$("<p>Enter your support key:</p>").appendTo(t);var n=$('<input placeholder="key"></input>').appendTo(t);$("<br><br>").appendTo(t),$('<button type="button">Cancel</button>').tapOrClick(function(){e.remove()}).appendTo(t),$('<button type="button">OK</button>').tapOrClick(function(){"bw-magic"===n.val()&&(openDebugWindow(),e.remove(),localStorage.setItem("bw-debug-enabled","true"))}).appendTo(t)}}function initializeDebugSupport(e){var t=0;e.clickOrHold(function(){t=0},function(){3==++t&&(showDebugDialog(),t=0)},2e3);try{"true"===localStorage.getItem("bw-debug-enabled")&&openDebugWindow()}catch(e){}}function makeWidget(e){e=e||{};var t=$("body");t.addClass("bw"),e.hasOwnProperty("no-user-select")&&!0===e["no-user-select"]&&t.addClass("no-user-select");var n,r=e.layout||"";if("title_layout"===r?(n=createTitleLayout("body","#bottom-container")).find(".top-container").addClass("title-only"):"title_overlay_layout"===r?((n=createTitleLayout("body","#bottom-container")).addClass("title-overlay"),n.find(".top-container").addClass("title-only")):n="title_toolbar_layout"===r?createTitleLayout("body","#bottom-container","#title-toolbar"):$("#container"),e.hasOwnProperty("title")&&""!==e.title){var o=n.find("#title");o.html(e.title),initializeDebugSupport(o)}else{var a=n.find(".top-container");a.addClass("title-empty"),initializeDebugSupport(a)}"ibw-platform-ipad-ibooks-epub"===platform.getPlatform()&&(e.hasOwnProperty("epubBlockTouchEndCheck")||(e.epubBlockTouchEndCheck=function(e){return e.srcElement instanceof SVGElement||$(e.srcElement).hasClass("epub-block")}),document.addEventListener("touchend",function(t){var n=$(window).width();(t.layerX<50||n-t.layerX<50||e.epubBlockTouchEndCheck(t))&&t.preventDefault()},!1),e.hasOwnProperty("epubBlockTouchStartCheck")&&document.addEventListener("touchstart",function(t){e.epubBlockTouchStartCheck(t)&&t.preventDefault()},!1)),ShowBacklinkIfRequired()}function getRoot(){return platform.isWebPreview()?window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/",window.location.pathname.lastIndexOf("/")-1)):""}return $(function(){var e=$("html");e.hasClass("ibw-platform-custom")||e.addClass(platform.getPlatform())}),window.custom_alert=dialog.showAlert,window.criticalAlert=dialog.showCriticalAlert,window.bw_confirmation_dialog=dialog.showConfirmationDialog,window.tr=tr,window.getUrlParams=qs.getUrlParams,window.getNakedURL=getNakedURL,window.setQueryParameters=setQueryParameters,window.createLabeledCheckbox=uiComponents.createLabeledCheckbox,window.createProgressBar=uiComponents.createProgressBar,window.createSimpleCheckbox=uiComponents.createSimpleCheckbox,window.createNumberButtons=uiComponents.createNumberButtons,window.createSimpleRadiobutton=uiComponents.createSimpleRadiobutton,window.createLabeledRadiobutton=uiComponents.createLabeledRadiobutton,window.createProgressCircle=uiComponents.createProgressCircle,window.URIEncodeImage=uriEncodeImage,window.BWAdaptToPageProtocol=adaptToPageProtocol,window.updateConfigCSS=bwTool.updateConfigCSS,{makeWidget:makeWidget,getNakedURL:getNakedURL,setQueryParameters:setQueryParameters,prependToTitleToolbar:prependToTitleToolbar,centerTitle:centerWidgetTitle,ShowBacklinkIfRequired:ShowBacklinkIfRequired,getRoot:getRoot}}(__webpack_require__(2),__webpack_require__(11),__webpack_require__(334),__webpack_require__(335),__webpack_require__(9),__webpack_require__(7),__webpack_require__(0),__webpack_require__(25),__webpack_require__(20),__webpack_require__(61),__webpack_require__(86),__webpack_require__(336))},,,,,,,function(e,t,n){var r=function(e,t,r,o,a,i,s,c,l,d,u){var p=arguments.length>11&&void 0!==arguments[11]?arguments[11]:n(1),f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:n(330)(),h=arguments.length>13&&void 0!==arguments[13]?arguments[13]:n(333),g=arguments.length>14&&void 0!==arguments[14]?arguments[14]:n(144),v={INIT:-1,ANONYMOUS:0,OFFLINE:1,ONLINE:2},m=t.Deferred(),w=t.Deferred();return v.initialized=function(){return m.resolve(),w},p.getConfig().then(function(n){var a=c.getParameters(),s=d.isLTI(),p=a.sso,b=a.login_hint,y=c.getQueryParams(window.location.search).toplevel,k=s&&!y||a.no_logout,C=v.INIT,T=!1;v.stateChangeCallbacks=[],v.registerStateChangeCallback=function(e){this.stateChangeCallbacks.push(e)},v.triggerStateChangeCallbacks=function(){for(var e=[],n=0;n<this.stateChangeCallbacks.length;++n)e.push(this.stateChangeCallbacks[n](C,T));return t.when.apply(null,e)},v.onlinecheck_enabled=!1;var x=null,_=2;function S(){return"no"!==n.support_student_account||d.isLTI()||p}function I(e){return e.firstName&&""!=e.firstName&&e.lastName&&""!=e.lastName?e.firstName+" "+e.lastName:e.firstName&&""!=e.firstName?e.firstName:e.lastName&&""!=e.lastName?e.lastName:e.providerHumanID&&""!=e.providerHumanID&&e.providerHumanID!==e.providerID?e.providerHumanID:e.email&&""!=e.email?e.email.substring(0,e.email.indexOf("@")):e.providerID}v.isStudentAccountsSupported=S,v.setCredentials=function(e,t){var n={username:I(e),userid:e.id,email:e.email,providerid:e.providerID,providerhumanid:e.providerHumanID,provider:e.provider,school:t,className:e.className,token:e.token,sid:null,coaccount:e.isCoAccount};l.setCredentials(n),f.setCredentials(l.credentials())},v.clearCredentials=function(){l.clear(),f.setCredentials(l.credentials())},v.loadCredentials=function(){return t.Deferred(function(e){f.getCredentials().done(function(t){null!==t?l.setCredentials(t):l.clear(),e.resolve(l.credentials())}).fail(function(){console.log("credentials load failure"),l.clear(),e.resolve(l.credentials())})}).promise()},v.getStudentInfo=function(e,r){var o=null,a=null;return null!=e&&""!==e?a={Authorization:"BWWAAuthToken "+e}:null!=r&&""!==r&&(o={sid:r}),t.ajax({type:"GET",dataType:"json",data:o,url:n.student_account_server+"/student/GetInfo",headers:a,timeout:1e4})},v.checkIfOnline=function(){if(!this.onlinecheck_enabled)return t.when();var e=t.Deferred(),n=l.getUserToken();return this.getStudentInfo(n,null).done(function(t){console.log("Got back online !"),v.goOnline(),e.resolve()}).fail(function(){e.reject()}),e},v.goOffline=function(t){console.log("goOffline");var n=this;e.pushAsyncFunc(function(){return console.log("Executing goOffline"),n.setState(v.OFFLINE)})},v.goOnline=function(t){console.log("goOnline");var n=this;e.pushAsyncFunc(function(){return console.log("Executing goOnline"),n.setState(v.ONLINE)})},v.scheduleOnlineCheck=function(){var e=this;_=Math.min(2*_,20),this.onlinecheck_enabled&&(x=setTimeout(function(){e.checkIfOnline().always(function(){e.scheduleOnlineCheck()})},1e3*_))},v.startOnlineCheck=function(){this.onlinecheck_enabled=!0,_=2,this.scheduleOnlineCheck()},v.stopOnlineCheck=function(){this.onlinecheck_enabled=!1,null!==x&&clearTimeout(x)},v.setState=function(e){return e===C?(console.log("Warning: setting identical storage state, ignoring"),t.when()):(C===v.OFFLINE&&this.stopOnlineCheck(),e===v.OFFLINE&&this.startOnlineCheck(),C=e,this.triggerStateChangeCallbacks())},v.setForceOfflineStorage=function(){return!1===T&&(T=!0),this.triggerStateChangeCallbacks()},v.setUserInfo=function(e,t){console.log("Log in successfull"),this.setCredentials(e,t),this.setState(this.ONLINE)},v.waitForExternalLogin=function(e,r){return r=r||2e3,t.Deferred(function(a){var i=null,s=null;var c=h.createPollingUI(function(){i&&clearTimeout(i),s&&s.abort(),l(),a.reject()});function l(){c.close()}!function c(){i=null;var d={sid:e.sid};console.log("Poll",e.sid),s=t.ajax({type:"GET",dataType:"json",data:d,url:n.student_account_server+"/student/GetInfo",timeout:1e4,success:function(e){s=null,l(),a.resolve(e)},error:function(e,t,n){if(s=null,"abort"!==t)if(401===e.status||0===e.status)try{0===e.status||"authenticating"===JSON.parse(e.responseText).auth.status?i=setTimeout(c,r):(l(),a.reject({msg:o("Authentication error.")}))}catch(e){l(),a.reject({msg:o("Server error when signing in.")})}else l(),a.reject({msg:o("Received error trying to sign in")+" ("+e.status+")"})}})}()}).promise()},v.serverLogin=function(e,r,a){return t.Deferred(function(i){var s={schoolCode:e,username:r,password:a};return t.ajax({type:"POST",data:s,url:n.student_account_server+"/student/Login",timeout:1e4}).done(function(e){i.resolve(e)}).fail(function(e){401==e.status?i.reject({msg:o("Wrong username or password, please try again.")}):i.reject({msg:o("Received error trying to sign in")+" ("+e.status+")"})})}).promise()},v.login=function(e,n,r){var o=this;return t.Deferred(function(t){"oauth"===n||"signup"===r.action?o.waitForExternalLogin(e).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}):"login"===r.action?o.serverLogin(r.school,r.username,r.password).done(function(e){t.resolve(e,r.school)}).fail(function(e){t.reject(e)}):t.reject({msg:"Unsupported login action"})}).promise()},v.getLoginCredentials=function(e,n){return t.Deferred(function(t){"oauth"===n?t.resolve(e,n):"bw"===n?h.queryBWCredentials(e).done(function(r){t.resolve(e,n,r)}).fail(function(e){t.reject(e)}):"school"===n?h.querySchoolCredentials(e).done(function(r){t.resolve(e,n,r)}).fail(function(e){t.reject(e)}):t.reject({msg:"Unsupported login type: "+n})}).promise()},v.hasSchool=function(){return n.hasOwnProperty("student_account_school")&&n.student_account_school.hasOwnProperty("code")&&null!==n.student_account_school.code&&""!==n.student_account_school.code&&"null"!==n.student_account_school.code},v.selectLoginType=function(e){var n=this;return t.Deferred(function(t){if(e.oauth_links.length>0||!n.hasSchool()){if(p)for(var a=0;a<e.oauth_links.length;++a){var i=e.oauth_links[a];if(i.provider===p)return void r.navigateAlert(o("You need to be signed in to use this widget."),o("Please sign in"),o("OK"),i.url)}h.queryLoginMethod(e).done(function(n){t.resolve(e,n)}).fail(function(e){t.reject(e)})}else t.resolve(e,"school")}).promise()},v.getLoginInfo=function(){var e=a.lfq?c.split(a.lfq):{};e.schoolCode=this.hasSchool()?n.student_account_school.code:"",p?e.providers=p:n.student_account_authrestrict&&"yes"===n.student_account_authrestrict&&(e.providers=(n.student_account_authproviders||[]).join(",")),e.source=function(e){var t=i.getPlatform();return"ibw-platform-ipad-ibooks"===t||"ibw-platform-ipad-ibooks-epub"===t?"ibooks-ios":"ibw-platform-ipad-bookwidgets"===t?i.isPreview()?"bwapp-preview":"bwapp":"ibw-platform-osx-ibooks"===t||"ibw-platform-osx-ibooks-epub"===t?"ibooks-osx":"ibw-platform-osx-preview"===t||"ibw-platform-win32-preview"===t?"bw-preview":"ibw-platform-android-chrome"!==t||e?i.isPreview()?"create-preview":i.isTopLevelPlay()?"play":"embed":"embed"}(!!p),n.kmuserid&&""!=n.kmuserid&&(e.creator=n.kmuserid),"undefined"!=typeof bwshortcode&&(e.widget=bwshortcode),i.isIOS()&&(e.ios="1"),e.q=a.q;var r=g("body");return t.Deferred(function(a){t.ajax({type:"GET",dataType:"json",data:e,url:n.student_account_server+"/student/GetLoginForm",timeout:1e4}).done(function(e){r.close(),a.resolve(e)}).fail(function(e){r.close(),400==e.status?a.reject({msg:o("Widget configuration error: school doesn't exist.")}):a.reject({msg:o("Could not connect to server, check your internet connection.")})})}).promise()},v.reportFailure=function(e){return e&&e.hasOwnProperty("msg")?h.showMessage(e.msg,o("Sign in failed")):t.when(!0)},v.requestSignin=function(){var e=this;return t.Deferred(function(t){e.getLoginInfo().then(e.selectLoginType.bind(e)).then(e.getLoginCredentials.bind(e)).then(e.login.bind(e)).then(e.setUserInfo.bind(e)).then(function(){t.resolve(!1)}).fail(function(n){e.reportFailure(n).done(function(e){t.resolve(!e)})})}).promise()},v.showLoginStateInfo=function(){return C===v.OFFLINE?h.queryLogout(o("Offline"),o("You're currently offline and logged in as user:"),this.getUserName(),k):C===v.ONLINE?h.queryLogout(o("Online"),o("You're currently online and logged in as user:"),this.getUserName(),k):t.when()},v.loopLoginUntilOnline=function(e){var t=this;this.requestSignin().done(function(n){C===t.ONLINE?e.resolve():n?t.loopLoginUntilOnline(e):h.showMessage(o("You need to be signed in to use this widget."),o("Please sign in")).done(function(){t.loopLoginUntilOnline(e)})})},v.forceLogin=function(){var e=t.Deferred();return this.loopLoginUntilOnline(e),e},v.setAnonymousOrForceLogin=function(){d.isEmbeddedLTI()?this.loginLTI():"optional"===n.support_student_account?(this.setState(this.ANONYMOUS),w.resolve()):this.forceLogin().done(function(){w.resolve()})},v.initializeWithStoredCredentials=function(e){var t=this,r=e.token,o=e.sid,a=null!=r&&""!==r;if(!1===a&&!1===(null!=o&&""!==o)||S()&&this.hasSchool()&&n.student_account_school.code!==e.school)this.setAnonymousOrForceLogin();else{var i=g("body");t.getStudentInfo(r,o).done(function(n){if(i.close(),p&&!o&&(n.provider!==p||!b||0==b.length||n.providerID!==b&&n.providerHumanID!==b))return console.log("Logged in with incompatible credentials. Re-login."),void t.setAnonymousOrForceLogin();t.setCredentials(n,e.school),t.setState(v.ONLINE),w.resolve()}).fail(function(e){i.close(),console.log("Error getting student info -> either invalid token or wrong connection"),a&&401!==e.status?(t.setState(v.OFFLINE),w.resolve()):t.setAnonymousOrForceLogin()})}},v.loginLTI=function(){var e=g("body"),a=this;t.ajax({type:"POST",data:{lti:c.urlencode(c.getParameters()),url:window.location.protocol+"//"+window.location.host+window.location.pathname,wa:n.WA,id:n.uuid2},headers:u.getAJAXHeaders(),url:n.student_account_server+"/student/Login",timeout:1e4}).then(function(t){e.close(),d.setEmbeddedLTIAuthenticated(),a.setCredentials(t,null),a.setState(v.ONLINE),w.resolve()},function(t){e.close();try{var n=JSON.parse(t.responseText);if("noLTILicense"==n.code)return a.setState(a.ANONYMOUS),void w.reject();if(null!=n.message&&n.message.length>0)return void r.showFatalAlert(n.message,o("Error"))}catch(e){}0===t.readyState?r.showFatalAlert(o("You need an internet connection to access this widget."),o("Error")):r.showFatalAlert(o("Error signing in."),o("Error"))})},v.initialize=function(){var e=this;t(function(){if(!S())return e.setState(e.ANONYMOUS),void w.resolve();var t=a.sid;return t?(console.log("Got SID from params"),history.replaceState("",document.title,window.location.pathname+window.location.search+c.removeQueryStringParameter(c.getHash(),"sid")),void e.initializeWithStoredCredentials({sid:t})):!d.isEmbeddedLTI()||d.isEmbeddedLTIAuthenticated()?!s&&i.isPreview()?(e.setState(e.ANONYMOUS),void w.resolve()):void e.loadCredentials().done(e.initializeWithStoredCredentials.bind(e)):void e.loginLTI()})},m.then(function(){v.initialize()}),v.logout=function(){return this.clearCredentials(),"optional"===n.support_student_account?this.setState(v.ANONYMOUS):(g("body"),window.location.reload(!1)),t.when().promise()},v.requestSignout=function(){return this.showLoginStateInfo().done(this.logout.bind(this))},v.getUserToken=function(){return l.getUserToken()},v.getUserSid=function(){return l.getUserSid()},v.getUserName=function(){return l.getUserName()},v.getUserClassName=function(){return l.getUserClassName()},v.getUserId=function(){return l.getUserId()},v.getEmail=function(){return l.getEmail()},v.getProviderId=function(){return l.getProviderId()},v.getProviderHumanId=function(){return l.getProviderHumanId()},v.isCoAccount=function(){return l.isCoAccount()},v.getState=function(){return C},v.getForceOfflineStorage=function(){return T},v.hasProperty=function(e){return"user_id"===e},v.getProperty=function(e){if("user_id"==e)return this.getUserId()}}),v}.bind(null,n(89),n(0),n(9),n(7),n(63),n(2),n(34),n(11),n(134),n(62),n(337));e.exports={f:r,o:r()}},,,,,function(e,t){e.exports={BWDS_ERROR_INTERNAL:0,BWDS_ERROR_UNKNOWN:1,BWDS_ERROR_UNAVAILABLE:2,BWDS_ERROR_WRONG_ATTRIB:3,BWDS_ERROR_FULL:4,BWDS_ERROR_SECURITY:5}},,,,,,,,,,,,,,,function(e,t){e.exports=function(){var e=[];function t(){for(var t=0;t<e.length;++t)e[t]()}return{executeCssUpdateCallbacks:t,CssUpdateCallbacks:e,updateConfigCSS:function(e){for(var n=document.getElementsByTagName("link"),r=0,o=n.length;r<o;r++){var a=n[r],i=a.rel;if("string"!=typeof i||0===i.length||"stylesheet"===i){var s=a.getAttribute("href");0===s.indexOf("config")&&-1!==s.indexOf(".css")&&(a.setAttribute("href","config"+e+".css"),setTimeout(t,100))}}},addAllDesignInfo:function(){void 0!==window.addAllDesignInfo&&window.addAllDesignInfo()},addCSSUpdateCallback:function(t){e.push(t)}}}()},function(e,t,n){var r,o,a;e.exports=(r=n(11),o=r.getParameters(),a=!!o.lti_authenticated,{isLTI:function(){return!!o.lti||!!o.lti_version},isEmbeddedLTI:function(){return!!o.lti_version},isEmbeddedLTIAuthenticated:function(){return a},setEmbeddedLTIAuthenticated:function(){a=!0,r.updateWindowQueryParameter("lti_authenticated","1")}})},function(e,t,n){var r;e.exports=(r=n(0),function(e,t,n,o){var a=o&&""!==o?"onclick=\"setTimeout(function() { parent.postMessage({ msg:'"+o+"'}, '*');}, 1000);\" ":"",i=document.createElement("iframe");i.className="bwexternallink";var s='<body style="margin: 0px"><a style="display: block; width: 100%; height: 100%; background:red;" '+a+'href="'+t+'" target="_blank">&nbsp;</a></body>';e.appendChild(i),i.contentWindow.document.open(),i.contentWindow.document.write(s),i.contentWindow.document.close(),r(i).css({position:"absolute",left:0,top:0,width:"100%",height:"100%"})})},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o,a,i;e.exports=(o=n(22).createLogger("CallbackBridge"),a=1,(i=function(){this.id=a++,this.listening=!1,this.nextCallbackID=1,this.callbacks={},this.handleMessage=this._handleMessage.bind(this)}).prototype.getMessagePrefix=function(){return"bw-CBBridge-"+this.id+"-"},i.prototype.startListening=function(){window.addEventListener("message",this.handleMessage)},i.prototype.stopListening=function(){window.removeEventListener("message",this.handleMessage)},i.prototype._handleMessage=function(e){var t=this.getMessagePrefix();"object"===r(e.data)&&"string"==typeof e.data.command&&e.data.command.substr(0,t.length)===t&&(e.data.hasOwnProperty("err")?this.processCallback(e.data.command,e.data.err,e.data.data):this.processCallback(e.data.command,e.data.arg))},i.prototype.registerCallbacks=function(e,t){var n=""+this.nextCallbackID++;return this.callbacks[n]={ok:e,error:t},{ok:this.getMessagePrefix()+n+"-ok",error:this.getMessagePrefix()+n+"-error"}},i.prototype.registerCallback=function(e,t){var n=""+this.nextCallbackID++;return this.callbacks[n]={cb:e,singleshot:!t},this.getMessagePrefix()+n+"-cb"},i.prototype.processCallback=function(e,t,n){try{var r=e.match(/bw-CBBridge-.*-(.*)-(ok|error|cb)$/);if(r){var a,i=r[1],s=this.callbacks[i];return s?"cb"===r[2]?((a=s.cb)(t,n),void(s.singleshot&&delete this.callbacks[i])):(a="ok"===r[2]?s.ok:s.error,delete this.callbacks[i],void a(t)):void o.error("Cannot find callback with ID "+i+" Bridge "+this.id+this.callbacks)}o.error("Malformed callback: "+e)}catch(e){o.error(e)}},i)},,,,,,,,,,,,,,,,,,,,,function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o,a,i,s;e.exports=(o=n(2),a=n(0),i=n(86),s={getParameterByNameRaw:function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null===n?"":n[1].replace(/\+/g," ")},isYoutubeUrl:function(e){var t=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/);return!(!t||11!==t[2].length)},getYoutubeId:function(e){var t=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/);if(t&&11===t[2].length)return console.log("Youtube id: ",t[2]),t[2];var n=s.getParameterByNameRaw(e,"v");return""!==n?(console.log("Youtube id: ",n),n):(console.log("Youtube id: ",e),e)},timeToSeconds:function(e){var t=e.match(/([0-9]+)m([0-9]+)s/);if(null===t)return 0;console.log(t);var n=60*parseInt(t[1])+parseInt(t[2]);return console.log(n),n},getYoutubeStart:function(e){var t=s.getParameterByNameRaw(e,"start");if(""!==t)return console.log("Start: ",t),parseInt(t);var n=s.getParameterByNameRaw(e,"t");return""!==n?(console.log("Start: ",s.timeToSeconds(n)),s.timeToSeconds(n)):0},getYoutubeEnd:function(e){var t=s.getParameterByNameRaw(e,"end");return""!==t?(console.log("End: ",t),parseInt(t)):0},getInterval:function(e){var t="",n=s.getYoutubeStart(e);0!==n&&(t="?start="+n);var r=s.getYoutubeEnd(e);return 0!==r&&(t+=""===t?"?":"&",t+="end="+r),console.log("Interval: ",t),t},addPlayerIFrame:function(e,t){var n=a(e);if("ibw-platform-win32-preview"===o.getPlatform()||"ibw-platform-osx-preview"===o.getPlatform())return n.html("<br>Youtube videos are not supported in preview mode."),void n.css({"background-color":"black",color:"white","text-weight":"bold","text-align":"center"});var r=i("http://www.youtube.com/embed/")+s.getYoutubeId(t)+s.getInterval(t);console.log("iframe url: ",r),n.append("<iframe seamless id='playeriframe' src='"+r+"'></iframe>")},youtubeplaceholdercounter:0,resolveYoutubePlaceholdersNew:function(e){e.find(".youtubeplaceholder").each(function(){var e=a(this);if(void 0===e.attr("id")){console.log("prepare movie player");var t="YTP_"+s.youtubeplaceholdercounter++;e.attr("id",t);var n=e.attr("src");s.addPlayerIFrame("#"+t,n)}})},YouTubeLoading:!1,YouTubeVideos:[],loadYouTubePlayer:function(e,t,n){var r=document.createElement("script");r.setAttribute("type","text/javascript"),r.setAttribute("src",i("http://www.youtube.com/player_api")),document.getElementsByTagName("body")[0].appendChild(r)},pollStartVideos:function(){if(console.log("pollStartVideos()"),void 0!==window.YT&&void 0!==window.YT.Player){console.log("YT player ready, really playing");for(var e=0;e<s.YouTubeVideos.length;++e)s.YouTubeVideos[e]()}else setTimeout(s.pollStartVideos,100)},playYouTube:function(e,t){var n=s.getYoutubeId(t),i=s.getYoutubeStart(t),c=s.getYoutubeEnd(t);if("ibw-platform-win32-preview"===o.getPlatform()||"ibw-platform-osx-preview"===o.getPlatform()){var l=a(e);return l.html("<br>Youtube videos are not supported in preview mode."),void l.css({"background-color":"black",color:"white","text-weight":"bold","text-align":"center"})}function d(){console.log("createYouTubeVideo() "+e+" "+n+" "+i+" "+c);var t=a(e),o={rel:0};0!==i&&(o.start=i),0!==c&&(o.end=c),console.log(r(window.YT.Player)),new window.YT.Player(e.substring(1),{height:t.height(),width:t.width(),videoId:n,playerVars:o})}void 0!==window.YT&&void 0!==window.YT.Player?d():(s.YouTubeVideos.push(d),s.YouTubeLoading||(s.YouTubeLoading="true",s.loadYouTubePlayer(),setTimeout(s.pollStartVideos,100)))},resolveYoutubePlaceholders:function(e){function t(e,t){var n=t.width(),r=t.height(),o=a('<div class="videodiv"></div>').css({width:n,height:r}).appendTo(t);return a('<iframe frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>').css({width:n,height:r}).appendTo(o).attr("src",e),o}e.find(".youtubeplaceholder").each(function(){var e=a(this);if(void 0===e.attr("id")){console.log("prepare movie player");var n="YTP_"+s.youtubeplaceholdercounter++;e.attr("id",n);var r=e.attr("src");!function(e){return-1!==e.toLowerCase().indexOf("youtu")}(r)?function(e){return-1!==e.toLowerCase().indexOf("vimeo")}(r)?function(e,n){t(i("http://player.vimeo.com/video")+"/"+function(e){var t=e.match(/.*\/(.+)\??.*/);return t?t[1]:e}(e),n).addClass("bw-vimeo-wrapper")}(r,a("#"+n)):function(e){return-1!==e.toLowerCase().indexOf("giphy")}(r)?function(e,n){t(i("http://giphy.com/embed")+"/"+function(e){var t=e.match(/.*\/(.+)\??.*/);return t?t[1]:e}(e),n).addClass("bw-giphy-wrapper")}(r,a("#"+n)):console.error("Unsupported video URL: "+r):s.playYouTube("#"+n,r)}})}})},function(e,t){e.exports=function(e){var t="file:";window&&window.location&&window.location.protocol&&(t=window.location.protocol);var n="";return 0===e.indexOf("http://")?n="http://":0===e.indexOf("https://")?n="https://":0===e.indexOf("//")&&(n="//"),""!==n?"file:"===t?"//"===n?"http:"+e:e:"http:"===t?e:"https:"===t?"http://"===n?e.replace("http://","https://"):e:"//"===n?"https:"+e:e:e}},function(e,t,n){(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r,o=n(21).isArray;r=function(){var e=function(e){return!isNaN(1*e)},t=function(e){var t=e.charCodeAt(0);return t>=65&&t<=90||t>=97&&t<=122},n=function(e){return t(e)&&e===e.toUpperCase()},r=function(e){return t(e)&&e===e.toLowerCase()},a=function(e,t,n,r,a){var i;if(t)if(""===n&&(n=1),o(t)&&"1"===n)for(var s=0;s<t.length;++s)i={atom:t[s].atom,qty:parseInt(t[s].qty)},s===t.length-1&&(0!==r&&(i.charge=r),""!==a&&(i.phase=a)),e.push(i);else i={atom:t,qty:parseInt(n)},0!==r&&(i.charge=r),""!==a&&(i.phase=a),e.push(i)},i=function(t){for(var n="",r=0,o=0;o<t.length;++o){var a=t.charAt(o);if(e(a))n+=a;else if("+"===a){if(r=1,o!==t.length-1)return 0}else{if("-"!==a)return 0;if(r=-1,o!==t.length-1)return 0}}return parseInt(n)*r},s=function t(o){var s=[],c="",l="",d=0,u="";if(-1!==o.indexOf("!")||-1!==o.indexOf("@")||-1!==o.indexOf("#")||-1!==o.indexOf("$"))return[];var p=o+"H";p=p.replace(/\(s\)/g,"!").replace(/\(aq\)/g,"@").replace(/\(g\)/g,"#").replace(/\(l\)/g,"$");for(var f=0;f<p.length;++f){var h=p.charAt(f);if(n(h))a(s,c,l,d,u),c=h,l="",u="",d=0;else if(r(h)){if(!c)return[];c+=h}else if(e(h)){if(!c)return[];l+=h}else if("("===h){for(var g=!1,v=f+1;v<p.length;++v)if(")"===p.charAt(v)){g=!0;break}if(!g)return[];if(!e(p.charAt(v+1)))return[];if(a(s,c,l,d,u),(c=t(p.substring(f+1,v)))===[])return[];l="",u="",d=0,f=v}else if("{"===h){for(g=!1,v=f+1;v<p.length;++v)if("}"===p.charAt(v)){g=!0;break}if(!g)return[];var m=p.substring(f+1,v);d=i(m),f=v}else if("!"===h){if(""!==u)return[];u="s"}else if("@"===h){if(""!==u)return[];u="aq"}else if("#"===h){if(""!==u)return[];u="g"}else{if("$"!==h)return[];if(""!==u)return[];u="l"}}return s},c=function(t,n){for(var r="",o=0;o<t.length;++o){var a=t.charAt(o);if(!e(a)){r=""===r?1:parseInt(r);var i=s(t.substring(o));return i!==[]&&(n.push({formula:i,qty:r}),!0)}r+=a}return console.error("Chemistryparser parseTerm: This should never happen"),!1},l=function(e){var t=e.replace(/ /g,"").split("=");if(2!==t.length)return{reactants:[],products:[]};for(var n=t[0].replace(/\+\}/g,"*}").split("+"),r=t[1].replace(/\+\}/g,"*}").split("+"),o=[],a=[],i=0;i<n.length;++i){var s=n[i].replace(/\*\}/g,"+}");if(!c(s,o))return{reactants:[],products:[]}}for(i=0;i<r.length;++i){s=r[i].replace(/\*\}/g,"+}");if(!c(s,a))return{reactants:[],products:[]}}return{reactants:o,products:a}},d=function e(t){for(var n="",r=0;r<t.length;++r){var a=t[r];o(a.atom)?a.qty>1?n=n+"("+e(a.atom)+")":n+=e(a.atom):n+=a.atom,a.qty>1&&(n=n+"_{"+a.qty+"}"),a.phase&&(n=n+"("+a.phase+")")}return n},u=function(e,t){for(var n=[],r=0;r<e.length;++r){var o=e[r],a="";t||1===o.qty||(a=o.qty+" \\, "),a+=d(o.formula),t?n.push({formula:a,qty:o.qty}):n.push(a)}return n},p=function(e){for(var t=[],n=0;n<e.length;++n)for(var r=e[n].formula,a=e[n].qty,i=0;i<r.length;++i){var s=r[i];if(o(s.atom))for(var c=0;c<s.atom.length;++c)t.push({atom:s.atom[c].atom,qty:s.atom[c].qty*s.qty*a});else t.push({atom:s.atom,qty:s.qty*a})}return t},f=function(e){for(var t=[],n=0;n<e.length;++n){for(var r=e[n],o=!1,a=0;a<t.length;++a){var i=t[a];if(r.atom===i.atom){i.qty=i.qty+r.qty,o=!0;break}}o||t.push(r)}return t},h=function(e,t){for(var n=0;n<e.length;++n)if(e[n].atom===t)return n;return-1},g=function(e,t){for(var n=0,r=0;r<e.length;++r){var o=h(t,e[r].atom);if(o===n)++n;else if(o>=n){var a=t.splice(o,1)[0];t.splice(n,0,a),++n}}},v=function(e){var t=p(e.reactants),n=p(e.products);return t=f(t),n=f(n),g(t,n),{reactants:t,products:n}},m=function(e,t){var n=1;if(o(e[0].atom)){if(n=e[0].qty,e=e[0].atom,t.pattern.length!==e.length)return 0}else if(t.pattern.length>e.length)return 0;for(var r=0;r<t.pattern.length;++r){var a=t.pattern[r],i=e[r];if(a.atom!==i.atom)return 0;if(1===t.pattern.length)n=i.qty;else if(a.qty!==i.qty)return 0}return n},w=function(e){for(var t=[],n=0;n<e.length;++n){for(var r=e[n],o=!1,a=0;a<t.length;++a){var i=t[a];if(r.ion===i.ion.ion&&r.charge===i.ion.charge){i.qty++,o=!0;break}}o||t.push({ion:r,qty:1})}return t};return{parseFormula:s,parseCharge:i,parseEquation:l,formatFormula:d,formatIon:function(e){var t=d(s(e.ion))+"^{";return 1===e.charge?t+="+":-1===e.charge?t+="-":e.charge>0?t+=e.charge+"+":t+=-e.charge+"-",t+="}"},formatEquation:function(e,t){return{reactants:u(e.reactants,t),products:u(e.products,t)}},reduceReactantsAndProducts:v,isBalanced:function(e){var t=l(e),n=v(t);if(0===n.reactants.length)return!1;if(n.reactants.length!==n.products.length)return!1;for(var r=0;r<n.reactants.length;++r){var o=n.reactants[r],a=n.products[r];if(a.atom!==o.atom||a.qty!==o.qty)return!1}return!0},matchOrder:g,matchIon:m,splitFormulaInIons:function(e,t){for(var n=[],r=s(e);r.length>0;){for(var o={ion:{pattern:[]}},a=0;a<t.length;++a){var i=t[a],c=m(r,i);c>0&&i.pattern.length>o.ion.pattern.length&&(o={ion:i,qty:c})}if(!(o.ion.pattern.length>0))return console.error("Error: formula contains unknown ions!"),console.error("Partial match: "),console.error(n),console.error("Head of parsedFormula:"),console.error(r),[];n.push({ion:o.ion.ion,charge:o.ion.charge,qty:o.qty}),o.qty>1?r.splice(0,1):r.splice(0,o.ion.pattern.length)}return n},joinIonsToFormula:function(e){e=w(e);for(var t=[],n=0;n<e.length;++n){var r=e[n];1===r.ion.pattern.length?t.push({atom:r.ion.pattern[0].atom,qty:r.qty}):t.push({atom:r.ion.pattern,qty:r.qty})}return function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n];if(o(r.atom))if(1===r.qty)for(var a=0;a<r.atom.length;++a)t.push({atom:r.atom[a].atom,qty:r.atom[a].qty});else t.push(r);else t.push(r)}return t}(t)},totalCharge:function(e){for(var t=0,n=0;n<e.length;++n)t+=e[n].charge;return t},equalFormulas:function e(t,n){if(t.length!==n.length)return!1;for(var r=0;r<t.length;++r){if(t[r].qty!==n[r].qty)return!1;if(o(t[r].atom)){if(!o(n[r].atom))return!1;if(!e(t[r].atom,n[r].atom))return!1}else if(t[r].atom!==n[r].atom)return!1}return!0},reduceIons:w}},"function"==typeof bwdefine?bwdefine("bw/chemistryparser",[],r):"object"===t(e)&&e.exports&&(e.exports=r())}).call(this,n(12)(e))},function(e,t,n){var r=n(21).map;e.exports={url:function(e,t){var n="js2objc://"+e;return t&&(n+="?"+r(t,function(e,t){return encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&")),n}}},function(e,t,n){e.exports=function(e){var t={},n=null,r=[];function o(){0!=r.length?(n=r.shift())():n=null}return t.pushAsyncFunc=function(t){var a=e.Deferred();return r.push(function(){t().always(function(){a.resolve(),o()})}),null===n&&o(),a},t.pushSyncFunc=function(t){this.pushAsyncFunc(function(){return t(),e.when()})},t}(n(0))},function(e,t,n){var r=function(e,t,r,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n(145),i=!1;function s(t){var n=r.Deferred();return a.remove(t,function(t){return null===t||t.code==e.BWDS_ERROR_UNKNOWN?n.resolve():(console.log("Remove failed: "+JSON.stringify(t)),n.reject()),n}),n}function c(n,s,c){var l=r.Deferred();return a.write(n,s,function(n){if(null===n)l.resolve();else{if(c&&!1===i){if(n.code==e.BWDS_ERROR_SECURITY){var r=t.getPlatform();"ibw-platform-ipad-ibooks-epub"===r||"ibw-platform-ipad-ibooks"===r?o.showCriticalAlert("Unable to save your answer, please restart iBooks to solve this issue.<br>"+r.getIOSIBooksRestartInfo(),"Storage error"):o.showCriticalAlert("Storing answers not supported on this platform.","Storage error")}else o.showCriticalAlert("Could not save your answer.","Storage problem");i=!0}console.log("Save failed"),l.reject()}}),l}function l(n,s){var c=r.Deferred();return a.read(n,function(n,r){if(null===n)r?c.resolve(r):(console.log("How did this happen?  No saved data on read!"),c.reject({}));else{if(s&&!1===i)if(n.code==e.BWDS_ERROR_SECURITY){var a=t.getPlatform();"ibw-platform-ipad-ibooks-epub"===a||"ibw-platform-ipad-ibooks"===a?o.showCriticalAlert("Unable to save your answer, please restart iBooks to solve this issue.<br>"+a.getIOSIBooksRestartInfo(),"Storage error"):o.showCriticalAlert("Storing answers not supported on this platform.","Storage error"),i=!0}else n.code!=e.BWDS_ERROR_UNKNOWN&&(console.log("Error "+n.code+" occurred while loading data: "+n.message),o.showCriticalAlert("Storing answers not supported on this platform.","Storage error"),i=!0);c.reject({})}}),c}function d(e,t){var n=e||{};for(var r in t){var o=t[r];null===o?delete n[r]:n[r]=o}return n}return{createWidgetStorage:function(e,t,n,o,i,u,p){var f={},h=""==i?"":i+"/";function g(){return h+"books/"+e+"/"+t+"/"+n}var v={};function m(e){return g()+"/img/"+e}return f.loadAll=function(e){var t,n;o?l(g()+u,p).done(e).fail(function(){e(null)}):""!==i?l(g(),p).always(function(t){try{var n=JSON.parse(t);v=n,e(JSON.parse(t))}catch(t){console.log("Can't parse bwds user data"),console.log(t),e(v)}}):(t=g(),n=r.Deferred(),a.dir(t,function(e,t){null===e?n.resolve(t):n.reject(e)}),n).done(function(t){var n={},o=[];function i(e,t,r){a.read(e+"/"+t,function(e,o){null===e?n[t]=o:console.log("Received error reading: "+t),r.resolve()})}for(var s=0;s<t.length;++s){var c=r.Deferred();o.push(c),i(g(),t[s],c)}r.when.apply(null,o).done(function(){e(n)})}).fail(function(t){e({})})},f.write=function(e,t){if(o)null===e?s(g()+u).always(t):c(g()+u,e,p).always(t);else if(""!==i)v=d(v,e),c(g(),JSON.stringify(v),p).always(t);else{var n=[];for(var a in e){var l=e[a];null===l?n.push(s(g()+"/"+a)):n.push(c(g()+"/"+a,l,p))}r.when.apply(null,n).always(t)}},f.overwriteAndSetVersion=function(e,t){var n=r.Deferred();if(o)null===e?s(g()+u).always(function(){n.resolve()}):c(g()+u,e,p).always(function(){f.setVersion(t).always(function(){n.resolve()})});else if(""!==i){var a=JSON.stringify(e);v=JSON.parse(a),c(g(),a,p).always(function(){f.setVersion(t).always(function(){n.resolve()})})}else console.error("bwds_storage_if.overwriteAndSetVersion not implemented for this storage mode... only intended for local caching"),n.reject();return n},f.setVersion=function(e){var t=r.Deferred(),n=g();return o&&(n+=u),a.stat(n,function(r,o,i){null===r?a.setStat(n,{backup_date:o.modified,backup_version:e},function(e){null===e?t.resolve():(console.log("Problem writing stat: "+JSON.stringify(e)),t.reject())}):(console.log("Got error reading stat for "+n+": means offline mode won't work"),t.reject())}),t},f.getVersion=function(e){var t=g();o&&(t+=u),a.stat(t,function(t,n,r){null===t?e({version:n.backup_version,offlinedata:n.backup_date!=n.modified,hasdata:!0}):(console.log("Error reading stat... assume there is no data"),e({version:0,offlinedata:!1,hasdata:!1}))})},f.writeImage=function(e,t){return c(m(e),t,p)},f.clearImage=function(e){return s(m(e))},f.isImageBackedUp=function(e){var t=r.Deferred();return a.stat(m(e),function(e,n,r){null===e?t.resolve(n.backup_date==n.modified):t.reject()}),t},f.listImagesAndBackupStatus=function(){var e=r.Deferred();return a.stat(g()+"/img",function(t,n,r){if(null===t){for(var o=[],a=0;a<r.length;++a){var i=r[a].name;o.push({id:i.substring(i.lastIndexOf("/")+1),backed_up:r[a].backup_date===r[a].modified})}e.resolve(o)}else e.resolve([])}),e},f.setImageBackedUp=function(e){var t=r.Deferred();return a.stat(m(e),function(n,r,o){null===n?a.setStat(m(e),{backup_date:r.modified},function(e){null===e?t.resolve():t.reject()}):t.reject()}),t},f.readImage=function(e){return l(m(e),p)},f.sync=function(e){a.executeSync(e)},f},createInfoStorage:function(e,t,n){var r={},o={},a={};function i(e){return(""==t?"":t+"/")+"info/"+e}return l(i("BWCommon"),n).always(function(e){try{o=JSON.parse(e)}catch(e){o={}}}),l(i(e),n).always(function(e){try{a=JSON.parse(e)}catch(e){a={}}}),r.getCommonProperties=function(e){e(o)},r.getGroupProperties=function(e){e(a)},r.setCommonProperties=function(e){o=d(o,e),c(i("BWCommon"),JSON.stringify(o),n)},r.setGroupProperties=function(t){a=d(a,t),c(i(e),JSON.stringify(a),n)},r}}}.bind(null,n(46),n(2),n(0),n(9));e.exports={f:r,o:r()}},,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t),n.d(t,"spellCheckAttribs",function(){return s}),n.d(t,"spellCheckAttribString",function(){return c});var r=n(162),o=n.n(r),a={spellcheck:"true",autocomplete:"new-password"},i={spellcheck:"false",autocorrect:"off",autocomplete:"new-password"};function s(e){return e?a:i}function c(e){var t=s(e);return o()(t,function(e,t){return t+'="'+e+'"'}).join(" ")}},,,,,,,,,,,,,,,,,function(e,t){var n;e.exports={_creds:n={username:null,userid:null,email:null,providerid:null,providerhumanid:null,provider:null,school:null,token:null,sid:null,coaccount:null},credentials:function(){return this._creds},clear:function(){this._creds=n},setCredentials:function(e){this._creds=e},getUserToken:function(){return this._creds.token},getUserSid:function(){return this._creds.sid},getUserName:function(){return this._creds.username},getUserClassName:function(){return this._creds.className},getUserId:function(){return this._creds.userid},getEmail:function(){return this._creds.email},getProviderId:function(){return this._creds.providerid},getProviderHumanId:function(){return this._creds.providerhumanid},isCoAccount:function(){return this._creds.coaccount}}},function(e,t){e.exports=window.Hammer},,function(e,t,n){e.exports=function(e,t,n){return function(n){var r=n.tablediv,o=n.tabledata,a=n.hasOwnProperty("calculate")?n.calculate:function(){},i=!!n.hasOwnProperty("support_correction_colors")&&n.support_correction_colors;function s(e){if(0===e.length)throw new Error("too little params");var t=e[0];return e.shift(),t}function c(e){if(0===e.length)throw new Error("too little params");if(isNaN(e[0]))throw new Error("wrong param type, not int");var t=parseInt(e[0]);return e.shift(),t}function l(e,t){return e.length>0&&e[0]===t&&(e.shift(),!0)}function d(e,t,n){var r=function(e,t){var n=Math.pow(10,t||0);return String(Math.round(e*n)/n)}(e,t);return n&&(r=String(r).split("").reverse().join("").replace(/(\d{3}\B)/g,"$1,").split("").reverse().join("")),r}function u(e,t){if(isNaN(e))return e;var n,r,o,a,i=e,u=t.split(", ");try{if("number"===(n=s(u)))i=d(e,r=c(u),o=l(u,"ts"));else if("percentage"===n)i=d(100*e,r=c(u),o=l(u,"ts")),i+="%";else if("currency"===n){r=c(u),o=l(u,"ts"),a=s(u);var p=l(u,"post");i=d(e,r,o),p?i+=a:i=a+i}}catch(e){console.log("Error parsing format: "+e)}return i}t('<div class="styledtablehidden" style="display:none"></div>').appendTo(t(r).parent());var p=null,f=null;function h(e,t,n){for(var r=0;r<e.length;++r){var o=e[r];if(o.row===t&&o.column===n)return o}return null}for(var g=function(n,a,s,c,l,d,g){var v=t(a),m={},w=o.values[s][c];w.hasOwnProperty("CellFormat")&&(d=u(d,w.CellFormat),v.find(".bw-table-cell-contents").html(d));for(var b=["font-family","font-weight","font-style","font-variant","font-size"],y=0;y<b.length;++y){var k=b[y];w.hasOwnProperty(k)&&(m[k]=w[k])}if(w.hasOwnProperty("font-size")&&(m["line-height"]=Math.max(parseInt(w["font-size"]),21)+"px"),i&&w.hasOwnProperty("CellRole")&&("checked"===w.CellRole||"input"===w.CellRole)){if(p){var C=h(p.correctioninfo,s,c);if(C&&C.answer!==d&&(C=h((p=f()).correctioninfo,s,c)),C)if(1===C.correctness)v.addClass("cell_correct").removeClass("cell_wrong"),v.find(".bw-table-cell-contents").append(" &#x2713;");else if(-2!==C.correctness&&C.correct){var T=C.correct.split(/\|\||##/),x=1===T.length?C.correct:T.join(" / ");v.addClass("cell_wrong").removeClass("cell_correct").find(".bw-table-cell-contents").append('<span class="cell_right_value"> ('+x+")</span>"),0===C.correctness&&v.find(".cell_right_value").append(" &#x2718;")}else v.addClass("cell_open")}}else w.hasOwnProperty("BackgroundColor")&&(m.background=w.BackgroundColor,m["background-clip"]="padding-box"),w.hasOwnProperty("TextColor")&&(m.color=w.TextColor);if(w.hasOwnProperty("HAlign")&&(m["text-align"]=w.HAlign),w.hasOwnProperty("VAlign")&&(m["vertical-align"]=w.VAlign),w.hasOwnProperty("BorderLeft")&&(m["border-left"]=w.BorderLeft),w.hasOwnProperty("BorderRight")&&(m["border-right"]=w.BorderRight),w.hasOwnProperty("BorderTop")&&(m["border-top"]=w.BorderTop),w.hasOwnProperty("BorderBottom")&&(m["border-bottom"]=w.BorderBottom),o.hasOwnProperty("layout")&&o.layout.hasOwnProperty("rows")&&(m.height=o.layout.rows[s].height+"px"),v.css(m),w.hasmath){var _=t(r).parent().find("#cell_"+s+"_"+c).clone();_.removeAttr("id"),v.empty().append(_),e.process(v.find(".bwmathquill"))}},v=o&&o.values?o.values:[],m=function(n){for(var o=[],a=n||[],i=0;i<a.length;++i){for(var s=a[i],c=[],l=0;l<s.length;++l){var d=s[l];if(!d.hasOwnProperty("CellRole")||"calculated"!==d.CellRole&&"checked"!==d.CellRole)if(d.hasOwnProperty("CellRole")&&"readonly"===d.CellRole){var u=e.prepare(d.value);u!==d.value?(t('<span id="cell_'+i+"_"+l+'">'+u+"</span>").appendTo(t(r).parent().find(".styledtablehidden")),d.hasmath=!0,c.push(u)):c.push(d.value)}else c.push(d.value);else c.push("")}o.push(c)}return o}(v),w=t.extend(!0,[],m),b=0,y=o&&o.layout&&o.layout.columns?o.layout.columns:[],k=0;k<y.length;++k)b+=y[k].width;for(k=0;k<v.length;++k)for(var C=v[k],T=0,x=0,_=0;_<C.length;++_){if((E=C[_]).hasOwnProperty("BorderTop")){var S=parseInt(E.BorderTop);S>T&&(T=S)}if(E.hasOwnProperty("BorderBottom")){var I=parseInt(E.BorderBottom);I>x&&(x=I)}}for(_=0;_<y.length;++_){var O=0,A=0;for(k=0;k<v.length;++k){var E;if((E=o.values[k][_]).hasOwnProperty("BorderLeft")){var q=parseInt(E.BorderLeft);q>O&&(O=q)}if(E.hasOwnProperty("BorderRight")){var P=parseInt(E.BorderRight);P>A&&(A=P)}}b+=O+A}var D={};D.data=m,D.table_change_callbacks=[],D.setChangeCallBack=function(e){this.table_change_callbacks.push(e)},D.callChangeCallbacks=function(){for(var e=0;e<this.table_change_callbacks.length;++e)this.table_change_callbacks[e]()};var R={data:m,asyncRendering:!1,stretchH:"none",onChange:function(e,n){a(),t(r).bwtable("render"),D.callChangeCallbacks()},maxColumns:o&&o.layout&&o.layout.colums?o.layout.columns.length:0,cells:function(e,t,n){var r={renderer:g};return!o.values[e][t].hasOwnProperty("CellRole")||"readonly"!==o.values[e][t].CellRole&&"calculated"!==o.values[e][t].CellRole||(r.readOnly=!0),r},width:b,spellcheck:n.spellcheck};if(o&&o.layout&&o.layout.columns){var N=[];for(y=o.layout.columns,k=0;k<y.length;++k)N.push(y[k].width);R.colWidths=N}return t(r).bwtable(R),D.setData=function(e){for(var n=o&&o.values?o.values:[],i=0;i<e.length;++i){var s=e[i];if(n[s.row]&&n[s.row][s.column]){var c=n[s.row][s.column];c.hasOwnProperty("CellRole")&&"checked"!==c.CellRole&&"input"!==c.CellRole||(m[s.row][s.column]=s.value)}}a(),t(r).bwtable("render")},D.getData=function(){for(var e=[],t=o&&o.values?o.values:[],n=0;n<t.length;++n)for(var r=t[n],a=0;a<r.length;++a){var i=r[a];i.hasOwnProperty("CellRole")&&"input"!==i.CellRole&&"checked"!==i.CellRole||m[n][a]!==w[n][a]&&e.push({row:n,column:a,value:m[n][a]})}return e},D.getProgress=function(){for(var e=0,t=0,n=o&&o.values?o.values:[],r=0;r<n.length;++r)for(var a=n[r],i=0;i<a.length;++i){var s=a[i];"input"!==s.CellRole&&"checked"!==s.CellRole||(++e,m[r][i]!==w[r][i]&&++t)}return{inputCellCount:e,changedCellCount:t}},D.clear=function(){for(var e=o&&o.values?o.values:[],n=0;n<e.length;++n)for(var i=e[n],s=0;s<i.length;++s){var c=i[s];c.hasOwnProperty("CellRole")&&"checked"!==c.CellRole&&"input"!==c.CellRole||(m[n][s]="checked"!==c.CellRole?c.value:"")}a(),t(r).bwtable("render"),this.callChangeCallbacks()},D.loadCorrect=function(e){for(var n=0;n<e.values.length;++n)for(var o=e.values[n],a=0;a<o.length;++a){var i=o[a];i.hasOwnProperty("CellRole")&&"checked"===i.CellRole&&(m[n][a]=i.value)}t(r).bwtable("render")},D.render=function(){t(r).bwtable("render")},D.setReadOnly=function(e){t(r).bwtable("updateSettings",{readOnly:e})},D.setCorrectionCallback=function(e){p=(f=e)?f():null,t(r).bwtable("render")},D.getCheckInput=function(){for(var e=[],t=o&&o.values?o.values:[],n=0;n<t.length;++n)for(var r=t[n],a=0;a<r.length;++a){var i=r[a];!i.hasOwnProperty("CellRole")||"input"!==i.CellRole&&"checked"!==i.CellRole||e.push({row:n,column:a,value:m[n][a]})}return e},D.getFormattedValueForCell=function(e,t){var n=o.values[e][t];return n.hasOwnProperty("CellFormat")?u(m[e][t],n.CellFormat):m[e][t]},D.getEmailTable=function(e,t){for(var n='<table border="1" style="border-collapse:collapse">',r=o&&o.values?o.values:[],a=0;a<r.length;++a){n+="<tr>";for(var i=r[a],s=0;s<i.length;++s){var c,l=i[s];if(l.hasOwnProperty("CellRole"))if("checked"===l.CellRole||"input"===l.CellRole){var d=t?h(t.correctioninfo,a,s):null;l.hasOwnProperty("CellFormat")?(c=u(m[a][s],l.CellFormat),e&&d&&(0===d.correctness||-1===d.correctness&&d.hasOwnProperty("correct"))&&(c+=" ("+u(d.correct,l.CellFormat)+")")):(c=m[a][s],e&&d&&(0===d.correctness||-1===d.correctness&&d.hasOwnProperty("correct"))&&(c+=" ("+d.correct+")"))}else c="calculated"===l.CellRole?l.hasOwnProperty("CellFormat")?u(m[a][s],l.CellFormat):m[a][s]:l.value;else c=l.hasOwnProperty("CellFormat")?u(m[a][s],l.CellFormat):m[a][s];var p="padding: 5px;";if(e&&l.hasOwnProperty("CellRole")&&("checked"===l.CellRole||"input"===l.CellRole)){var f=t?h(t.correctioninfo,a,s):null,g=f&&-2===f.correctness,v=f&&1===f.correctness;g?(p+="color:black;",p+="background: #FAAE3C;"):v?(p+="color:green;",p+="background: #C0FFC0;"):(p+="color:red;",p+="background:#FFC0C0;")}else l.hasOwnProperty("BackgroundColor")&&(p+="background:"+l.BackgroundColor+";"),l.hasOwnProperty("TextColor")&&(p+="color:"+l.TextColor+";");l.hasOwnProperty("HAlign")&&(p+="text-align:"+l.HAlign+";"),l.hasOwnProperty("VAlign")&&(p+="vertical-align:"+l.VAlign+";"),l.hasOwnProperty("BorderLeft")&&(p+="border-left:"+l.BorderLeft+";"),l.hasOwnProperty("BorderRight")&&(p+="border-right:"+l.BorderRight+";"),l.hasOwnProperty("BorderTop")&&(p+="border-top:"+l.BorderTop+";"),l.hasOwnProperty("BorderBottom")&&(p+="border-bottom:"+l.BorderBottom+";"),n+='<td style="'+p+'">'+c+"</td>"}n+="</tr>"}return n+="</table>"},D}}(n(4),n(0),n(317))},function(e,t,n){e.exports=function(e){var t=[];function n(e){for(var r=0;r<t.length;++r){0===(a=t[r]).starttime&&(a.starttime=e);var o=e-a.starttime;if(o>=a.duration){a.obj.setTranslate(a.to_x,a.to_y);var a=t.splice(r,1);--r,null!=a[0].callback&&a[0].callback()}else{var i=o/a.duration,s=a.easingfunc(i,o,0,1,a.duration);a.obj.setTranslate(a.from_x+a.delta_x*s,a.from_y+a.delta_y*s)}}t.length>0&&requestAnimationFrame(n)}e.fn.extend({setTranslate:function(e,t){var n="translate("+e+"px ,"+t+"px)";this.css({transform:n,"-webkit-transform":n,"-moz-transform":n,"-ms-transform":n})},getTranslate:function(){var e=this.css("transform");if(!(e||(e=this.css("-webkit-transform"))||(e=this.css("-ms-transform"))||(e=this.css("-moz-transform"))))return{x:0,y:0};var t=e.indexOf("matrix(");if(-1===t)return{x:0,y:0};var n=e.indexOf(")",t+1);if(-1===n)return{x:0,y:0};var r=e.substring(t+7,n).split(",");return{x:parseInt(r[4]),y:parseInt(r[5])}},animateTranslate:function(r,o,a,i,s){var c=this.getTranslate();t.push({obj:this,duration:a,starttime:0,from_x:c.x,from_y:c.y,to_x:r,to_y:o,delta_x:r-c.x,delta_y:o-c.y,easingfunc:e.easing[i],callback:s}),1===t.length&&requestAnimationFrame(n)}})}(n(0))},function(e,t,n){(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(n,r){"use strict";"function"==typeof bwdefine?bwdefine("bw/whiteboard_drawing",["bw/color-maps"],r):"object"===t(e)&&e.exports&&(e.exports=r())}(0,function(e){"use strict";function t(e){return e.substr(2)}function n(t){return"background"===t?"background":e&&e.light.hasOwnProperty(t)?e.light[t]:t}function r(e){return"C,"+n(e)}return{transformToRgbColors:function(e){var n=[];try{for(var o=e.split("\n"),a=0;a<o.length;++a){var i=o[a];if("C"===i[0]){var s=t(i);n.push(r(s))}else n.push(i)}}catch(e){console.log("Exception ransforming drawing to rgb"),console.log(e)}return n.join("\n")},create:function(){var e=[],r=0;function o(){r<e.length-1&&e.splice(r+1,e.length-1-r),e[r].objectpointer<e[r].objects.length&&e[r].objects.splice(e[r].objectpointer,e[r].objects.length-e[r].objectpointer)}function a(t){return o(),e[r].objects.push(t),++e[r].objectpointer,t}function i(e,t,n){return a({type:"line",points:e,color:t,linewidth:n})}function s(e,t,n,r,o){return a({type:"text",x:e,y:t,text:n,color:r,fontsize:o})}function c(e,t,n,r,o,i,s){return a({type:"photo",img:e,imgsrc:t,dx:n,dy:r,w:o,h:i,rad:s})}function l(e){return parseInt(e.substr(2))}function d(e){return parseInt(e.substr(2))}function u(e,t,n){for(var r=e.split(","),o=[],a=1;a<r.length;++a){var s=r[a].split(":");2!==s.length?console.log("Invalid point when reading whiteboard line: "+r[a]):o.push({x:parseInt(s[0]),y:parseInt(s[1])})}i(o,t,n)}function p(e,t,n){var r=e.split(",");r.shift(),s(parseInt(r.shift()),parseInt(r.shift()),r.join(","),t,n)}function f(e,t,n){var r=e.split(",");r.shift();var o=parseInt(r.shift()),a=parseInt(r.shift()),i=parseInt(r.shift()),s=parseInt(r.shift()),l=parseFloat(r.shift()),d=new Image;d.onload=function(){n()},d.error=function(){n(!0)};var u=r.join(",");t(u,function(e){"data:"!==e.substr(0,5)&&(d.crossOrigin="Anonymous"),d.src=e}),c(d,u,o,a,i,s,l)}function h(e){return"C,"+e}function g(e){return"W,"+e}function v(e){return"S,"+e}function m(e){var t=[];t.push("L");for(var n=0;n<e.points.length;++n)t.push(e.points[n].x+":"+e.points[n].y);return t.join(",")}function w(e){return"T,"+e.x+","+e.y+","+e.text}function b(e){return"P,"+e.dx+","+e.dy+","+e.w+","+e.h+","+e.rad+","+e.imgsrc}function y(e,t,r,o){e.beginPath(),e.fillStyle=n(r),e.arc(t.x,t.y,o/2,Math.PI/180*0,Math.PI/180*360,!1),e.fill()}function k(e,t,r){!function(e,t,r,o,a){if(e.save(),"background"!==r){y(e,t[0],r,o),e.beginPath(),e.strokeStyle=n(r),e.lineWidth=o,e.moveTo(t[0].x,t[0].y);var i=0;for(i=1;i<t.length-2;i++){var s=(t[i].x+t[i+1].x)/2,c=(t[i].y+t[i+1].y)/2;e.quadraticCurveTo(t[i].x,t[i].y,s,c)}t.length>2?e.quadraticCurveTo(t[i].x,t[i].y,t[i+1].x,t[i+1].y):e.lineTo(t[i].x,t[i].y),e.stroke(),y(e,t[t.length-1],r,o)}else for(i=0;i<t.length;i++)a(e,t[i].x,t[i].y);e.restore()}(t,e.points,e.color,e.linewidth,r)}function C(e,t){t.font=e.fontsize+"px Arial",t.fillStyle=n(e.color),t.fillText(e.text,e.x,e.y)}function T(e,t){if(t.save(),t.translate(e.dx,e.dy),t.rotate(e.rad),!0===e.img.complete)try{t.drawImage(e.img,-e.w/2,-e.h/2,e.w,e.h)}catch(e){console.log("Can't draw image... no clue why..."+e)}else t.fillStyle="#E0E0E0",t.fillRect(-e.w/2,-e.h/2,e.w,e.h),t.strokeStyle="black",t.strokeRect(-e.w/2,-e.h/2,e.w,e.h),t.font="16px Arial",t.fillStyle="black",t.textAlign="center",t.textBaseline="middle",t.fillText("Can't load image",0,0);t.restore()}function x(e,t){return{x1:Math.min(e.x1,t.x1),x2:Math.max(e.x2,t.x2),y1:Math.min(e.y1,t.y1),y2:Math.max(e.y2,t.y2)}}function _(e){for(var t={x1:Number.MAX_VALUE,x2:-Number.MAX_VALUE,y1:Number.MAX_VALUE,y2:-Number.MAX_VALUE},n=0;n<e.points.length;++n){var r=e.points[n];if(isNaN(r.x)||isNaN(r.y))throw Object();t.x1=Math.min(t.x1,r.x),t.x2=Math.max(t.x2,r.x),t.y1=Math.min(t.y1,r.y),t.y2=Math.max(t.y2,r.y)}return t}function S(e,t){t.save(),t.font=e.fontsize+"px Arial";var n=t.measureText(e.text);return t.restore(),{x1:e.x,x2:e.x+n.width,y1:e.y-e.fontsize,y2:e.y}}return e.push({objects:[],objectpointer:0}),{clearPage:function(){o(),e.push({objects:[],objectpointer:0}),++r},isEmpty:function(){return 0===e[r].objectpointer},addLine:i,addText:s,addPhoto:c,load:function(e,n,r){try{for(var o="",a=0,i=0,s=e.split("\n"),c=0;c<s.length;++c){var h=s[c];"C"===h[0]?o=t(h):"W"===h[0]?a=l(h):"S"===h[0]?i=d(h):"L"===h[0]?u(h,o,a):"T"===h[0]?p(h,o,i):"P"===h[0]?f(h,n,r):(console.log("Invalid line when reading whiteboard data"),console.log(h))}}catch(t){console.log("Error loading whiteboard data"),console.log(e)}},save:function(){for(var t=[],n="",o=0,a=0,i=0;i<e[r].objectpointer;++i){var s=e[r].objects[i];"line"===s.type?(s.color!==n&&(n=s.color,t.push(h(n))),s.linewidth!==a&&(a=s.linewidth,t.push(g(a))),t.push(m(s))):"text"===s.type?(s.color!==n&&(n=s.color,t.push(h(n))),s.fontsize!==o&&(o=s.fontsize,t.push(v(o))),t.push(w(s))):"photo"===s.type&&t.push(b(s))}return t.join("\n")},undo:function(){e[r].objectpointer>0?--e[r].objectpointer:r>0&&--r},redo:function(){e[r].objectpointer<e[r].objects.length?++e[r].objectpointer:r<e.length-1&&++r},drawToContext:function(t,n){n=n||function(e,t,n){e.clearRect(t,n,20,20)};for(var o=0;o<e[r].objectpointer;++o){var a=e[r].objects[o];"line"===a.type?k(a,t,n):"text"===a.type?C(a,t):"photo"===a.type&&T(a,t)}},bounds:function(t){if(0===e[r].objectpointer)return{x1:0,x2:0,y1:0,y2:0};for(var n,o,a={x1:Number.MAX_VALUE,x2:-Number.MAX_VALUE,y1:Number.MAX_VALUE,y2:-Number.MAX_VALUE},i=0;i<e[r].objectpointer;++i){var s=e[r].objects[i];if("line"===s.type){if(s.points.length>0)try{a=x(a,_(s))}catch(e){console.log("Ignoring bounds for invalid line"),console.log(s)}}else"text"===s.type?a=x(a,S(s,t)):"photo"===s.type&&(a=x(a,(n=s,o=void 0,o=Math.sqrt(n.w*n.w+n.h*n.h)/2,{x1:n.dx-o,x2:n.dx+o,y1:n.dy-o,y2:n.dy+o})))}return a}}}}})}).call(this,n(12)(e))},function(e,t,n){var r=function(e,t,r,o){var a,i,s,c,l,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n(1),u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n(41).o,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:n(90).o,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:n(161).o,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:n(380),g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:n(144),v={},m="",w=!1,b=t.getParameters(),y=b.hasOwnProperty("teacher_id")?b.teacher_id:"",k=b.hasOwnProperty("school_id")?b.school_id:"";v.WIDGET_ANONYMOUS=0,v.WIDGET_OFFLINE=1,v.WIDGET_ONLINE=2;var C=null,T=-1,x=!1;function _(){T!==v.WIDGET_ONLINE||x||C.moveImageOnlineIfRequired().done(function(e){e&&_()})}function S(){var t=g("body"),n=e.Deferred();return h.start(),C.loadAll(function(e){h.end(),t.close(),a(e),_(),n.resolve()}),n}v.stateChanged=function(t,n){if(t===T&&n===x)return console.log("Warning: setting identical storage state, ignoring"),e.when();if(T===v.WIDGET_OFFLINE&&t===v.WIDGET_ONLINE&&!0===n)return T=t,x=n,e.when();var r="no"!==d.getConfigSync().save_answers;switch(t){case v.WIDGET_ANONYMOUS:console.log("Using anonymous storage"),C=p.createWidgetStorage(s,i,l,w,"",m,r);break;case v.WIDGET_ONLINE:if(!1===n){console.log("Using online storage"),C=f.createWidgetStorage(s,i,c,l,w,u.getUserId(),m,y,k);break}case v.WIDGET_OFFLINE:console.log("Using offline storage"),C=p.createWidgetStorage(s,i,l,w,u.getUserId(),m,r)}var o,g=T,b=x;return T=t,x=n,function(e,t){return-1!=e&&e+t<3}(g,t)?S():g===v.WIDGET_OFFLINE&&t===v.WIDGET_ONLINE?(o=e.Deferred(),h.start(),C.goneOnlineSync(function(e){h.end(),"CONFLICT"==e.status&&a(e.data),_(),o.resolve()}),o):g===v.WIDGET_ONLINE&&t===v.WIDGET_OFFLINE||b!==x?function(){var t=e.Deferred();C.loadAll(function(e){t.resolve()})}():e.when()},v.init=function(e){var t=this;a=e.updateCallback,i=e.type,s=e.group,c=e.name,l=e.id,w=e.singleKey,m=e.extension,h.init(),u.initialized().then(function(){t.stateChanged(u.getState(),u.getForceOfflineStorage()),S(),u.registerStateChangeCallback(t.stateChanged.bind(t))},function(){t.stateChanged(u.ANONYMOUS,!0),S()});var n=!!e.hide_account;u.isStudentAccountsSupported()&&!n&&r.init()};var I,O=!1,A=!1;return v.write=function(t){null!==C&&(O?function(e){A?I=w?e:function(e,t){var n=e||{};for(var r in t)n[r]=t[r];return n}(I,e):(I=e,A=!0)}(t):o.pushAsyncFunc(function(){return function t(n){var r=e.Deferred();return O=!0,h.start(),C.write(n,function(e){h.end(),e&&"CONFLICT"==e.status&&a(e.data),O=!1,A?(A=!1,t(I).done(function(){r.resolve()})):r.resolve()}),r}(t)}))},v.registerImage=function(t){var n=e.Deferred(),r=(new Date).getTime()+function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}(5);return C.writeImage(r,t).done(function(){n.resolve("bwimg:"+r)}).fail(function(){n.reject()}),n},v.clearImage=function(t){var n=e.Deferred();if(0==t.indexOf("bwimg:")){var r=t.substring(6);C.clearImage(r).done(function(){n.resolve()}).fail(function(){console.log("Could not clear image"),n.reject()})}else n.reject();return n},v.getImageUrl=function(t){var n=e.Deferred();if(0==t.indexOf("bwimg:")){var r=t.substring(6);C.readImage(r).done(function(e){n.resolve(e)}).fail(function(){n.reject("")})}else n.resolve(t);return n},v.sync=function(e){o.pushSyncFunc(e)},v.clear=function(){},v}.bind(null,n(0),n(11),n(381),n(89));e.exports={f:r,o:r()}},function(e,t){e.exports={GetItem:function(e){return localStorage.getItem(e)},RemoveItem:function(e){localStorage.removeItem(e)},SetItem:function(e,t){localStorage.setItem(e,t)},Clear:function(){localStorage.clear()}}},function(e,t,n){var r=n(88);e.exports=function(e,t){var o=n(22).createLogger("NativeSQLAsyncKeyStore"),a=new e;a.startListening();return function(e){e=e||function(e){var t=document.createElement("IFRAME");t.setAttribute("src",e),t.setAttribute("height","1px"),t.setAttribute("width","1px"),document.documentElement.appendChild(t),t.parentNode.removeChild(t),t=null};var t={};function n(e){var t=String.fromCharCode(29);return(e=e.map(function(e){return e.replace(new RegExp(",","g"),t)})).join()}return t.resultForCallback=function(e,t){a.processCallback(e,t)},t.runningInIframe=function(){try{return window.self!==window.top}catch(e){return!0}},t.callObjC=function(n,o,i,s){var c=r.url(n,o),l=a.registerCallbacks(i,s),d="'"+l.ok+"'",u="'"+l.error+"'",p="BWKSNativeSQL.resultForCallback";t.runningInIframe()&&(p="function BWKSNativeSQL_callback_wrapper(callbackID, arg) { window.postMessage({ 'command': callbackID, 'arg': arg, 'to': '_widget' }, '*'); }; BWKSNativeSQL_callback_wrapper"),e(c+"&okCallbackId="+d+"&errorCallbackId="+u+"&callbackFunc="+p)},t.getItemsAsync=function(e,r,a){if(0==e.length)return o.error("NativeSQL Error: getItemsAsync without names"),void a({message:"NativeSQL Error: getItemsAsync without names"});t.callObjC("getItemsAsync",{names:n(e)},r,a)},t.getDirAttribs=function(e,n,r){t.callObjC("getDirAttribsAsync",{dirname:e},n,r)},t.setItemsAsync=function(e,n,r){if(0==e.length)return o.error("NativeSQL Error: setItemsAsync without names"),void r({message:"setItemsAsync without names"});if(e.length>1)return o.error("NativeSQL Error: setItemsAsync can only handle 1 item"),void r({message:"setItemsAsync can only handle 1 item"});var a=e[0];t.callObjC("setItemAsync",{keyname:a.key,value:a.value,attribs:a.attribs},n,r)},t.removeItemsAsync=function(e,r,a){if(0==e.length)return o.error("NativeSQL Error: removeItemsAsync without names"),void a({message:"NativeSQL Error: removeItemsAsync without names"});t.callObjC("removeItemsAsync",{names:n(e)},r,a)},t.clearAllAsync=function(e,t){t("Clearing all data in BookWidgets app is not supported")},t}}(n(64))},function(e,t,n){var r,o;e.exports=(r=n(331),n(11),(o=function(e,t,n,o){this.sender=new r(e,"*"),this.useSessionStorage=o,this.token=n}).prototype.postMessage=function(e,t,n){this.token&&(e.token=this.token),this.useSessionStorage&&(e.useSessionStorage=!0),this.sender.send(e,function(e,r){return e?n(e):t(r)})},o.prototype.getItemsAsync=function(e,t,n){this.postMessage({command:"getItems",names:e},t,n)},o.prototype.setItemsAsync=function(e,t,n){this.postMessage({command:"setItems",items:e},t,n)},o.prototype.removeItemsAsync=function(e,t,n){this.postMessage({command:"removeItems",names:e},t,n)},o.prototype.clearAllAsync=function(e,t){this.postMessage({command:"clear"},e,t)},o.prototype.getDirAttribs=function(e,t,n){this.postMessage({command:"getDirAttribs",name:e},t,n)},o)},function(e,t,n){e.exports=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=e('<div class="bw-throbber-wrapper bw-centering-container"></div>').appendTo(t),a=e('<canvas class="bw-throbber bw-centered" width="'+n+'" height="'+n+'">').appendTo(o),i=a[0].getContext("2d");i.translate(n/2,n/2);for(var s=30*n/100,c=0;c<s;++c){i.rotate(2*-Math.PI/s);var l=r?0:255;i.strokeStyle="rgba("+l+","+l+","+l+","+(1/s).toFixed(2)+")",i.lineWidth=3,i.moveTo(n/5,0),i.lineTo(2*n/5,0),i.stroke()}var d=null,u=!1;return window.requestAnimationFrame(function e(t){if(d||(d=t),!u){var n="rotate("+360*Math.floor(t/1e3*s)/s+"deg)";a.css({transform:n,"-webkit-transform":n,"-moz-transform":n,"-ms-transform":n}),window.requestAnimationFrame(e)}}),{close:function(){o.remove(),u=!0}}}}(n(0))},function(e,t,n){var r,o,a,i,s,c,l,d,u,p,f,h,g,v,m,w;e.exports=(r=n(2),o=n(146).o,a=n(338),i=n(339),s=n(142),c=n(143),n(46),l=n(376),u=new(n(377))(o),p=new a,f=new l(p),h=new i,g=new l(h),v=new s,m=new l(v),w=r.getPlatform(),-1!==window.location.search.substring(1).indexOf("bwds-proxy")?(d=new l(new c("_storage")),console.log("BWDS: Proxy")):"ibw-platform-ipad-bookwidgets"===w?(d=m,window.BWKSNativeSQL=v,console.log("BWDS: Native")):"ibw-platform-ipad-ibooks"===w?(console.log("BWDS: IndexedDB"),d=g):"ibw-platform-osx-chrome"!==w&&"ibw-platform-osx-preview"!==w&&"ibw-platform-win32-preview"!==w&&"ibw-platform-win32-chrome"!==w&&"ibw-platform-chromebook-chrome"!==w&&"ibw-platform-android-chrome"!==w||!window.openDatabase?(d=u,console.log("BWDS: Local")):(console.log("BWDS: WebSQL"),d=f),d.test={BWKSIDB:h,BWKSWebSQL:p,BWDSLocal:u,BWDSWebSQL:f},-1!==navigator.userAgent.indexOf("ibookwidgets")&&(window.BWDS=d),d)},function(e,t,n){var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n(141);function r(e){return"iBookWidgets/"+e}var o=e.createLogger("BWKSLocal");return{getItem:function(e){return o.debug("getItem "+r(e)),t.GetItem(r(e))},setItem:function(e,n){o.debug("setItem "+r(e));try{return t.SetItem(r(e),n),!0}catch(e){return!1}},removeItem:function(e){o.debug("removeItem "+r(e)),t.RemoveItem(r(e))},clear:function(){o.debug("clear"),t.Clear()}}}.bind(null,n(22));e.exports={f:r,o:r()}},,,,,,,,,,,,,,function(e,t,n){e.exports=function(e){var t={},n=function(e){return e<10?"0"+e:""+e};function r(e){var t=Array.prototype.slice.call(arguments,1);try{e&&e.apply(null,t)}catch(e){console.log("Received error when executing callback: "+e)}}return t.getDateTime=function(){var e=new Date;return n(e.getFullYear())+"-"+n(1+e.getMonth())+"-"+n(e.getDate())+" "+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds())},t.error=function(e,t){return{code:e,message:t}},t.trimLeadingSlash=function(e){return e.length>0&&"/"==e[0]?e.substr(1):e},t.newCallbackQueue=function(){var e={executeList:[],executing:!1,executeNext:function(){e.executeList.length>0?(e.executing=!0,e.executeList.shift().cb(e.executeNext)):e.executing=!1},executeSequential:function(t,n){if(null!=n&&!1!==n&&null!=n&&e.executeList.length>0)for(var r=0;r<e.executeList.length;++r)e.executeList[r].tag==n&&e.executeList.splice(r,1);e.executeList.push({cb:t,tag:n}),e.executing||e.executeNext()}};return e},t.callSafe=r,t.handleException=function(n,o,a){18==n.code?r(o,t.error(e.BWDS_ERROR_SECURITY,"AsyncBWDS Security Error: problem when accessing: "+JSON.stringify(n))):r(o,t.error(e.BWDS_ERROR_INTERNAL,"AsyncBWDS Error: problem when accessing: "+JSON.stringify(n))),a&&a()},t}(n(46))},function(e,t,n){var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n(41).o,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n(378).o,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n(90).o;return{createWidgetStorage:function(n,a,i,s,c,l,d,u,p){var f={};return f.os=r.createWidgetStorage(a,i,s,c,u,p),f.bs=o.createWidgetStorage(n,a,s,c,t.getUserId(),d,!1),f.loadAll=function(t){var n=e.Deferred(),r=e.Deferred();this.os.loadAll(function(e,t){n.resolve(e,t)}),this.bs.getVersion(function(e){r.resolve(e)});var o=this;e.when(n,r).done(function(e,n){var r=e[0],a=e[1];-1==a?(console.log("error accessing online data, return local data or null"),n.hasdata?o.bs.loadAll(t):t(c?null:{})):!1===n.offlinedata||n.version<a?o.bs.overwriteAndSetVersion(r,a).always(function(){t(r)}):o.bs.loadAll(function(e){o.os.overwrite(e,function(n){o.bs.setVersion(n.version).always(function(){t(e)})})})})},f.goneOnlineSync=function(t){var n=e.Deferred(),r=e.Deferred();this.os.loadAll(function(e,t){n.resolve(e,t)}),this.bs.getVersion(function(e){r.resolve(e)});var o=this;e.when(n,r).done(function(e,n){var r=e[0],a=e[1];-1==a?console.log("goneOnlineSync: Can't find online version"):n.version<a?(console.log("goneOnlineSync: local version out of date, need to use online version"),o.bs.overwriteAndSetVersion(r,a).always(function(){t({status:"CONFLICT",data:r})})):!0===n.offlinedata?(console.log("goneOnlineSync: latest version is local, pushing state online"),o.bs.loadAll(function(e){o.os.overwrite(e,function(e){o.bs.setVersion(e.version).always(function(){t({status:"OK"})})})})):t({status:"OK"})})},f.write=function(e,t){var n=this;n.bs.write(e,function(){n.os.write(e,function(e){void 0!==e&&e.hasOwnProperty("data")?n.bs.overwriteAndSetVersion(e.data,e.version).always(function(){t(e)}):t(e)})})},f.writeImage=function(t,n){var r=e.Deferred(),o=this;return o.bs.writeImage(t,n).done(function(){r.resolve(),o.os.writeImage(t,n).done(function(){o.bs.setImageBackedUp(t)}).fail(function(){})}).fail(function(){o.os.writeImage(t,n).done(function(){r.resolve()}).fail(function(){r.reject()})}),r},f.clearImage=function(t){var n=e.Deferred();return e.when(this.bs.clearImage(t),this.os.clearImage(t)).done(function(){n.resolve()}).fail(function(){n.reject()}),n},f.readImage=function(t){var n=e.Deferred(),r=this;return r.bs.readImage(t).done(function(e){n.resolve(e)}).fail(function(){r.os.readImage(t).done(function(e){n.resolve(e)}).fail(function(){n.reject()})}),n},f.moveImageOnline=function(t){var n=e.Deferred(),r=this;return r.bs.readImage(t).done(function(e){r.os.writeImage(t,e).done(function(){r.bs.setImageBackedUp(t),n.resolve()}).fail(function(){n.reject()})}).fail(function(){n.reject()}),n},f.moveImageOnlineIfRequired=function(){var t=e.Deferred(),n=this;return n.bs.listImagesAndBackupStatus().done(function(e){for(var r=0;r<e.length;++r)if(!1===e[r].backed_up)return void n.moveImageOnline(e[r].id).done(function(){t.resolve(!0)}).fail(function(){t.reject()});t.resolve(!1)}),t},f},createInfoStorage:function(e,n,a){var i={};return i.os=r.createInfoStorage(e,n,a),i.bs=o.createInfoStorage(e,t.getUserId(),!1),i.getCommonProperties=function(e){var t=this;this.os.getCommonProperties(function(n){t.bs.setCommonProperties(n),e(n)})},i.getGroupProperties=function(e){var t=this;this.os.getGroupProperties(function(n){t.bs.setGroupProperties(n),e(n)})},i.setCommonProperties=function(e){this.os.setCommonProperties(e),this.bs.setCommonProperties(e)},i.setGroupProperties=function(e){this.os.setGroupProperties(e),this.bs.setGroupProperties(e)},i}}}.bind(null,n(0));e.exports={f:r,o:r()}},,function(e,t,n){var r,o,a,i,s,c,l,d,u,p,f;n(164),e.exports=(r=n(1),o=n(204),a=n(205),i=n(293),s=n(3),c=n(0),l=n(25),d=n(7),u=n(408),p=n(34),n(425),f=n(2),void c(function(){r.getConfig().then(function(e){var t,n=c,r=a(o),h=i(e,o,r);function g(){return e.questions?e.questions.length:0}function v(){return"yes"===e.submit_answers||"yes"===e.show_answers||"Score only"===e.show_score||"Score vs maximum"===e.show_score}var m,w=0;function b(){C(1)}function y(e,n){if("true"===(n=n||c("#QC"+(e+1))).attr("noquestion"))t.setProgress(e,"done");else{var r=m(n);!0===r.answered?t.setProgress(e,"done"):!1===r.allunanswered?t.setProgress(e,"half"):t.setProgress(e,"")}}function k(){return v()?g()+1:g()}function C(o,a){if(f.isPreview()&&localStorage.setItem("QuizPreviewPage."+e.uuid2,o),c(".active").stop(!0,!0),c("#question-content")[0].scrollTop=0,w!==o){if(w>0&&w<=g()&&y(w-1),o>0&&o<=g()){var i=c("#QC"+o),l=i.attr("cindex"),d=e.questions[l],u=r.getNumbering(d,i.attr("numbering"));"true"!==d.noquestion||"yes"===e.info_numbering?t.setTextAndPosition(u,o-1):t.setTextAndPosition('<div class="bw-info">i</div>',o-1)}else t.setTextAndPosition('<div class="bw-info">i</div>',parseInt(-1));var p=1*w<1*o?900:-900,h="QC"+o,v=n("#"+h);v.css({top:p}).addClass("active"),r.questionIf.hasOwnProperty(h)&&r.questionIf[h].repaint&&r.questionIf[h].repaint(),v.animate({top:0},function(){if(w=o,s.removeAudioElements(),s.replacePlaceholders(".active"),r.questionIf.hasOwnProperty(h)&&r.questionIf[h].repaint&&r.questionIf[h].repaint(),"yes"===e.auto_play_audio){var t=c("#QC"+o+" audio");t.length>0&&t[0].play()}}),n(".quizwidget .question-content").css("overflow-y","hidden"),n("#QC"+w).animate({top:-p},function(){n(this).removeClass("active"),n(this).css("top","0"),n(".quizwidget .question-content").css("overflow-y","auto")}),a&&c(".active").stop(!0,!0),1===o?n(".prevarrow").addClass("bw-icon-hidden"):n(".prevarrow").removeClass("bw-icon-hidden"),o===k()?n(".nextarrow").addClass("bw-icon-hidden"):n(".nextarrow").removeClass("bw-icon-hidden")}}function T(){c("#questions").removeClass("questions_shown").css("left",0).animate({left:c("#questions").width()},function(){c("#questions").html("").css("left","100%")})}function x(e){C(this.getAttribute("index"),!0),T()}window.onresize=function(){c(".quizwidget").trigger("resized")};var _={getWidgetType:function(){return d("Quiz")},questionCount:g,preLoadInit:function(){t=l.createProgressCircle(".progress-container","progress",g()),p.centerTitle()},createQuestions:function(t,r,o){var a,i,s,l=0,u=0,p=n("#question-content"),m=0;for(a=0;a<g();++a){var w=t[a],y=r[w];if("true"!==y.noquestion&&++u,"true"===y.noquestion&&"yes"!==e.info_numbering||++l,y)if((s=n("<div class='content' id='"+(i="QC"+(a+1))+"' ></div>").appendTo(p)).attr("cindex",w),s.attr("qindex",l),s.attr("sindex","yes"===e.random_order?w:u),s.attr("question-type",y.Type),"true"===y.noquestion&&s.attr("noquestion","true"),void 0!==h.questionTypes[y.Type]){if("true"===y.noquestion||"yes"!==e.save_answers)h.questionTypes[y.Type].render(y,a+1,null);else{var k="#"+i;h.questionTypes[y.Type].render(y,a+1,o(k))}if("true"!==y.noquestion){var T=e.questions[parseInt(s.attr("cindex"))],x=h.questionTypes[y.Type].getAnswer(s,!0,T);x&&x.hasOwnProperty("outof")&&x.outof>0&&("yes"===e.show_question_points&&c(document.createElement("div")).addClass("question-points").html('<span class="scored-points">&nbsp;&nbsp;</span> / '+x.outof).prependTo(s),m+=parseFloat(x.outof))}}else console.error("Question type "+y.Type+" unknown.")}if(v()){s=c("<div class='submitpage' id='"+(i="QC"+(a+1))+"' ></div>").appendTo(p),"yes"===e.show_question_points&&m>0&&c(document.createElement("div")).addClass("question-points").html('<span class="scored-points">&nbsp;&nbsp;</span> / '+m).prependTo(s);var _,S,I,O=c("<div class='bw-centering-container'></div>").appendTo(s),A=c(document.createElement("div")).addClass("pre-submit bw-centered").appendTo(O);c('<div class="textdescriptiontitle">'+d("All done !")+"</div>").appendTo(A),"yes"===e.submit_answers?(_=d("Click the button to submit or go back to review your answers."),I="big-submit-button",S=d("Submit")):"yes"===e.show_answers?(_=d("Click the button to see the correct answers or go back to review your answers."),I="big-check-button",S=d("Show answers")):(_=d("Click the button to see your score or go back to review your answers."),I="big-check-button",S=d("Show score")),c(document.createElement("p")).text(_).appendTo(A),c(document.createElement("div")).attr("id",I).addClass("textbutton bw-button").text(S).appendTo(A);var E=c(document.createElement("div")).addClass("post-submit").appendTo(s),q=c('<div class="feedbackwrapper bw-centering-container"></div>').appendTo(E);c('<div class="bw-centered feedback"><div class="textdescriptiontitle">'+d("All done !")+"</div></div>").appendTo(q);var P=c(document.createElement("div")).addClass("textbutton bw-button bw-centered").tapOrClick(function(e){e.preventDefault(),e.stopPropagation(),b()}).appendTo(q);c(document.createElement("span")).css({position:"relative",left:"10px"}).addClass("bw-icon-small bw-icon-angle-left").appendTo(P),c(document.createElement("span")).css({position:"relative",left:"-10px"}).addClass("bw-icon-small bw-icon-angle-left").appendTo(P)}var D=1;if(f.isPreview()){var R=localStorage.getItem("QuizPreviewPage."+e.uuid2);R&&(D=parseInt(R),g()<D?D=1:console.log("Preview starts on page",D))}C(D),setTimeout(function(){c(".quizwidget .question-index .margin").css({"overflow-x":"hidden","overflow-y":"auto"})},100)},postCreateInit:function(){function t(){1!==w&&C(1*w-1)}function o(){w!==k()&&C(1*w+1)}n(".quizwidget .question-content").css("overflow-y","auto"),c(".bw-progress-circle").addClass("bw-button"),c(".bw-progress-circle").makeButton(d("Show question list")).tapOrClick(function(){c("#questions").hasClass("questions_shown")?T():function(){var t,n,o=c("#questions");for(n=0;n<g();++n){var a=c("#QC"+(n+1)),i=a.attr("cindex");if("true"===a.attr("noquestion"))"yes"==e.info_numbering?(t=r.getNumbering(e.questions[i],a.attr("numbering")),c('<div class="question-button bw-button" index="'+(n+1)+'">'+t+"</div>").appendTo(o)):c('<div class="question-button bw-button bw-info" index="'+(n+1)+'">i</div>').appendTo(o);else{""===(t=r.getNumbering(e.questions[i],a.attr("numbering")))&&(t="&nbsp;");var s=c('<div class="question-button bw-button" index="'+(n+1)+'">'+t+"</div>").appendTo(o),l=m(a);!0===r.checkMode&&"yes"===e.show_answers?!0===l.manual?s.addClass("manual"):!0===l.correct?s.addClass("correct"):!0!==l.allunanswered&&s.addClass("wrong"):!0===l.answered&&s.addClass("answered")}}v()&&c('<div class="question-button bw-button bw-info" index="'+(n+1)+'">i</div>').appendTo(o),o.addClass("questions_shown").css("left",o.width()).animate({left:0}),c(".question-button").makeButton().tapOrClick(x)}()}),n("#question-content .content").each(function(){!function(e){var t,n=e.attr("id");try{t=parseInt(n.substring(2))-1}catch(e){console.error("error...")}for(y(t,e);t>0&&"true"===c("#question-content .content[cindex='"+--t+"']").attr("noquestion");)y(t,e)}(c(this))}),n(".prevarrow").makeButton(d("Previous question")).tapOrClick(function(){n(this).hasClass("bw-icon-hidden")||t()}),n(".nextarrow").makeButton(d("Next question")).tapOrClick(function(){n(this).hasClass("bw-icon-hidden")||o()}),document.onkeydown=function(e){e=e||window.event,c(e.target).is("input, textarea")||("37"==e.keyCode?t():"39"==e.keyCode&&o())},"yes"===e.allow_text_selection&&c("body").addClass("allow_text_selection")},moveToStart:b,moveToSubmitSection:function(){C(g()+1)},setGetQuestionState:function(e){m=e}};return u(_,r,h),_})}))},function(e,t,n){"use strict";n.r(t);n(165),n(190),n(192),n(196),n(198)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t);var r=n(0),o=n(11),a=n(200),i=a.loadJS,s=a.loadCSS,c=!1,l=!1,d=new RegExp("https://www.bookwidgets.com/create/api/widgets/[0-9]+/preview/config.(css||js)?");function u(e){return 0===window.location.pathname.indexOf("/_ah/gcs/bookwidgets-eu--widgets/")?window.location.origin+"/_ah/gcs/bookwidgets-eu--widget-assets"+e:"widgets-eu.bookwidgets.com"===window.location.host?0===e.search(d)?e:"//widget-assets-eu.bookwidgets.com"+e:e}t.default=function(){var e=o.split(window.location.search.substring(1));e.dbg4&&n(201)({apiKey:e.dbg4,notifyReleaseStages:["production"],releaseStage:"production"});var t=r.Deferred();if(!1===l&&!1===c){c=!0;var a=u(e.content)||"config.js",d=u(e.design)||"config.css";r.when(i(a),s(d)).fail(function(){t.reject(new Error("Unable to load config file"))}).always(function(){c=!1,l=!1;var e=window.widgetconfig;t.resolve(e),-1===navigator.userAgent.indexOf("ibookwidgets")&&(window.widgetconfig=void 0)})}return t}},function(e,t,n){var r=n(0);e.exports={loadJS:function(e,t,n){var o=r.Deferred(),a=document.createElement("script");if(a.setAttribute("type","text/javascript"),n){var i=!0,s=!1,c=void 0;try{for(var l,d=n[Symbol.iterator]();!(i=(l=d.next()).done);i=!0){var u=l.value;a.setAttribute(u,n[u])}}catch(e){s=!0,c=e}finally{try{i||null==d.return||d.return()}finally{if(s)throw c}}}return a.onload=function(){o.resolve()},a.onerror=function(){window.navigator&&window.navigator.userAgent&&-1===window.navigator.userAgent.indexOf("PhantomJS")&&-1===window.navigator.userAgent.indexOf("HeadlessChrome")&&console.error("Could not load: "+e),o.reject()},a.setAttribute("src",e),document.getElementsByTagName(t||"head")[0].appendChild(a),o},loadCSS:function(e,t){var n=r.Deferred(),o=document.createElement("link");return o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.onload=function(){n.resolve()},o.onerror=function(){window.navigator&&window.navigator.userAgent&&-1===window.navigator.userAgent.indexOf("PhantomJS")&&-1===window.navigator.userAgent.indexOf("HeadlessChrome")&&console.error("Could not load: "+e),n.reject()},o.setAttribute("href",e),document.getElementsByTagName(t||"head")[0].appendChild(o),n}}},,,function(e,t,n){e.exports=function(e){var t=[];window.activateDesignInfoTooltips=function(){console.log("activateDesignInfoTooltips");var n=!0;e.each(t,function(t,r){var o=e(r[0]),a="n";o.height()>700?a=o.offset()&&o.offset().left>800?"e":"w":o.offset()&&o.offset().top>700&&(a="s"),o.attr("data-tipsy",r[1]).tipsy({html:!0,title:"data-tipsy",gravity:a}),e(r[0]).click(function(e){void 0!==window.previewsidebar&&n&&(window.previewsidebar.setSelectedItem(r[1]),n=!1,setTimeout(function(){n=!0},100))})})};var n=[],r=!1;var o=!1;window.BwNotifyWidgetLoaded=function(){o||(o=!0,window.parent.postMessage("BwWidgetLoaded","*"),window.clientApp&&window.clientApp.widgetLoaded&&window.clientApp.widgetLoaded())};var a=!0;function i(){for(;n.length>0;){n.shift()()}a&&window.BwNotifyWidgetLoaded()}return window.BwUseManualWidgetLoadedNotification=function(){a=!1},function(o){if("bwshortcode"in o&&(window.bwshortcode=o.bwshortcode),"pre"in o&&(console.log("Preview"),"designinfo"in o)){console.log("With design info");for(var a=0;a<o.designinfo.length;++a)s=o.designinfo[a].s,c=o.designinfo[a].d,t.push([s,c]);"undefined"!=typeof previewsidebar&&(console.log("Previewsidebar is defined, immediately set design config"),e(function(){var e;e=function(){window.CssUpdateCounter&&(console.log("has CssUpdateCounter -> updating configCss"),window.updateConfigCSS(window.CssUpdateCounter)),console.log("Activating tooltips"),setTimeout(function(){window.activateDesignInfoTooltips()},3e3)},r?setTimeout(e,0):n.push(e)}))}var s,c;if("bra"in o&&e(function(){"iPad"===navigator.platform&&-1!==navigator.userAgent.indexOf("BookWidgets")||e("body").append('<div class="branding"></img></div>')}),"tri"in o&&e(function(){if("iPad"===navigator.platform||-1===navigator.userAgent.indexOf("BookWidgets")&&-1===navigator.userAgent.indexOf("ibookwidgets")){e("body").append('<div class="dialog-sheet" id="preview_alert" style="color: red; text-shadow: none;">  <p>This is a free preview widget, created using a trial version of BookWidgets. <b>This widget may only be used for demonstration and evaluation purposes!</b></p>  <p>Please purchase a license key for the BookWidgets tool to remove this message.</p></div>');var t=e('<div class="dialog-sheet-shadow"/>');e(document.body).append(t),window.CreateDialogSheetFor("#preview_alert"),setTimeout(function(){e("#preview_alert").data("dialogSheet").show()},2e3),setTimeout(function(){e("#preview_alert").data("dialogSheet").hide()},6e3),setTimeout(function(){e("#preview_alert").data("dialogSheet").show()},3e4),setTimeout(function(){e("#preview_alert").data("dialogSheet").hide()},34e3)}}),void 0===String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")}),window.getWidgetUrl=function(){return window.location.href},window.bwbackbuttonlabel=null,"performance"in window==!1&&(window.performance={}),"now"in window.performance==!1){var l=Date.now();window.performance.timing&&window.performance.timing.navigationStart&&(l=window.performance.timing.navigationStart),window.performance.now=function(){return Date.now()-l}}return o.hasOwnProperty("backbutton_label")&&""!==o.backbutton_label&&(window.bwbackbuttonlabel=o.backbutton_label),"Vertical"===o.widget_orientation?e("html").addClass("vertical"):e("html").addClass("horizontal"),null!=o.widget_language&&""!==o.widget_language&&e("html").attr("lang",o.widget_language),o.hasOwnProperty("LocalizationMap")&&(window.bwlocalizationmap=o.LocalizationMap),setTimeout(i,0),null}}(n(0))},function(e,t,n){e.exports=function(e,t,n){var r=e;var o={matchImage:function(e,t,o,a){return e=n(e),r("None"===t?'<div><img src="'+e+'" style="max-width: 300px" /></div>':'<div><img src="'+e+'" /></div>')},getQuestionImageDivs:function(e,t,n,o){var a={};return o||(o="After"),n&&n.sources&&n.sources.length>0?(o.startsWith("Before")&&(a.imgdiv=r("<div></div>").appendTo(e)),a.questdiv=r("<div></div>").appendTo(e),a.audiodiv=r("<div></div>").appendTo(e),o.startsWith("Between")&&(a.imgdiv=r("<div></div>").appendTo(e)),a.answerdiv=r("<div></div>").appendTo(e),a.hintdiv=r("<div></div>").appendTo(e),a.rationalediv=r('<div class="rationale"></div>').appendTo(e),o.startsWith("After")&&(a.imgdiv=r("<div></div>").appendTo(e)),a.videodiv=r('<div class="videowrapper"></div>').appendTo(e)):(a.questdiv=r("<div></div>").appendTo(e),a.audiodiv=r("<div></div>").appendTo(e),a.answerdiv=r("<div></div>").appendTo(e),a.hintdiv=r("<div></div>").appendTo(e),a.rationalediv=r('<div class="rationale"></div>').appendTo(e),a.videodiv=r('<div class="videowrapper"></div>').appendTo(e)),a.titlediv=a.questdiv,a.textdiv=a.answerdiv,a},getIndexPrefix:function(e){return""===e?"":'<div class="questionnumber">'+t("QUESTION")+" "+e+"</div>"},getMailIndexPrefix:function(e){return e+". "},mH:"h3",MH:"h1",getConnectionType:function(){return"Straight"},getWidgetType:function(){return"quiz"},JspRtlOffset:function(){return 0},getScrollObject:function(){return e(".question-content")}};return o}(n(0),n(7),n(20))},function(e,t,n){var r,o,a,i,s,c,l,d,u,p=n(117),f=p.spellCheckAttribs,h=p.spellCheckAttribString;e.exports=(r=n(1),o=n(4),a=n(3),i=n(85),s=n(0),c=n(291),l=n(8),d=n(6),n(20),u=n(33),function(e){var t=r.getConfigSync(),n={};function p(e){return t.LocalizationMap[e]&&""!=t.LocalizationMap[e]?t.LocalizationMap[e]:e}return n.translate=p,n.localize=function(e,t,n){n=n||"",s(e).html(p(t)+n)},n.createRationale=function(e,t,r){if(null!=e.Rationale&&""!=e.Rationale||null!=e.rationale_img&&e.rationale_img.sources&&e.rationale_img.sources.length>0||void 0!==r){if(t.hasClass("rationale")||(t=t.find(".rationale").length>0?t.find(".rationale"):s('<div class="rationale"></div>').appendTo(t)),t.empty(),void 0!==r&&t.append(r),void 0!==e.Rationale){var a=s("<div class='the-rationale' >"+o.prepare(e.Rationale)+"</div>").appendTo(t);l.processRichTextImages(a),d.processRichTextWidgetPlayLinks(a,!0)}n.addOptionalImage(e.rationale_img,e.rationale_imgsize,a),t.hide()}else""===t.html()&&t.hasClass("rationale")&&t.hide()},n.showRationales=function(e){e.find(".rationale").each(function(){var e=s(this);""!==e.html()&&(e.show(),o.process(e.find(".bwmathquill")),i.resolveYoutubePlaceholders(e),a.processAudioTags(e))})},n.hideRationales=function(e){e.find(".rationale").hide()},n.createHint=function(e,t,n){if(null!=e.hint&&""!=e.hint){s("<div class='hint' >"+o.prepare(e.hint)+"</div>").appendTo(t).click(function(){s(this).hide(),s(this).parent().parent().find(".hintbutton").show()}).hide(),l.processRichTextImages(t),d.processRichTextWidgetPlayLinks(t,!0);var r=s("<div></div>").appendTo(t);s("<div class='hintbutton' >"+p("Show hint")+"</div>").appendTo(r).makeButton().click(function(){s(this).parent().parent().find(".hint").show(),s(this).hide(),n&&n()})}},n.getNumbering=function(e,n){return"yes"==t.auto_numbering?n:e.number},n.spellcheckattrib=function(){return h("yes"===t.spellcheck)},n.addSpellCheckAttrib=function(e){e.attr(f("yes"===t.spellcheck))},n.inputModeAttrib=function(e){return"Numerical"!==e?"":'pattern="[0-9]*" '},n.addInputModeAttrib=function(e,t){"Numerical"===t&&e.attr("pattern","[0-9]*")},n.replaceBadQuotes=function(e){return e.replace(/[\u2018\u2019]/g,"'")},n.compareVal=function(e,t,n){return(e=this.replaceBadQuotes(e))===(t=this.replaceBadQuotes(t))},n.matchesOneOfAnswers=function(e,t,n){n&&(e=e.toLowerCase(),t=t.toLowerCase()),e=this.replaceBadQuotes(e);for(var r=(t=this.replaceBadQuotes(t)).split(/\|\||##/),o=0;o<r.length;++o)if(e===r[o].trim())return!0;return!1},n.processEmbeddedElements=function(t){o.process(t.find(".bwmathquill")),i.resolveYoutubePlaceholders(t),"quiz"==e.getWidgetType()&&a.replaceAudioByPlaceholder(t),a.processAudioTags(t)},n.imageLoadedCallbacks=[],n.triggerImageLoaded=function(){for(var e=0;e<this.imageLoadedCallbacks.length;++e)n.imageLoadedCallbacks[e]()},n.addImageLoadedCallback=function(e){this.imageLoadedCallbacks.push(e)},n.createTextOrPictureAnswer=c.createTextOrPictureAnswer,n.createPairAnswer=c.createPairAnswer,n.createWordListAnswer=c.createWordListAnswer,n.createMultiSelectAnswerCollector=function(e,t,n){return{_score:"each"==e?0:t,max:"each"==e?0:t,correctness:[],answers:[],add:function(r,o,a){"each"===e?r?(this.max+=t,n?o?(this.answers.push(a),this.correctness.push(1),this._score+=t):(this.answers.push(""),this.correctness.push(0)):(this.answers.push(""),this.correctness.push(-1))):n?o?(this.answers.push(a),this.correctness.push(0),this._score-=t):(this.answers.push(""),this.correctness.push(1)):(this.answers.push(""),this.correctness.push(-1)):n?r?o?(this.answers.push(a),this.correctness.push(1)):(this.answers.push(""),this.correctness.push(0),this._score=0):o?(this.answers.push(a),this.correctness.push(0),this._score=0):(this.answers.push(""),this.correctness.push(1)):(this.answers.push(""),this.correctness.push(-1),this._score=0)},score:function(){return"each"==e&&this._score<0?0:this._score}}},n.needToSyncTags=function(){return this.checkMode||"yes"===t.color_correct_answers},n.data=function(e,t,n){return void 0===n?e.data(t):e.data(t,n)},n.hasData=function(e,t){return void 0!==e.data(t)},n.findByData=function(e,t,n,r){for(var o=e.find(t),a=0;a<o.length;++a){var i=s(o[a]);if(this.data(i,n)===r)return i}return console.log("not found ",n,r),s()},n.addClass=function(e,t){var n=e.attr("class"),r=n?n.split(" "):[];-1===r.indexOf(t)&&(r.push(t),e.attr("class",r.join(" ")))},n.removeClass=function(e,t){var n=e.attr("class"),r=n?n.split(" "):[],o=r.indexOf(t);-1!==o&&(r.splice(o,1),e.attr("class",r.join(" ")))},n.setTag=function(e,t){var n=this;e.each(function(){var e=s(this);n.addClass(e,"bw-tagged");var r=n.data(e,"tags")||{};r[t]=!0,n.data(e,"tags",r),n.needToSyncTags()&&n.addClass(e,t)})},n.clearTag=function(e,t){var n=this;e.each(function(){var e=s(this);n.addClass(e,"bw-tagged");var r=n.data(e,"tags")||{};r[t]=!1,n.data(e,"tags",r),n.needToSyncTags()&&n.removeClass(e,t)})},n.findTag=function(e,t){var n=this;return e.find(".bw-tagged").filter(function(){return!0===n.data(s(this),"tags")[t]})},n.hasTag=function(e,t){return!!e.is(".bw-tagged")&&!0===this.data(e,"tags")[t]},n.syncDomWithTags=function(e){var t=this;function n(e){var n=t.data(e,"tags");for(var r in n)n.hasOwnProperty(r)&&(n[r]?t.addClass(e,r):t.removeClass(e,r))}e.is(".bw-tagged")&&n(e),e.find(".bw-tagged").each(function(){n(s(this))})},n.clearDomTagInfo=function(e){var t=this;function n(e){var n=t.data(e,"tags");for(var r in n)n.hasOwnProperty(r)&&t.removeClass(e,r)}e.is(".bw-tagged")&&n(e),e.find(".bw-tagged").each(function(){n(s(this))})},n.syncDomWithTagsIfRequired=function(e){this.needToSyncTags()&&this.syncDomWithTags(e)},n.addNarrowScreenPadding=function(e){s(document.createElement("div")).addClass("narrow-screen-padding").appendTo(e)},n.addOptionalImage=function(e,t,n,r){if(e&&e.sources&&0!=e.sources.length){var o=t?t.toLowerCase():"big",a=s(document.createElement("figure")).addClass("picture").append(u.create({img:e,loadcb:r}).addClass(o)).appendTo(n);e.hasOwnProperty("caption")&&""!==e.caption&&(a.addClass("with-caption"),s(document.createElement("figcaption")).text(e.caption).appendTo(a))}},n.createOptionalImage=function(e,t,n){this.addOptionalImage(e.img,e.imgsize,t,n)},n.tabIndex=0,n.checkMode=!1,n.questionIf={},n.wrapTypeConstructor=function(e,t){function r(e){var t=s(e).attr("id");return n.questionIf[t]}return{save:function(e){return r(e).save()},load:function(e,t){return r(e).load(t)},clear:function(e){return r(e).clear()},render:function(o,a,i,s){var c=e(o,a,i,t,s);return n.questionIf["QC"+a]=c,c.hasOwnProperty("preprocessLoadData")&&(this.preprocessLoadData=function(e,t,n){return r(e).preprocessLoadData(t,n)}),c.hasOwnProperty("preprocessSaveData")&&(this.preprocessSaveData=function(e,t,n){return r(e).preprocessSaveData(t,n)}),c.hasOwnProperty("freeResources")&&(this.freeResources=function(e,t){return r(e).freeResources(t)}),c.hasOwnProperty("fetchAsset")&&(this.fetchAsset=function(e){return r(e).fetchAsset()}),c.hasOwnProperty("assetUploadCompleteCB")&&(this.assetUploadCompleteCB=function(e,t){return r(t).assetUploadCompleteCB(e)}),c.render()},prepareCorrection:function(e,t){return r(e).prepareCorrection(t)},getAnswer:function(e,t,n,o){return r(e).getAnswer(t,n,o)}}},n.QuestionTypeBase=function(e,t,n,r){return{data:e,pindex:t,changeCB:n,qc:r,save:function(){return null},load:function(){return!1},clear:function(){return!1},render:function(){return!1},prepareCorrection:function(){return null},getAnswer:function(){return null},setReadOnly:function(){return!1},loadCorrect:function(){return!1}}},n.QuestionTypeBasic=function(e,t,r,i,c){var u=n.QuestionTypeBase(e,t,r,i);return u.render=function(){this.questionid="QC"+t,this.question=c||s("#"+this.questionid),this.qindex=this.question.attr("qindex"),this.divs=this.qc.getQuestionImageDivs(this.question,this.data.imgsize,this.data.img,this.data.imgpos),n.addNarrowScreenPadding(this.question),this.numbering=n.getNumbering(this.data,this.qindex),this.question.attr("numbering",this.numbering),s("<"+this.qc.MH+" class='the-question'>"+this.qc.getIndexPrefix(this.numbering)+o.prepare(this.data.Question)+"</"+this.qc.MH+">").appendTo(this.divs.questdiv),l.processRichTextImages(this.divs.questdiv),d.processRichTextWidgetPlayLinks(this.divs.questdiv,!0),this.data.audio&&""!=this.data.audio&&a.createPlayer(this.data.audio,"quiz"===this.qc.getWidgetType()).appendTo(this.divs.audiodiv),this.renderTypeSpecificPart(),n.createHint(this.data,this.divs.hintdiv),this.divs.rationalediv.addClass("rationalediv"),n.createOptionalImage(e,this.divs.imgdiv),n.processEmbeddedElements(this.question)},u.renderTypeSpecificPart=function(){},u.prepareCorrection=function(e){return n.createRationale(e,this.divs.rationalediv),null},u},n.createCorrectWrongMarker=function(e){e=e||{};var t=s(document.createElement(e.hasOwnProperty("elementType")?e.elementType:"span")).addClass("cr-marker");return s(document.createElement("span")).addClass(e.hasOwnProperty("correctClass")?"cr-correct "+e.correctClass:"cr-correct").html("&#x2713;").appendTo(t),s(document.createElement("span")).addClass(e.hasOwnProperty("wrongClass")?"cr-wrong "+e.wrongClass:"cr-wrong").html("&#x2718;").appendTo(t),t},n.getStateFromAnswer=function(e){var t,n,r,o,a,i=0,s=0;if(e){if(e.correctness.constructor===Array){n=!0,o=!1,t=!0,a=!0;for(var c=0;c<e.correctness.length;++c)-2===e.correctness[c]&&(o=!0),1!==e.correctness[c]&&(n=!1),-1===e.correctness[c]?t=!1:a=!1;r=!1===n&&!1===o&&!1===a}else t=-1!==e.correctness,a=-1===e.correctness,n=1===e.correctness,o=-2===e.correctness,r=0===e.correctness;i=e.score,s=e.outof}return{answered:t,correct:n,wrong:r,manual:o,allunanswered:a,score:i,outof:s}},n.widgetSupportsCorrection=function(){return"yes"===t.show_answers||"yes"===t.color_correct_answers},n})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){e.exports=function(){function e(e){return window.location.origin+window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/")+1)+e}return{createTextOrPictureAnswer:function(t,n){return"undefined"==typeof bwshortcode?t:{type:"Image",url:e(n),name:t}},createPairAnswer:function(t,n,r,o){return"undefined"==typeof bwshortcode?""!==r?t+" - "+r:t+" -":""===r?void 0===n||""===n?{type:"WordPair",name1:t,name2:""}:{type:"ImageWordPair",url1:e(n),name1:t,name2:""}:void 0===n||""===n?void 0===o||""===o?{type:"WordPair",name1:t,name2:r}:{type:"WordImagePair",name1:t,name2:r,url2:e(o)}:void 0===o||""===o?{type:"ImageWordPair",name1:t,url1:e(n),name2:r}:{type:"ImagePair",name1:t,url1:e(n),name2:r,url2:e(o)}},createWordListAnswer:function(t,n){if("undefined"==typeof bwshortcode){for(var r=[],o=0;o<n.length;++o)r.push(n[o].name);return t+" - "+r.join(" ")}for(var a={name:t,list:[],type:"WordImageListPair"},i=0;i<n.length;++i)void 0!==n[i].pic&&""!==n[i].pic?a.list.push({name:n[i].name,url:e(n[i].pic)}):(a.list.push({name:n[i].name}),a.type="WordWordListPair");return a}}}()},function(e,t,n){var r,o,a;e.exports=(r=n(0),o=n(135),a=n(2),{bwMakeDragAndResizable:function(e,t,n,i,s){var c=-1!==a.getPlatform().indexOf("ibooks"),l=new o.Manager(e.get(0));l.add(new o.Pan({threshold:0,pointers:0})),c||l.add(new o.Pinch({threshold:0})).recognizeWith([l.get("pan")]);var d=null;function u(t){null===d&&(d={pos:e.offset(),width:e.width(),height:e.height(),center:{x:e.offset().left,y:e.offset().top}}),t&&!d.hasOwnProperty("last_rotation")&&(d.center=t.center)}function p(t){var n=t.scale;e.offset({top:d.pos.top+t.deltaY+(d.center.y-d.pos.top)*(1-n),left:d.pos.left+t.deltaX+(d.center.x-d.pos.left)*(1-n)}),c||(e.width(d.width*n),e.height(d.height*n))}function f(t){var n=e.width(),o=e.height(),a=e.position(),i=r(window).width(),c=r(window).height();e.width(n*t),e.height(o*t),e.css("left",(a.left-i/2)*t+i/2),e.css("top",(a.top-c/2)*t+c/2),s&&s()}l.on("hammer.input",function(e){e.isFinal&&(d=null)}),l.on("panstart panmove",function(e){"panstart"===e.type?u():(p(e),i&&i())}),c||(l.on("pinchstart pinchmove",function(e){"pinchstart"===e.type?u(e):(p(e),s&&s())}),l.on("pinchend pinchcancel",function(){d&&(d=null,u())})),t.tapOrClick(function(){f(1.25)}),n.tapOrClick(function(){f(.8)})}})},function(e,t,n){var r;e.exports=(r=n(294),function(e,t,n){for(var o=[],a=e.questions||[],i=0;i<a.length;++i){for(var s=a[i].Type,c=r[s],l=!0,d=0;d<o.length;++d)if(o[d][0]==c[0]){l=!1;break}l&&o.push(c)}for(var u={},p=0;p<o.length;++p){var f=o[p][1](t,n);for(var h in f)u[h]=f[h]}return{questionTypes:u}})},function(e,t,n){var r,o,a,i,s,c,l,d,u,p,f,h,g,v,m,w,b;e.exports=(r=n(295),o=n(297),a=n(302),i=n(303),s=n(304),c=n(305),l=n(306),d=n(312),u=n(313),p=n(314),f=n(316),h=n(318),g=n(319),v=n(321),m=n(322),w=n(323),b=n(326),{TextDescription:["qt_textdescription",r],TextMultpleChoice:["qt_multiplechoice",o],RatedMultipleChoice:["qt_multiplechoice",o],TextMultiSelect:["qt_multiselect",a],QuestionTable:["qt_questiontable",i],PictureMultpleChoice:["qt_picturemultiplechoice",s],PictureMultiSelect:["qt_picturemultiplechoice",s],MultiLine:["qt_multiline",c],RichText:["qt_richtext",l],ExtraMultiLine:["qt_extramultiline",d],ExtraCheckbox:["qt_extracheckbox",u],FillInText:["qt_fillintext",p],FillInTable:["qt_fillintable",f],AnnotatePicture:["qt_annotatepicture",h],SingleLine:["qt_singleline",g],PictureOrdering:["qt_pictureordering",v],WordOrdering:["qt_wordordering",m],WordMatch:["qt_match",w],WordPictureMatch:["qt_match",w],PicturePictureMatch:["qt_match",w],AudioWordMatch:["qt_match",w],AudioPictureMatch:["qt_match",w],TextDragDrop:["qt_dragdrop",b],PictureDragDrop:["qt_dragdrop",b],Whiteboard:["qt_whiteboard",n(327)],Photo:["qt_photo",n(384)],Numeric:["qt_numeric",n(387)],BalanceChemicalEquation:["qt_balancechemicalequation",n(388)],IonicCompoundBuilder:["qt_ioniccompoundbuilder",n(389)],CorrectSentence:["qt_correct_sentence",n(390)],MarkSentence:["qt_marksentence",n(392)],DragWordsInSentence:["qt_dragwordsinsentence",n(394)],Group:["qt_group",n(396)],AudioRecording:["qt_audiorecording",n(398)]})},function(e,t,n){var r,o,a,i,s,c,l,d,u=n(296).processEmbeddedIframes;e.exports=(r=n(1),o=n(4),a=n(3),i=n(0),s=n(86),c=n(85),l=n(8),d=n(6),function(e,t){var n=r.getConfigSync(),p={};function f(){}return p.TextDescription={save:f,load:f,clear:f,render:function(r,p,f){var h,g,v="QC"+p,m=i("#"+v),w=m.attr("qindex"),b=e.getQuestionImageDivs(m,r.imgsize,r.img,r.imgpos),y="yes"==n.info_numbering?t.getNumbering(r,w):"";if(m.attr("numbering",y),i("<"+e.MH+" class='textdescriptiontitle'>"+e.getIndexPrefix(y)+o.prepare(r.Title)+"</"+e.MH+">").appendTo(b.titlediv),l.processRichTextImages(b.titlediv),d.processRichTextWidgetPlayLinks(b.titlediv,!0),i('<div class = "textdescription">'+o.prepare(r.Text)+"</div>").appendTo(b.textdiv),l.processRichTextImages(b.textdiv),d.processRichTextWidgetPlayLinks(b.textdiv,!0),r.audio&&""!=r.audio&&a.createPlayer(r.audio,"quiz"==e.getWidgetType()).appendTo(b.audiodiv),t.createHint(r,b.hintdiv),b.rationalediv.addClass("rationalediv"),t.createOptionalImage(r,b.imgdiv),""!=r.videoid)i("<div class='videodiv'><div id='"+(C=v+"_video")+"'></div></div>").appendTo(b.videodiv),c.playYouTube("#"+C,r.videoid);else if(""!=r.url&&"I have a URL"===r.linktype||""!=r.iframe_embed_code&&"I have an iframe embed code"===r.linktype){var k,C=v+"_video";k="I have a URL"===r.linktype?r.url:i((h=r.iframe_embed_code,(g=document.createElement("div")).innerHTML=h,0===g.childNodes.length?"":g.childNodes[0].nodeValue)).attr("src");var T={src:s(k)};""!==r.width&&(T.width=r.width),""!==r.height&&(T.height=r.height);var x=i(document.createElement("iframe")).attr(T).appendTo(b.videodiv);u(x)}t.processEmbeddedElements(m)},prepareCorrection:function(e,n){t.createRationale(n,e.find(".rationalediv"))},getAnswer:function(t){return{question:i(t).find(e.MH).html(),answer:"",correctness:1,score:0,outof:0}}},p})},function(e,t,n){"use strict";function r(e){var t=["allow-forms","allow-modals","allow-pointer-lock","allow-popups","allow-popups-to-escape-sandbox","allow-same-origin","allow-scripts"];null!=document.hasStorageAccess&&t.push("allow-storage-access-by-user-activation");try{e.attr({allow:"microphone",sandbox:t.join(" ")})}catch(e){console.log()}}n.r(t),n.d(t,"processEmbeddedIframes",function(){return r})},function(e,t,n){var r,o,a,i,s,c,l,d,u;e.exports=(n(1),r=n(4),o=n(3),a=n(2),i=n(0),s=n(25),c=n(8),l=n(6),d=n(26),u=n(5),function(e,t){var n={};function p(e,t){i(e).find(".bw-radiobutton").each(function(){i(this).attr("answer")===t?i(this).trigger("check"):i(this).trigger("clear")})}function f(e){i(e).find(".bw-radiobutton").trigger("clear")}function h(e){return i(e).find("[checked='checked']").attr("answer")}return n.TextMultpleChoice={name:"TextMultpleChoice",save:h,load:p,clear:f,render:function(n,u,p,f){var h="QC"+u,g=(f=f||i("#"+h)).attr("qindex"),v={};t.questionIf[h]=v,v.setReadOnly=function(e){-1==a.getPlatform().indexOf("ipad")&&f.find(".bw-radiobutton").prop("disabled",e)},v.loadCorrect=function(e){f.find(".bw-radiobutton").trigger("clear"),f.find(".tmc-row[value="+e.Valid+"]").trigger("check")};var m=e.getQuestionImageDivs(f,n.imgsize,n.img,n.imgpos);t.addNarrowScreenPadding(f);var w=t.getNumbering(n,g);f.attr("numbering",w),i("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(w)+r.prepare(n.Question)+"</"+e.MH+">").appendTo(m.questdiv),c.processRichTextImages(m.questdiv),l.processRichTextWidgetPlayLinks(m.questdiv,!0),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(m.audiodiv);var b=i("<div class='tmc-cover'></div>").appendTo(m.answerdiv);if(n.Answers)for(var y=d.randomIndexList(n.Answers.length),k=0;k<n.Answers.length;++k){var C="yes"===n["random-answer-order"]?y[k]:k,T=r.prepare(n.Answers[C].trim());t.tabIndex+=1;var x=s.createLabeledRadiobutton(b,T,function(){t.checkMode||(i(this).parent().find(".bw-radiobutton").trigger("clear"),i(this).trigger("check"),null!==p&&p())});x.find(".bw-button-label").append(t.createCorrectWrongMarker()),x.attr("answer",n.Answers[C]).attr("value",C+1).addClass("tmc-row"),"yes"===n["multi-column"]&&x.addClass("tmc-multi-column")}return t.createHint(n,m.hintdiv),m.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,m.imgdiv),t.processEmbeddedElements(f),f},prepareCorrection:function(e,n){var r=e.find(".tmc-row[value="+n.Valid+"]");r.length>0&&t.setTag(r,"tmc-answer"),t.createRationale(n,e.find(".rationalediv"))},getAnswer:function(t,n,r){var o=i(t),a=o.find(e.MH).html(),s=o.find("[checked='checked']");if(n){var c=s.length?s.attr("value"):null,l=u.check.TextMultpleChoice(r,c),d=null;try{d=r.Answers[parseInt(r.Valid)-1]}catch(e){}return{question:a,answer:-1===l.correctness?"":s.attr("answer"),check_input:c,correctness:l.correctness,score:l.score,outof:l.outof,canonicalAnswer:d}}return{question:a,answer:s.length>0?s.attr("answer"):""}}},n.RatedMultipleChoice={name:"RatedMultpleChoice",save:h,load:p,clear:f,render:function(n,d,u,p){var f="QC"+d,h=(p=p||i("#"+f)).attr("qindex"),g={};t.questionIf[f]=g,g.setReadOnly=function(e){-1==a.getPlatform().indexOf("ipad")&&p.find(".bw-radiobutton").prop("disabled",e)};var v=e.getQuestionImageDivs(p,n.imgsize,n.img,n.imgpos);t.addNarrowScreenPadding(p);var m=t.getNumbering(n,h);p.attr("numbering",m),i("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(m)+r.prepare(n.Question)+"</"+e.MH+">").appendTo(v.questdiv),c.processRichTextImages(v.questdiv),l.processRichTextWidgetPlayLinks(v.questdiv,!0),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(v.audiodiv);for(var w=i("<div class='rmc-cover'></div>").appendTo(v.answerdiv),b=n.Answers?n.Answers:[],y=0;y<b.length;++y){var k=r.prepare(b[y].answer.trim());t.tabIndex+=1;var C=s.createLabeledRadiobutton(w,k,function(){t.checkMode||(i(this).parent().find(".bw-radiobutton").trigger("clear"),i(this).trigger("check"),null!==u&&u())});C.attr("answer",b[y].answer).attr("value",y).addClass("tmc-row"),"yes"==n["multi-column"]&&C.addClass("tmc-multi-column")}t.createHint(n,v.hintdiv),v.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,v.imgdiv),t.processEmbeddedElements(p)},prepareCorrection:function(e,n){t.createRationale(n,e.find(".rationalediv"))},getAnswer:function(t,n,r){var o=i(t).find(e.MH).html(),a=i(t).find("[checked='checked']"),s=a.length?a.attr("value"):null,c=u.check.RatedMultipleChoice(r,s);return{question:o,answer:a.attr("answer")||"",check_input:s,correctness:c.correctness,score:c.score,outof:c.outof}}},n})},,,,function(e,t,n){"use strict";n.r(t),t.default=function(e){return"undefined"==typeof window||window.navigator&&window.navigator.userAgent&&(window.navigator.userAgent.indexOf("PhantomJS")>=0||window.navigator.userAgent.indexOf("ibookwidgets")>=0)?e:(new window.DOMParser).parseFromString("<html>"+e+"</html>","text/html").documentElement.textContent}},function(e,t,n){var r,o,a,i,s,c,l,d,u;e.exports=(n(1),r=n(4),o=n(3),a=n(2),i=n(0),s=n(25),c=n(8),l=n(6),d=n(26),u=n(5),function(e,t){var n={},p=i;function f(e){return e.replace(/\D/g," ")}function h(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1}return n.TextMultiSelect={Name:"TextMultiSelect",save:function(e){for(var t=i(e),n=[],r=t.find(".bw-checkbox").length,o=0;o<r;++o)"checked"===t.find(".bw-checkbox[value="+o+"]").attr("checked")?n.push(1):n.push(0);return JSON.stringify(n)},load:function(e,t){var n=JSON.parse(t);i(e).find(".bw-checkbox").each(function(e){var t=i(this);1===n[parseInt(t.attr("value"))]?t.trigger("check"):t.trigger("clear")})},clear:function(e){i(e).find(".bw-checkbox").trigger("clear")},render:function(n,u,g,v){var m="QC"+u,w=(v=v||i("#"+m)).attr("qindex"),b={};t.questionIf[m]=b,b.setReadOnly=function(e){-1===a.getPlatform().indexOf("ipad")&&v.find(".bw-checkbox").prop("disabled",e)},b.loadCorrect=function(e){var t=f(e.Valid).split(" ");v.find(".bw-checkbox").each(function(){var e=i(this);h(t,parseInt(e.attr("value"))+1+"")?e.trigger("check"):e.trigger("clear")})};var y=e.getQuestionImageDivs(v,n.imgsize,n.img,n.imgpos);t.addNarrowScreenPadding(v);var k=t.getNumbering(n,w);v.attr("numbering",k),p("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(k)+r.prepare(n.Question)+"</"+e.MH+">").appendTo(y.questdiv),c.processRichTextImages(y.questdiv),l.processRichTextWidgetPlayLinks(y.questdiv,!0),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"===e.getWidgetType()).appendTo(y.audiodiv);var C=p("<div class='tmc-cover'></div>").appendTo(y.answerdiv);if(n.Answers)for(var T=d.randomIndexList(n.Answers.length),x=0;x<n.Answers.length;++x){var _="yes"===n["random-answer-order"]?T[x]:x,S=r.prepare(n.Answers[_].trim());t.tabIndex+=1;var I=s.createLabeledCheckbox(C,S,function(){t.checkMode||null!=g&&g()});I.find(".bw-button-label").append(t.createCorrectWrongMarker()),I.attr("value",_).addClass("tmc-row"),"yes"===n["multi-column"]&&I.addClass("tmc-multi-column")}t.createHint(n,y.hintdiv),y.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,y.imgdiv),t.processEmbeddedElements(v)},prepareCorrection:function(e,n){if(null!=n.Valid){var r=f(n.Valid).split(" ");e.find(".tmc-row").each(function(){var e=i(this);h(r,parseInt(e.attr("value"))+1+"")&&t.setTag(e,"tmc-answer")})}t.createRationale(n,e.find(".rationalediv"))},getAnswer:function(t,n,r){for(var o=i(t),a=o.find(e.MH).html(),s=[],c=[],l=r.Answers?r.Answers:[],d=0;d<l.length;++d){var p="checked"===o.find(".bw-checkbox[value="+d+"]").attr("checked");s.push(p),c.push(p?l[d]:"")}if(n){var f=u.check.TextMultiSelect(r,s);return{question:a,answer:c,check_input:s,correctness:f.correctness,score:f.score,outof:f.outof}}return{question:a,answer:c}}},n})},function(e,t,n){var r,o,a,i,s,c,l,d,u;e.exports=(n(1),r=n(4),o=n(3),a=n(2),i=n(0),s=n(9),c=n(25),l=n(8),d=n(6),u=n(5),function(e,t){var n={};return n.QuestionTable={save:function(e){var t={};return i(e).find("tr.question").each(function(){var e=i(this).attr("nr"),n=i(this).find("[checked='checked']").attr("value");t[e]=n}),JSON.stringify(t)},load:function(e,t){var n=i(e);this.clear(e);var r=JSON.parse(t);n.find("tr.question").each(function(){var e=i(this).attr("nr"),t=r[e];if(void 0!==t&&""!==t){var n=i(this).find(".bw-simple-radiobutton[value='"+t+"']");n.trigger("check"),n.parent().addClass("qt-checked")}}),this.check(n)},clear:function(e){var t=i(e);t.find(".qt-checked").removeClass("qt-checked"),t.find(".bw-simple-radiobutton").trigger("clear")},splitRow:function(e,t){return e.rows[t].split(/\|\||##/)},rowQuestion:function(e,t){return this.splitRow(e,t)[0].trim()},rowAnswer:function(e,t){var n=this.splitRow(e,t);return n.length>1?n[1].trim():null},render:function(n,s,u,p){var f="QC"+s,h=(p=p||i("#"+f)).attr("qindex"),g={};t.questionIf[f]=g,g.setReadOnly=function(e){-1==a.getPlatform().indexOf("ipad")&&p.find(".bw-simple-radiobutton").prop("disabled",e)};var v=this;g.loadCorrect=function(e){p.find(".qt-checked").removeClass("qt-checked");for(var t={},n=e.columns?e.columns:[],r=0;r<n.length;++r)t[n[r].trim()]=r;for(var o=p.find("tr.question"),a=e.rows?e.rows:[],s=0;s<a.length;++s){var c=v.rowAnswer(e,s);if(null!==c&&t.hasOwnProperty(c)){var l=i(o[s]),d=i(l.find(".bw-simple-radiobutton")[t[c]]);d.trigger("check"),d.parent().addClass("qt-checked")}}};var m=e.getQuestionImageDivs(p,n.imgsize,n.img,n.imgpos);t.addNarrowScreenPadding(p);var w=t.getNumbering(n,h);p.attr("numbering",w),i("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(w)+r.prepare(n.Question)+"</"+e.MH+">").appendTo(m.questdiv),l.processRichTextImages(m.questdiv),d.processRichTextWidgetPlayLinks(m.questdiv,!0),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(m.audiodiv);var b=i("<div class='qt-cover'></div>").appendTo(m.answerdiv),y=i("<table></table>").appendTo(b),k=i("<tr></tr>").appendTo(y);function C(e){return f+"_answer_"+e}if(i("<th></th>").appendTo(k),n.columns)for(var T=0;T<n.columns.length;++T){var x=n.columns[T].trim();i("<th>"+r.prepare(x)+"</th>").attr("id",C(T)).appendTo(k)}var _=this;if(n.rows)for(var S=0;S<n.rows.length;++S){var I=i('<tr class="question"></tr>').appendTo(y);I.attr("nr",S);var O=this.rowQuestion(n,S);i("<th class='nocenter'>"+r.prepare(O)+"</td>").appendTo(I);var A=n.columns?n.columns:[];for(T=0;T<A.length;++T){var E=i("<td></td>").appendTo(I);c.createSimpleRadiobutton(E,function(){if(!t.checkMode){var e=i(this),n=i(this.parentNode.parentNode);n.find(".qt-checked").removeClass("qt-checked"),n.find(".bw-simple-radiobutton").trigger("clear"),e.trigger("check"),e.parent().addClass("qt-checked"),_.check(p),null!=u&&u()}},C(T)).attr("value",T).attr("name","qt_"+s+"_"+S)}I.append(t.createCorrectWrongMarker({elementType:"td"}))}t.createHint(n,m.hintdiv),m.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,m.imgdiv),t.processEmbeddedElements(p)},prepareCorrection:function(e,n){var r=n.columns?n.columns:[],o={rows:n.rows?n.rows:[],columns:r,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(o));var a,c=[];for(a=0;a<r.length;++a)c[r[a].trim()]=!0;for(var l=e.find("tr.question"),d=0;d<l.length;++d){var u=i(l[d]),p=this.rowAnswer(n,d);for(null===p||c.hasOwnProperty(p)||s.showAlert("'"+p+"' is not a valid answer for question <br><br>"+this.rowQuestion(n,d),"Configuration error"),a=0;a<r.length;++a)r[a].trim()===p&&t.setTag(i(u.find("td")[a]),"qt-answer")}this.check(e),t.createRationale(n,e.find(".rationalediv"))},getCheckInput:function(e){var t=[];return e.find("tr.question").each(function(){var e=i(this).find("[checked='checked']");if(e.length>0){var n=e.attr("value");t.push(n)}else t.push(null)}),t},check:function(e){try{var n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}for(var r=this.getCheckInput(e),o=u.check.QuestionTable(n,r),a=e.find("tr.question"),s=0;s<a.length;++s){var c=i(a[s]);1===o.correctness[s]?(t.setTag(c,"qt-correct"),t.clearTag(c,"qt-wrong")):0===o.correctness[s]?(t.clearTag(c,"qt-correct"),t.setTag(c,"qt-wrong")):(t.clearTag(c,"qt-correct"),t.clearTag(c,"qt-wrong"))}},getAnswer:function(t,n,r){var o=i(t),a=o.find(e.MH).html(),s=[];o.find("tr.question").each(function(){var e=i(this).find("[checked='checked']");if(e.length>0){var t=e.attr("value"),n=parseInt(t);s.push(isNaN(n)?"":r.columns[n])}else s.push(null)});var c=this.getCheckInput(o);if(n){var l=u.check.QuestionTable(r,c);return{question:a,answer:s,check_input:c,correctness:l.correctness,score:l.score,outof:l.outof}}return{question:a,answer:s}}},n})},function(e,t,n){var r,o,a,i,s,c,l;e.exports=(n(1),r=n(4),o=n(3),a=n(0),n(20),i=n(8),s=n(6),c=n(5),l=n(33),function(e,t){var n={};function d(e){return e.replace(/\D/g," ")}function u(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1}return n.PictureMultpleChoice={save:function(e){var n=a(e).find(".selected");return t.data(n,"report-name")},load:function(e,n){a(e).find(".pmc-quiz").each(function(){var e=a(this);t.data(e,"report-name")===n?e.trigger("check"):e.trigger("clear")})},clear:function(e){a(e).find(".pmc-quiz").trigger("clear")},render:function(n,c,d,u){var p="QC"+c,f=(u=u||a("#"+p)).attr("qindex"),h={};t.questionIf[p]=h,h.loadCorrect=function(e){u.find(".pmc-quiz").each(function(){var t=a(this);t.attr("value")+""==e.Valid+""?t.trigger("check"):t.trigger("clear")})};var g=e.getQuestionImageDivs(u,n.imgsize,n.img,n.imgpos),v=t.getNumbering(n,f);a("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(v)+r.prepare(n.Question)+"</"+e.MH+">").appendTo(g.questdiv),i.processRichTextImages(g.questdiv),s.processRichTextWidgetPlayLinks(g.questdiv,!0),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(g.audiodiv),u.attr("numbering",v);var m=a("<div class='pmc-cover'></div>").appendTo(g.answerdiv);if(n.Answers){for(var w=0;w<n.Answers.length;++w){var b=n.Answers[w].sources[0].src,y=a(document.createElement("div")).addClass("pmc-quiz");l.create({img:n.Answers[w],type:"div",background:"white",disable_click:!0,disable_press:!0}).appendTo(y),y.bind("check",function(){a(this).addClass("selected").attr({"aria-checked":"true"})}),y.bind("clear",function(){a(this).removeClass("selected").attr({"aria-checked":"false"})}),y.trigger("clear"),y.css({position:"relative"}),t.data(y,"report-name",n.Answers[w].origbase),y.attr({value:w+1,pic:b}),a('<div class="right-picture"></div>').appendTo(y),t.createCorrectWrongMarker({elementType:"div"}).addClass("picture-marker").appendTo(y),y.appendTo(m),y.makeButton({role:"radio"}).clickOrHold(function(e){var n;t.checkMode||(a(n=this).hasClass("selected")?a(n).trigger("clear"):(a(n.parentNode).find(".pmc-quiz").trigger("clear"),a(n).trigger("check")),null!=d&&d())},function(){a(this).find("[role=image]").trigger("zoom")},1e3)}(w>3||""!=n.img)&&m.css({margin:"auto"})}t.processEmbeddedElements(u),t.createHint(n,g.hintdiv),g.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,g.imgdiv)},prepareCorrection:function(e,n){var r=e.find(".pmc-quiz");r.length>=n.Valid&&t.setTag(a(r[n.Valid-1]),"pmc-answer"),t.createRationale(n,e.find(".rationalediv"))},getAnswer:function(n,r,o){var i=a(n),s=i.find(e.MH).html(),l=i.find(".selected"),d=l.length?l.attr("value"):null,u=0===l.length?"":t.createTextOrPictureAnswer(t.data(l,"report-name"),l.attr("pic"));if(r){var p=c.check.PictureMultpleChoice(o,d);return{question:s,answer:u,check_input:d,correctness:p.correctness,score:p.score,outof:p.outof}}return{question:s,answer:u}}},n.PictureMultiSelect={save:function(e){var n=[];return a(e).find(".selected").each(function(){n.push(t.data(a(this),"report-name"))}),JSON.stringify(n)},load:function(e,n){try{var r=JSON.parse(n);a(e).find(".pmc-quiz").each(function(){-1!=r.indexOf(t.data(a(this),"report-name"))&&a(this).trigger("check")})}catch(e){console.error("Error loading PictureMultiSelect data")}},clear:function(e){a(e).find(".pmc-quiz").trigger("clear")},render:function(n,c,p,f){var h="QC"+c,g=(f=f||a("#"+h)).attr("qindex"),v={};t.questionIf[h]=v,v.loadCorrect=function(e){var t=d(e.Valid).split(" "),n=1;f.find(".pmc-quiz").each(function(){u(t,n+++"")?a(this).trigger("check"):a(this).trigger("clear")})};var m=e.getQuestionImageDivs(f,n.imgsize,n.img,n.imgpos),w=t.getNumbering(n,g);a("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(w)+r.prepare(n.Question)+"</"+e.MH+">").appendTo(m.questdiv),i.processRichTextImages(m.questdiv),s.processRichTextWidgetPlayLinks(m.questdiv,!0),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(m.audiodiv),f.attr("numbering",w),f.attr("scoring-weight",n["scoring-weight"]),f.attr("policy",n.policy);var b=a("<div class='pmc-cover'></div>").appendTo(m.answerdiv);if(n.Answers)for(var y=0;y<n.Answers.length;++y){var k=n.Answers[y].sources[0].src,C=a(document.createElement("div")).addClass("pmc-quiz");l.create({img:n.Answers[y],type:"div",background:"white",disable_click:!0,disable_press:!0}).appendTo(C),C.bind("check",function(){a(this).addClass("selected").attr({"aria-checked":"true"})}),C.bind("clear",function(){a(this).removeClass("selected").attr({"aria-checked":"false"})}),C.trigger("clear"),C.css({position:"relative"}),t.data(C,"report-name",n.Answers[y].origbase),C.attr({pic:k}),a('<div class="right-picture"></div>').appendTo(C),t.createCorrectWrongMarker({elementType:"div"}).addClass("picture-marker").appendTo(C),C.appendTo(b),C.makeButton({role:"checkbox"}).clickOrHold(function(e){var n;t.checkMode||(a(n=this).hasClass("selected")?a(n).trigger("clear"):a(n).trigger("check"),null!=p&&p())},function(){a(this).find("[role=image]").trigger("zoom")},1e3)}t.processEmbeddedElements(f),t.createHint(n,m.hintdiv),m.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,m.imgdiv)},prepareCorrection:function(e,n){if(null!=n.Valid)for(var r=d(n.Valid).split(" "),o=e.find(".pmc-quiz"),i=0;i<o.length;++i)u(r,1+i+"")&&t.setTag(a(o[i]),"pmc-answer");t.createRationale(n,e.find(".rationalediv"))},getAnswer:function(n,r,o){var i=a(n),s=i.find(e.MH).html(),l=[],d=[];i.find(".pmc-quiz").each(function(e){var n=a(this).hasClass("selected");l.push(n),d.push(n?t.createTextOrPictureAnswer(t.data(a(this),"report-name"),a(this).attr("pic")):"")});var u=c.check.PictureMultiSelect(o,l);return{question:s,answer:d,check_input:l,correctness:u.correctness,score:u.score,outof:u.outof}}},n})},function(e,t,n){var r,o,a,i,s,c,l,d;e.exports=(n(1),r=n(4),o=n(3),a=n(2),i=n(0),s=n(63),c=n(8),l=n(6),d=n(5),function(e,t){var n={},u=i;return n.MultiLine={name:"MultiLine",save:function(e){return u(e).find(".edit").val()},load:function(e,t){var n=u(e);n.find(".edit").val(t),this.check(n)},clear:function(e){var t=u(e);t.find(".edit").val(""),this.check(t)},getCheckInput:function(e){return e.find(".edit").val()},check:function(e){try{var n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}for(var r=this.getCheckInput(e),o=d.check.MultiLine(n,r),a=!0,i=0;i<o.keywords.length;++i)if(o.keywords[i].match){a=!1;break}var s=e.find(".ml-cover");switch(o.correctness){case 0:a?t.setTag(s,"ml-none"):t.clearTag(s,"ml-none"),t.clearTag(s,"ml-answer");break;case 1:t.clearTag(s,"ml-none"),t.setTag(s,"ml-answer");break;case-2:t.setTag(s,"ml-open");break;case-1:t.clearTag(s,"ml-open"),t.clearTag(s,"ml-none"),t.clearTag(s,"ml-answer")}},render:function(n,p,f,h){var g=this,v="QC"+p,m=(h=h||i("#"+v)).attr("qindex"),w={};t.questionIf[v]=w,w.setReadOnly=function(e){-1==a.getPlatform().indexOf("ipad")&&h.find("textarea").prop("disabled",e)},w.loadCorrect=function(e){h.find(".edit").val(e.Keywords.join("\n")),g.check(h)};var b=e.getQuestionImageDivs(h,n.imgsize,n.img,n.imgpos),y=t.getNumbering(n,m);h.attr("numbering",y),u("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(y)+r.prepare(n.Question)+"</"+e.MH+">").appendTo(b.questdiv),c.processRichTextImages(b.questdiv),l.processRichTextWidgetPlayLinks(b.questdiv,!0),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(b.audiodiv);var k=u("<div class='ml-cover hidecover bw-column-container'></div>").appendTo(b.answerdiv),C=i(document.createElement("div")).addClass("bw-column-resizing").appendTo(k),T=u("<textarea "+t.spellcheckattrib()+" ></textarea>").addClass("edit").appendTo(C);t.createCorrectWrongMarker({elementType:"div"}).addClass("bw-column-fixed bw-centering-container").appendTo(k);try{T.xarea()}catch(e){}T.bind("keyup",function(){null!=f&&f()}),T.bind("change",function(){null!=f&&setTimeout(f,200)});var x="yes"==n["support-links"],_="yes"===n["show-matched-keywords"]&&""!==n.Keywords;if(x||_){x&&h.attr("support-links","yes"),_&&k.addClass("show-keywords");var S=u('<div class="textareacover"></div>').prependTo(C),I=function(e){return i("<div/>").text(e).html()},O=function(){var e=function(e){for(var t=e.split(/\r\n|\r|\n/),n=0;n<t.length;n++)t[n]=I(t[n]);return t.join("<br>")}(T.val());x&&(e=d.linkifyLinks(e)),_&&(e=function(e){for(var n=e,r=JSON.parse(t.data(h,"questionconfig")||'{"keywords": [], "case-sensitive": "no"}'),o=r["case-sensitive"],a=r.Keywords||[],i=[],s=0;s<a.length;++s)for(var c=a[s].split(/\|\||##/),l=c.length>1&&!1===isNaN(c[c.length-1]),d=0;d<(l?c.length-1:c.length);++d)""!==c[d].trim()&&i.push((c[d]+"").replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,"\\$1"));if(i.length>0){var u=o&&"no"==o?"gi":"g";n=n.replace(new RegExp("\\b("+i.join("|")+")\\b",u),"<span class='ml-keyword'>$1</span>")}return n}(e)),S.html(e);for(var n=T.parent();!n.parent().hasClass("ml-cover");)n=n.parent();var r=n.position();S.css({left:r.left,top:r.top,width:T.outerWidth(),height:T.outerHeight()}),S.find(".weblink").each(function(){s(this,i(this).attr("href").replace(/&amp;/g,"&"))})},A=function(){O(),k.addClass("showcover").removeClass("hidecover")};w.repaint=O,T.bind("focusout",function(){A()}),T.bind("focus",function(){k.removeClass("showcover").addClass("hidecover")}),A()}t.createHint(n,b.hintdiv),b.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,b.imgdiv),t.processEmbeddedElements(h)},prepareCorrection:function(e,n){var r={"case-sensitive":n["case-sensitive"],"scoring-weight":n["scoring-weight"]};"Keywords"in n&&n.Keywords.length>0&&(r.Keywords=n.Keywords),t.data(e,"questionconfig",JSON.stringify(r));var o=this;e.find("textarea").bind("keyup change",function(){o.check(e)}),o.check(e),t.createRationale(n,e.find(".rationalediv"))},getAnswer:function(t,n,r,o){var a=u(t),i=a.find(e.MH).html(),s=this.getCheckInput(a);if(n){var c=d.check.MultiLine(r,s);"yes"==a.attr("support-links")&&(s=d.linkifyLinks(s));var l=[];if(o&&c.hasOwnProperty("keywords"))for(var p=0;p<c.keywords.length;++p){var f=c.keywords[p];f.match?f.hasOwnProperty("points")?l.push("&#9745 "+f.keyword+"("+f.points+")<br>"):l.push("&#9745 "+f.keyword+"<br>"):l.push("&#9744 "+f.keyword+"<br>")}return{question:i,annotatedtable:l.join(""),answer:s,check_input:s,correctness:c.correctness,score:c.score,outof:c.outof}}return{question:i,answer:s}}},n})},function(e,t,n){var r,o,a,i,s,c,l;e.exports=(n(1),r=n(4),o=n(3),a=n(307),i=n(0),s=n(8),c=n(6),l=n(5),function(e,t){var n={},d=i;return n.RichText={save:function(e){var n=d(e).find(".rteditor").html(),r=d(e).attr("id");return t.questionIf[r].lastSavedData=n,n},load:function(e,n){var r=d(e).attr("id");t.questionIf[r].lastSavedData=n;var o=d(e).find(".rteditor").html(n);a.sanitizeEditor(o)},clear:function(e){d(e).find(".rteditor").html("")},render:function(n,l,u){var p="QC"+l,f=i("#"+p),h=f.attr("qindex"),g=e.getQuestionImageDivs(f,n.imgsize,n.img,n.imgpos),v=t.getNumbering(n,h);f.attr("numbering",v),f.attr("scoring-weight",n["scoring-weight"]),d("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(v)+r.prepare(n.Question)+"</"+e.MH+">").appendTo(g.questdiv),s.processRichTextImages(g.questdiv),c.processRichTextWidgetPlayLinks(g.questdiv,!0),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(g.audiodiv);var m=d("<div class='ml-cover hidecover'></div>").appendTo(g.answerdiv),w=a.createEditor(p+"_rteditor",m);t.addSpellCheckAttrib(w);var b={lastSavedData:""};t.questionIf[p]=b,b.setReadOnly=function(e){e?(w.parent().find(".btn-toolbar-wrapper").hide(),w.attr("contenteditable","false")):(w.parent().find(".btn-toolbar-wrapper").show(),w.attr("contenteditable","true"))},w.on("blur keyup paste input",function(){if(null!=u){var e=i(this),n=e.html(),r=e.closest(".content").attr("id");t.questionIf[r].lastSavedData!=n&&u()}}),t.createHint(n,g.hintdiv),g.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,g.imgdiv),t.processEmbeddedElements(f)},prepareCorrection:function(e,n){t.createRationale(n,e.find(".rationalediv"))},getAnswer:function(t,n,r){var o=d(t),a=o.find(e.MH).html(),i=o.find(".rteditor").html(),s=l.check.RichText(r,i);return{question:a,answer:i,correctness:s.correctness,score:s.score,outof:s.outof}}},n})},function(e,t,n){n(308);var r=n(309).sanitizeNode;e.exports=function(e,t,o,a){function i(e){r(e[0])}return window.jQuery||(window.jQuery=t),n(310),n(311),{createEditor:function(n,r){var s=t('<div class="rteditor-toolbar-wrapper"></div>').appendTo(r),c=t('<div id="'+n+'_toolbar" class="bw-toolbar" data-role="editor-toolbar" data-target="#'+n+'"></div>').appendTo(s),l=t('<div class="rtwrapper"></div>').appendTo(r),d=t('<div id="'+n+'" class="rteditor"></div>').appendTo(l);function u(e,n){var r;n.hasOwnProperty("color")?(r=t('<a class="btn bw-toolbutton btn-color"><div class="bw-icon bw-icon-fill-drop"></div></a>').appendTo(e),t('<div class="bw-icon bw-icon-fill-drop-small"></div>').appendTo(r).css("color",n.color)):r=t('<a class="btn bw-toolbutton"><div class="'+n.iconclass+'"></div></a>').appendTo(e),n.hasOwnProperty("id")&&r.attr("id",n.id),n.hasOwnProperty("data-edit")&&r.attr("data-edit",n["data-edit"])}function p(e,n){for(var r=t('<div class="bw-button-group">').appendTo(e),o=0;o<n.length;++o)u(r,n[o])}return d.on("paste",function(){setTimeout(function(){i(d)})}),p(c,[{id:"btn-clear",title:"Clear",iconclass:"bw-icon bw-icon-trash"}]),document.queryCommandSupported("undo")&&-1==e.getPlatform().indexOf("ipad")&&p(c,[{"data-edit":"undo",title:"Undo",iconclass:"bw-icon bw-icon-undo"},{"data-edit":"redo",title:"Redo",iconclass:"bw-icon bw-icon-redo"}]),p(c,[{"data-edit":"bold",title:"Bold",iconclass:"bw-icon bw-icon-bold"},{"data-edit":"italic",title:"Italic",iconclass:"bw-icon bw-icon-italic"},{"data-edit":"strikethrough",title:"Strikethrough",iconclass:"bw-icon bw-icon-strikethrough"},{"data-edit":"underline",title:"Underline)",iconclass:"bw-icon bw-icon-underline"}]),p(c,[{"data-edit":"insertunorderedlist",title:"Bullet list",iconclass:"bw-icon bw-icon-list-ul"},{"data-edit":"insertorderedlist",title:"Number list",iconclass:"bw-icon bw-icon-list-ol"},{"data-edit":"outdent",title:"Reduce indent",iconclass:"bw-icon bw-icon-outdent"},{"data-edit":"indent",title:"Indent",iconclass:"bw-icon bw-icon-indent"}]),p(c,[{"data-edit":"justifyleft",title:"Align Left",iconclass:"bw-icon bw-icon-align-left"},{"data-edit":"justifycenter",title:"Center)",iconclass:"bw-icon bw-icon-align-center"},{"data-edit":"justifyright",title:"Align Right)",iconclass:"bw-icon bw-icon-align-right"},{"data-edit":"justifyfull",title:"Justify",iconclass:"bw-icon bw-icon-align-justify"}]),p(c,[{"data-edit":"foreColor black",title:"Color black",color:"black"},{"data-edit":"foreColor red",title:"Color red",color:"red"},{"data-edit":"foreColor blue",title:"Color blue",color:"blue"},{"data-edit":"foreColor green",title:"Color green",color:"green"}]),c.find("#btn-clear").click(function(){a.showConfirmationDialog(o("Clear the text and start over?"),o("Are you sure?"),function(){t("#"+n).html("")},null,o("Yes, clear"),o("No, keep"))}),t("#"+n).wysiwyg({toolbarSelector:"#"+n+"_toolbar[data-role=editor-toolbar]"}),d},sanitizeEditor:i}}(n(2),n(0),n(7),n(9))},function(e,t,n){},function(e,t){var n=["DIV","SPAN","P","U","I","B","EM","STRONG","STRIKE","UL","LI","OL","FONT","BR","BLOCKQUOTE"],r=["STYLE","SCRIPT","TEXTAREA","NOSCRIPT","INPUT","IMG"],o=["color","font-weight","text-align","font-style","text-decoration"];function a(e){if(1===e.nodeType){var t=e.tagName;return-1===n.indexOf(t)?-1===r.indexOf(t)?2:1:0}return-1}function i(e){if(null==e)return e;for(var t=e.split(";"),n=[],r=0;r<t.length;++r)for(var a=t[r],i=0;i<o.length;++i)if(a.startsWith(o[i])){n.push(a);break}return n.join(";")}e.exports={sanitizeNode:function e(t){for(var n=t.childNodes,r=0;r<n.length;++r){var o=n[r];switch(a(o)){case 0:if(o.hasAttributes())for(var s=o.attributes,c=s.length-1;c>=0;c--){var l=s[c].name;switch(l){case"style":o.setAttribute("style",i(s[c].value));break;case"color":case"align":break;default:o.removeAttribute(l)}}e(o);break;case 1:t.removeChild(o);break;case 2:var d=o.textContent;if(null!=d){var u=document.createElement("span");u.textContent=d,t.replaceChild(u,o)}else t.removeChild(o)}}}}},,function(e,t){!function(e){"use strict";e.fn.cleanHtml=function(){var t=e(this).html();return t&&t.replace(/(<br>|\s|<div><br><\/div>|&nbsp;)*$/,"")},e.fn.wysiwyg=function(t){var n,r,o,a,i=this,s=function(){r.activeToolbarClass&&e(r.toolbarSelector).find(o).each(function(){var t=e(this).data(r.commandRole);t=t.split(" ").shift(),document.queryCommandState(t)?e(this).addClass(r.activeToolbarClass):e(this).removeClass(r.activeToolbarClass)})},c=function(e,t){var n=e.split(" "),r=n.shift(),o=n.join(" ")+(t||"");document.execCommand(r,0,o),s()},l=function(){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount)return e.getRangeAt(0)},d=function(){n=l()},u=function(){var e=window.getSelection();if(n){try{e.removeAllRanges()}catch(e){document.body.createTextRange().select(),document.selection.empty()}e.addRange(n)}},p=function(t){i.focus(),e.each(t,function(t,n){/^image\//.test(n.type)?e.when(function(t){var n=e.Deferred(),r=new FileReader;return r.onload=function(e){n.resolve(e.target.result)},r.onerror=n.reject,r.onprogress=n.notify,r.readAsDataURL(t),n.promise()}(n)).done(function(e){c("insertimage",e)}).fail(function(e){r.fileUploadError("file-reader",e)}):r.fileUploadError("unsupported-file-type",n.type)})},f=function(e,t){u(),document.queryCommandSupported("hiliteColor")&&document.execCommand("hiliteColor",0,t||"transparent"),d(),e.data(r.selectionMarker,t)};return r=e.extend({},e.fn.wysiwyg.defaults,t),o="a[data-"+r.commandRole+"],button[data-"+r.commandRole+"],input[type=button][data-"+r.commandRole+"]",a=r.hotKeys,e.each(a,function(e,t){i.keydown(e,function(e){i.attr("contenteditable")&&i.is(":visible")&&(e.preventDefault(),e.stopPropagation(),c(t))}).keyup(e,function(e){i.attr("contenteditable")&&i.is(":visible")&&(e.preventDefault(),e.stopPropagation())})}),""!=e(this).attr("placeholder")&&(""==e(this).html()&&e(this).html(e(this).attr("placeholder")),e(this).html()==e(this).attr("placeholder")&&e(this).addClass("placeholderText"),e(this).bind("focus",function(t){if(""!=e(this).attr("placeholder")&&e(this).text()==e(this).attr("placeholder")){var n=this;setTimeout(function(){e(n).removeClass("placeholderText"),e(n).html("")},10)}}),e(this).bind("blur",function(t){""!=e(this).attr("placeholder")&&""==e(this).text()&&(e(this).addClass("placeholderText"),e(this).html(e(this).attr("placeholder")))})),r.dragAndDropImages&&i.on("dragenter dragover",!1).on("drop",function(e){var t=e.originalEvent.dataTransfer;e.stopPropagation(),e.preventDefault(),t&&t.files&&t.files.length>0&&p(t.files)}),function(t,n){t.find(o).click(function(){u(),i.focus(),c(e(this).data(n.commandRole)),d()}),t.find("[data-toggle=dropdown]").click(u),t.find("input[type=text][data-"+n.commandRole+"]").on("webkitspeechchange change",function(){var t=this.value;this.value="",u(),t&&(i.focus(),c(e(this).data(n.commandRole),t)),d()}).on("focus",function(){var t=e(this);t.data(n.selectionMarker)||(f(t,n.selectionColor),t.focus())}).on("blur",function(){var t=e(this);t.data(n.selectionMarker)&&f(t,!1)}),t.find("input[type=file][data-"+n.commandRole+"]").change(function(){u(),"file"===this.type&&this.files&&this.files.length>0&&p(this.files),d(),this.value=""})}(e(r.toolbarSelector),r),i.attr("contenteditable",!0).on("mouseup keyup mouseout",function(){d(),s()}),e(window).bind("touchend",function(e){var t=i.is(e.target)||i.has(e.target).length>0,n=l();n&&n.startContainer===n.endContainer&&n.startOffset===n.endOffset&&!t||(d(),s())}),this},e.fn.wysiwyg.defaults={hotKeys:{"ctrl+b meta+b":"bold","ctrl+i meta+i":"italic","ctrl+u meta+u":"underline","ctrl+z meta+z":"undo","ctrl+y meta+y meta+shift+z":"redo","ctrl+l meta+l":"justifyleft","ctrl+r meta+r":"justifyright","ctrl+e meta+e":"justifycenter","ctrl+j meta+j":"justifyfull","shift+tab":"outdent",tab:"indent"},toolbarSelector:"[data-role=editor-toolbar]",commandRole:"edit",activeToolbarClass:"btn-info",selectionMarker:"edit-focus-marker",selectionColor:"darkgrey",dragAndDropImages:!0,fileUploadError:function(e,t){console.log("File upload error",e,t)}}}(window.jQuery)},function(e,t,n){var r;e.exports=(n(1),r=n(0),function(e,t){var n={},o=r;return n.ExtraMultiLine={save:function(e){return o(e).find(".edit").val()},load:function(e,t){var n=o(e).find(".edit");n.val(t),n.trigger("change")},clear:function(e){o(e).find(".edit").val("")},render:function(n,a,i){var s=r("#QC"+a),c=s.attr("qindex"),l=t.getNumbering(n,c);s.attr("numbering",l);var d=o("<div class='eml-cover'></div>").appendTo(s);o("<div class='eml-question'>"+e.getIndexPrefix(l)+n.label+"</div>").appendTo(d);var u=o("<textarea "+t.spellcheckattrib()+"class='edit' ></textarea>").appendTo(d);u.xarea(),u.bind("keyup",function(){null!=i&&i()}),u.bind("change",function(){null!=i&&setTimeout(i,200)})},getAnswer:function(e){var t=o(e).find(".eml-question").html(),n=o(e).find(".edit").val();return{question:t,answer:n,correctness:""==n?-1:-2,score:0,outof:0}}},n})},function(e,t,n){var r,o;e.exports=(n(1),r=n(0),o=n(25),function(e,t){var n={},a=r;return n.ExtraCheckbox={save:function(e){return"checked"==a(e).find(".bw-checkbox").attr("checked")?"yes":"no"},load:function(e,t){var n=a(e).find(".bw-checkbox");"yes"==t?n.trigger("check"):n.trigger("clear")},clear:function(e){a(e).find(".bw-checkbox").trigger("clear")},render:function(n,i,s){var c="QC"+i,l=r("#"+c),d=l.attr("qindex"),u=t.getNumbering(n,d);l.attr("numbering",u);var p=a("<div class='ecb-cover'></div>").appendTo(l);if(o.createLabeledCheckbox(p,e.getIndexPrefix(u)+n.label,function(){null!=s&&s(),p.find(".mandatory-field-reminder").hide()}),r('<div class="mandatory-field-reminder">'+n.mandatory_reminder+"</div>").appendTo(p),"yes"==n.mandatory){var f={};t.questionIf[c]=f,f.mandatoryFieldsOK=function(){return"checked"===p.find(".bw-checkbox").attr("checked")},f.showMandatoryFieldReminder=function(){"checked"!==p.find(".bw-checkbox").attr("checked")&&p.find(".mandatory-field-reminder").show()}}},getAnswer:function(e){return{question:a(e).find(".bw-checkbox-label").html(),answer:"checked"===a(e).find(".bw-checkbox").attr("checked")?"yes":"no",correctness:1,score:0,outof:0}}},n})},function(e,t,n){var r,o,a,i,s,c,l;e.exports=(n(1),r=n(4),o=n(3),a=n(2),i=n(0),n(315),s=n(8),c=n(6),l=n(5),function(e,t){var n={},d=i;return n.FillInText={name:"FillInText",getData:function(e){var t=[];return d(e).find(".edit").each(function(e){if(i(this).is("input")){var n=i(this).val().trim();t.push(n)}else i(this).is("select")&&(n=i(this).find("option:selected").text(),t.push(n))}),t},save:function(e){return JSON.stringify(this.getData(e))},load:function(e,t){var n=d(e),r=JSON.parse(t),o=0;n.find(".edit").each(function(e){i(this).is("input")?i(this).val(r[o++]).trigger("update"):i(this).is("select")&&i(this).val(r[o++].trim()).attr("selected",!0)}),this.check(n)},clear:function(e){d(e).find(".edit").each(function(e){var t=i(this);t.is("input")?t.val("").trigger("update"):t.is("select")&&(this.selectedIndex=-1,t.trigger("change"))}),this.check(e)},getCheckInput:function(e){return this.getData(e)},check:function(e){var n;try{n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}var r=this.getCheckInput(e),o=l.check.FillInText(n,r),a=0;e.find(".edit").each(function(e){var n=o.correctness[a++],r=i(this);if(r.is("input"))switch(n){case-2:t.setTag(r.parent(),"fit-open");break;case-1:t.clearTag(r.parent(),"fit-open"),t.clearTag(r.parent(),"fit-answer"),t.clearTag(r.parent(),"fit-wrong");break;case 0:t.clearTag(r.parent(),"fit-answer"),t.setTag(r.parent(),"fit-wrong");break;case 1:t.setTag(r.parent(),"fit-answer"),t.clearTag(r.parent(),"fit-wrong")}else if(r.is("select"))switch(n){case-1:t.setTag(r.parent(),"fit-empty"),t.clearTag(r.parent(),"fit-answer"),t.clearTag(r.parent(),"fit-wrong");break;case 0:t.clearTag(r.parent(),"fit-answer"),t.clearTag(r.parent(),"fit-empty"),t.setTag(r.parent(),"fit-wrong");break;case 1:t.setTag(r.parent(),"fit-answer"),t.clearTag(r.parent(),"fit-empty"),t.clearTag(r.parent(),"fit-wrong")}})},render:function(n,u,p,f){var h=this,g="QC"+u,v=(f=f||i("#"+g)).attr("qindex"),m={};t.questionIf[g]=m,m.setReadOnly=function(e){-1==a.getPlatform().indexOf("ipad")&&f.find("input, select").prop("disabled",e)},m.loadCorrect=function(e){var t=f.find("input"),n=f.find("select"),r=0,o=0;l.processFillInText(l.getFITText(e),function(e,a){if(null!==a)if("text"===a.type)i(t[r++]).val(a.typeconfig);else{var s=a.typeconfig.split("##")[0].trim();i(n[o++]).val(s).attr("selected",!0)}}),h.check(f)};var w=function(e){var o=0,a="";return l.processFillInText(r.prepare(e),function(e,r){o+=1,a+=e,null!==r&&(a+=function(e,r){var o=e.type,a=e.typeconfig,s=e.style;if("text"===o)return"<span><input type='text' "+t.inputModeAttrib(n.keyboard)+t.spellcheckattrib()+"class='edit' id='"+r+'\'  autocapitalize="none" style="'+s.join(";")+'"></input></span>';if("select"===o){for(var c=a.split(/\|\||##/),l=0;l<c.length;++l)c[l]=c[l].trim();if(0===c.length)return"<span>Fill In Blanks: INVALID SELECT<span>";c.sort();var d="<span><select class='edit' id='"+r+"' style=\""+s.join(";")+'">';for(d+='<option value="" data-placeholder="true">-</option>',l=0;l<c.length;++l)d+='<option value="'+c[l]+'">'+c[l]+"</option>";return d+="</select></span>",d+='<span class="print-only-inline">('+i("<div>").text(c.join(" / ")).html()+")</span>"}return"<span>Fill In Blanks: INVALID Type ("<<o<<")<span>"}(r,"FIT_"+u+"_"+o))}),a}(l.getFITText(n)),b=t.getNumbering(n,v);f.addClass("fillintext"),f.attr("numbering",b),f.attr("scoring-weight",n["scoring-weight"]);var y=e.getQuestionImageDivs(f,n.imgsize,n.img,n.imgpos),k=l.isLegacyFITStyle(n)?[w,""]:[r.prepare(n.Question),w];d("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(b)+k[0]+"</"+e.MH+">").appendTo(y.questdiv),i(document.createElement("div")).addClass("fit-sentence").html(k[1]).appendTo(y.questdiv),s.processRichTextImages(y.questdiv),c.processRichTextWidgetPlayLinks(y.questdiv,!0),f.find("select").each(function(){t.setTag(i(this).parent(),"fit-empty")}),f.find("input, select").each(function(){t.createCorrectWrongMarker().appendTo(i(this).parent())});try{f.find("input:text").autoGrowInput()}catch(e){}return f.find(".fit-empty").each(function(){var e=i(this);e.removeClass("fit-empty"),t.setTag(e,"fit-empty")}),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(y.audiodiv),t.createHint(n,y.hintdiv),y.rationalediv.addClass("rationalediv"),f.find("input").each(function(e){i(this).bind("keyup",function(){null!=p&&p()}),i(this).bind("change",function(){null!=p&&setTimeout(p,200)})}),f.find("select").each(function(e){i(this).bind("change",function(e,t){null!=p&&p()})}),t.createOptionalImage(n,y.imgdiv),t.processEmbeddedElements(f),f},prepareCorrection:function(e,n){var o={"case-sensitive":n["case-sensitive"],Question:n.Question,Sentence:n.Sentence,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(o));var a,i=this;e.find("input").on("keyup change update",function(){i.check(e)}),i.check(e),e.find("select").on("change",function(){i.check(e)});var s=function(e){var t=!1,n="";return l.processFillInText(r.prepare(e),function(e,r){if(n+=e,null!==r){var o=function(e){var t,n=e.type,r=e.typeconfig;if("text"==n)return(t=r.split(/\|\||##/)).length>0?t.join(" / "):"";if("select"==n){var o=r.split(/\|\||##/);return 0===o.length?"Fill In Blanks: INVALID SELECT":o[0]}return"Fill In Blanks: INVALID Type ("<<n<<")"}(r);""!==o||"select"===r.type?(n+='<span class="answer">'+o+"</span>",t=!0):n+="_____"}}),t?n:null}(l.getFITText(n));return null!==s&&(a="<div class='the-answer' >"+t.translate("The answer:")+"<br><br>"+s+"</div>"),t.createRationale(n,e.find(".rationalediv"),a),{extrarationale:a}},getAnswer:function(e,t,n){var o=d(e),a=function(e){var t="";return l.processFillInText(r.prepare(e),function(e,n){t+=e,null!==n&&(t+="_____")}),t}(n.Question),i=function(e){var t="";return l.processFillInText(r.prepare(e),function(e,n){t+=e,null!==n&&(t+=n.typeconfig.split("##")[0])}),t}(l.getFITText(n)),s=this.getCheckInput(o),c=l.check.FillInText(n,s);return{question:a,"report-question":a,answer:s,check_input:s,correctness:c.correctness,score:c.score,outof:c.outof,canonicalAnswer:i,canonicalAnswerCSS:{"font-size":"20px"}}}},n})},function(e,t,n){var r;e.exports=void((r=n(0)).fn.autoGrowInput=function(e){return e=r.extend({maxWidth:1500,minWidth:0,comfortZone:40},e),this.filter("input:text").each(function(){var t=e.minWidth||r(this).width(),n="",o=r(this),a=r("<tester/>").css({position:"absolute",top:-9999,left:0,width:"auto",fontSize:o.css("fontSize"),fontFamily:o.css("fontFamily"),fontWeight:o.css("fontWeight"),letterSpacing:o.css("letterSpacing"),whiteSpace:"nowrap",opacity:.01});a.insertAfter(o),r(this).bind("keyup keydown blur update",function(){if(n!==(n=o.val())){var r=n.replace(/&/g,"&amp;").replace(/\s/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");a.html(r);var i=a.width(),s=Math.min(Math.max(i+e.comfortZone,t),e.maxWidth);o.width(s)}})}),this})},function(e,t,n){var r,o,a,i,s,c,l,d;e.exports=(r=n(1),o=n(137),a=n(4),i=n(3),s=n(0),c=n(8),l=n(6),d=n(5),function(e,t){var n=r.getConfigSync(),u=s,p={};return p.FillInTable={save:function(e){var n=u(e).attr("id");return JSON.stringify(t.questionIf[n].table.getData())},load:function(e,n){var r=u(e).attr("id"),o=JSON.parse(n);t.questionIf[r].table.setData(o)},clear:function(e){var n=u(e).attr("id");t.questionIf[n].table.clear()},render:function(r,d,p,f){var h="QC"+d,g=(f=f||s("#"+h)).attr("qindex"),v=e.getQuestionImageDivs(f,r.imgsize,r.img,r.imgpos),m=t.getNumbering(r,g);f.attr("numbering",m),u("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(m)+a.prepare(r.Question)+"</"+e.MH+">").appendTo(v.questdiv),c.processRichTextImages(v.questdiv),l.processRichTextWidgetPlayLinks(v.questdiv,!0),r.audio&&""!=r.audio&&i.createPlayer(r.audio,"quiz"==e.getWidgetType()).appendTo(v.audiodiv);var w="table_"+d,b=u("<div class='table-cover' id=\""+w+'"></div>').appendTo(v.answerdiv);v.answerdiv.addClass("table-scroll-wrapper");var y=o({tablediv:"#"+w,tabledata:r.tabledata,support_correction_colors:t.widgetSupportsCorrection(),spellcheck:"yes"===n.spellcheck});null!=p&&y.setChangeCallBack(p);var k={};k.table=y,t.questionIf[h]=k,k.repaint=function(){y.render()},k.setReadOnly=function(e){!1===e&&"no"===n.color_correct_answers&&y.setCorrectionCallback(null),y.setReadOnly(e),setTimeout(y.render.bind(y))},k.loadCorrect=function(e){this.table.loadCorrect(e.tabledata)},b.show(),t.createHint(r,v.hintdiv),v.rationalediv.addClass("rationalediv"),t.createOptionalImage(r,v.imgdiv),t.processEmbeddedElements(v.questdiv)},prepareCorrection:function(e,n){var r={"case-sensitive":n["case-sensitive"],tabledata:n.tabledata,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(r));var o=e.attr("id"),a=t.questionIf[o].table;a.setCorrectionCallback(function(){return d.check.FillInTable(n,a.getCheckInput())}),t.createRationale(n,e.find(".rationalediv"))},getAnswer:function(n,r,o,a){for(var i=u(n),s=i.attr("id"),c=t.questionIf[s].table,l=i.find(e.MH).html(),p=c.getCheckInput(),f=d.check.FillInTable(o,p),h=[],g=0;g<f.correctioninfo.length;++g){var v=f.correctioninfo[g];h.push(c.getFormattedValueForCell(v.row,v.column))}return{question:l,annotatedtable:c.getEmailTable(a,f),answer:h,check_input:p,correctness:f.correctness,score:f.score,outof:f.outof}}},p})},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o,a=n(117).spellCheckAttribs;e.exports=void(o=n(0)).fn.extend({bwtable:function(e,t){function n(e,t){var n=e.data("config");if(n){var r=e.find("tr");e.toggleClass("readonly",!0===n.readOnly);for(var a=0;a<r.length;++a)for(var i=o(r[a]),s=n.data[a],c=i.find("td"),l=0;l<c.length;++l){var d=s[l],u=o(c[l]);if(t||d!==u.attr("value")){var p=n.cells(a,l),f=o(document.createElement("div")).addClass("bw-table-cell-contents").html(d);u.find(".bw-table-cell-contents").replaceWith(f),p.hasOwnProperty("renderer")&&p.renderer(e,u[0],a,l,null,d,p),u.attr("value",d),u.find("textarea").val(d)}}}}"string"!=typeof e?"object"===r(e)&&function(e,t){e.empty();for(var r=o(document.createElement("table")).addClass("bw-table"),i=o(document.createElement("tbody")).appendTo(r),s=0;s<t.data.length;++s)for(var c=t.data[s],l=o(document.createElement("tr")).appendTo(i),d=function(){function r(e){e.css("height",e.parent().innerHeight())}var i,d;p=c[u],f=o(document.createElement("td")).attr("value",p).appendTo(l),t.hasOwnProperty("colWidths")&&f.css({width:t.colWidths[u]}),h=t.cells(s,u),o(document.createElement("div")).addClass("bw-table-cell-contents").html(p).appendTo(f),h.hasOwnProperty("renderer")&&h.renderer(e,f[0],s,u,null,p,h),!0!==h.readOnly&&(g=o(document.createElement("textarea")).addClass("bw-table-cell-input").val(p).appendTo(f).attr(a(t.spellcheck)).on("focus",function(){var e=o(this);e.parent().addClass("editing"),r(e)}).on("blur",(i=s,d=u,function(){var t=o(this),r=t.parent().parent().parent().parent().parent().data("config");t.parent().removeClass("editing");var a=t.val();t.parent().attr("value")!==a&&(r.data[i][d]=a,r.onChange([[i,d]]),n(e))})),r(g))},u=0;u<c.length;++u){var p,f,h,g;d()}r.appendTo(e),e.data("config",t)}(this,e):function(e,t,r){var o;if("render"!==t)return"loaddata"===t?(o=r,e.data("config").data=o,void n(e,!1)):"updateSettings"===t?(function(e,t){var n=e.data("config");for(var r in t)n[r]=t[r]}(e,r),void n(e,!0)):void console.error("Unknown bwtable command: ",t);n(e,!0)}(this,e,t)}})},function(e,t,n){var r,o,a,i,s,c,l,d;e.exports=(n(1),r=n(4),o=n(3),a=n(2),i=n(0),s=n(20),c=n(8),l=n(6),d=n(5),function(e,t){var n={},u=i;return n.AnnotatePicture={getData:function(e){var t=[];return i(e).find(".edit").each(function(e){var n=i(this).val().trim();t.push(n)}),t},save:function(e){return JSON.stringify(this.getData(e))},load:function(e,t){var n=JSON.parse(t),r=0;u(e).find(".edit").each(function(e){i(this).val(n[r++])}),this.check(u(e))},clear:function(e){var t=i(e);t.find(".edit").val(""),this.check(t)},getCheckInput:function(e){return this.getData(e)},check:function(e){try{var n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}var r=this.getCheckInput(e),o=d.check.AnnotatePicture(n,r),a=0,s=e.attr("id");e.find(".edit").each(function(){var e=i("#"+s+"_ap_"+a+", #"+s+"_ap_"+a+"_picwrapper, #"+s+"_ap_"+a+"_tablewrapper");switch(o.correctness[a++]){case-2:t.setTag(e,"ap-open");break;case-1:t.clearTag(e,"ap-open"),t.clearTag(e,"ap-answer"),t.clearTag(e,"ap-wrong");break;case 0:t.clearTag(e,"ap-answer"),t.setTag(e,"ap-wrong");break;case 1:t.setTag(e,"ap-answer"),t.clearTag(e,"ap-wrong")}})},render:function(n,d,p,f){var h=this,g="QC"+d,v=(f=f||i("#"+g)).attr("qindex"),m={};t.questionIf[g]=m,m.setReadOnly=function(e){-1===a.getPlatform().indexOf("ipad")&&f.find("input, textarea").prop("disabled",e)},m.loadCorrect=function(e){var t=0;f.find(".edit").each(function(){var n=e.EditFields[t++];i(this).val(n.Valid.trim())}),h.check(f)};var w=t.getNumbering(n,v);f.attr("numbering",w),u("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(w)+r.prepare(n.Question)+"</"+e.MH+">").appendTo(f),c.processRichTextImages(f),l.processRichTextWidgetPlayLinks(f,!0),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(f);var b=u('<div class="ap-cover"> </div>');"yes"===n["cover-fields"]&&b.addClass("cover-fields"),b.appendTo(f),t.createHint(n,f),i('<div class="rationale rationalediv"></div>').appendTo(f);var y=u('<div class="ap-picture"> </div>').appendTo(b);""!=n.background_picture&&y.css("background-image","url("+s(n.background_picture)+")");for(var k=u("<div></div>").addClass("ap-svg-wrapper").css("direction","ltr").appendTo(y),C=0,T=0,x=15,_=n.EditFields?n.EditFields:[],S=0;S<_.length;++S){var I=_[S],O=g+"_ap_"+S,A=g+"_ap_"+S+"_picwrapper",E="Numerical"==n.keyboard?"input":"textarea",q=i(document.createElement("div")).addClass("ap-field").attr("id",A);i(document.createElement("div")).addClass("ap-field-bg").appendTo(q);var P=i(document.createElement(E)).addClass("edit").attr({id:O,nr:S,autocapitalize:"none"}).css("border-color",n["field-border-color"]).appendTo(q);t.data(P,"name",I.name),t.addSpellCheckAttrib(P),t.addInputModeAttrib(P,n.keyboard),q.appendTo(y),q.css({left:I.position.X+"px",top:I.position.Y+"px",width:I.position.Width+"px",height:I.position.Height+"px","max-width":I.position.Width+"px","max-height":I.position.Height+"px"}),t.createCorrectWrongMarker({elementType:"div"}).addClass("picture-marker").appendTo(q),"Dotted"==n["field-border"]?q.addClass("ap_border_dotted"):"None"==n["field-border"]&&q.addClass("ap_border_none"),"Transparent"==n["field-background"]?q.addClass("ap_background_transparent"):"Semi-transparent"==n["field-background"]&&q.addClass("ap_background_semitransparent");var D=parseInt(I.position.X)+parseInt(I.position.Width),R=parseInt(I.position.Y)+parseInt(I.position.Height);C=Math.max(D,C),T=Math.max(R,T),""!=I.position.MarkerX&&""!=I.position.MarkerY&&(D=parseInt(I.position.MarkerX)+x,R=parseInt(I.position.MarkerY)+x,C=Math.max(D,C),T=Math.max(R,T)),P.bind("keyup",function(){null!=p&&p()}),P.bind("change",function(){null!=p&&setTimeout(p,200)})}y.css({height:T+"px"});var N,M,L=i(document.createElement("table")).addClass("ap-table");for(S=0;S<_.length;++S){I=_[S],A=g+"_ap_"+S+"_tablewrapper";var B=i(document.createElement("tr")).attr("id",A).appendTo(L);i(document.createElement("td")).text(S+1).appendTo(B),i(document.createElement("td")).addClass("fieldwrapper").appendTo(B),t.createCorrectWrongMarker({elementType:"td"}).appendTo(B)}function W(){if(N){var e=b.width(),t=parseInt(y.css("margin"));isNaN(t)&&(t=parseInt(y.css("margin-left"))+parseInt(y.css("margin-right"))/2);for(var r=e-2*t,o=1,a=0;a<_.length;++a)if(""!=(d=_[a]).position.MarkerX&&""!=d.position.MarkerY){var s=parseInt(d.position.MarkerX)+x;if(s>0){var c=r/s;o=Math.min(c,o)}}var l=r/N;if(o=Math.min(l,o),r>720){for(b.removeClass("narrow-mode"),a=0;a<_.length;++a){var d=_[a],u=parseInt(d.position.Width),p=parseInt(d.position.X)+u/2;if(p>0){var f=(r-u/2)/p;o=Math.min(f,o)}}var h=i(b.find("textarea, input")[0]),v=parseInt(h.css("padding")||h.css("padding-top")),m=parseInt(h.css("border-top-width"))+parseInt(h.css("border-top-width"))+2*v+1.5*parseInt(h.css("font-size"));for(a=0;a<_.length;++a){var w=i("#"+g+"_ap_"+a),C=g+"_ap_"+a+"_picwrapper",T=i("#"+C);w.parent().attr("id")!==C&&(w.prependTo(T),w.css("border-color",n["field-border-color"])),d=_[a];var S=Math.max(m,parseInt(d.position.Height)),I=(r=parseInt(d.position.Width),(parseInt(d.position.X)+r/2)*o),O=(parseInt(d.position.Y)+S/2)*o;T.css({left:Math.max(0,I-r/2),top:Math.max(0,O-S/2),height:S,"max-height":S})}!function(e,t){console.log("drawLinesAndMarkers");for(var r=[],o=0,a=0,i=0;i<_.length;++i){var s=_[i];if(""!=s.position.MarkerX&&""!=s.position.MarkerY){var c,l,d=parseInt(s.position.MarkerX)*e,u=parseInt(s.position.MarkerY)*e,p=Math.max(t,parseInt(s.position.Height)),f=parseInt(s.position.Width),h=(parseInt(s.position.X)+f/2)*e,g=(parseInt(s.position.Y)+p/2)*e;if(p>0&&f>0)if(d<h){if(u<g)if((h-d)/(g-u)>f/p){var v=g-f/2*(g-u)/(h-d);h-=f/2,g=v}else h-=p/2*(h-d)/(g-u),g=v=g-p/2;else u>g?(h-d)/(u-g)>f/p?(v=g-f/2*(g-u)/(h-d),h-=f/2,g=v):(h-=p/2*(h-d)/(u-g),g=v=g+p/2):h-=f/2;var m=Math.atan2(g-u,h-d);c=d+Math.cos(m)*x,l=u+Math.sin(m)*x}else d>h?(u<g?(d-h)/(g-u)>f/p?(v=g-f/2*(g-u)/(d-h),h+=f/2,g=v):(h-=p/2*(h-d)/(g-u),g=v=g-p/2):u>g?(d-h)/(u-g)>f/p?(v=g-f/2*(g-u)/(d-h),h+=f/2,g=v):(h-=p/2*(h-d)/(u-g),g=v=g+p/2):h+=f/2,m=Math.atan2(g-u,h-d),c=d+Math.cos(m)*x,l=u+Math.sin(m)*x):(c=d,u<g?(g-=p/2,l=u+x):u>g&&(g+=p/2,l=u-x));o=Math.max(o,c),o=Math.max(o,h),o=Math.max(o,d+x),a=Math.max(a,l),a=Math.max(a,g),a=Math.max(a,u+x),r.push('<line x1="X1" y1="Y1" x2="X2" y2="Y2" CLASS COLOR/>'.replace("X1",c).replace("X2",h).replace("Y1",l).replace("Y2",g).replace("CLASS","Dotted"==n["field-border"]?'class="line-dashed"':"").replace("COLOR",'style="stroke:'+n["field-marker-color"]+'"'));var w=('<circle cx="X1" cy="Y1" r="'+x+'" COLOR/>').replace("X1",d).replace("Y1",u).replace("COLOR",'style="stroke:'+n["field-marker-color"]+'"');r.push(w)}}r.length?k.html('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+Math.max(y.width(),o)+'px" height="'+Math.max(y.height(),a)+'px">'+r.join("")+"</svg>"):k.html("")}(o,m)}else for(b.addClass("narrow-mode"),function(e,t){for(var r=0,o=0,a=[],i=0;i<_.length;++i){var s=_[i],c=(""!=s.position.MarkerX?parseInt(s.position.MarkerX):parseInt(s.position.X)+parseInt(s.position.Width)/2)*e,l=(""!=s.position.MarkerY?parseInt(s.position.MarkerY):parseInt(s.position.Y)+parseInt(s.position.Height)/2)*e;r=Math.max(r,c+x),o=Math.max(o,l+x);var d=('<circle cx="X1" cy="Y1" r="'+x+'" COLOR/>').replace("X1",c).replace("Y1",l).replace("COLOR",'style="stroke:'+n["field-marker-color"]+'"');a.push(d);var u='<text x="X1" y="Y1" class="ap-marker-text" fill="COLOR">NR</text>'.replace("X1",c).replace("Y1",l).replace("NR",i+1).replace("COLOR",n["field-marker-color"]);a.push(u)}a.length?k.html('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+Math.max(y.width(),r)+'px" height="'+Math.max(y.height(),o)+'px">'+a.join("")+"</svg>"):k.html("")}(o),a=0;a<_.length;++a){w=i("#"+g+"_ap_"+a);var A=g+"_ap_"+a+"_tablewrapper",E=i("#"+A+" .fieldwrapper");w.parent().parent().attr("id")!==A&&(w.prependTo(E),w.css("border-color",""));var q=i("#"+g+"_ap_"+a+"_picwrapper");d=_[a],S=parseInt(d.position.Height)*o,r=parseInt(d.position.Width)*o,I=parseInt(d.position.X)*o+r/2,O=parseInt(d.position.Y)*o+S/2,q.css({left:Math.max(0,I-r/2),top:Math.max(0,O-S/2),height:S,"max-height":S})}y.css({width:N*o,height:M*o})}}L.appendTo(b),m.repaint=m.onResize=W,c.getImageSize(n.background_picture,function(e,t){N=e,M=t,W()}),t.processEmbeddedElements(f)},prepareCorrection:function(e,n){var r={"case-sensitive":n["case-sensitive"],EditFields:n.EditFields,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(r));var o=this;e.find("input, textarea").on("keyup change",function(){o.check(e)}),o.check(e);for(var a,i=[],s=n.EditFields?n.EditFields:[],c=0;c<s.length;++c){var l=s[c];if(""!=l.Valid){var d=l.Valid.split(/\|\||##/),u=1===d.length?l.Valid:d.join(" / ");i.push(u)}}return 0!=i.length&&(a="<div class='the-answer' >"+t.translate("The answers:")+'</br><div class="answer">'+i.join(", ")+"</div></div>"),t.createRationale(n,e.find(".rationalediv"),a),{extrarationale:a}},getAnswer:function(t,n,r){for(var o=u(t),a=o.find(e.MH).html(),i=this.getCheckInput(o),s=d.check.AnnotatePicture(r,i),c=[],l=r.EditFields?r.EditFields:[],p=0;p<l.length;++p){var f=l[p];switch(s.correctness[p]){case-2:c.push(f.name+": "+i[p]);break;case-1:c.push(f.name+": (no answer)");break;case 0:case 1:c.push(f.name+": "+i[p])}}return{question:a,answer:c,check_input:i,correctness:s.correctness,score:s.score,outof:s.outof}}},n})},function(e,t,n){var r,o,a,i,s,c,l,d;e.exports=(n(1),r=n(4),o=n(3),a=n(2),i=n(0),s=n(320),c=n(8),l=n(6),d=n(5),function(e,t){var n={};return n.SingleLine={name:"SingleLine",save:function(e){return i(e).find(".sl-cover .edit").val()},load:function(e,t){var n=i(e);n.find(".sl-cover .edit").val(t),this.check(n)},clear:function(e){var t=i(e);t.find(".sl-cover .edit").val(""),t.find(".sl-cover").removeClass("sl-open").removeClass("sl-answer")},check:function(e){var n;try{n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}var r=e.find("input").val(),o=d.check.SingleLine(n,r),a=e.find(".sl-cover");switch(o.correctness){case-2:t.setTag(a,"sl-open");break;case-1:t.clearTag(a,"sl-answer"),t.clearTag(a,"sl-wrong");break;case 0:t.clearTag(a,"sl-answer"),t.setTag(a,"sl-wrong");break;case 1:t.setTag(a,"sl-answer"),t.clearTag(a,"sl-wrong")}},render:function(n,d,u,p){var f=this,h="QC"+d,g=(p=p||i("#"+h)).attr("qindex"),v={};t.questionIf[h]=v,v.setReadOnly=function(e){-1==a.getPlatform().indexOf("ipad")&&p.find("input").prop("disabled",e)},v.loadCorrect=function(e){f.load(p[0],e.Valid),f.check(p)};var m=e.getQuestionImageDivs(p,n.imgsize,n.img,n.imgpos),w=t.getNumbering(n,g);p.attr("numbering",w),i("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(w)+r.prepare(n.Question)+"</"+e.MH+">").appendTo(m.questdiv),c.processRichTextImages(m.questdiv),l.processRichTextWidgetPlayLinks(m.questdiv,!0),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(m.audiodiv);var b=null!=n.placeholder&&""!=n.placeholder?' placeholder="'+s(n.placeholder)+'"':"",y=i("<div class='sl-cover bw-column-container'><input type='text' "+t.inputModeAttrib(n.keyboard)+t.spellcheckattrib()+b+" class='edit bw-column-expanding' autocapitalize=\"none\"></input></div>").appendTo(m.answerdiv);t.createCorrectWrongMarker({elementType:"div"}).addClass("bw-column-fixed bw-centering-container").appendTo(y);var k=y.find("input");return k.on("keyup",function(){null!=u&&u()}),k.on("change",function(){null!=u&&setTimeout(u,200)}),t.createHint(n,m.hintdiv),m.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,m.imgdiv),t.processEmbeddedElements(p),p},prepareCorrection:function(e,n){var r={Valid:n.hasOwnProperty("Valid")?n.Valid:"","case-sensitive":n["case-sensitive"],"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(r));var o,a=this;if(e.find("input").bind("keyup change",function(){a.check(e)}),a.check(e),n.hasOwnProperty("Valid")&&""!=n.Valid.trim()){var i=n.Valid.replace(/</g,"&lt;").split(/\|\||##/);o="<div class='the-answer' >"+t.translate(1==i.length?"The answer:":"Correct answers:")+'<br><br><div class="answer">'+i.join("<br>")+"</div></div>"}return t.createRationale(n,e.find(".rationalediv"),o),{extrarationale:o}},getAnswer:function(t,n,r){var o=i(t),a=o.find(e.MH).html(),s=o.find(".sl-cover .edit").val();if(n){var c=d.check.SingleLine(r,s);return{question:a,answer:s,check_input:s,correctness:c.correctness,score:c.score,outof:c.outof,canonicalAnswer:r.Valid}}return{question:a,answer:s}}},n})},function(e,t){e.exports=function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}},function(e,t,n){var r,o,a,i,s,c,l;e.exports=(n(1),r=n(4),o=n(3),a=n(0),n(20),i=n(8),s=n(6),c=n(5),l=n(33),function(e,t){var n={};return n.PictureOrdering={save:function(e){var n=[];return a(e).find(".target .target-box").each(function(){var e=a(this).find(".po-pic");e.length?n.push(t.data(e,"report-name")):n.push("")}),JSON.stringify(n)},load:function(e,n){this.clear(e);var r=JSON.parse(n),o=0;a(e).find(".target .target-box").each(function(){var n=this;""!=r[o]&&a(e).find(".display .po-pic").each(function(){t.data(a(this),"report-name")==r[o]&&a(this).appendTo(a(n))}),++o}),a(e).trigger("change")},clear:function(e){var n=a(e),r=[];n.find(".target .po-pic").each(function(){var e=a(this);t.clearTag(e.parent(),"correct"),t.clearTag(e.parent(),"wrong"),r.push(e)});var o=n.find(".po-cover");t.clearTag(o,"all-wrong"),t.clearTag(o,"all-correct"),n.find(".display .po-quiz").each(function(){var e=a(this);0===this.childNodes.length&&r.length>0&&r.pop().appendTo(e)})},getCheckInput:function(e){var n=[];return e.find(".target .target-box").each(function(){var e=a(this).find(".po-pic").get(0);if(e){var r=t.data(a(e),"report-name");n.push(r)}else n.push(null)}),n},check:function(e){try{var n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}var r=this.getCheckInput(e),o=c.check.PictureOrdering(n,r),i=0,s=e.find(".po-cover");s.find(".target .target-box").each(function(){var e=a(this);switch(o.correctness[i]){case-1:t.clearTag(e,"wrong"),t.clearTag(e,"correct");break;case 1:t.clearTag(e,"wrong"),t.setTag(e,"correct");break;case 0:t.clearTag(e,"correct"),t.setTag(e,"wrong")}++i}),c.allCorrect(o)?s.removeClass("all-wrong").addClass("all-correct"):s.addClass("all-wrong").removeClass("all-correct")},render:function(n,d,u,p){var f=this,h="QC"+d,g=(p=p||a("#"+h)).attr("qindex"),v=t.getNumbering(n,g);a("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(v)+r.prepare(n.Question)+"</"+e.MH+">").appendTo(p),i.processRichTextImages(p),s.processRichTextWidgetPlayLinks(p,!0),p.attr("numbering",v),p.attr("scoring-weight",n["scoring-weight"]),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(p);var m=a("<div class='po-cover'></div>").appendTo(p);t.setTag(m,"all-wrong");var w={};t.questionIf[h]=w,w.loadCorrect=function(e){var n=0;p.find(".target .target-box").each(function(){var r=a(this),o=c.pictureId(e.Pictures[n++]);t.findByData(p,".po-pic","report-name",o).appendTo(r)}),f.check(p)};var b=a("<div class='display'></div>").appendTo(m).get(0),y=a("<div class='target'></div>").appendTo(m).get(0);if(t.createHint(n,p),a('<div class="rationalediv"></div>').appendTo(p),n.Pictures)for(var k=0;k<n.Pictures.length;++k){var C=n.Pictures[k].sources[0].src,T=a("<div class='po-quiz'></div>");if(b.childNodes.length){var x=Math.ceil((b.childNodes.length-1)*Math.random());Math.random()<.5?T.insertAfter(b.childNodes[x]):T.insertBefore(b.childNodes[x])}else T.appendTo(b);var _=a("<div class='po-pic' tabindex='-1'></div>").append(l.create({img:n.Pictures[k],type:"div",disable_press:!0}));t.data(_,"report-name",c.pictureId(n.Pictures[k])),_.attr({pic:C}),t.createCorrectWrongMarker({elementType:"div"}).addClass("picture-marker").appendTo(_),_.appendTo(T);var S=function(e,t){t.childNodes.length&&a(t.childNodes[0]).insertBefore(e),a(e).appendTo(t),a(e).css({position:"static"}),p.trigger("change"),null!=u&&u()};_.draggable({scope:h,appendTo:m,start:function(e,t){},stop:function(e,t){a(this).animate({top:0,left:0},function(){a(this).css({position:"relative"})})}}),T.droppable({drop:function(e,t){S(t.draggable,this)},tolerance:"intersect",scope:h}),a("<div class='target-box' index='"+k+"'></div>").appendTo(y).droppable({drop:function(e,t){S(t.draggable,this)},tolerance:"intersect",scope:h})}t.processEmbeddedElements(p)},prepareCorrection:function(e,n){var r={Pictures:n.Pictures,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(r));var o=this;a(e).on("change",function(){o.check(e)}),o.check(e);for(var i=a("<div class='the-answer'>"+t.translate("The answer:")+"</div>"),s=a("<div class='answer-box'>").appendTo(i),c=n.Pictures?n.Pictures:[],d=0;d<c.length;++d)l.create({img:c[d],background:"white",type:"div"}).addClass("po-quiz").appendTo(s);var u=i.html();return t.createRationale(n,e.find(".rationalediv"),u),{extrarationale:u}},getAnswer:function(n,r,o){var i=a(n),s=i.find(e.MH).html(),l=[];i.find(".target .target-box").each(function(){var e=a(this).find(".po-pic");e.length?l.push(t.createTextOrPictureAnswer(t.data(e,"report-name"),e.attr("pic"))):l.push("")});var d=this.getCheckInput(i),u=c.check.PictureOrdering(o,d);return{question:s,answer:l,check_input:d,correctness:u.correctness,score:u.score,outof:u.outof}}},n})},function(e,t,n){var r,o,a,i,s,c,l,d;e.exports=(r=n(1),o=n(4),a=n(3),i=n(0),s=n(8),c=n(6),l=n(5),d=n(26),function(e,t){var n=r.getConfigSync(),u={};return u.WordOrdering={save:function(e){var t=[];return i(e).find(".ms-cover .words .wordwrapper").each(function(){t.push(i(this).attr("word"))}),JSON.stringify(t)},load:function(e,t){var n=i(e),r=JSON.parse(t);r.length>0&&n.addClass("answered");var o=[];n.find(".ms-cover .words .wordwrapper").each(function(){o.push(i(this).detach())});for(var a=n.find(".ms-cover .words .cr-marker"),s=0;s<r.length;++s)for(var c=0;c<o.length;++c)if(o[c].attr("word")==r[s]){o[c].insertBefore(a),o.splice(c,1);break}for(c=0;c<o.length;++c)o[c].insertBefore(a);n.trigger("change")},clear:function(e){var n=i(e);n.removeClass("answered");var r=[];function o(e){for(var t=[],n=0;n<e.length;++n)t.push(e[n].attr("word"));return t.join(",")}n.find(".ms-cover .words .wordwrapper").each(function(){r.push(i(this).detach())});for(var a=i(e).attr("id"),s=t.questionIf[a].data;r.length>1&&o(r)===s.Words.join(",");)r=d.shuffleArray(r);for(var c=n.find(".ms-cover .words .cr-marker");r.length>0;)r.shift().insertBefore(c);n.trigger("change")},getCheckInput:function(e){var t=[];return e.hasClass("answered")?(e.find(".wordwrapper").each(function(){var e=i(this);t.push(e.attr("word"))}),t):null},check:function(e){var n;try{n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}var r=this.getCheckInput(e),o=l.check.WordOrdering(n,r);if("each"===n.policy){var a=0;e.find(".wordwrapper").each(function(){var e=i(this);1===o.correctness[a]?t.setTag(e,"ms-correctword"):t.clearTag(e,"ms-correctword"),++a})}else 1===o.correctness?t.setTag(e.find(".ms-cover"),"ms-answer"):t.clearTag(e.find(".ms-cover"),"ms-answer")},render:function(r,l,u,p){var f="QC"+l,h=(p=p||i("#"+f)).attr("qindex"),g={};g.data=r,t.questionIf[f]=g,g.setReadOnly=function(e){p.find(".wordwrapper").draggable(e?"disable":"enable")},g.loadCorrect=function(e){var t=[];p.find(".ms-cover .words .wordwrapper").each(function(){t.push(i(this).detach())});for(var n=p.find(".ms-cover .words .cr-marker"),r=0;r<e.Words.length;++r)for(var o=0;o<t.length;++o)if(t[o].attr("word")==e.Words[r]){t[o].insertBefore(n),t.splice(o,1);break}p.trigger("change"),p.addClass("answered")};var v=e.getQuestionImageDivs(p,r.imgsize,r.img,r.imgpos),m=t.getNumbering(r,h);p.attr("numbering",m),i("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(m)+o.prepare(r.Question)+"</"+e.MH+">").appendTo(v.questdiv),s.processRichTextImages(v.questdiv),c.processRichTextWidgetPlayLinks(v.questdiv,!0),r.audio&&""!=r.audio&&a.createPlayer(r.audio,"quiz"===e.getWidgetType()).appendTo(v.audiodiv);var w=i('<div class="ms-cover"> </div>');w.appendTo(v.answerdiv);var b=i('<div class="words"> </div>');"Sentences"===r.order_type&&b.addClass("sentence"),b.appendTo(w);var y=[];if(r.Words)for(var k=0;k<r.Words.length;++k)y.push({word:r.Words[k],pos:k});function C(e){for(var t=[],n=0;n<e.length;++n)t.push(e[n].word);return t.join(",")}for(;y.length>1&&C(y)===r.Words.join(",");)y=d.shuffleArray(y);for(k=0;k<y.length;++k){var T=i('<div class="wordwrapper">'+o.prepare(y[k].word)+"</div>").attr("word",y[k].word);T.appendTo(b),T.draggable({scope:f,helper:"clone",start:function(e,t){var n=i(e.target||e.srcElement);n.addClass("drag_placeholder"),this.clone=n.clone().insertAfter(n),n.hide()},drag:function(e,t){if(i("#"+f).addClass("answered"),"Sentences"!=r.order_type){var o=this.clone[0];(p=t.helper.offset()).right=p.left+i(o).width();var a=null,s="right-to-left"===n.direction,c=!1;if(i("#"+f+" .ms-cover .words .wordwrapper").each(function(){if(!i(this).hasClass("ui-draggable-dragging")&&!c){this!=o&&(a=this);var e=i(this).offset();if(e.right=e.left+i(this).width(),e.bottom=e.top+i(this).height(),e.top<p.top+10&&p.top-10<e.bottom){var t=(p.left+p.right)/2,n=(e.left+e.right)/2;if(t<n&&t>e.left-20){if(c=!0,this!=o)try{return i(o).detach(),void(s?i(o).insertAfter(this):i(o).insertBefore(this))}catch(e){}}else if(t>n&&t<e.right+20&&(c=!0,this!=o))try{return i(o).detach(),void(s?i(o).insertBefore(this):i(o).insertAfter(this))}catch(e){}}}}),!c&null!=a){var l=i(a).offset();l.right=l.left+i(a).width(),l.bottom=l.top+i(a).height();var d=l.top<p.top+10&&p.top-10<l.bottom,u=s?p.right<=l.left:p.left>=l.right;if(d&&u)try{a!=o&&(i(o).detach(),i(o).insertAfter(a))}catch(e){}}}else{var p=t.helper.offset(),h=(a=null,o=this.clone[0],c=!1,!1);i("#"+f+" .ms-cover .words .wordwrapper").each(function(){if(!c&&!i(this).hasClass("ui-draggable-dragging")){var e=i(this).offset();if(p.top<e.top){if(c=!0,i(this).hasClass("drag_placeholder"))return;i(o).detach(),i(o).insertBefore(this)}i(this).hasClass("drag_placeholder")?h=!0:(a=this,h=!1)}}),!1===c&&!1===h&&(i(o).detach(),i(o).insertAfter(a))}},stop:function(e,t){var n=i(this);this.clone.replaceWith(n),n.show().removeClass("drag_placeholder").animate({top:0,left:0},function(){p.trigger("change"),u&&u()})}})}t.createCorrectWrongMarker().appendTo(b),t.createHint(r,v.hintdiv),v.rationalediv.addClass("rationalediv"),t.createOptionalImage(r,v.imgdiv),t.processEmbeddedElements(p)},prepareCorrection:function(e,n){var r={Words:n.Words,AlternateAnswers:n.AlternateAnswers,"scoring-weight":n["scoring-weight"],policy:n.policy,order_type:n.order_type};e.attr("policy",n.policy),t.data(e,"questionconfig",JSON.stringify(r));var a=this;e.bind("change",function(){a.check(e)}),a.check(e);var i="Sentences"===n.order_type?"<br>":" ",s=(n.Words?n.Words:[]).join(i),c="<div class='the-answer' >"+t.translate("The answer:")+'<br><br><div class="answer">'+o.prepare(s)+"</div></div>";return t.createRationale(n,e.find(".rationalediv"),c),{extrarationale:c}},getAnswer:function(t,n,r){var o=i(t),a=o.find(e.MH).html(),s=this.getCheckInput(o),c=l.check.WordOrdering(r,s),d=[];if(o.find(".ms-cover .words .wordwrapper").each(function(){d.push(i(this).attr("word"))}),"all"===r.policy){var u="Sentences"===r.order_type?"<br>":" ";return{question:a,answer:d.join(u),check_input:s,correctness:c.correctness,score:c.score,outof:c.outof}}return{question:a,answer:d,check_input:s,correctness:c.correctness,score:c.score,outof:c.outof}}},u})},function(e,t,n){var r,o,a,i,s,c,l,d,u,p,f,h=0,g=1,v=2;e.exports=(r=n(1),o=n(4),a=n(3),i=n(0),s=n(8),c=n(6),l=n(324),d=n(5),u=n(33),p=n(26),f=n(7),function(e,t){var n=r.getConfigSync(),m={};function w(e,n){var r=i(e).attr("id"),o=JSON.parse(n);t.questionIf[r].matchConnections.setLoading();for(var a=0;a<o.length;++a)o[a].sourceId=t.findByData(i(e),".connectsource","id",o[a].sourceId).attr("id"),o[a].targetId=t.findByData(i(e),".connecttarget","id",o[a].targetId).attr("id");return t.questionIf[r].setConnections(o)}function b(e){for(var n=i(e).attr("id"),r=t.questionIf[n].matchConnections.getConnections(),o=0;o<r.length;++o)r[o].sourceId=t.data(i(e).find("#"+r[o].sourceId),"id"),r[o].targetId=t.data(i(e).find("#"+r[o].targetId),"id");return JSON.stringify(r)}function y(e){var n=i(e).attr("id");t.questionIf[n].matchConnections.clearConnections()}function k(e,t){return t===g?null==e.sources||0===e.sources.length:""===e}function C(e,t,n){return e===h?t:e===g?d.pictureId(t):e===v?n+"":(console.error("Invalid element type: ",e),0)}function T(e,n,r,o){var a={pairs:n.pairs,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(a));for(var s=[],c=i(e).attr("id"),l=n.pairs?n.pairs:[],u=0;u<l.length;++u)s.push({sourceId:t.findByData(i(e),".connectsource","txt",C(r,l[u].source,u)).attr("id"),targetId:t.findByData(i(e),".connecttarget","txt",d.pictureId(l[u].target)).attr("id")});t.questionIf[c].matchConnections.setCorrectPairs(s);var p=this;e.bind("change",function(){p.check(e)}),t.createRationale(n,e.find(".rationalediv"))}function x(e){for(var n=i(e).attr("id"),r=t.questionIf[n].matchConnections.getConnections(),o=[],a=0;a<r.length;++a){var s=r[a];o.push({source:t.data(e.find("#"+s.sourceId),"txt"),target:t.data(e.find("#"+s.targetId),"txt")})}return o}function _(n,r,o,a,s,c){for(var l=i(n),u=l.find(e.MH).html(),p=x(l),f=d.check[c](o,p),m=[],w=o.pairs?o.pairs:[],b=0;b<w.length;++b){var y,k,C=w[b],T=C.source;switch(a){case h:y=k=T;break;case g:y=k=C.source.hasOwnProperty("origbase")?C.source.origbase:T;break;case v:y=b+"",k=C.audiodesc}if(""!==k){for(var _=null,S=0;S<p.length;++S){var I=p[S];y===I.source&&(_=I.target)}if(null!==_){for(var O=!1,A=0;A<w.length;++A){var E=w[A],q=E.target,P=E.target.hasOwnProperty("origbase")?E.target.origbase:q;if(_===P){m.push(t.createPairAnswer(k,a===g&&T.sources&&T.sources.length>0?T.sources[0].src:"",P,s===g&&q.sources&&q.sources.length>0?q.sources[0].src:"")),O=!0;break}}O||console.error("Match getAnswer problem... don't find target "+_)}else m.push(t.createPairAnswer(k,a===g?T.sources[0].src:"","",""))}}return{question:u,answer:m,check_input:p,correctness:f.correctness,score:f.score,outof:f.outof}}function S(r,l,m,w,b,y,T){var x="QC"+l,_=(y=y||i("#"+x)).attr("qindex"),S={};t.questionIf[x]=S;var I=T.create("#"+x,e.getScrollObject(),t,e.getConnectionType(),b);function O(){I.repaint(),"right-to-left"===n.direction&&I.fixEndpointPositionsForRtl(e.JspRtlOffset()),I.repaint()}S.matchConnections=I;var A=e.getQuestionImageDivs(y,r.imgsize,r.img,r.imgpos);y.addClass("match");var E=t.getNumbering(r,_);y.attr("numbering",E),y.attr("scoring-weight",r["scoring-weight"]),i("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(E)+o.prepare(r.Question)+"</"+e.MH+">").appendTo(A.questdiv),s.processRichTextImages(A.questdiv),c.processRichTextWidgetPlayLinks(A.questdiv,!0),r.audio&&""!==r.audio&&a.createPlayer(r.audio,"quiz"===e.getWidgetType()).appendTo(A.audiodiv),t.createHint(r,A.hintdiv,O),A.rationalediv.addClass("rationalediv"),S.setConnections=function(e){I.setLoading(!0),I.clearConnections();for(var t=0;t<e.length;++t)I.connect(e[t].sourceId,e[t].targetId);I.setLoading(!1)};var q=r.pairs?r.pairs:[];S.check=function(){for(var e=JSON.parse(t.data(y,"questionconfig")),n=e.pairs?e.pairs:[],r=0;r<n.length;++r)if(!k(n[r].source,m)&&!k(n[r].target,w)){for(var o=t.findByData(y,".connectsource","txt",C(m,n[r].source,r)).attr("id"),a=t.findByData(y,".connecttarget","txt",d.pictureId(n[r].target)).attr("id"),i=-1,s=I.getConnections(),c=0;c<s.length;++c)if(s[c].sourceId===o){i=s[c].targetId;break}i!==a&&I.connect(o,a,!0)}setTimeout(I.repaint.bind(I),0)},S.setReadOnly=function(e){if(!1===e){var t=I.getConnections();this.setConnections(t)}};for(var P=[],D=0;D<q.length;++D){var R='<td class="match_source match_source_'+D+'"></td>',N='<td class="match_target match_target_'+D+'"></td>';"right-to-left"===n.direction?P.push("<tr>"+N+R+"</tr>"):P.push("<tr>"+R+N+"</tr>")}var M=i('<table class="match_table">'+P.join("")+"</table>").attr("resize-mode",r.img_resize_mode).appendTo(y);function L(e,t,n){e.css({width:"",height:""});var r=function(e){function t(e){return e.outerWidth()-e.width()}return 2*(t(e.parent())+t(e.parent().parent())+t(e.parent().parent().parent())+25)}(e),o=Math.max((n.width-r)/2,40),a=Math.max(n.height/t-20-10,40);e.css({maxWidth:o,maxHeight:a,width:"auto"})}function B(){var e=y.closest(".contentarea");return{width:e.width()||1,height:(e.height()||1)-y.find("h1").outerHeight(!0)-20}}S.repaint=S.onResize=function(){if("Auto"===r.img_resize_mode){var e=B();y.find(".match_table img").each(function(){L(i(this),r.pairs.length,e)})}setTimeout(O,0)},S.loadCorrect=function(e){I.setLoading(!0),I.clearConnections();for(var n=0;n<q.length;++n)if(!k(q[n].source,m)&&!k(q[n].target,w)){var r=t.findByData(y,".connectsource","id",x+"_cs_"+n).attr("id"),o=t.findByData(y,".connecttarget","id",x+"_ct_"+n).attr("id");I.connect(r,o)}I.setLoading(!1)};var W=B(),F=[];for(D=0;D<q.length;++D)F.push(D);function U(e){return i(document.createElement("div")).append(u.create(e))}for(var z,j,Q,H=0,J=0;J<q.length;++J)if(D=F[J],!k((ee=q[D]).source,m)){var Y,V=x+"_cs_"+D;if(m===g){var $=ee.source.sources&&ee.source.sources.length>0?ee.source.sources[0].src:"",K=ee.source.origbase;Y=i(document.createElement("div")).addClass("connectwindow connectpicture connectsource").attr("pic",$).attr("id",p.randomId(20)),t.data(Y,"id",V),t.data(Y,"txt",K),t.createCorrectWrongMarker().appendTo(Y);var G=U(ee.source).addClass("imgwrapper").appendTo(Y);i(G).find("img").one("load",function(){"Auto"===r.img_resize_mode&&L(i(this),q.length,W),t.triggerImageLoaded()}).each(function(){this.complete&&i(this).load()})}else m===h?(Y=i(document.createElement("div")).addClass("connectwindow connectword connectsource").html(o.prepare(ee.source)).attr("id",p.randomId(20)),t.data(Y,"id",V),t.data(Y,"txt",ee.source),t.createCorrectWrongMarker().prependTo(Y)):m===v&&(Y=i(document.createElement("div")).addClass("connectwindow connectaudio connectsource").attr("id",p.randomId(20)),z=ee.source,j=Y,Q=void 0,Q=a.addElement(z,"body"),i('<div class="bw-button audiobutton"><div class="bw-icon-large bw-icon-music-play-2"></div>').makeButton(f("play")).tapOrClick(Q.toggle.bind(Q)).appendTo(j),t.data(Y,"id",V),t.data(Y,"txt",J+""),t.createCorrectWrongMarker().prependTo(Y));M.find(".match_source_"+H).append(Y),++H}var X=p.randomIndexList(q.length),Z=0;for(J=0;J<q.length;++J){var ee,te;if(D=X[J],!k((ee=q[D]).target,w))V=x+"_ct_"+D,w===g?($=ee.target.sources&&ee.target.sources.length>0?ee.target.sources[0].src:"",K=ee.target.origbase,te=i(document.createElement("div")).addClass("connectwindow connectpicture connecttarget").attr("pic",$).attr("id",p.randomId(20)),t.data(te,"id",V),t.data(te,"txt",K),G=U(ee.target).addClass("imgwrapper").appendTo(te),i(G).find("img").one("load",function(){"Auto"===r.img_resize_mode&&L(i(this),q.length,W),t.triggerImageLoaded()}).each(function(){this.complete&&i(this).load()}),t.createCorrectWrongMarker().appendTo(te)):(te=i(document.createElement("div")).addClass("connectwindow connectword connecttarget").html(o.prepare(ee.target)).attr("id",p.randomId(20)),t.data(te,"id",V),t.data(te,"txt",ee.target),t.createCorrectWrongMarker().appendTo(te)),M.find(".match_target_"+Z).append(te),++Z}for(M.find("tr").each(function(){var e=i(this);e.find(".match_source").is(":empty")&&e.find(".match_target").is(":empty")&&e.remove()}),D=0;D<q.length;++D)k(q[D].source,m)||(V=x+"_cs_"+D,I.addSource(t.findByData(y,".connectsource","id",V).attr("id")));for(D=0;D<q.length;++D)k(q[D].target,w)||(V=x+"_ct_"+D,I.addTarget(t.findByData(y,".connecttarget","id",V).attr("id")));t.createOptionalImage(r,A.imgdiv,O),t.processEmbeddedElements(y),o.schedule(O)}return m.WordMatch={save:b,load:w,clear:y,MatchConnections:l,render:function(e,t,n,r){return S(e,t,h,h,n,r,this.MatchConnections)},prepareCorrection:function(e,t){return T(e,t,h)},getCheckInput:x,getAnswer:function(e,t,n){return _(e,0,n,h,h,"WordMatch")}},m.WordPictureMatch={save:b,load:w,clear:y,MatchConnections:l,render:function(e,t,n,r){return S(e,t,h,g,n,r,this.MatchConnections)},prepareCorrection:function(e,t){return T(e,t,h)},getCheckInput:x,getAnswer:function(e,t,n){return _(e,0,n,h,g,"WordPictureMatch")}},m.PicturePictureMatch={save:b,load:w,clear:y,MatchConnections:l,render:function(e,t,n,r){return S(e,t,g,g,n,r,this.MatchConnections)},prepareCorrection:function(e,t){return T(e,t,g)},getCheckInput:x,getAnswer:function(e,t,n){return _(e,0,n,g,g,"PicturePictureMatch")}},m.AudioWordMatch={save:b,load:w,clear:y,MatchConnections:l,render:function(e,t,n,r){return S(e,t,v,h,n,r,this.MatchConnections)},prepareCorrection:function(e,t){return T(e,t,v)},getCheckInput:x,getAnswer:function(e,t,n){return _(e,0,n,v,h,"AudioWordMatch")}},m.AudioPictureMatch={save:b,load:w,clear:y,MatchConnections:l,render:function(e,t,n,r){return S(e,t,v,g,n,r,this.MatchConnections)},prepareCorrection:function(e,t){return T(e,t,v)},getCheckInput:x,getAnswer:function(e,t,n){return _(e,0,n,v,g,"AudioPictureMatch")}},m})},function(e,t,n){var r,o;e.exports=(r=n(325),o=n(0),{create:function(e,t,n,a,i){var s,c=r.getInstance();c.setRenderMode(c.SVG),c.importDefaults({DragOptions:{cursor:"pointer",zIndex:2e3},PaintStyle:{strokeStyle:"#666"},EndpointStyle:{width:20,height:16,strokeStyle:"#666"},Endpoint:"Rectangle",Anchors:["TopCenter","TopCenter"]});var l=[],d=!1;function u(t){for(var r=0;r<s.pairs.length;++r){var a=s.pairs[r];if(t.sourceId===a.sourceId)if(t.targetId===a.targetId)if(!0===t.getParameter("correction"))n.setTag(o(t.canvas),"wm-missing-answer");else{n.setTag(o(t.canvas),"wm-correct-answer");var i=o(e).find("#"+t.sourceId),c=o(e).find("#"+t.targetId);n.setTag(i,"wm-correct-answer"),n.setTag(c,"wm-correct-answer"),n.clearTag(i,"wm-wrong-answer"),n.clearTag(c,"wm-wrong-answer")}else n.setTag(o(t.canvas),"wm-wrong-answer"),i=o(e).find("#"+t.sourceId),c=o(e).find("#"+t.targetId),n.clearTag(i,"wm-correct-answer"),n.clearTag(c,"wm-correct-answer"),n.setTag(i,"wm-wrong-answer"),n.setTag(c,"wm-wrong-answer")}}function p(t,r){if(r){for(var a=-1,c=0;c<l.length;c++)if(l[c]===t){a=c;break}-1!==a&&(l.splice(a,1),!1===d&&null!==i&&i());var p=o(e).find("#"+t.sourceId),f=o(e).find("#"+t.targetId);n.clearTag(p,"wm-correct-answer"),n.clearTag(f,"wm-correct-answer"),n.clearTag(p,"wm-wrong-answer"),n.clearTag(f,"wm-wrong-answer")}else l.push(t),s.hasOwnProperty("pairs")&&(u(t),o(t.canvas).attr("source",t.sourceId),o(t.canvas).attr("target",t.targetId)),!1===d&&null!==i&&i()}c.bind("connection",function(e,t){p(e.connection,!1)}),c.bind("connectionDetached",function(e,t){p(e.connection,!0)});var f=[],h={tolerance:"touch",hoverClass:"dropHover",activeClass:"dragActive"},g={endpoint:["Dot",{radius:15}],anchor:[1,.5,1,0],paintStyle:{width:25,height:21},isSource:!0,connectorStyle:{lineWidth:4},connector:a,maxConnections:2,dropOptions:h,detachable:!1,reattach:!1},v={endpoint:["Dot",{radius:15}],anchor:[0,.5,0,0],paintStyle:{opacity:.5},isTarget:!0,dropOptions:h,maxConnections:2,beforeDrop:function(e){return function(e){for(var t=-1,n=0;n<l.length;n++)if(l[n].targetId===e.targetId){t=n;break}-1!==t&&c.detachAllConnections(e.targetId)}(e),function(e){for(var t=-1,n=0;n<l.length;n++)if(l[n].sourceId===e.sourceId){t=n;break}-1!==t&&c.detachAllConnections(l[t].targetId)}(e),!0},detachable:!1,reattach:!1};function m(e){var n=!0,r=null;function a(e){null!=r&&(clearTimeout(r),r=null);var o=t.scrollTop();t.scrollTop(o+e),n||(r=setTimeout(function(){r=null,a(e)},50))}e.bind("mousedown",function(e){function r(e){var r;r=e.originalEvent.clientY,n=!0,r<25&&(n=!1,a(-5)),r>t.height()-25&&(n=!1,a(5))}o("html").on("mouseup",function e(){n=!0,o("html").off("mouseup",e),o("html").off("mousemove",r)}),o("html").on("mousemove",r)})}return s={repaint:c.repaintEverything.bind(c),addSource:function(t){f[t]=c.addEndpoint(t,{scope:e,container:o(e)},g),o(f[t].endpoint.svg.parentNode).attr({source:t,"aria-labelledby":t}),m(o(f[t].endpoint.svg.parentNode))},addTarget:function(t){f[t]=c.addEndpoint(t,{scope:e,container:o(e)},v),o(f[t].endpoint.svg.parentNode).attr({target:t,"aria-labelledby":t})},clearConnections:function(){for(;l.length>0;){var e=l[0];c.detachAllConnections(e.sourceId),c.detachAllConnections(e.targetId)}this.repaint()},fixEndpointPositionsForRtl:function(t){o(e).find(" ._jsPlumb_endpoint").each(function(){o(this).css("left",parseInt(o(this).css("left"))-t+"px")})},connect:function(e,t,n){var r=f[e],o=f[t];r&&o&&(n?c.connect({source:r,target:o,parameters:{correction:!0}}):c.connect({source:r,target:o}))},getConnections:function(){for(var e=[],t=0;t<l.length;++t)!0!==l[t].getParameter("correction")&&e.push({sourceId:l[t].sourceId,targetId:l[t].targetId});return e},setCorrectPairs:function(e){this.pairs=e;for(var t=0;t<l.length;++t)u(l[t])},setLoading:function(e){d=e}}}})},function(e,t){e.exports=window.jsPlumb},function(e,t,n){var r,o,a,i,s,c,l,d,u;e.exports=(n(1),r=n(4),o=n(3),a=n(0),i=n(20),s=n(8),c=n(6),l=n(5),n(138),d=n(33),u=n(26),function(e,t){var n={};function p(e,n){var r=a(e),o=JSON.parse(n),i=[];r.find(".dd-cover .dditem").each(function(){i.push(a(this))});var s={};if(r.find(".dd-cover .ddbox").each(function(){s[t.data(a(this),"name")]=a(this)}),r.hasClass("onlydroponboxes")){for(var c=0;c<o.length;++c)for(var l=o[c],d=0;d<l.words.length;++d)if(null!=(p=s[l.name]))for(var u=0;u<i.length;++u)if(i[u].attr("save")==l.words[d]){i[u].appendTo(p),i.splice(u,1);break}}else for(s.DD_BOXES=r.find(".dd-boxes"),c=0;c<o.length;++c)for(l=o[c],d=0;d<l.words.length;++d){var p;if(null!=(p=s[l.name]))for(u=0;u<i.length;++u)i[u].attr("save")==l.words[d].name&&(i[u].appendTo(p),i[u].css({position:"absolute",left:l.words[d].left,top:l.words[d].top}),i.splice(u,1))}r.trigger("change")}function f(e){var t=a(e);t.find(".dd-cover .dditem").appendTo(t.find(".dd-cover .words")),t.trigger("change")}function h(e){var n=[];if(a(e).hasClass("onlydroponboxes"))a(e).find(".dd-cover .ddbox").each(function(){var e={};e.name=t.data(a(this),"name"),e.words=[],a(this).find(".dditem").each(function(){e.words.push(a(this).attr("save"))}),n.push(e)});else{a(e).find(".dd-cover .ddbox").each(function(){var e=a(this),r={};r.name=t.data(e,"name"),r.words=[],e.find(".dditem").each(function(){var e=a(this),t={};t.name=e.attr("save"),t.left=e.position().left,t.top=e.position().top,r.words.push(t)}),n.push(r)});var r={name:"DD_BOXES",words:[]};a(e).find(".dd-boxes > .dditem").each(function(){var e=a(this),t={};t.name=e.attr("save"),t.left=e.position().left,t.top=e.position().top,r.words.push(t)}),n.push(r)}return JSON.stringify(n)}function g(e){var n=[];return e.find(".dd-cover .ddbox").each(function(){var e=a(this),r=t.data(e,"name");e.find(".dditem").each(function(){var e=a(this).attr("save");n.push([e,r])})}),n}function v(e,n){try{var r=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}for(var o=this.getCheckInput(e),i=(n?l.check.PictureDragDrop(r,o):l.check.TextDragDrop(r,o)).items,s=0;s<i.length;++s)i[s].used=!1;e.find(".dd-cover .ddbox, .dd-cover .words").each(function(){var e=a(this),n=t.data(e,"name")||"";e.find(".dditem").each(function(){for(var e=a(this),r=e.attr("save"),o=!1,s=0;s<i.length;++s){var c=i[s];if(!c.used&&c.pair[0]===r&&c.pair[1]===n){o=!0,c.used=!0;break}}o?(t.setTag(e,"dd-correct"),t.clearTag(e,"dd-wrong")):(t.clearTag(e,"dd-correct"),t.setTag(e,"dd-wrong"))})})}function m(e,n){var r={Boxes:n.Boxes,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(r));var o=this;e.bind("change",function(){o.check(e)}),o.check(e),t.createRationale(n,e.find(".rationalediv"))}function w(n,r,o,i){var s=a(n),c=s.find(e.MH).html(),d=this.getCheckInput(s),u=i?l.check.PictureDragDrop(o,d):l.check.TextDragDrop(o,d),p=[],f={};if(i)for(var h=o.Boxes?o.Boxes:[],g=0;g<h.length;++g){var v=h[g];if(v.Items)for(var m=0;m<v.Items.length;++m)f[l.pictureId(v.Items[m])]=v.Items[m].filename||v.Items[m]}for(g=0;g<u.items.length;++g){var w=u.items[g];w.correct?p.push(t.createPairAnswer(w.pair[0],f[w.pair[0]],w.pair[1])):null!==w.answer?p.push(t.createPairAnswer(w.pair[0],f[w.pair[0]],w.answer+"("+w.pair[1]+")")):p.push(t.createPairAnswer(w.pair[0],f[w.pair[0]],"("+w.pair[1]+")"))}return{question:c,answer:p,check_input:d,correctness:u.correctness,score:u.score,outof:u.outof}}function b(n,l,p,f,h){var g="QC"+l,v=(h=h||a("#"+g)).attr("qindex"),m={};t.questionIf[g]=m,m.loadCorrect=function(e){var n=[];h.find(".dd-cover .dditem").each(function(){n.push(a(this))});for(var r=h.find(".dd-cover .ddbox"),o=e.Boxes?e.Boxes:[],i=0;i<o.length;++i){var s=o[i];if(s.Items)for(var c=0;c<s.Items.length;++c)for(var l=s.Items[c].filename||s.Items[c],d=p&&s.Items[c].origbase||l,u=0;u<n.length;++u)if(d===n[u].attr("save")){n[u].appendTo(a(r[i])),n.splice(u,1);break}}for(r={},h.find(".dd-cover .ddbox").each(function(){r[t.data(a(this),"name")]=a(this)}),i=0;i<n.length;++i)n[i].appendTo(r[t.data(n[i],"boxname")]);h.trigger("change")},m.setReadOnly=function(e){h.find(".dditem").draggable(e?"disable":"enable")};var w=t.getNumbering(n,v);h.attr("numbering",w),h.attr("scoring-weight",n["scoring-weight"]),h.attr("policy",n.policy),"yes"==n["only-drop-on-boxes"]&&h.addClass("onlydroponboxes"),a("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(w)+r.prepare(n.Question)+"</"+e.MH+">").appendTo(h),s.processRichTextImages(h),c.processRichTextWidgetPlayLinks(h,!0),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(h),t.createHint(n,h),a(document.createElement("div")).addClass("rationalediv").appendTo(h);var b=a('<div class="dd-cover"> </div>');b.appendTo(h);var y=a('<div class="words"> </div>');y.appendTo(b);var k=a(document.createElement("div")).addClass("dd-boxes-scrolling-wrapper").css({width:"100%","overflow-x":"auto"}).appendTo(b),C=a('<div class="dd-boxes"> </div>');function T(e,t){var n=a(e).offset();a(e).appendTo(t),a(e).offset(n),h.trigger("change")}C.appendTo(k),y.droppable({drop:function(e,t){T(t.draggable,this)},tolerance:"intersect",scope:g}),y.addClass("animatedrop");for(var x=[],_=n.Boxes?n.Boxes:[],S=0;S<_.length;++S){var I=_[S];if(I.Items)for(var O=0;O<I.Items.length;++O)x.push(I.Items[O])}x=u.shuffleArray(x);var A,E,q={},P={},D=k[0],R=e.getScrollObject()[0];function N(e){P.down>0&&(R.scrollTop=R.scrollTop+(P.down>>1)),P.up>0&&(R.scrollTop=R.scrollTop-(P.up>>1)),P.left>0&&(D.scrollLeft=D.scrollLeft-(P.left>>1)),P.right>0&&(D.scrollLeft=D.scrollLeft+(P.right>>1)),(P.up>0||P.down>0||P.left>0||P.right>0)&&e()&&setTimeout(N.bind(null,e),100)}function M(e){var t=a(document.createElement("div")).append(d.create({img:e,disable_press:!0}));return"Fixed"===n.img_resize_mode&&t.addClass("fixed-size").css("height",n.img_resize_height),t}function L(e,t,n,r){var o=e.offset(),a=t.top+r,i=t.left+n;return i>=o.left&&a>=o.top&&i<=o.left+e.outerWidth()&&a<=o.top+e.outerHeight()}for(S=0;S<x.length;++S){var B=x[S],W=a('<div class="dditem"></div>');if(t.setTag(W,"dd-wrong"),p){var F=x[S].origbase;W.attr({save:F,pic:B.sources[0].src}).addClass("dditem-img"),M(B).addClass("imgwrapper").appendTo(W),t.createCorrectWrongMarker().appendTo(W)}else W.attr("save",x[S]),W.html(r.prepare(x[S])),t.createCorrectWrongMarker().appendTo(W);"None"==n["item-frame"]&&W.addClass("dditem-noframe"),W.appendTo(y),W.draggable({scope:g,helper:function(e){var t=a(e.currentTarget),n=t.clone().addClass("dragging-clone").appendTo(b);return n.css({position:"absolute",width:t.width(),height:t.height()}),this.offsetX=t.width()/2,this.offsetY=t.height()/2,n.get(0)},appendTo:b,start:function(e,t){a(this).addClass("drag_placeholder"),q={top:a(R).offset().top+50,bottom:a(R).offset().top+a(R).height()-50,left:a(D).offset().left+50,right:a(D).offset().left+a(D).width()-50,scrollTop:R.scrollTop},A=!1,E=!0,this.targetBoxes=b.find(".words, .ddbox")},drag:function(e,t){var n=this.targetBoxes.find(".current-drop-target");if(0==n.length||!L(n,t.offset,this.offsetX,this.offsetY)){this.targetBoxes.removeClass("current-drop-target");for(var r=0;r<this.targetBoxes.length;++r)if(L(n=a(this.targetBoxes[r]),t.offset,this.offsetX,this.offsetY)){n.addClass("current-drop-target");break}}var o=a(".ui-draggable-dragging");function i(){o.setTranslate(0,R.scrollTop-q.scrollTop)}P.up=q.top-e.clientY,P.down=e.clientY-q.bottom,P.left=q.left-e.clientX,P.right=e.clientX-q.right,(P.up>0||P.down>0||P.left>0||P.right>0)&&!A?(N(function(){return i(),E}),A=!0):(i(),A=!1)},stop:function(e,t){this.targetBoxes.removeClass("current-drop-target"),A=!1,E=!1;var n=a(this);n.removeClass("drag_placeholder"),n.parent().hasClass("animatedrop")?(n.css("position","relative"),n.offset(a(t.helper).offset()),n.animate({top:0,left:0},function(){null!=f&&f()})):(n.css("position","absolute"),n.offset(a(t.helper).offset()),null!=f&&f())}})}if(""!=n.background_picture){C.css("background-image","url("+i(n.background_picture)+")");var U=new Image;U.onload=function(){C.css("width",this.width+"px").css("height",this.height+"px")},U.src=n.background_picture}var z,j=0,Q=0;for("no"==n["only-drop-on-boxes"]&&C.droppable({drop:function(e,t){T(t.draggable,this)},scope:g}),S=0;S<_.length;++S){var H=_[S];if(""!==H.name){var J=a('<div id="'+g+"ddbox_"+S+'" class="ddbox" ></div>');if(t.data(J,"name",(z=H.name,a(document.createElement("div")).html(z).text())),a('<div class="ddboxbg"></div>').appendTo(J),J.droppable({drop:function(e,t){T(t.draggable,this)},tolerance:"intersect",scope:g}),"yes"===n["only-drop-on-boxes"]&&J.addClass("animatedrop"),J.appendTo(C),"yes"!==n["auto-position"]){J.css({left:H.position.X+"px",top:H.position.Y+"px",width:H.position.Width+"px",height:H.position.Height+"px"});var Y=H.position.X+H.position.Width,V=H.position.Y+H.position.Height;Y>j&&(j=Y),V>Q&&(Q=V),J.addClass("positioned")}else""!=H.position.Width&&J.css("width",H.position.Width+"px"),""!=H.position.Height&&J.css("min-height",H.position.Height+"px");"yes"==n["show-box-header"]&&a('<div class="ddbox_box_header">'+H.name+"</div>").appendTo(J),"Dotted"==n["box-border"]?J.addClass("ddbox_border_dotted"):"None"==n["box-border"]&&J.addClass("ddbox_border_none"),"Transparent"==n["box-background"]?J.addClass("ddbox_background_transparent"):"Semi-transparent"==n["box-background"]&&J.addClass("ddbox_background_semitransparent"),J.bind("touchend",function(){T(self.dragItem,this)})}}"yes"==n["auto-position"]&&C.addClass("auto-position"),t.processEmbeddedElements(h)}return n.TextDragDrop={save:h,load:p,clear:f,check:function(e){return v.bind(this)(e,!1)},getCheckInput:g,render:function(e,t,n,r){return b.bind(this)(e,t,!1,n,r)},prepareCorrection:m,getAnswer:function(e,t,n){return w.bind(this)(e,t,n,!1)}},n.PictureDragDrop={save:h,load:p,clear:f,check:function(e){return v.bind(this)(e,!0)},getCheckInput:g,render:function(e,t,n,r){return b.bind(this)(e,t,!0,n,r)},prepareCorrection:m,getAnswer:function(e,t,n){return w.bind(this)(e,t,n,!0)}},n})},function(e,t,n){var r,o,a,i,s,c,l;e.exports=(n(1),n(139),r=n(328),o=n(4),a=n(3),i=n(0),s=n(8),c=n(6),l=n(5),function(e,t){var n={},d=i;return n.Whiteboard={save:function(e){var n=d(e).attr("id");return t.questionIf[n].whiteboard.saveData()},load:function(e,n){var r=d(e).attr("id");t.questionIf[r].isLoaded=!1,t.questionIf[r].whiteboard.loadData(n,function(){t.questionIf[r].isLoaded=!0})},clear:function(e){var n=d(e).attr("id");return t.questionIf[n].whiteboard.clearPage()},render:function(n,l,u){var p="QC"+l,f=i("#"+p),h=f.attr("qindex"),g=t.getNumbering(n,h);f.attr("numbering",g),f.attr("scoring-weight",n["scoring-weight"]),d("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(g)+o.prepare(n.Question)+"</"+e.MH+">").appendTo(f),s.processRichTextImages(f),c.processRichTextWidgetPlayLinks(f,!0),n.audio&&""!=n.audio&&a.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(f);var v=d("<div class='w-cover'></div>").appendTo(f),m=d("<div class='w-toolbar-wrapper'></div>").appendTo(v),w=d("<div class='bw-toolbar'></div>").appendTo(m);w.addClass("black"==n.button_color?"white":"black");var b=d("<div class='bw-toolbar hidden'></div>").appendTo(m);b.addClass("black"==n.button_color?"white":"black"),d('<div id="buttons-container" class="bw-button-group"></div>').appendTo(w),d('<div id="width-buttons-container" class="bw-button-group"></div>').appendTo(w),d('<div id="colors-container" class="bw-button-group"></div>').appendTo(w),d('<div id="tool-buttons-container" class="bw-button-group"></div>').appendTo(w),d('<div id="photo-buttons-container" class="bw-button-group"></div>').appendTo(b);var y=d('<div id="drawingareawrapper"></div>').appendTo(v),k=d('<div id="drawingarea"></div>').appendTo(y);d('<input type="class" id="textedit" size="50"></input>').appendTo(y),d("<input type='file' accept='image/*'' class='take-picture-field hidden'>").appendTo(v);var C=d("<div class='photo-placer hidden'></div>").appendTo(y),T=Math.round(4*(n.Height-100)/3),x=n.Height-100;C.css("height",x+"px"),C.css("width",T+"px"),C.attr("data-start-height",x),C.attr("data-start-width",T),r.addWidthButtons("#"+p+" #width-buttons-container",!0),r.addColorButtons("#"+p+" #colors-container",!0),r.addClearUndoRedoButtons("#"+p+" #buttons-container"),r.addZoomButtons("#"+p+" #buttons-container","yes"===n.enable_pan),r.addDrawToolButtons("#"+p+" #buttons-container","yes"===n.enable_photo,"yes"===n.enable_pan,!0,n.stickers&&n.stickers.length>0),r.addPhotoEditingButtons("#"+p+" #photo-buttons-container");var _={};t.questionIf[p]=_,_.whiteboard=r.createWhiteboard({topselector:"#"+p,canvasselector:" #drawingarea",createCanvas:!0,width:k.width(),height:n.Height,background_image:n.img,background_resize_policy:n["resize-policy"],maintoolbar:w,phototoolbar:b,enablephoto:"yes"==n.enable_photo,colorsaspopup:"bottom",widthaspopup:"bottom",toolsaspopup:"bottom",allow_pan:"yes"===n.enable_pan,allow_zoom:"yes"===n.enable_pan,stickers:n.stickers}),k.find("canvas").css("height",n.Height),_.repaint=_.onResize=function(){var e=i("#"+p),t=e.find("#drawingarea");e.find("canvas").attr("width",t.width()),this.whiteboard.redrawOnResize()},_.whiteboard.onChange(function(){null!=u&&u()}),_.setReadOnly=function(e){this.whiteboard.setReadOnly(e)},t.createHint(n,f),v.addClass("rationalediv"),t.processEmbeddedElements(f)},prepareCorrection:function(e,n){t.createRationale(n,e.find(".rationalediv"))},fetchAsset:function(e){var n=d(e).attr("id"),r=t.questionIf[n].whiteboard.imgData();return r?{data:r,mimetype:"image/png"}:void 0},assetUploadCompleteCB:function(e,n){var r=d(n).attr("id");t.questionIf[r].url=e},getAnswer:function(n,r,o){var a=d(n),i=a.attr("id"),s=a.find(e.MH).html(),c=t.questionIf[i].url,u=l.check.Whiteboard(o,!1===t.questionIf[i].whiteboard.isEmpty());return{question:s,answer:c,correctness:u.correctness,score:u.score,outof:u.outof}}},n})},function(e,t,n){n(329),e.exports=function(e,t,n,r,o,a,i,s,c){return{addColorButtons:function(e,t){var n=[{datacolor:"white",classname:"bw-color-white"},{datacolor:"black",classname:"bw-color-black"},{datacolor:"red",classname:"bw-color-red"},{datacolor:"orange",classname:"bw-color-orange"},{datacolor:"yellow",classname:"bw-color-yellow"},{datacolor:"#00de00",classname:"bw-color-green"},{datacolor:"blue",classname:"bw-color-blue"},{datacolor:"#bc00de",classname:"bw-color-purple"},{datacolor:"brown",classname:"bw-color-brown"}],o=r(e);if(o.addClass("color-button-bar"),!0===t){r('<div class="bw-toolbutton" id="color_popup"><div class="bw-icon bw-icon-fill-drop"></div><div class="bw-icon bw-icon-fill-drop-small bw-color-blue"></div></div>').appendTo(o);for(var a=r('<div id="colorpopup"/>').appendTo(r("body")),i=0;i<n.length;++i)r('<a data-color="'+n[i].datacolor+'" href="#"><i class="bw-icon bw-icon-fill-drop-small '+n[i].classname+'"></i></a>').appendTo(a)}else for(i=0;i<n.length;++i)r('<div class="bw-toolbutton colorbutton " data-color="'+n[i].datacolor+'"><div class="bw-icon bw-icon-fill-drop-small '+n[i].classname+'"></div></div>').appendTo(o)},addZoomButtons:function(e,t){var o=r(e);o.addClass("tool-button-bar"),!0===t&&!1===n.isTouchDevice()&&(r('<div class="bw-toolbutton" id="zoom_in_drawing"><div class="bw-icon bw-icon-zoom-in"></div></div>').appendTo(o),r('<div class="bw-toolbutton" id="zoom_out_drawing"><div class="bw-icon bw-icon-zoom-out"></div></div>').appendTo(o))},addWidthButtons:function(e,t){var n=[{datasize:2,datafontsize:16,classname:"bw-icon-smalldot"},{datasize:6,datafontsize:20,classname:"bw-icon-mediumdot"},{datasize:14,datafontsize:24,classname:"bw-icon-largedot"}],o=r(e);if(o.addClass("width-button-bar"),!0===t){r('<div class="bw-toolbutton" id="width_popup"><div class="bw-icon bw-icon-smalldot"></div></div>').appendTo(o);for(var a=r('<div id="widthpopup"/>').appendTo(r("body")),i=0;i<n.length;++i)r('<a data-size="'+n[i].datasize+'" data-fontsize="'+n[i].datafontsize+'" href="#"><i class="bw-icon '+n[i].classname+'"></i></a>').appendTo(a)}else for(i=0;i<n.length;++i)r('<div class="bw-toolbutton" data-size="'+n[i].datasize+'" data-fontsize="'+n[i].datafontsize+'"><div class="bw-icon '+n[i].classname+'"></div></div>').appendTo(o)},addDrawToolButtons:function(e,t,o,a,i){var s=[{id:"drawtool",classname:"bw-icon-pencil"},{id:"linetool",classname:"bw-icon-line"},{id:"texttool",classname:"bw-icon-text"},{id:"eraser",classname:"bw-icon-eraser"}];o&&s.unshift({id:"pantool",classname:"bw-icon-pan"});var c=r(e);if(c.addClass("tool-button-bar"),!0===a){r('<div class="bw-toolbutton bw-selected" id="tool_popup"><div class="bw-icon bw-icon-pencil"></div></div>').appendTo(c);for(var l=r('<div id="toolpopup"/>').appendTo(r("body")),d=0;d<s.length;++d)r('<a data-tool="'+s[d].id+'" href="#"><i class="bw-icon '+s[d].classname+'"></i></a>').appendTo(l)}else for(d=0;d<s.length;++d){var u=s[d];r('<div class="bw-toolbutton" id="'+u.id+'"><div class="bw-icon '+u.classname+'"></div></div>').appendTo(c)}!0===t&&("ibw-platform-osx-ibooks"==n.getPlatform()||r.browser.msie&&10==r.browser.version||r('<div class="bw-toolbutton" id="cameratool"><div class="bw-icon bw-icon-camera"></div></div>').appendTo(c)),!0===i&&r('<div class="bw-toolbutton" id="stickertool"><div class="bw-icon bw-icon-sticker"></div></div>').appendTo(c)},addClearUndoRedoButtons:function(e){var t=r(e);r('<div class="bw-toolbutton" id="reset_image"><div class="bw-icon bw-icon-trash"></div></div>').appendTo(t),r('<div class="bw-toolbutton" id="undo"><div class="bw-icon bw-icon-undo"></div></div>').appendTo(t),r('<div class="bw-toolbutton" id="redo"><div class="bw-icon bw-icon-redo"></div></div>').appendTo(t)},addPhotoEditingButtons:function(e){var t=r(e);r('<div class="bw-toolbutton" id="zoom_in"><div class="bw-icon bw-icon-grow"></div></div>').appendTo(t),r('<div class="bw-toolbutton" id="zoom_out"><div class="bw-icon bw-icon-shrink"></div></div>').appendTo(t),r('<div class="bw-toolbutton" id="rotate_left"><div class="bw-icon bw-icon-rotate-left"></div></div>').appendTo(t),r('<div class="bw-toolbutton" id="rotate_right"><div class="bw-icon bw-icon-rotate-right"></div></div>').appendTo(t),r('<div class="bw-toolbutton" id="accept_image"><div class="bw-icon bw-icon-accept"></div></div>').appendTo(t),r('<div class="bw-toolbutton" id="reject_image"><div class="bw-icon bw-icon-reject"></div></div>').appendTo(t)},createWhiteboard:function(l){var d,u,p,f,h,g,v,m=l.topselector,w=l.toolbarselector||l.topselector,b=m+" "+l.canvasselector,y=l.texteditselector||m+" #textedit",k=l.toolbarselector?l.canvasselector+", "+l.toolbarselector:l.topselector,C=e.create(),T={x:0,y:0},x=1,_=1;!0===l.createCanvas&&r(document.createElement("div")).attr("id","canvasdiv").append(r(document.createElement("canvas")).attr("id","canvas").attr({width:l.width,height:l.height}).text("Your browser does not support the HTML 5 Canvas.")).appendTo(b);var S=r(b+" #canvas")[0],I=S.getContext("2d"),O={image:null,policy:l.background_resize_policy&&""!=l.background_resize_policy?l.background_resize_policy:"No resize",isDefined:function(){return null!==this.image},isNull:function(){return null===this.image||0==this.width()||0==this.height()},width:function(){return this.image.width},height:function(){return this.image.height},scale:function(e,t){if(this.isNull())return 1;var n=e/this.width(),r=t/this.height();switch(this.policy){case"Cover entire area, keep aspect ratio":return Math.max(n,r);case"Contain entire picture, keep aspect ratio":return Math.min(n,r);case"No resize":default:return 1}},origin:function(e,t,n){return this.isNull()||"Cover entire area, keep aspect ratio"!==this.policy&&"Contain entire picture, keep aspect ratio"!==this.policy?{x:0,y:0}:{x:(e-n*this.width())/2,y:(t-n*this.height())/2}},drawScale:function(e,t){return 1/this.scale(1024,650)}},A=!1;function E(e){if(!A||e){var t=S.width,n=S.height;0!=t&&0!=n&&(A=!0,x=O.scale(t,n),T=O.origin(t,n,x),_=O.drawScale())}}l.background_image&&""!=l.background_image&&(O.image=new Image,O.image.onload=function(){E(!0),Ne()},"http:"!=window.location.protocol&&"https:"!=window.location.protocol||(O.image.crossOrigin="Anonymous"),O.image.src=l.background_image);var q=!0===l.image_on_top;function P(){S.width=S.width,W(S,I),C.clearPage(),Ne()}function D(e){a.showConfirmationDialog(o("Are you sure?"),o("Clear the image and start over?"),function(){P(),e&&e(),null!==De&&De()},null,o("Yes, clear the image"),o("No, keep my image"))}function R(e){f&&f.removeClass("bw-selected"),(f=r(e)).addClass("bw-selected"),d=r(e).data("color")}function N(){R(this)}function M(e){for(var t=e.split(" "),n=0;n<t.length;++n)if(0==t[n].indexOf("bw-color"))return t[n];return""}function L(e){p=r(e).data("size"),g=r(e).data("fontsize"),v&&v.removeClass("bw-selected"),(v=r(e)).addClass("bw-selected")}function B(){L(this)}function W(e,t){!0===l.transparentbackground?t.clearRect(0,0,e.width,e.height):(t.fillStyle="white",t.fillRect(0,0,e.width,e.height))}r(w+" #reset_image").tapOrClick(function(){D()}),r(w+" #undo").tapOrClick(function(e){C.undo(),null!==De&&De(),Ne()}),r(w+" #redo").tapOrClick(function(e){C.redo(),Ne(),null!==De&&De()}),null!=l.toolsaspopup&&"no"!=l.toolssaspopup?(r(w+" #tool_popup").on("toolbarItemClick",function(e,t){switch(r(t).attr("data-tool")){case"pantool":he();break;case"drawtool":pe();break;case"linetool":fe();break;case"texttool":ue();break;case"eraser":ke()}r(this).find("div").removeClass().addClass(r(t).find("i").attr("class")),r(this).data("toolbarObj").hide()}),r(w+" #tool_popup").toolbar({content:"#toolpopup",position:l.toolsaspopup,hideOnClick:!0}).on("toolbarShown",function(){r(w).trigger("whiteboardToolbarShown")})):(r(w+" #pantool").tapOrClick(he),r(w+" #drawtool").tapOrClick(pe),r(w+" #linetool").tapOrClick(fe),r(w+" #texttool").tapOrClick(ue),r(w+" #eraser").tapOrClick(ke)),r(w+" #zoom_in_drawing").tapOrClick(function(){x*=1.25;var e=r(b),t=e.width(),n=e.height();T.x=1.25*(T.x-t/2)+t/2,T.y=1.25*(T.y-n/2)+n/2,Ne()}),r(w+" #zoom_out_drawing").tapOrClick(function(){x/=1.25;var e=r(b),t=e.width(),n=e.height();T.x=(T.x-t/2)/1.25+t/2,T.y=(T.y-n/2)/1.25+n/2,Ne()}),r(w+" #cameratool").click(function(){se(),r("body").is(".ibw-platform-osx-ibooks")||(-1==n.getPlatform().indexOf("preview")?r(this).closest(".w-cover").find(".take-picture-field").click():a.showAlert(o("Accessing the camera and photo library does not work on this platform."),o("Camera not supported")))}),r(w+" #stickertool").click(function(){var e=r(document.createElement("div")).addClass("bw-popup-wrapper bw-centering-container").appendTo("body"),t=r(document.createElement("div")).addClass("stickers bw-centered").appendTo(e);function n(){e.remove()}function o(e){e.preventDefault(),e.stopPropagation();var t=r(this);n(),be(t.attr("src"),!0)}e.tapOrClick(n);for(var a=0;a<l.stickers.length;++a)r(document.createElement("img")).attr("src",l.stickers[a].sources[0].src).addClass("sticker").tapOrClick(o).appendTo(t)}),r(w+" #textedit").change(ce),r(w+" #zoom_in").tapOrClick(function(){var e=r(m+" .w-cover .photo-placer"),t=1.1*e.width(),n=1.1*e.height();e.width(t),e.height(n);var o=(1-1.1)*e.width()/2,a=(1-1.1)*e.height()/2,i=e.offset();e.offset({top:i.top+a,left:i.left+o})}),r(w+" #zoom_out").tapOrClick(function(){var e=r(m+" .w-cover .photo-placer"),t=e.width()*(1/1.1),n=e.height()*(1/1.1);e.width(t),e.height(n);var o=(1-1/1.1)*e.width()/2,a=(1-1/1.1)*e.height()/2,i=e.offset();e.offset({top:i.top+a,left:i.left+o})}),r(w+" #rotate_left").tapOrClick(function(){me-=15,ge(r(m+" .w-cover .photo-placer"),me)}),r(w+" #rotate_right").tapOrClick(function(){me+=15,ge(r(m+" .w-cover .photo-placer"),me)}),r(w+" #accept_image").tapOrClick(function(){var e=r(m+" .w-cover .photo-placer"),n=e.width(),i=e.height(),s=e.position(),c=e.attr("data-blob"),l="true"===e.find("img").attr("sticker"),d=me*Math.PI/180;ge(e,0);var u=e.position();ge(e,me);var p=u.left-s.left,f=u.top-s.top,h=r(m+" #drawingareawrapper"),g=r(m+" #drawingarea"),v=parseInt(h.css("padding-left"))+parseInt(g.css("border-left-width")),w=parseInt(h.css("padding-top"))+parseInt(g.css("border-top-width"));function b(e,t){var r=new Image;r.onload=function(){var e=(s.left+n/2+p-v-T.x)/x,o=(s.top+i/2+f-w-T.y)/x;C.addPhoto(r,t,e,o,n/x,i/x,d),null!==De&&De(),Ne()},r.onerror=function(e){console.log("Error loading image (1)"),console.log(e)},"data:"!=e.substr(0,5)&&(r.crossOrigin="Anonymous"),r.src=e,we()}if(l){var y=c.startsWith("http:")||c.startsWith("https:")?c:window.location.protocol+c;console.log("addImage",y),b(y,y)}else{var k=r("<img>");k.appendTo(e),k.load(function(){var n=k.width(),i=k.height(),s=e.width(),c=e.height(),l=function(e,t,n){var o,a=document.createElement("canvas"),i=a.getContext("2d");""!=r(e).attr("src")&&(a.width=t,a.height=n,i.drawImage(e,0,0,t,n));try{var s=.9;do{s-=.1,o=a.toDataURL("image/jpeg",s)}while(o.length>25e4&&s>.5)}catch(e){console.log("No image/jpeg supported for toDataURL"),o=a.toDataURL("image/png")}return o}(k[0],Math.min(n,s),Math.min(i,c));k.remove(),t.registerImage(l).done(function(e){b(l,e)}).fail(function(){a.showAlert(o("Could not store picture"),o("Error using picture"))})}),k.error(function(e){console.log("Error loading image (2)"),console.log(e)}),"http:"!=window.location.protocol&&"https:"!=window.location.protocol||(k[0].crossOrigin="Anonymous"),k.attr("src",c)}}),r(w+" #reject_image").tapOrClick(function(){we()}),r.fn.enterKey=function(e){return this.each(function(){r(this).keypress(function(t){"13"==(t.keyCode?t.keyCode:t.which)&&e.call(this,t)})})},r(y).enterKey(ce),u=O.isDefined()||!0===l.transparentbackground?"background":"white",null!=l.colorsaspopup&&"no"!=l.colorsaspopup?(r(w+" #color_popup").on("toolbarItemClick",function(e,t){R(t);var n=r(this).find(".bw-icon-fill-drop-small");n.removeClass(M(n.attr("class"))).addClass(M(r(t).find("i").attr("class"))),r(this).data("toolbarObj").hide()}),r(w+" #color_popup").toolbar({content:"#colorpopup",position:l.colorsaspopup,hideOnClick:!0}).on("toolbarShown",function(){r(w).trigger("whiteboardToolbarShown")}),d="blue"):(r(w+" .colorbutton").each(function(e,t){r(t).css("color",i.light[r(t).data("color")]),r(t).tapOrClick(N)}),R(r(w+" .colorbutton")[1]),d="black"),null!=l.widthaspopup&&"no"!=l.widthsaspopup?(r(w+" #width_popup").on("toolbarItemClick",function(e,t){L(t),r(this).find("div").removeClass().addClass(r(t).find("i").attr("class")),r(this).data("toolbarObj").hide()}),r(w+" #width_popup").toolbar({content:"#widthpopup",position:l.widthaspopup,hideOnClick:!0}).on("toolbarShown",function(){r(w).trigger("whiteboardToolbarShown")}),p=2,g=16):(r(w+" #width-buttons").children("li").each(function(e,t){r(t).tapOrClick(B)}),L(r(w+" #width-buttons li:first-child")[0])),S.addEventListener("mousedown",function(e){U||(U=!0,de.start({x:e.clientX,y:e.clientY}))},!1),S.addEventListener("mousemove",function(e){U&&de.move({x:e.clientX,y:e.clientY})},!1),S.addEventListener("mouseup",Ce,!1),S.addEventListener("mouseleave",Ce,!1),S.addEventListener("touchstart",function(e){if(e.preventDefault(),!0!==Ie){if(!0===Se){if(!0!==l.allow_pan)return;return Ae=e.changedTouches[0].identifier,void Ee(e,Oe,Ae)}1==e.changedTouches.length||!0!==l.allow_pan?(Oe=e.changedTouches[0].identifier,function(e,t){Se=!0,Ie=!1;var n=xe(e,t);de.start(n)}(e,Oe)):(Oe=e.changedTouches[0].identifier,Ae=e.changedTouches[1].identifier,Ee(e,Oe,Ae))}},!1),S.addEventListener("touchend",qe,!1),S.addEventListener("touchcancel",qe,!1),S.addEventListener("touchmove",function(e){if(e.preventDefault(),Se){var t=xe(e,Oe);if(!t)return;de.move(t)}else if(Ie){var n=_e(e,Oe),r=_e(e,Ae);if(null===n||null===r)return void(Ie=!1);Te.move(n,r)}},!1),W(S,I);var F,U=!1,z=0;function j(e,t,n){var o=r(e).offset();return{x:t-o.left+window.pageXOffset,y:n-o.top+window.pageYOffset}}function Q(e,t,n,r){var o,a,s=j(S,e,t);o=s.x,a=s.y,I.beginPath(),"background"!=n?z?(I.strokeStyle=i.light[n],I.lineWidth=r,I.moveTo(o,a),I.lineTo(z.x,z.y),I.stroke()):(I.fillStyle=i.light[n],I.arc(o,a,r/2,Math.PI/180*0,Math.PI/180*360,!1),I.fill(),I.closePath()):Y(I,o,a),q&&Pe(I);var c={};c.x=(o-T.x)/x,c.y=(a-T.y)/x,F.push(c),z={x:o,y:a}}function H(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}var J=2.5;function Y(e,t,n){var r=t-10,o=n-10;if(O.isNull())e.clearRect(r,o,20,20);else if(e.fillStyle="white",e.fillRect(r,o,20,20),r<O.width()&&o<O.height()){var a=O.width()-r,i=O.height()-o;a>20&&(a=20),i>20&&(i=20),e.drawImage(O.image,r,o,a,i,r,o,a,i)}}function V(e,t){var n="background"==e?F:function(e){var t=[];t.push(e[0]);for(var n=0,r=1;r<e.length-1;++r)H(e[n],e[r])>=J&&(t.push(e[r]),n=r);return t.push(e[e.length-1]),t}(F);return C.addLine(n,e,t),null!==De&&De(),n}function $(e,t,n){F=[],z=0,Q(e.x,e.y,t,n)}function K(e,t,n){Q(e.x,e.y,t,n)}function G(e,t,n){V(t,n),Ne()}var X,Z={start:function(e){$(e,d,p*_)},move:function(e){K(e,d,p*_)},end:function(e){G(0,d,p*_)}},ee={start:function(e){F=[],z=0,Q(e.x,e.y,d,p*_),Q(e.x,e.y,d,p*_),ee.activeLine=C.addLine(F,d,p*_),null!==De&&De()},move:function(e){F=[],Q(e.x,e.y,d,p*_),ee.activeLine.points[1]=F[0],Ne()},end:function(e){H(ee.activeLine.points[0],ee.activeLine.points[1])<5&&C.undo(),null!==De&&De(),Ne()}},te={start:function(e){},move:function(e){},end:function(e){}},ne={start:function(e){X=e,l.panbackground&&l.panbackground.start&&l.panbackground.start({pageX:e.x,pageY:e.y})},move:function(e){l.panbackground&&0!=l.panbackground.panDisabled()||(T={x:T.x+e.x-X.x,y:T.y+e.y-X.y},X=e),l.panbackground&&l.panbackground.move&&l.panbackground.move({pageX:e.x,pageY:e.y}),Ne()},end:function(e){l.panbackground&&0!=l.panbackground.panDisabled()||(T={x:T.x+e.x-X.x,y:T.y+e.y-X.y}),l.panbackground&&l.panbackground.end&&l.panbackground.end({pageX:e.x,pageY:e.y}),Ne()}},re={start:function(e){$(e,u,14)},move:function(e){K(e,u,14)},end:function(e){G(0,u,14)}},oe=!1;function ae(){var e=r(y);C.addText((parseInt(e.css("left"))-T.x)/x,(parseInt(e.css("top"))-T.y)/x+g*_,e.val(),d,g*_),null!==De&&De(),e.val(""),Ne()}function ie(e,t,o){var a=r(y);oe&&""!=a.val()&&ae(),a.css("left",e+"px"),a.css("top",t+"px"),a.css("display","block");var i=r(b).width()-e-15,s=i<200?i:200;if(a.css("width",s+"px"),"ibw-platform-ipad-ibooks"===n.getPlatform()&&n.inIframe()){if(!o){var c=a;a=a.clone(),c.replaceWith(a),a.enterKey(ce)}}else a.focus();oe=!0}function se(){r(y).hide(),oe=!1}function ce(e){var t=r(y);return""==t.val()?(se(),oe=!1):(ae(),ie(parseInt(t.css("left")),parseInt(t.css("top"))+g*x*_,!0)),e.stopPropagation(),!0}var le={start:function(e){},move:function(e){},end:function(e){var t=j(S,e.x,e.y);ie(t.x,t.y,!1)}},de=Z;function ue(){h&&h.removeClass("bw-selected"),(h=r(w+" #texttool")).addClass("bw-selected"),de=le,r(k).attr("selected-tool","text")}function pe(){h&&h.removeClass("bw-selected"),(h=r(w+" #drawtool")).addClass("bw-selected"),se(),de=Z,r(k).attr("selected-tool","draw")}function fe(){h&&h.removeClass("bw-selected"),(h=r(w+" #linetool")).addClass("bw-selected"),se(),de=ee,r(k).attr("selected-tool","line")}function he(){h&&h.removeClass("bw-selected"),(h=r(w+" #pantool")).addClass("bw-selected"),se(),de=ne,r(k).attr("selected-tool","pan")}function ge(e,t){var n="rotate("+t+"deg)";e.get(0).style.transform=n,e.get(0).style.oTransform=n,e.get(0).style.msTransform=n,e.get(0).style.mozTransform=n,e.get(0).style.webkitTransform=n}pe();var ve,me=0;function we(){var e=r(m+" .w-cover .photo-placer");e.css({background:"transparent"}),e.addClass("hidden"),ge(e,0),e.height(e.attr("data-start-height")),e.width(e.attr("data-start-width")),e.css({left:0,top:0}),l.maintoolbar.removeClass("hidden"),l.phototoolbar.addClass("hidden"),me=0}function be(e,t){var o=r(m).find(".w-cover .photo-placer");o.empty();var a=r("<img ondragstart='return false;'>").css({"image-orientation":"0"});"http:"!=window.location.protocol&&"https:"!=window.location.protocol||(a[0].crossOrigin="Anonymous"),a.attr({src:e,sticker:t?"true":"false"}).appendTo(o),o.removeClass("hidden").css({width:"100%",height:"100%",top:0,left:0}),a.load(function(){var r=u=a.width(),i=u/(d=a.height()),c=o.width(),l=o.height();if(u/c>d/l)var d=(u=Math.min(c,u))/i;else var u=(d=Math.min(l,d))*i;o.height(d),o.width(u),a.attr({width:"100%",height:"100%"}),o.css("overflow","hidden"),n.isIOS()&&!1===t?s(event.target.files[0],{width:r,height:0,crop:!1,quality:100,rotate:0,callback:function(e,t,n){o.attr("data-blob",e)}}):o.attr("data-blob",e)}),l.maintoolbar.addClass("hidden"),l.phototoolbar.removeClass("hidden")}function ye(e){var t=r(m);1==e.target.files.length&&0==e.target.files[0].type.indexOf("image/")&&(we(),be(URL.createObjectURL(e.target.files[0])));var n=t.find(".w-cover .take-picture-field");n.replaceWith(r(n[0].outerHTML)),t.find(".w-cover .take-picture-field").on("change",ye)}function ke(){h&&h.removeClass("bw-selected"),(h=r(w+" #eraser")).addClass("bw-selected"),se(),de=re,r(k).attr("selected-tool","eraser")}function Ce(e){U&&(U=!1,de.end({x:e.clientX,y:e.clientY}))}!0===l.enablephoto&&(ve=r(m),!("url"in window)&&"webkitURL"in window&&(window.URL=window.webkitURL),ve.find(".w-cover .take-picture-field").on("change",ye)),(!0===l.enablephoto||l.stickers&&l.stickers.length>0)&&function(){var e=r(m).find(".w-cover .photo-placer");e.get(0).addEventListener("touchstart",function(e){e.preventDefault()},!1),e.get(0).addEventListener("touchmove",function(e){e.preventDefault()},!1),e.get(0).addEventListener("touchend",function(e){e.preventDefault()},!1);var t=new c.Manager(e.get(0));t.add(new c.Pan({threshold:0,pointers:0})),t.add(new c.Rotate({threshold:0})).recognizeWith(t.get("pan")),t.add(new c.Pinch({threshold:0})).recognizeWith([t.get("pan"),t.get("rotate")]);var n=null;function o(t){null===n&&(n={pos:e.offset(),width:e.width(),height:e.height(),center:{x:e.offset().left,y:e.offset().top}}),t&&!n.hasOwnProperty("last_rotation")&&(n.last_rotation=me-t.rotation,n.center=t.center)}function a(t){var r=Math.max(.3,t.scale);e.offset({top:n.pos.top+t.deltaY+(n.center.y-n.pos.top)*(1-r),left:n.pos.left+t.deltaX+(n.center.x-n.pos.left)*(1-r)}),e.width(n.width*r),e.height(n.height*r),n.hasOwnProperty("last_rotation")&&(me=n.last_rotation+t.rotation,ge(e,me))}t.on("hammer.input",function(e){e.isFinal&&(n=null)}),t.on("panstart panmove",function(e){"panstart"===e.type?o():a(e)}),t.on("rotatestart rotatemove",function(e){"rotatestart"===e.type?o(e):a(e)}),t.on("pinchstart pinchmove",function(e){"pinchstart"===e.type?o(e):a(e)}),t.on("rotateend rotatecancel pinchend pinchcancel",function(){n&&(n=null,o())})}();var Te={getCenter:function(e,t){return j(S,(e.x+t.x)/2,(e.y+t.y)/2)},getDistance:function(e,t){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},start:function(e,t){this.center=this.getCenter(e,t),this.size=this.getDistance(e,t)},move:function(e,t){var n=this.getCenter(e,t),r=this.getDistance(e,t);!0===l.allow_zoom?(T.x=(T.x-this.center.x)*r/this.size+n.x,T.y=(T.y-this.center.y)*r/this.size+n.y,x=x*r/this.size):(T.x=T.x-this.center.x+n.x,T.y=T.y-this.center.y+n.y),this.center=n,this.size=r,Ne()},end:function(){}};function xe(e,t){for(var n=0;n<e.changedTouches.length;++n)if(e.changedTouches[n].identifier===t){var r=e.changedTouches[n];return{x:r.clientX,y:r.clientY}}return null}function _e(e,t){for(var n=0;n<e.touches.length;++n)if(e.touches[n].identifier===t){var r=e.touches[n];return{x:r.clientX,y:r.clientY}}return null}var Se=!1,Ie=!1,Oe=0,Ae=0;function Ee(e,t,n){Se=!1,Ie=!0;var r=_e(e,t),o=_e(e,n);Te.start(r,o)}function qe(e){if(e.preventDefault(),Se){var t=xe(e,Oe);if(!t)return;Se=!1,de.end(t)}else if(Ie){var n=xe(e,Oe),r=xe(e,Ae);null===n&&null===r||(Te.end(),Ie=!1)}}function Pe(e){O.isNull()||e.drawImage(O.image,0,0)}var De=null;function Re(e){q||Pe(e),C.drawToContext(e,Y),q&&Pe(e)}function Ne(){S.width=S.width;var e=S.getContext("2d");W(S,e),e.save(),e.translate(T.x,T.y),e.scale(x,x),Re(e),e.restore()}return{loadData:function(e){P(),C.load(e,function(e,n){t.getImageUrl(e).always(function(e){n(e)})},Ne),Ne()},saveData:function(){return C.save()},imgData:function(){var e=document.createElement("canvas"),t=e.getContext("2d"),n=C.bounds(t);O.isNull()||(n.x1=Math.min(n.x1,0),n.y1=Math.min(n.y1,0),n.x2=Math.max(n.x2,O.width()),n.y2=Math.max(n.y2,O.height())),e.width=Math.max(100,n.x2-n.x1),e.height=Math.max(100,n.y2-n.y1),W(e,t),t.save(),t.translate(-n.x1,-n.y1),Re(t),t.restore();var r=e.toDataURL();return console.log("Image data: "+r.length+" bytes"),r},canvas:S,onChange:function(e){De=e},redraw:Ne,redrawOnResize:function(){E(!l.allow_zoom),Ne()},setReadOnly:function(e){de=e?te:Z,l.maintoolbar&&l.maintoolbar.toggleClass("hidden",e)},isEmpty:function(){return C.isEmpty()},clear:D,clearPage:P,setOrigin:function(e){T=e},selectTool:function(e){"pan"===e?he():"draw"===e?pe():"text"===e?ue():"eraser"===e?ke():console.log("Request to select unknown tool: "+e)}}}}}(n(139),n(140).o,n(2),n(0),n(7),n(9),n(382),n(383),n(135))},function(e,t,n){},function(e,t,n){e.exports=function(e,t,r,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n(2),i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n(141),s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:n(142),c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:n(143);function l(t){this._storage=t,this.setCredentials=function(t){var n=this;return e.Deferred(function(e){n._storage.setItemsAsync([{key:"BwCredentials",value:JSON.stringify(t),attribs:""}],function(){e.resolve()},function(){e.reject()})})},this.getCredentials=function(){var t=this;return e.Deferred(function(e){t._storage.getItemsAsync(["BwCredentials"],function(t){try{var n=JSON.parse(t.BwCredentials.value);e.resolve(n)}catch(t){e.reject()}},function(){e.reject()})})}}var d=r.isLTI()||t.getParameters().sso;return d&&console.log("Using session storage for credentials"),"ibw-platform-ipad-bookwidgets"===a.getPlatform()?new l(new s):a.usesCredentialProxy()?new l(new c("_secureStorage",!0,t.getQueryParams(window.location.search)["bwds-secure-proxy-token"],d)):new function(t){this.setCredentials=function(n){return e.Deferred(function(e){try{t.SetItem("BwCredentials",JSON.stringify(n)),e.resolve()}catch(t){e.reject()}})},this.getCredentials=function(){return e.Deferred(function(e){try{var n=JSON.parse(t.GetItem("BwCredentials"));e.resolve(n)}catch(t){e.reject()}})}}(d?o:i)}.bind(null,n(0),n(11),n(62),n(332))},function(e,t,n){var r,o;e.exports=(r=n(64),(o=function(e,t){this.name=e,this.origin=t,this.callbackBridge=new r,this.callbackBridge.startListening()}).prototype.send=function(e,t,n){e.to=this.name,e.cb=this.callbackBridge.registerCallback(t,n),parent.postMessage(e,this.origin)},o)},function(e,t){e.exports={GetItem:function(e){return sessionStorage.getItem(e)},RemoveItem:function(e){sessionStorage.removeItem(e)},SetItem:function(e,t){sessionStorage.setItem(e,t)},Clear:function(){sessionStorage.clear()}}},function(e,t,n){e.exports=function(e,t,n,r,o,a,i){var s={},c=e.getConfigSync();function l(){var e=a.getPlatform();return!!("ibw-platform-ipad-ibooks"===e||"ibw-platform-ipad-ibooks-epub"===e||"ibw-platform-osx-ibooks"===e||"ibw-platform-osx-ibooks-epub"===e||"ibw-platform-android-chrome"===e||a.isPreview()||"ibw-platform-ipad-bookwidgets"!==e&&!1===a.isTopLevelPlay())}function d(e){for(var t=0;t<e.bw_links.length;++t){var n=e.bw_links[t];if("bw-student"===n.name)return n}return null}function u(){return c.hasOwnProperty("student_account_school")&&c.student_account_school.hasOwnProperty("code")&&null!==c.student_account_school.code&&""!==c.student_account_school.code&&"null"!==c.student_account_school.code}return s.createDialog=function(e,n){var r=t('<div class="bw-login-dialog-wrapper"></div>'),a=t(document.createElement("div")).css({position:"absolute",width:"100%",height:"100%",left:"0px",top:"0px"}).appendTo(r),i=t('<div id="bw-login-dialog" class="bw-row-container"></div>').appendTo(r);return n&&(r.addClass("bw-centering-container"),i.addClass("bw-centered")),r.appendTo("body"),e&&a.click(function(){r.remove(),e.reject()}),{close:r.remove.bind(r),show:function(e,n){var r;i.empty(),n&&t('<div class="login-dialog-title bw-row-fixed"></div>').html(n).appendTo(i),e.appendTo(i),(r=i).find(".weblink").each(function(){o(t(this).parent()[0],t(this).attr("href"),!0,t(this).attr("message")),t(this).attr("href","")}),r.find(".external-link").each(function(){o(this,t(this).attr("href"),!1,t(this).attr("message")),t(this).attr("href","")})}}},s.queryLoginMethod=function(e){var n=this;return t.Deferred(function(o){var a=n.createDialog(o,!0),i=t('<div class="login-type-selection login-dialog-body"></div>');var s,c=d(e),p=null!==c;function f(){removeEventListener("message",h),a.close()}function h(e){var t=e.data;t.hasOwnProperty("msg")&&"linkclicked"===t.msg&&(f(),o.resolve("oauth"))}e.oauth_links.length>0&&function(n,o){n=e.oauth_links;for(var a=0;a<n.length;++a){var i=n[a],s=l()&&i.toplevel,c=s?'target="_blank" class="weblink login-type-button" ':'target="_top" class="login-type-button" ',d=s?"":"onclick=\"setTimeout(function() { window.postMessage({ msg:'linkclicked'}, '*');}, 1000);\" ";t('<div class="web-link-wrapper"> <a message="linkclicked" href="'+i.url+'" '+c+d+">"+r("Sign in using")+" "+i.name+"</a></div>").appendTo(o)}}(e.oauth_links,i),p&&(u()||(s=i,t('<div class="login-type-button"></div>').html(r("Sign in using email and password")).tapOrClick(function(){o.resolve("bw"),f()}).appendTo(s)),function(e,n){t('<div class="login-type-button"></div>').html(r("Sign in using school account")).tapOrClick(function(){o.resolve("school"),f()}).appendTo(n)}(0,i)),a.show(i,r("Sign in")),window.postMessage({msg:"requestlogin"},"*"),addEventListener("message",h)}).promise()},s.queryBWCredentials=function(e){var n=this;return t.Deferred(function(o){var a=n.createDialog(o,!0),i=d(e),s=t('<div class="login-form login-dialog-body"></div>');function c(){removeEventListener("message",u),a.close()}function u(e){var t=e.data;t.hasOwnProperty("msg")&&"linkclicked"===t.msg&&(c(),o.resolve({action:"signup"}))}!function(e,n){var a=t('<input id="bw-email" placeholder="'+r("Email")+'" class="login-dialog-field"  tabindex="1">').appendTo(n),i=t('<input id="bw-password" type="password" placeholder="'+r("Password")+'" class="login-dialog-field" tabindex="2">').appendTo(n);t('<button class="login-dialog-button"  tabindex="3"></button>').html(r("Sign in")).tapOrClick(function(){o.resolve({action:"login",school:"",username:a.val(),password:i.val()}),c()}).appendTo(n);var s=l(),d=s?'target="_blank" class="external-link" ':'target="_top" ',u=s?"":"onclick=\"setTimeout(function() { window.postMessage({ msg:'linkclicked'}, '*');}, 1000);\" ";e.hasOwnProperty("resetPasswordURL")&&t('<a href="'+e.resetPasswordURL+'" '+d+">"+r("Forgot password?")+"</a>").addClass("bw-reset-password").appendTo(n),e.hasOwnProperty("registerURL")&&t('<hr><p style="position: relative">Don\'t have an account?<br><a message="linkclicked" href="'+e.registerURL+'" '+d+u+">"+r("Sign up here")+"</a></p>").appendTo(n).find("a").addClass("bw-signup")}(i,s),a.show(s,r("Sign in")),window.postMessage({msg:"requestlogin"},"*"),addEventListener("message",u)}).promise()},s.querySchoolCredentials=function(e){var n=this;return t.Deferred(function(e){var o,a=n.createDialog(e,!0),i=t('<div class="login-form login-dialog-body"></div>');u()||(o=t('<input id="school-school" placeholder="'+r("School code")+'" class="login-dialog-field" tabindex="1">').appendTo(i));var s=t('<input id="school-username" placeholder="'+r("Username")+'" class="login-dialog-field" tabindex="2">').appendTo(i),l=t('<input id="school-password"  type="password" placeholder="'+r("Password")+'" class="login-dialog-field" tabindex="3">').appendTo(i);t('<button class="login-dialog-button"  tabindex="4"></button>').html(r("Sign in")).tapOrClick(function(){var t=u()?c.student_account_school.code:o.val();e.resolve({action:"login",school:t,username:s.val(),password:l.val()}),a.close()}).appendTo(i),a.show(i,u()?c.student_account_school.name:r("Sign in")),window.postMessage({msg:"requestlogin"},"*")}).promise()},s.queryLogout=function(e,n,o,a){var i=this;return t.Deferred(function(s){var c=i.createDialog(s),l=t('<div id="offline-dialog" class="login-dialog-body"></div>');t("<p>"+n+"</p>").appendTo(l),t('<div id="login-current-user"></div>').html(o).appendTo(l),a||t('<div class="login-dialog-button"></div>').html(r("Sign out")).tapOrClick(function(){c.close(),s.resolve()}).appendTo(l),c.show(l,e)}).promise()},s.showMessage=function(e,o){return t.Deferred(function(t){n.showAlert(e,o,r("OK"),function(){t.resolve()})})},s.createPollingUI=function(e){var n=this.createDialog(null,!0),o=t('<div class="login-pollingdialog"></div>');return t("<p></p>").html(r("Waiting for account sign in to complete...")).appendTo(o),t('<div class="login-dialog-button"></div>').html(r("Cancel")).tapOrClick(e).appendTo(o),n.show(o,r("Waiting")),n},s}(n(1),n(0),n(9),n(7),n(63),n(2),n(34))},function(e,t,n){var r=n(61);e.exports=function(e){window.addEventListener("message",function(t){var n=t.data;"set-css"===n.command&&(!function(t){for(var n=document.getElementsByTagName("link"),r=0,o=n.length;r<o;r++){var a=n[r],i=a.rel;if("string"!=typeof i||0===i.length||"stylesheet"===i){var s=a.getAttribute("href");0===s.indexOf("config")&&-1!==s.indexOf(".css")&&(a.disabled=!0)}}e("style[id='designconfig']").remove();var c=document.createElement("style");c.id="designconfig",c.type="text/css",c.appendChild(document.createTextNode(t)),document.head.appendChild(c)}(n.css),r.executeCssUpdateCallbacks())})}(n(0))},function(e,t){e.exports=void window.addEventListener("message",function(e){"print"===e.data.command&&window.print()})},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o,a,i;e.exports=(o=n(2),a=n(0),-1!==(i=o.getPlatform()).indexOf("android")?a.fn.extend({clickOnDraggable:function(e){return this.each(function(){var t=!1;this.ClickOnDraggableCallback=e,a(this).on("touchstart",function(e){var n=e.originalEvent?e.originalEvent:e;1===n.changedTouches.length&&1===n.touches.length&&n.changedTouches[1]===n.touches[1]?(t=!0,setTimeout(function(){t&&(console.error("touch takes too long"),t=!1)},100)):t=!1}),a(this).on("touchend",function(e){if(t){var n=e.originalEvent?e.originalEvent:e;1===n.changedTouches.length&&0===n.touches.length?(t=!1,this.ClickOnDraggableCallback()):t=!1}})})}}):a.fn.extend({clickOnDraggable:function(e){return this.each(function(){a(this).click(e)})}}),-1!==i.indexOf("android")||-1!==i.indexOf("preview")||-1!==i.indexOf("phantomjs")||-1!==i.indexOf("headlesschrome")||-1!==i.indexOf("chrome")||"ibw-platform-osx-safari"===i||"ibw-platform-osx-ibooks"===i||"ibw-platform-osx-ibooks-epub"===i?a.fn.extend({tapOrClick:function(e){return this.each(function(){a(this).click(e);var t=this,n=a(this);n.is("button")||n.is("a")||n.on("keydown",function(n){var r=n.which;13!==r&&32!==r||e.bind(t)({preventDefault:function(){},stopPropagation:function(){},stopImmediatePropagation:function(){}})})})},tapOrClickOff:function(){return this.each(function(){a(this).unbind("click");var e=a(this);e.is("button")||e.is("a")||e.off("keydown")})},triggerTapOrClick:function(e){return this.each(function(){a(this).trigger("click",e)})}}):a.fn.extend({tapOrClick:function(e){return this.each(function(){var t=this,n=a(this);n.addClass("epub-block"),n.find("*").each(function(){this instanceof SVGElement||a(this).addClass("epub-block")}),n.hammer?n.hammer().on("tap",function(r){e.bind(t)(r),n.blur(),r.stopImmediatePropagation()}):n.click(function(r){e.bind(t)(r),n.blur()}),(n.hammer||!n.is("button")&&!n.is("a"))&&n.on("keydown",function(n){var r=n.which;13!==r&&32!==r||e.bind(t)({preventDefault:function(){},stopPropagation:function(){},stopImmediatePropagation:function(){}})})})},tapOrClickOff:function(){return this.each(function(){var e=a(this);e.hammer?e.hammer().off("tap"):e.unbind("click"),(e.hammer||!e.is("button")&&!e.is("a"))&&e.off("keydown")})},triggerTapOrClick:function(e){return this.each(function(){var t=a(this);t.hammer?t.hammer().trigger("tap",e):t.trigger("click",e)})}}),a.fn.extend({clickOrHold:function(e,t,n){return n=n||3e3,this.each(function(){var r=!1,o=null;a(this).click(function(t){r||e.bind(this)(t),r=!1}),a(this).on("keydown",function(t){var n=t.which;13!==n&&32!==n||e.bind(this)({prevent:function(){},stopPropagation:function(){},stopImmediatePropagation:function(){}})}),a(this).on("mousedown touchstart",function(){var e=this;o=setTimeout(function(){o=null,r=!0,t.bind(e)()},n)}),a(this).on("mouseup touchend",function(){null!==o&&(clearTimeout(o),o=null),r&&setTimeout(function(){r=!1},400)})})}}),void a.fn.extend({makeButton:function(e){"string"==typeof(e=e||{})&&(e={label:e}),this.attr({role:e.hasOwnProperty("role")?e.role:"button"});var t=this.attr("tabindex");return"undefined"!==r(t)&&!1!==t||this.attr({tabindex:"0"}),e.hasOwnProperty("label")&&this.attr({"aria-label":e.label}),e.hasOwnProperty("labelledby")&&this.attr({"aria-labelledby":e.labelledby}),this},makeLink:function(e){return this.attr({role:"link",tabindex:"0"}),e&&this.attr({"aria-label":e}),this}}))},function(e,t,n){var r;e.exports=(r=n(1).getConfigSync(),{getAJAXHeaders:function(){return null!=r.widget_language&&r.widget_language.length>0?{"Accept-Language":r.widget_language}:{}}})},function(e,t,n){e.exports=function(e){var t=n(22).createLogger("WebSQLAsyncKeyStore");function r(e,n,r){t.error("WebSQL Error: executeSQL triggered error: "+r.message),null!=e&&e(r)}var o=function(e,t){this.name=e||"BWDS1",this.initialized=!1,this.valid=!1,this.db=null,this.openDatabase=void 0!==t?t:window.openDatabase?window.openDatabase.bind(window):function(){console.error("webSQL not supported")}};return o.prototype._prepareDatabase=function(e,n){var r=this.openDatabase(this.name,"","Offline BW storage",5242880);return""==r.version&&(t.debug("WebSQL: creating db"),r.changeVersion(r.version,"1.0",function(e){t.debug("WebSQL: creating table"),e.executeSql("CREATE TABLE keyvalue (keyname PRIMARY KEY, dir, name, value, attribs)")},n)),r},o.prototype._initializeAndRun=function(e,n){if(this.initialized)this.valid?void 0!==e&&e():(t.debug("WebSQL Error: Database is initialized but not valid, calling error"),void 0!==n&&n(this.error));else if(this.initialized=!0,this.openDatabase){try{t.debug("WebSQL: initializing database"),this.db=this._prepareDatabase(function(e){t.debug("WebSQL Error: Received error while preparing database: "+e.message)}),this.valid=!0}catch(e){switch(e.code){case e.SECURITY_ERR:t.debug("WebSQL Error: Received security error: "+e.message);break;case e.INVALID_STATE_ERR:t.debug("WebSQL Error: Received invalid state error: "+e.message);break;default:t.debug("WebSQL Error: Received error "+e.code+": "+e.message)}return this.valid=!1,this.error=e,void n(e)}e()}else t.debug("WebSQL Error: No WebSQL database available"),this.valid=!1,this.error={code:9999,message:"WebSQL Error: No WebSQL database available"},n(this.error)},o.prototype._initializeAndRunTransaction=function(e,n,r){var o=this;this._initializeAndRun(function(){o.db[e?"readTransaction":"transaction"](function(e){try{n(e)}catch(e){t.error("Error while executing transaction: "+e.code+": "+e.message),null!=r&&r(e)}},function(e){t.error("WebSQL Error: "+e.code+" starting transaction :"+e.message),o.valid=!1,o.initialized=!1,null!=r&&r(e)})},function(e){t.error("WebSQL Error: database not valid"),null!=r&&r(e)})},o.prototype._initializeAndRunReadTransaction=function(e,t){this._initializeAndRunTransaction(!0,e,t)},o.prototype._initializeAndRunReadWriteTransaction=function(e,t){this._initializeAndRunTransaction(!1,e,t)},o.prototype.getItemsAsync=function(e,n,o){if(0===e.length)return t.debug("WebSQL Error: getItemsAsync without names"),void o({code:9999,message:"WebSQL Error: getItemsAsync without names"});this._initializeAndRunReadTransaction(function(a){for(var i="",s=0;s<e.length;++s)i+=(""==i?"":", ")+"?";a.executeSql("SELECT keyname, value, attribs FROM keyvalue where keyname IN ("+i+")",e,function(e,r){for(var o={},a=0;a<r.rows.length;++a){var i=r.rows.item(a);o[i.keyname]=i,t.debug("WebSQL: read ("+i.keyname+") = "+i.value)}n(o)},r.bind(null,o))},o)},o.prototype.getDirAttribs=function(e,t,n){this._initializeAndRunReadTransaction(function(o){o.executeSql("SELECT keyname, attribs FROM keyvalue where dir = ?",[e],function(e,n){for(var r={},o=0;o<n.rows.length;++o){var a=n.rows.item(o);r[a.keyname]=a.attribs}t(r)},r.bind(null,n))},n)},o.prototype.setItemsAsync=function(e,n,o){if(0===e.length)return t.error("WebSQL Error: setItemsAsync without names"),void o({code:9999,message:"setItemsAsync without names"});if(e.length>1)return t.error("WebSQL Error: setItemsAsync can only handle 1 item"),void o({code:9999,message:"setItemsAsync can only handle 1 item"});var a=e[0];this._initializeAndRunReadWriteTransaction(function(i){var s,c=a.key,l=c.lastIndexOf("/"),d="";-1!=l&&(d=c.substring(0,l)),s=c.substring(l+1),i.executeSql("INSERT OR REPLACE INTO 'keyvalue' ( 'keyname', 'dir', 'name', 'value', 'attribs' ) VALUES ( ? , ? , ?, ? , ? )",[a.key,d,s,a.value,a.attribs],function(r,i){i.rowsAffected!=e.length?(t.error("WebSQL Error: store error on key "+name),o({code:9999,message:"WebSQL store error: wrong # rows affected"})):null!=n?(t.debug("WebSQL: wrote ("+a.key+")"),n()):t.error("WebSQL Error: setItemsAsync no OK function")},r.bind(null,o))},o)},o.prototype.removeItemsAsync=function(e,n,o){if(0===e.length)return t.debug("WebSQL Error: removeItemsAsync without names"),void o({code:9999,message:"WebSQL Error: removeItemsAsync without names"});this._initializeAndRunReadWriteTransaction(function(a){for(var i="",s=0;s<e.length;++s)i+=(""==i?"":", ")+"?";a.executeSql("DELETE FROM keyvalue where keyname IN ("+i+")",e,function(r,o){t.debug("WebSQL: removed "+e.join(", ")),null!=n&&n()},r.bind(null,o))},o)},o.prototype.clearAllAsync=function(e,n){this._initializeAndRunReadWriteTransaction(function(o){o.executeSql("DELETE FROM keyvalue",[],function(n,r){t.debug("WebSQL: Cleared all"),null!=e&&e()},r.bind(null,n))},n)},o}()},function(e,t,n){var r=n(21).each,o=n(340);e.exports=function(e){var t=n(22).createLogger("IndexedDBAsyncKeyStore");var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o;this.idbstore=t};return a.prototype.getItemsAsync=function(e,n,r){var o=this;if(t.debug("IndexedDBAsyncKeyStore getItemsAsync"),0===e.length)return t.debug("IndexedDB Error: getItemsAsync without names"),void r({code:9999,message:"IndexedDB Error: getItemsAsync without names"});var a={};e.reduce(function(e,n){return e.then(function(){return function(e){var n=this;return t.debug("readelem ",e),new Promise(function(r,o){n.idbstore.get(e).then(function(n){t.debug("read elem: "+e),null!=n&&(a[e]=n),r()},function(n){t.debug("error accessing elem: "+e),o(n)}).catch(function(e){t.error("Caught idb exception",e),o(e)})})}.bind(o,n)()})},Promise.resolve()).then(function(){n(a)},r)},a.prototype.getDirAttribs=function(e,n,o){t.debug("IndexedDBAsyncKeyStore getDirAttribs"),this.idbstore.direlems(e).then(function(e){var t={};r(e,function(e){t[e.keyname]=e.attribs}),n(t)},o)},a.prototype.setItemsAsync=function(e,n,r){if(t.debug("IndexedDBAsyncKeyStore setItemsAsync"),0===e.length)return t.error("IndexedDB Error: setItemsAsync without names"),void r({code:9999,message:"setItemsAsync without names"});if(e.length>1)return t.error("IndexedDB Error: setItemsAsync can only handle 1 item"),void r({code:9999,message:"setItemsAsync can only handle 1 item"});var o,a,i=e[0];this.idbstore.set(i.key,{keyname:i.key,value:i.value,attribs:i.attribs,dir:(o=i.key,a=o.lastIndexOf("/"),-1!=a?o.substring(0,a):"")}).then(function(){n()},r).catch(r)},a.prototype.removeItemsAsync=function(e,n,r){var o=this;if(t.debug("IndexedDBAsyncKeyStore removeItemsAsync"),0===e.length)return t.debug("IndexedDB Error: removeItemsAsync without names"),void r({code:9999,message:"IndexedDB Error: removeItemsAsync without names"});e.reduce(function(e,t){return e.then(function(){return o.idbstore.del(t)})},Promise.resolve()).then(function(){n()},r)},a.prototype.clearAllAsync=function(e,n){t.debug("IndexedDBAsyncKeyStore clearAllAsync"),this.idbstore.clear().then(e,n)},a}()},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,"Store",function(){return i}),n.d(t,"get",function(){return c}),n.d(t,"set",function(){return l}),n.d(t,"del",function(){return d}),n.d(t,"clear",function(){return u}),n.d(t,"direlems",function(){return p});var o,a=n(341),i=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"bwds-store",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"keyval";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.storeName=n,this._dbp=new a(function(e,r){var o=indexedDB.open(t,1);o.onerror=function(){return r(o.error)},o.onsuccess=function(){return e(o.result)},o.onupgradeneeded=function(){o.result.createObjectStore(n).createIndex("dir_idx","dir")}})}var t,n,o;return t=e,(n=[{key:"_withIDBStore",value:function(e,t){var n=this;return this._dbp.then(function(r){return new a(function(o,a){var i=r.transaction(n.storeName,e);i.oncomplete=function(){return o()},i.onabort=i.onerror=function(){return a(i.error)},t(i.objectStore(n.storeName))})})}}])&&r(t.prototype,n),o&&r(t,o),e}();function s(){return o||(o=new i),o}function c(e){var t;return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:s())._withIDBStore("readonly",function(n){t=n.get(e)}).then(function(){return t.result})}function l(e,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:s())._withIDBStore("readwrite",function(n){n.put(t,e)})}function d(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:s())._withIDBStore("readwrite",function(t){t.delete(e)})}function u(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:s())._withIDBStore("readwrite",function(e){e.clear()})}function p(e){var t;return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:s())._withIDBStore("readonly",function(n){t=n.index("dir_idx").getAll(e)}).then(function(){return t.result})}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var r,o,a;e.exports=(r=n(160),o=n(46),a=n(22).createLogger("AsyncKeyStoreToBWDSAdapter"),function(e){var t={};function n(e,n){t.queue.executeSequential(function(t){try{e(t)}catch(e){console.error("AsyncBWDS: Uncaught error: "+e),r.handleException(e,n,t)}})}return t.async=e,t.queue=r.newCallbackQueue(),t.readNoSync=function(e,n,r){a.debug("readNoSync "+e),t.async.getItemsAsync([e],function(r){if(r.hasOwnProperty(e)){var o=JSON.parse(r[e].attribs);!1===o.removed?n(r[e].value,t.fileStat(e,o)):n(null,t.fileStat(e,o))}else n(null,null)},function(e){r(e)})},t.read=function(e,a){n(function(n){t.readNoSync(e,function(e,t){null==e?r.callSafe(a,r.error(o.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file"),null,t):r.callSafe(a,null,e,t),n()},function(e){r.handleException(e,a,n)})},a)},t.writeNoSync=function(e,n,o,i){a.debug("writeNoSync "+e+" "+n);var s=null==n?0:n.length;t.async.getItemsAsync([e],function(a){var c,l=r.getDateTime();a.hasOwnProperty(e)?((c=JSON.parse(a[e].attribs)).updated_at=l,c.filesize=s,c.isdir=null==n,c.removed=!1,c.version=c.version+1,c.offline=!1):c={created_at:l,updated_at:l,filesize:s,isdir:null==n,removed:!1,version:1,backup_version:0,backup_date:null,offline:!1},t.async.setItemsAsync([{key:e,value:null==n?"":n,attribs:JSON.stringify(c)}],function(n){if(""!=e){var r=e.lastIndexOf("/"),a="";-1!=r&&(a=e.substring(0,r)),t.writeNoSync(a,null,o,i)}else o(t.fileStat(e,c))},function(e){i(e)})},function(e){i(e)})},t.write=function(e,o,a){n(function(n){t.writeNoSync(e,null==o?"":o,function(e){r.callSafe(a,null,e),n()},function(e){r.handleException(e,a,n)})},a)},t.removeFiles=function(e,n,o){if(0==e.length)null!=n&&n();else{var i=e.shift(),s=i.attribs,c=r.getDateTime();s.removed=!0,s.offline=!1,s.updated_at=c,t.async.setItemsAsync([{key:i.name,value:"",attribs:JSON.stringify(s)}],function(){t.removeFiles(e,function(){n(s)},o)},function(){a.error("removeFiles, could not write new file attribs to clear, removing including attribs"),t.async.removeItemsAsync([i.name],function(){t.removeFiles(e,function(){n(s)},o)},o)})}},t.removeRecurse=function(e,n,r){if(0==e.length)null!=n&&n();else{var o=e.shift();t.async.getDirAttribs(o,function(o){var a=[];for(var i in o){var s=JSON.parse(o[i]);!1===s.removed&&(!0===s.isdir&&e.push(i),a.push({name:i,attribs:s}))}t.removeFiles(a,function(){t.removeRecurse(e,n,r)},r)},r)}},t.removeNoSync=function(e,n,i){a.debug("removeNoSync "+e),""==e?t.removeRecurse([e],n,function(e){r.handleException(e,i)}):t.async.getItemsAsync([e],function(a){if(a.hasOwnProperty(e)){var s=JSON.parse(a[e].attribs);!1===s.removed?s.isdir?t.removeFiles([{name:e,attribs:s}],function(){t.removeRecurse([e],n,function(e){r.handleException(e,i)})},function(e){r.handleException(e,i)}):t.removeFiles([{name:e,attribs:s}],function(r){n(t.fileStat(e,r))},function(e){r.handleException(e,i)}):i(r.error(o.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file"))}else i(r.error(o.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file"))},function(e){r.handleException(e,i)})},t.remove=function(e,o){n(function(n){t.removeNoSync(e,function(){r.callSafe(o,null),n()},function(e){r.callSafe(o,e),n()})},o)},t.dirNoSync=function(e,n,o){a.debug("dirNoSync "+e),t.async.getDirAttribs(e,function(t){var o=[];for(var a in t)!1===JSON.parse(t[a]).removed&&""!=a&&o.push(r.trimLeadingSlash(a.substr(e.length)));o.length>0?n(o):n(null)},function(e){o(e)})},t.dir=function(e,a){n(function(n){t.dirNoSync(e,function(t){null!==t?r.callSafe(a,null,t):""===e?r.callSafe(a,null,[]):r.callSafe(a,r.error(o.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file")),n()},function(e){r.handleException(e,a,n)})},a)},t.fileStat=function(e,t){return{name:e,size:t.filesize,created:t.created_at,modified:t.updated_at,isdir:t.isdir,removed:t.removed,version:t.version,backup_version:t.backup_version,backup_date:t.hasOwnProperty("backup_date")?t.backup_date:null,offline:!!t.hasOwnProperty("offline")&&t.offline}},t.dirStat=function(e,n,r,o){a.debug("dirNoSync "+e),t.async.getDirAttribs(e,function(e){var o=[];for(var a in e)""!==a&&o.push(t.fileStat(a,JSON.parse(e[a])));r(n,o)},function(e){o(e)})},t.statNoSync=function(e,n,r){a.debug("statNoSync "+e),t.async.getItemsAsync([e],function(o){if(o.hasOwnProperty(e)){var a=JSON.parse(o[e].attribs),i=t.fileStat(e,a);a.isdir?t.dirStat(e,i,n,r):n(i)}else n(null)},function(e){r(e)})},t.stat=function(e,a){n(function(n){t.statNoSync(e,function(e,t){null!==e?void 0===t?r.callSafe(a,null,e):r.callSafe(a,null,e,t):r.callSafe(a,r.error(o.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file")),n()},function(e){r.handleException(e,a,n)})},a)},t.setStatNoSync=function(e,n,i,s){a.debug("setStatNoSync "+e),t.async.getItemsAsync([e],function(a){if(a.hasOwnProperty(e)){var c=JSON.parse(a[e].attribs);for(var l in n)if("backup_date"==l)c.backup_date=n.backup_date;else{if("backup_version"!=l)return void s(r.error(o.BWDS_ERROR_WRONG_ATTRIB,"KeyStoreBWDS Error: Can't set attribute "+l));c.backup_version=n.backup_version}t.async.setItemsAsync([{key:e,value:a[e].value,attribs:JSON.stringify(c)}],function(n){i(t.fileStat(e,c))},function(e){r.handleException(e,s)})}else s(r.error(o.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))},function(e){s(e)})},t.setStat=function(e,o,a){n(function(n){t.setStatNoSync(e,o,function(e){r.callSafe(a,null,e),n()},function(e){r.callSafe(a,e),n()})},a)},t.executeSync=function(e,n){t.queue.executeSequential(e,n)},t.clearAll=function(e){a.debug("clearAll"),t.async.clearAllAsync(function(){a.debug("AsyncBWDS.clearAll OK callback"),r.callSafe(e)},function(t){r.handleException(t,e)})},t})},function(e,t,n){e.exports=function(e,t,r){var o=n(22).createLogger("SyncKeyStoreToBWDSAdapter");function a(t,n){try{t()}catch(t){o.error("Uncaught error: "+t),e.handleException(t,n)}}return function(n){var r={};function i(n,o,a){return!1!==r.keystore.setItem(n,o)||(e.callSafe(a,e.error(t.BWDS_ERROR_FULL,"KeyStoreBWDS error: storage full"),null),!1)}return r.keystore=n,r.write=function(t,n,s){a(function(){o.debug("write "+t);var a,c,l=n.length,d=t.lastIndexOf(".");if(-1==d?(a=t,c=""):(a=t.substr(0,d),c=t.substr(d+1)),i(a,n,s))if(""!=a){var u,p=a.lastIndexOf("/"),f="";-1!=p&&(f=a.substring(0,p)),u=a.substring(p);var h,g=r.keystore.getItem(f),v=e.getDateTime();null===g?(h={})[u]={type:c,created_at:v,updated_at:v,filesize:l,removed:!1,version:1,backup_version:0,backup_date:null,offline:!1}:(h=JSON.parse(g))[u]?(h[u].type=c,h[u].updated_at=v,h[u].filesize=l,h[u].version=h[u].hasOwnProperty("version")?h[u].version+1:2,h[u].removed=!1,h[u].offline=!1):h[u]={type:c,created_at:v,updated_at:v,filesize:l,removed:!1,version:1,backup_version:0,backup_date:null,offline:!1};var m=r.fileStat(f,u,h[u]);r.write(f+".dir",JSON.stringify(h),function(t){e.callSafe(s,t,m)})}else e.callSafe(s,null,null)},s)},r.read=function(n,i){a(function(){var a,s;o.debug("read "+n);var c=n.lastIndexOf(".");-1==c?(a=n,s=""):(a=n.substr(0,c),s=n.substr(c+1));var l,d=a.lastIndexOf("/"),u="";-1!=d&&(u=a.substring(0,d)),l=a.substring(d);var p=r.keystore.getItem(u);if(null!==p){var f=JSON.parse(p);if(f[l])if(s&&f[l].type!=s)e.callSafe(i,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"),null,null);else if(!0===f[l].removed)e.callSafe(i,e.error(t.BWDS_ERROR_UNKNOWN,"BWKDLocal Error: removed file"),null,r.fileStat(u,l,f[l]));else{var h=r.keystore.getItem(a);e.callSafe(i,null,h,r.fileStat(u,l,f[l]))}else e.callSafe(i,e.error(t.BWDS_ERROR_UNKNOWN,"BWKDLocal Error: unknown file"),null,null)}else e.callSafe(i,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"),null,null)},i)},r.clearDir=function(e){var t=r.keystore.getItem(e);if(null!=t){var n=JSON.parse(t);for(var a in n)"dir"==n[a].type&&""!=a&&r.clearDir(e+a),o.debug("Clearing: "+e+a),r.keystore.removeItem(e+a);r.keystore.removeItem(e)}},r.clear=function(t,n){a(function(){if(o.debug("clear "+t),t)throw Error("clear(): Unexpected parameter");r.clearDir(""),e.callSafe(n,null)},n)},r.removeDir=function(t,n){o.debug("removeDir("+t+")");var a=r.keystore.getItem(t);if(null!=a){var s=JSON.parse(a),c=e.getDateTime();for(var l in s){var d=s[l];!1===d.removed&&("dir"===d.type?""!==l&&r.removeDir(t+l,n):(o.debug("Clearing: "+t+l),r.keystore.removeItem(t+l)),s[l].version=s[l].hasOwnProperty("version")?s[l].version+1:2,s[l].removed=!0,s[l].updated_at=c)}if(!i(t,JSON.stringify(s),n))return}},r.remove=function(n,i){a(function(){if(o.debug("remove "+n),""==n||null==n||null==n)return r.removeDir("",i),void e.callSafe(i,null);var a,s,c=n.lastIndexOf("."),l=(a=-1==c?n:n.substr(0,c)).lastIndexOf("/"),d="";-1!=l&&(d=a.substring(0,l)),s=a.substring(l);var u=r.keystore.getItem(d);if(null!==u){var p=JSON.parse(u);if(!p[s])return o.error("unknown file"),void e.callSafe(i,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"));"dir"==p[s].type?r.removeDir(n,i):r.keystore.removeItem(a),p[s].removed=!0,p[s].version=p[s].hasOwnProperty("version")?p[s].version+1:2;var f=e.getDateTime();p[s].updated_at=f;var h=r.fileStat(d,s,p[s]);r.write(d+".dir",JSON.stringify(p),function(t){e.callSafe(i,t,h)})}else e.callSafe(i,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))},i)},r.dir=function(n,i){a(function(){var a,s;if(o.debug("dir "+n),""!=n){var c,l=n.lastIndexOf("/"),d="";if(-1!=l&&(d=n.substring(0,l)),c=n.substring(l),null===(a=r.keystore.getItem(d)))return void e.callSafe(i,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown directory"));if(!1===(s=JSON.parse(a)).hasOwnProperty(c)||"dir"!==s[c].type)return void e.callSafe(i,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown directory"))}a=r.keystore.getItem(n),s=JSON.parse(a);var u=[];for(var p in s)!0!==s[p].removed&&u.push(e.trimLeadingSlash(p)+("dir"==s[p].type?"":"."+s[p].type));e.callSafe(i,null,u)},i)},r.fileStat=function(e,t,n){return{name:e+t+("dir"==n.type?"":"."+n.type),size:n.hasOwnProperty("filesize")?n.filesize:null==r.keystore.getItem(e+t)?0:r.keystore.getItem(e+t).length,created:n.created_at,modified:n.updated_at,isdir:"dir"==n.type,removed:n.hasOwnProperty("removed")&&!0===n.removed,version:n.version,backup_version:n.backup_version,backup_date:n.hasOwnProperty("backup_date")?n.backup_date:null,offline:!!n.hasOwnProperty("offline")&&n.offline}},r.dirStat=function(t,n,o){var a=r.keystore.getItem(t),i=JSON.parse(a),s=[];for(var c in i)s.push(r.fileStat(t,c,i[c]));e.callSafe(n,null,o,s)},r.stat=function(n,i){a(function(){if(o.debug("stat "+n),""!=n){var a,s,c=n.lastIndexOf("."),l=(a=-1==c?n:n.substr(0,c)).lastIndexOf("/"),d="";-1!=l&&(d=a.substring(0,l)),s=a.substring(l);var u=r.keystore.getItem(d);if(null!==u&&""!==u){var p=JSON.parse(u);if(p[s])return"dir"==p[s].type?void r.dirStat(n,i,r.fileStat(d,s,p[s])):void e.callSafe(i,null,r.fileStat(d,s,p[s]));e.callSafe(i,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))}else e.callSafe(i,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))}else r.dirStat(n,i,{isdir:!0,name:""})},i)},r.setStat=function(n,s,c){a(function(){if(o.debug("stat "+n),""!=n){var a,l,d=n.lastIndexOf("."),u=(a=-1==d?n:n.substr(0,d)).lastIndexOf("/"),p="";-1!=u&&(p=a.substring(0,u)),l=a.substring(u);var f=r.keystore.getItem(p);if(null!==f){var h=JSON.parse(f);if(h[l]){if("dir"==h[l].type)return void e.callSafe(c,e.error(t.BWDS_ERROR_WRONG_ATTRIB,"KeyStoreBWDS Error: Can't set attributes for directory"));for(var g in s)if("backup_date"==g)h[l].backup_date=s.backup_date;else{if("backup_version"!=g)return void e.callSafe(c,e.error(t.BWDS_ERROR_WRONG_ATTRIB,"KeyStoreBWDS Error: Can't set attribute "+g));h[l].backup_version=s.backup_version}if(!i(p,JSON.stringify(h),c))return;e.callSafe(c,null,r.fileStat(p,l,h[l]))}else e.callSafe(c,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))}else e.callSafe(c,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))}else e.callSafe(c,e.error(t.BWDS_ERROR_WRONG_ATTRIB,"KeyStoreBWDS Error: Can't set attributes for directory"))},c)},r.executeSync=function(e,t){e(function(){})},r.clearAll=function(e){a(function(){r.clear("",e)},e)},r}}(n(160),n(46))},function(e,t,n){var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n(1),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n(41).o,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n(379),a=t.getConfigSync();function i(e,t){var n=e||{};for(var r in t){var o=t[r];null===o?delete n[r]:n[r]=o}return n}function s(t,n,o){e.ajax({type:"GET",dataType:"json",data:t,timeout:3e4,headers:{Authorization:"BWWAAuthToken "+r.getUserToken()},url:a.student_account_server+"/widget-storage/",connectTimeout:2e3,beforeSend:function(e,t){var n=this,r=t.xhr;t.xhr=function(){var e=r();return n.connectTimeoutCB=setTimeout(function(){console.log("Connection timeout occurred !"),e.abort()},n.connectTimeout),e.onreadystatechange=function(){1==this.readyState&&clearTimeout(n.connectTimeoutCB)},e}},success:n,error:o})}function c(t,n,o,i,s){var c={version:n,data:JSON.stringify(o)},l=r.getUserToken();e.ajax({type:"PUT",contentType:"text/plain",data:JSON.stringify(c),url:a.student_account_server+"/widget-storage/"+t,headers:{Authorization:"BWWAAuthToken "+l},timeout:3e4,connectTimeout:2e3,beforeSend:function(e,t){var n=this,r=t.xhr;t.xhr=function(){var e=r();return n.connectTimeoutCB=setTimeout(function(){console.log("Connection timeout occurred !"),e.abort()},n.connectTimeout),e.onreadystatechange=function(){1==this.readyState&&clearTimeout(n.connectTimeoutCB)},e}},success:i,error:s})}return{createWidgetStorage:function(t,n,l,d,u,p){var f={},h=null,g=-1,v=null;return f.loadAll=function(e){var o={"widget-id":l,"widget-type":t,"widget-name":n,"teacher-id":u,"school-id":p};"undefined"!=typeof bwshortcode&&(o["widget-shortcode"]=bwshortcode),s(o,function(t){h=t.id,g=t.version,v=JSON.parse(t.data);try{e(d?v.hasOwnProperty("DATA")?v.DATA:"":v,g)}catch(e){console.error("Error in widget load callback"),console.error(e)}},function(t){403===t.status?(console.log("Online  storage nog allowed in this case, use offline storage: ",t.responseText),r.setForceOfflineStorage()):(console.error("Got error reading widget data"),r.goOffline()),e(d?null:{},-1)})},f.overwrite=function(e,t){c(h,g,d?{DATA:e}:e,function(e){g=e.version,v=JSON.parse(e.data),t({status:"OK",data:d?v.hasOwnProperty("DATA")?v.DATA:null:v,version:g})},function(e,n,o){if(console.log("Got error putting widget data"),409==e.status){console.log("Conflict, someone wrote newer data");var a=JSON.parse(e.responseText);g=a.version,v=JSON.parse(a.data),t({status:"CONFLICT",data:d?v.hasOwnProperty("DATA")?v.DATA:null:v,version:g})}else r.goOffline(),t({status:"OFFLINE"})})},f.write=function(e,t){this.overwrite(d?e:i(v,e),t)},f.writeImage=function(t,n){var i=e.Deferred();return function(t,n){var o=r.getUserToken(),i={name:n};return e.ajax({type:"POST",data:i,url:a.student_account_server+"/widget-storage/"+t+"/resources",headers:{Authorization:"BWWAAuthToken "+o},timeout:3e4,connectTimeout:2e3,beforeSend:function(e,t){var n=this,r=t.xhr;t.xhr=function(){var e=r();return n.connectTimeoutCB=setTimeout(function(){console.log("Connection timeout occurred !"),e.abort()},n.connectTimeout),e.onreadystatechange=function(){1==this.readyState&&clearTimeout(n.connectTimeoutCB)},e}}})}(h,t).done(function(t){(function(t,n,r){var a=new FormData,i=new o([r],{type:"image/jpeg"});return a.append("file",i),e.ajax({url:t,data:a,processData:!1,contentType:!1,type:"POST"})})(t.upload_url,0,n).done(function(){i.resolve()}).fail(function(){console.log("upload resource failed"),i.reject()})}).fail(function(){console.log("getting image url failed"),i.reject()}),i},f.clearImage=function(t){return e.Deferred().resolve()},f.readImage=function(t){var n=a.student_account_server+"/widget-storage/"+h+"/resources/"+t,o=r.getUserToken(),i=e.Deferred();return e.ajax({url:n,headers:{Authorization:"BWWAAuthToken "+o},type:"GET"}).done(function(t){e.ajax({url:t.url,type:"GET"}).done(function(e){i.resolve(e)}).fail(function(){i.reject()})}).fail(function(){i.reject()}),i},f.sync=function(e){e()},f},createInfoStorage:function(e,t,n){var r={};function o(e,r){s({"book-id":e,"teacher-id":t,"school-id":n},r,function(e){console.error("Got error reading widget data"),r({id:null,version:-1,data:"{}"})})}var a=null,l=-1,d=null,u=null,p=-1,f=null;function h(e,t,n,r){c(e,t,n,function(e){r(e.version)},function(){})}return o("BWCommon",function(e){a=e.id,l=e.version,d=JSON.parse(e.data)}),o(e,function(e){u=e.id,p=e.version,f=JSON.parse(e.data)}),r.getCommonProperties=function(e){e(d)},r.getGroupProperties=function(e){e(f)},r.setCommonProperties=function(e){d=i(d,e),h(a,l,d,function(e){l=e})},r.setGroupProperties=function(e){f=i(f,e),h(u,p,f,function(e){p=e})},r}}}.bind(null,n(0));e.exports={f:r,o:r()}},function(e,t){e.exports=window.Blob},function(e,t,n){var r,o,a;e.exports=(r=n(0),(a={}).init=function(){0===r("#storage-busy-marker").length&&r('<div id="storage-busy-marker"></div>').appendTo(".closebutton-container"),o=0},a.start=function(){0==o&&r("#storage-busy-marker").addClass("busy"),++o},a.end=function(){0==--o&&r("#storage-busy-marker").removeClass("busy")},a)},function(e,t,n){var r,o,a,i,s,c,l,d,u;e.exports=(r=n(1),o=n(41).o,a=n(89),i=n(0),s=n(7),c=n(34),l=n(2),d=n(9),u=r.getConfigSync(),{init:function(){function e(){return o.getState()===o.ANONYMOUS?o.requestSignin():o.requestSignout()}function t(){if(l.isPreview()){var t=o.hasSchool()?s("Students need school accounts associated with %(school)s (%(schoolCode)s) in order to sign in.").replace("%(school)s",u.student_account_school.name).replace("%(schoolCode)s",u.student_account_school.code)+"<br><br>":s("Any BookWidgets student account can be used to sign in.")+"<br><br>";d.showAlert(s("Your widget will require students to sign in.")+"<br><br>"+t+s("In widget preview mode sign in is not required / not supported."),s("Sign in not available"))}else a.pushAsyncFunc(e)}function n(e){var t="anonymous",n=s("Not signed in");switch(e){case o.OFFLINE:t="offline",n=s("You're offline");break;case o.ONLINE:t="online";var r=o.getUserName();-1!=r.indexOf("@")&&(r=r.substring(0,r.indexOf("@"))),n=r}var a=i("#loginbutton");if((a.html()!==n||a.attr("state")!==t)&&(a.html(n).attr({state:t}),e==o.OFFLINE||e==o.ONLINE)){var l=i(document.createElement("div")).addClass("login-change-wrapper").appendTo("#top-container"),d=a.clone();d.attr("id","login-change-alert").appendTo(l).fadeIn(400,"swing",function(){setTimeout(function(){d.fadeOut(400,"swing",function(){l.remove()})},1e3)}),a.effect&&a.effect("pulsate",{times:4},500)}c.centerTitle()}var r;r=i('<div id="loginbutton" class="loginbutton bw-tooltext"></div>'),c.prependToTitleToolbar(r),n(o.ANONYMOUS),r.tapOrClick(t),o.initialized().then(function(){n(o.getState()),o.registerStateChangeCallback(n)},function(){n(o.ANONYMOUS),i("#loginbutton").hide()})}})},function(e,t){e.exports={light:{white:"#FFFFFF",black:"#010539",red:"#D34400",orange:"#F39C12",yellow:"#F1C40F",green:"#13A04E","#00de00":"#13A04E",blue:"#3498DB",purple:"#9B59B6","#bc00de":"#9B59B6",brown:"#A56D47"},dark:{white:"#FFFFFF",black:"#010539",red:"#C0392B",orange:"#E67E22",yellow:"#F39C12",green:"#118C44","#00de00":"#118C44",blue:"#2980B9",purple:"#8E44AD","#bc00de":"#8E44AD",brown:"#8C6239"}}},function(e,t){e.exports=window.canvasResize},function(e,t,n){var r,o,a,i,s,c,l,d,u,p,f;e.exports=(n(1),r=n(4),o=n(3),a=n(2),i=n(385),s=n(0),c=n(8),l=n(9),d=n(7),u=n(6),p=n(386),f=n(5),function(e,t){var n={},h=s;return n.Photo={save:function(e){var n=h(e).attr("id"),r=t.questionIf[n].image;return r.is("[data-width]")?p(r.get(0),!0,!1):void 0},load:function(e,n){if("BLANK"!=n){var r=h(e).attr("id"),o=t.questionIf[r].image;t.questionIf[r].isLoaded=!1,c.getImageSize(n,function(e,a){o.attr("data-width",e),o.attr("data-height",a),o.attr("src",n),o.load(function(){t.questionIf[r].isLoaded=!0,o.closest(".photo-cover").addClass("photo-set")})})}else this.clear(e)},preprocessSaveData:function(e,t,n){var r=s.Deferred(),o=s(e),a=o.attr("savedresource");return a&&""!==a&&(t.clearImage(a),o.attr("savedresource",null)),"BLANK"===n?r.resolve(null):t.registerImage(n).done(function(e){o.attr("savedresource",e),r.resolve(e)}).fail(function(){l.showAlert(d("Could not store picture"),d("Error using picture"))}),r},preprocessLoadData:function(e,t,n){var r=s.Deferred(),o=n;return t.getImageUrl(n).then(function(t){s(e).attr("savedresource",o),r.resolve(e,t)},function(){console.log("Could not get image url for",n),r.reject()}),r},freeResources:function(e,t){var n=s(e),r=s.Deferred(),o=n.attr("savedresource");return o&&""!==o?(t.clearImage(o).then(function(){console.log("photo deleted"),r.resolve()},function(){r.reject()}),n.attr("savedresource",null)):r.resolve(),r},clear:function(e){var n=h(e).attr("id"),r=t.questionIf[n].image;t.questionIf[n].isLoaded=!1,t.questionIf[n].url="",t.questionIf[n].uploaded=!1;var o=r.closest(".photo-cover");o.removeClass("photo-set"),o.find(".photo-actual img").attr({src:"","data-width":null,"data-height":null})},render:function(n,l,d){var p="QC"+l,f=s("#"+p),g=f.attr("qindex"),v=e.getQuestionImageDivs(f,n.imgsize,n.img,n.imgpos),m=t.getNumbering(n,g);f.attr("numbering",m),f.attr("scoring-weight",n["scoring-weight"]),h("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(m)+r.prepare(n.Question)+"</"+e.MH+">").appendTo(v.questdiv),c.processRichTextImages(v.questdiv),u.processRichTextWidgetPlayLinks(v.questdiv,!0),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(v.audiodiv);var w=h("<div class='photo-cover'></div>").appendTo(v.answerdiv),b=h("<div class='photo-place-holder'></div>").appendTo(w);b.css("height",n.Height+"px"),b.css("width",Math.round(4*n.Height/3)+"px");var y=h("<div class='photo-place-holder-inner'></div>").appendTo(b);"ibw-platform-osx-ibooks"==a.getPlatform()?(h("<img src='img/photo-placeholder-no-camera.png'>").appendTo(y),h("<p>"+t.translate("No camera on this device")+"</p>").appendTo(y)):(h("<img src='img/photo-placeholder-camera.png'>").appendTo(y),h("<p>"+t.translate("Tap to select picture")+"</p>").appendTo(y));var k=h("<div class='photo-actual'></div>").appendTo(w);k.css("height",n.Height+"px"),k.css("width",Math.round(4*n.Height/3)+"px");var C=h("<img src='' alt=\"Can't load image\">").appendTo(k);h("<div class='photo-delete-button'><div class=\"bw-icon bw-icon-trash\"></div></div>").appendTo(k),h("<input type='file' accept='image/*' class='take-picture-field hidden'>").appendTo(w),i.createPhotoQuestion(f,function(){null!=d&&d()});var T={};t.questionIf[p]=T,T.image=C,t.createHint(n,v.hintdiv),v.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,v.imgdiv),t.processEmbeddedElements(f)},prepareCorrection:function(e,n){t.createRationale(n,e.find(".rationalediv"))},fetchAsset:function(e){var n=s(e).attr("id"),r=p(t.questionIf[n].image.get(0),!0,!0);return"BLANK"==r?(t.questionIf[n].url="",void(t.questionIf[n].uploaded=!1)):{data:r,mimetype:"image/png"}},assetUploadCompleteCB:function(e,n){var r=s(n).attr("id");t.questionIf[r].url=e,t.questionIf[r].uploaded=!0},getAnswer:function(n,r,o){var a=h(n),i=a.find(e.MH).html(),s=a.attr("id"),c=t.questionIf[s].url,l=f.check.Photo(o,a.find(".photo-cover").hasClass("photo-set"));return{question:i,answer:c,correctness:l.correctness,score:l.score,outof:l.outof}}},n})},function(e,t,n){var r,o,a,i;e.exports=(r=n(2),o=n(0),a=n(9),i=n(7),{createPhotoQuestion:function(e,t){!("url"in window)&&"webkitURL"in window&&(window.URL=window.webkitURL),e.find(".photo-cover .take-picture-field").on("change",function(e){if(1==e.target.files.length&&0==e.target.files[0].type.indexOf("image/")){var n=URL.createObjectURL(e.target.files[0]),r=o(this).parent().find(".photo-actual img");r.off("load"),r.load(function(){r.attr("data-width",r.width()),r.attr("data-height",r.height()),null!==t&&t()}),r.attr("src",n),o(this).parent().addClass("photo-set")}o(this).replaceWith(o(this).clone(!0))}),o("body").is(".ibw-platform-osx-ibooks")||e.find(" .photo-cover .photo-place-holder").click(function(){-1==r.getPlatform().indexOf("preview")?o(this).parent().find(".take-picture-field").click():a.showAlert(i("Accessing the camera and photo library does not work on this platform."),i("Camera not supported"))}),e.find(".photo-cover .photo-delete-button").tapOrClick(function(){var e=o(this).parent().parent();e.find(".photo-actual img").attr("src",""),e.removeClass("photo-set"),null!==t&&t()})}})},function(e,t,n){var r;e.exports=(r=n(0),function(e,t,n){var o,a=document.createElement("canvas"),i=a.getContext("2d");if(""!==r(e).attr("src")){var s=r(e).attr("data-width"),c=r(e).attr("data-height");a.width=s,a.height=c,i.drawImage(e,0,0,s,c)}else if(t)return"BLANK";if(!0===n)o=a.toDataURL("image/png");else try{var l=.9;do{l-=.1,o=a.toDataURL("image/jpeg",l)}while(o.length>25e4&&l>.5)}catch(e){console.log("No image/jpeg supported for toDataURL"),o=a.toDataURL("image/png")}return o})},function(e,t,n){var r,o,a,i,s,c,l;e.exports=(n(1),r=n(4),o=n(3),a=n(2),i=n(0),s=n(8),c=n(6),l=n(5),function(e,t){function n(e,t){for(var n=[],r=0;r<e.length;++r){for(var o=0;o<e[r].length;++o){var a=e[r][o];null==a||""===a.trim()?n.push("{}"):n.push(a.trim()),o!=e[r].length-1&&n.push("&")}r!=e.length-1&&n.push("\\\\")}return"$$\\leftLEFT \\begin{array} {cc} VALUES \\end{array} \\rightRIGHT$$".replace("LEFT","parentheses"===t?"(":"[").replace("RIGHT","parentheses"===t?")":"]").replace("VALUES",n.join(" "))}var d={},u=i;function p(e){return parseInt(1.2*e+1)}return d.Numeric={name:"Numeric",getData:function(e){var t={};return u(e).find(".n-cover .edit").each(function(){var e=i(this),n=i(this).attr("part"),r=e.val();t[n]=r}),t},save:function(e){var t=this.getData(e);return JSON.stringify(t)},load:function(e,t){var n=JSON.parse(t),r=i(e);r.find(".n-cover .edit").each(function(){var e=i(this),t=i(this).attr("part");n.hasOwnProperty(t)?e.val(n[t]):e.val(""),e.attr("size",p(e.val().length))}),this.check(r)},clear:function(e){var t=i(e);t.find(".n-cover .edit").each(function(){var e=i(this);e.val(""),e.attr("size",p(e.val().length))}),this.check(t)},getCheckInput:function(e){return this.getData(e)},check:function(e){var n;try{n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}var r=this.getCheckInput(e),o=l.check.Numeric(n,r),a=e.find(".n-cover");switch(o.correctness){case 0:t.clearTag(a,"n-answer");break;case 1:t.setTag(a,"n-answer");break;case-1:t.clearTag(a,"n-answer");break;case-2:t.setTag(a,"n-open")}},createMatrix:function(e,t,n){var r=i(document.createElement("table")).attr("matrix-style",t),o=i(document.createElement("tr")).appendTo(r);i(document.createElement("td")).addClass("matrix-left").appendTo(o);var a=i(document.createElement("td")).addClass("matrix-body").appendTo(o);i(document.createElement("td")).addClass("matrix-right").appendTo(o);for(var s=i(document.createElement("table")).appendTo(a),c=0;c<e.rows;++c)for(var l=i(document.createElement("tr")).appendTo(s),d=0;d<e.columns;++d)i(document.createElement("td")).appendTo(l).append(n(c,d));return r},render:function(n,d,f,h){var g=this,v="QC"+d,m=(h=h||i("#"+v)).attr("qindex"),w={};t.questionIf[v]=w,w.setReadOnly=function(e){-1===a.getPlatform().indexOf("ipad")&&h.find("input").prop("disabled",e)};var b=e.getQuestionImageDivs(h,n.imgsize,n.img,n.imgpos),y=t.getNumbering(n,m);h.attr("numbering",y),h.attr("scoring-weight",n["scoring-weight"]),u("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(y)+r.prepare(n.Question)+"</"+e.MH+">").appendTo(b.questdiv),s.processRichTextImages(b.questdiv),c.processRichTextWidgetPlayLinks(b.questdiv,!0),n.audio&&""!==n.audio&&o.createPlayer(n.audio,"quiz"===e.getWidgetType()).appendTo(b.audiodiv);var k=null!=n.placeholder&&""!==n.placeholder?' placeholder="'+n.placeholder+'"':"",C=u("<div class='n-cover bw-column-container'></div>").appendTo(b.answerdiv);if(C.attr("answer-style",n.answer_style),w.loadCorrect=function(e){h.find("input").each(function(){var t=i(this),n="";switch(t.attr("part")){case"single":n=e.unit&&""!==e.unit?e.single_number+e.unit:e.single_number;break;case"base":n=e.base;break;case"exponent":n=e.exponent;break;case"numerator":n=e.numerator;break;case"denominator":n=e.denominator;break;case"wholenumber":n=e.whole_number}t.val(n),t.attr("size",p(t.val().length))}),g.check(h)},"Single"===n.answer_style)i("<input type='text' "+t.inputModeAttrib("Numerical")+k+" class='edit single' part='single' size='1'></input>").appendTo(C);else if("Fraction"===n.answer_style)i('<table class="fraction"><tr><td class="numeratorcell"></td></tr><tr><td class="denominatorcell"></td></tr></table>').appendTo(C),i("<input type='text' "+t.inputModeAttrib("Numerical")+k+" class='edit fraction' part='numerator' size='1'></input>").appendTo(C.find(".numeratorcell")),i("<input type='text' "+t.inputModeAttrib("Numerical")+k+" class='edit fraction' part='denominator' size='1'></input>").appendTo(C.find(".denominatorcell"));else if("Mixed"===n.answer_style)i('<table class="fraction"><tr><td rowspan="2" class="wholenumbercell"></td><td class="numeratorcell"></td></tr><tr><td class="denominatorcell"></td></tr></table>').appendTo(C),i("<input type='text' "+t.inputModeAttrib("Numerical")+k+" class='edit fraction' part='wholenumber' size='1''></input>").appendTo(C.find(".wholenumbercell")),i("<input type='text' "+t.inputModeAttrib("Numerical")+k+" class='edit fraction' part='numerator' size='1'></input>").appendTo(C.find(".numeratorcell")),i("<input type='text' "+t.inputModeAttrib("Numerical")+k+" class='edit fraction' part='denominator' size='1'></input>").appendTo(C.find(".denominatorcell"));else if("Exponential"===n.answer_style)i('<div class="exponential"></div>').appendTo(C),i("<input type='text' "+t.inputModeAttrib("Numerical")+k+" class='edit' part='base' size='1'></input>").appendTo(C.find(".exponential")),i("<input type='text' "+t.inputModeAttrib("Numerical")+k+" class='edit' part='exponent' size='1'></input>").appendTo(C.find(".exponential"));else if("Matrix"===n.answer_style){var T=l.getMatrixDimensions(n.matrix);null!=T?this.createMatrix(T,"parentheses",function(e,n){var r=i(document.createElement("input")).attr({type:"text",size:"1",part:"c_"+e+"_"+n}).addClass("edit");return t.addInputModeAttrib(r,"Numerical"),r}).appendTo(C):console.log("Invalid matrix definition")}else console.error("Unsupported numeric question answer style: "+n.answer_style);t.createCorrectWrongMarker().addClass("bw-column-fixed bw-centering-container").appendTo(C);var x=C.find("input");return x.bind("keyup",function(){i(this).attr("size",p(i(this).val().length)),null!=f&&f()}),x.bind("change",function(){null!=f&&setTimeout(f,200)}),t.createHint(n,b.hintdiv),b.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,b.imgdiv),t.processEmbeddedElements(h),h},canonicalMatrix:function(e){var t=l.getMatrixDimensions(e.matrix);if(null==t)return null;for(var r=[],o=0;o<t.rows;++o){for(var a=[],i=e.matrix[o].split(" "),s=0;s<t.columns;++s)a.push(i[s]);r.push(a)}return n(r,"parentheses")},prepareCorrection:function(e,n){var o={single_number:n.single_number,unit:n.unit,whole_number:n.whole_number,numerator:n.numerator,denominator:n.denominator,base:n.base,exponent:n.exponent,matrix:n.matrix,answer_style:n.answer_style,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(o));var a,i=this;if(e.find("input").on("keyup change",function(){i.check(e)}),i.check(e),"Single"===n.answer_style)""===n.single_number||isNaN(n.single_number)||(a="<div class='the-answer' >"+t.translate("The answer:")+'<br><br><div class="answer">'+n.single_number+"</div></div>");else if("Fraction"===n.answer_style)a="<div class='the-answer' >"+t.translate("The answer:")+'<br><br><div class="answer">'+r.prepare("$$\\frac{"+n.numerator+"}{"+n.denominator+"}$$")+"</div></div>";else if("Mixed"===n.answer_style)a="<div class='the-answer' >"+t.translate("The answer:")+'<br><br><div class="answer">'+r.prepare("$$"+n.whole_number+"\\frac{"+n.numerator+"}{"+n.denominator+"}$$")+"</div></div>";else if("Exponential"===n.answer_style)a="<div class='the-answer' >"+t.translate("The answer:")+'<br><br><div class="answer">'+r.prepare("$$"+n.base+"^{"+n.exponent+"}$$")+"</div></div>";else if("Matrix"===n.answer_style){var s=this.canonicalMatrix(n);console.log(s),null!=s&&(a="<div class='the-answer' >"+t.translate("The answer:")+'<br><br><div class="answer">'+r.prepare(s)+"</div></div>")}return t.createRationale(n,e.find(".rationalediv"),a),{extrarationale:a}},getAnswer:function(t,r,o){var a,i,s=u(t),c=s.find(e.MH).html(),d=this.getCheckInput(s),p=l.check.Numeric(o,d),f=o.answer_style;if("Single"===f)a=-1===p.correctness?"":d.single,i="$$"+(o.unit&&""!==o.unit?o.single_number+o.unit:o.single_number)+"$$";else if("Fraction"===f)a=-1===p.correctness?"":"$$\\frac {"+d.numerator+"}{"+d.denominator+"}$$",i="$$\\frac{"+o.numerator+"}{"+o.denominator+"}$$";else if("Mixed"===f)a=-1===p.correctness?"":"$$"+d.wholenumber+" \\frac {"+d.numerator+"}{"+d.denominator+"}$$",i="$$"+o.whole_number+" \\frac {"+o.numerator+"}{"+o.denominator+"}$$";else if("Exponential"===f)a=-1===p.correctness?"":"$$ {"+d.base+"} ^ {"+d.exponent+"}$$",i="$$ {"+o.base+"} ^ {"+o.exponent+"}$$";else if("Matrix"===f){var h=[],g=l.getMatrixDimensions(o.matrix);if(null!=g){for(var v=0;v<g.rows;++v){for(var m=[],w=0;w<g.columns;++w)m.push(d["c_"+v+"_"+w]);h.push(m)}a=-1===p.correctness?"":n(h,"parentheses"),i=this.canonicalMatrix(o)}}return{question:c,answer:a,check_input:d,correctness:p.correctness,score:p.score,outof:p.outof,canonicalAnswer:i}}},d})},function(e,t,n){var r,o,a,i,s,c,l,d;e.exports=(r=n(1),o=n(137),a=n(87),i=n(4),s=n(3),c=n(0),l=n(25),d=n(5),function(e,t){var n=r.getConfigSync(),u={};function p(e,t){var n=[];switch(t){case"none":break;case"all":n=function(e,t){for(var n=[],r=e;r<=t;r++)n.push(r);return n}(0,e.length-1);break;case"odd":for(var r=1;r<e.length;r+=2)n.push(r);break;case"even":for(r=0;r<e.length;r+=2)n.push(r)}var o={values:[],layout:{rows:[],columns:[{width:100},{width:100}]},answers:[]};for(r=0;r<e.length;++r){var a="readonly",i=""+e[r].qty;n.length>0&&r===n[0]&&(a="checked",n.shift()),o.values.push([{value:e[r].atom,CellRole:"readonly"},{value:i,CellRole:a}]),o.layout.rows.push({height:30}),o.answers.push(""+e[r].qty)}return o}function f(e,n,r,a,i){c(document.createElement("div")).attr("id",e).appendTo(r);var s=p(n,a),l=o({tablediv:"#"+e,tabledata:s,compare_casesensitive:!1,support_correction_colors:t.widgetSupportsCorrection()});return l.setChangeCallBack(function(){i&&i()}),c("#"+e).find("tr").each(function(e,n){t.data(c(n).find("td:nth-of-type(2)"),"bce-answer",s.answers[e])}),l}function h(e){return"type1"===e||"type2"===e}function g(e){return"type1"===e||"type2"===e}function v(e){return"type1"===e?"none":"odd"}function m(e){return"type1"===e?"all":"even"}function w(e,t,n){for(var r=[],o=0;o<e.length;++o)n?r.push("<span class='nowrap'>_____ $$"+e[o].formula+"$$</span>"):t?r.push("<span class='nowrap bce-field empty'><input type='text' /> $$"+e[o].formula+"$$</span>"):r.push("<span class='nowrap'>$$"+e[o]+"$$</span>");return r}function b(e,t){var n=a.parseEquation(e.Equation),r="type3"===e.SubType,o=a.formatEquation(n,r||t),i="";return i+=w(o.reactants,r,t).join("$$\\, + \\,$$"),i+=" <span class='nowrap'>$$\\: \\rightarrow \\:$$</span> ",i+=w(o.products,r,t).join("$$\\, + \\,$$")}return u.BalanceChemicalEquation={save:function(e){var n=c(e),r=n.attr("id"),o=n.find("[data-subtype]").attr("data-subtype"),a="";h(o)&&(a=n.find("[checked='checked']").attr("answer")||"");var i=[],s=[];g(o)&&(i=t.questionIf[r].reactantsTable.getData(),s=t.questionIf[r].productsTable.getData());var l=[];return"type3"===o&&n.find("input").each(function(e,t){var n=c(t);l.push(n.val())}),JSON.stringify({checkedAnswer:a,enteredReactantsTableValues:i,enteredProductsTableValues:s,enteredCoefficients:l})},load:function(e,n){var r=c(e),o=r.attr("id");n=JSON.parse(n);var a=r.find("[data-subtype]").attr("data-subtype");h(a)&&n.checkedAnswer&&(r.find("[checked='checked']").trigger("clear"),r.find(".bw-radiobutton[answer='"+n.checkedAnswer+"']").trigger("check")),g(a)&&(t.questionIf[o].reactantsTable.setData(n.enteredReactantsTableValues),t.questionIf[o].productsTable.setData(n.enteredProductsTableValues)),"type3"===a&&r.find("input").each(function(e,t){var r=c(t);e<n.enteredCoefficients.length&&r.val(n.enteredCoefficients[e])}),this.check(r)},clear:function(e){var n=c(e),r=n.attr("id"),o=n.find("[data-subtype]").attr("data-subtype");h(o)&&n.find("[checked='checked']").trigger("clear"),g(o)&&(t.questionIf[r].reactantsTable.clear(),t.questionIf[r].productsTable.clear()),"type3"===o&&n.find("input").each(function(){var e=c(this);e.val(""),t.clearTag(e,"wrong")})},render:function(r,o,d,u){var g="QC"+o,w=(u=u||c("#"+g)).attr("qindex"),y=e.getQuestionImageDivs(u,r.imgsize,r.img,r.imgpos);t.addNarrowScreenPadding(u);var k=t.getNumbering(r,w);u.attr("numbering",k),u.attr("scoring-weight",r["scoring-weight"]);var C=r.Question+"<br><br>"+b(r);c("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(k)+i.prepare(C)+"</"+e.MH+">").appendTo(y.questdiv),t.createCorrectWrongMarker().appendTo(y.questdiv.find(".bce-field")),r.audio&&""!==r.audio&&s.createPlayer(r.audio,"quiz"===e.getWidgetType()).appendTo(y.audiodiv);var T=c("<div class='bce-cover'></div>").appendTo(y.answerdiv);T.attr("data-subtype",r.SubType);var x={};if("type3"!==r.SubType){var _=c(document.createElement("div")).addClass("tablewrapper").appendTo(T);c(document.createElement("div")).addClass("tabletitle").text(t.translate("Reactants")).appendTo(_);var S=c(document.createElement("div")).addClass("tablewrapper").appendTo(T);c(document.createElement("div")).addClass("tabletitle").text(t.translate("Products")).appendTo(S);var I=a.parseEquation(r.Equation),O=a.reduceReactantsAndProducts(I),A=f("reactantstable_"+o,O.reactants,_,v(r.SubType),d),E=f("productstable_"+o,O.products,S,m(r.SubType),d);x.reactantsTable=A,x.productsTable=E,t.questionIf[g]=x,x.repaint=function(){A.render(),E.render()},x.setReadOnly=function(e){!1===e&&"no"===n.color_correct_answers&&(A.setCorrectionCallback(null),E.setCorrectionCallback(null)),A.setReadOnly(e),A.render(),E.setReadOnly(e),E.render()},x.formattedEquation=b(r)}if(h(r.SubType)){var q=c(document.createElement("div")).addClass("balanced-or-not-control").appendTo(T),P=t.translate("Yes, this equation is balanced"),D=l.createLabeledRadiobutton(q,P,function(){t.checkMode||(c(this).parent().find(".bw-radiobutton").trigger("clear"),c(this).trigger("check"),null!=d&&d())});D.attr("answer",P).attr("check_input","yes"),D.find(".bw-button-label").append(t.createCorrectWrongMarker());var R=t.translate("No, this equation is not balanced"),N=l.createLabeledRadiobutton(q,R,function(){t.checkMode||(c(this).parent().find(".bw-radiobutton").trigger("clear"),c(this).trigger("check"),null!=d&&d())});N.attr("answer",R).attr("check_input","no"),N.find(".bw-button-label").append(t.createCorrectWrongMarker())}t.createHint(r,y.hintdiv),y.rationalediv.addClass("rationalediv"),t.createOptionalImage(r,y.imgdiv),"type3"===r.SubType&&(t.questionIf[g]=x,x.reportQuestion=r.Question+"<br>"+b(r,!0));var M=this;return u.find("input").each(function(e){c(this).bind("keyup",function(){M.check(u),null!=d&&d()}),c(this).bind("change",function(){M.check(u),null!=d&&setTimeout(d,200)})}),this.check(u),x.loadCorrect=function(e){switch(e.SubType){case"type1":case"type2":var t=a.parseEquation(e.Equation),n=a.reduceReactantsAndProducts(t),r=p(n.reactants,v(e.SubType)),o=p(n.products,m(e.SubType));A.loadCorrect(r),E.loadCorrect(o),u.find("[checked='checked']").trigger("clear"),a.isBalanced(e.Equation)?u.find(".bw-radiobutton[check_input='yes']").trigger("check"):u.find(".bw-radiobutton[check_input='no']").trigger("check");break;case"type3":var i=(t=a.parseEquation(e.Equation)).reactants.concat(t.products),s=0;u.find("input").each(function(){c(this).val(i[s++].qty)}),M.check(u)}},t.processEmbeddedElements(u),u},getCheckInput:function(e){var n,r=e.attr("id");switch(e.find("[data-subtype]").attr("data-subtype")){case"type1":case"type2":return{balanced:(n=e.find("[checked='checked']"),0===n.length?"":n.attr("check_input")),reactantsTable:t.questionIf[r].reactantsTable.getCheckInput(),productsTable:t.questionIf[r].productsTable.getCheckInput()};case"type3":var o=[];return e.find("input").each(function(e,t){var n=c(t);o.push(n.val()||"1")}),o}return null},check:function(e){if("type3"===e.find("[data-subtype]").attr("data-subtype")){var n;try{n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}var r=this.getCheckInput(e),o=d.check.BalanceChemicalEquation(n,r),a=0;e.find("input").each(function(e,n){var r=c(n);1===o.correctness[a++]?t.clearTag(r.parent(),"wrong"):t.setTag(r.parent(),"wrong"),""!==r.val()?t.clearTag(r.parent(),"empty"):t.setTag(r.parent(),"empty")})}},prepareCorrection:function(e,n){var r=e.attr("id"),o={SubType:n.SubType,Equation:n.Equation,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(o));var s,l=t.questionIf[r].reactantsTable,u=t.questionIf[r].productsTable,f=a.parseEquation(n.Equation),g=a.reduceReactantsAndProducts(f);if(l){var w={"case-sensitive":"no",tabledata:p(g.reactants,v(n.SubType)),"scoring-weight":"1"};l.setCorrectionCallback(function(){return d.check.FillInTable(w,l.getCheckInput())})}if(u){var y={"case-sensitive":"no",tabledata:p(g.products,m(n.SubType)),"scoring-weight":"1"};u.setCorrectionCallback(function(){return d.check.FillInTable(y,u.getCheckInput())})}if(h(n.SubType))if(a.isBalanced(n.Equation)){var k=t.translate("Yes, this equation is balanced"),C=c("[check_input=yes]");t.setTag(C,"bce-answer"),s=k}else{var T=t.translate("No, this equation is not balanced"),x=c("[check_input=no]");t.setTag(x,"bce-answer"),s=T}else s=i.prepare(b({Equation:n.Equation,SubType:"type1"}));var _="<div class='the-answer' >"+t.translate("The answer:")+'</br><div class="answer">'+s+"</div></div>";return t.createRationale(n,e.find(".rationalediv"),_),{extrarationale:_}},getAnswer:function(n,r,o,i){var s=c(n),l=s.attr("id"),u=s.find(e.MH).html(),f=this.getCheckInput(s),h=d.check.BalanceChemicalEquation(o,f),g=[],w="",y={},k="";switch(o.SubType){case"type1":case"type2":var C,T=t.translate("Yes, this equation is balanced"),x=t.translate("No, this equation is not balanced");switch(f.balanced){case"":C=t.translate("(no option chosen)");break;case"no":C=x;break;case"yes":C=T}w=a.isBalanced(o.Equation)?T:x;var _=a.parseEquation(o.Equation),S=a.reduceReactantsAndProducts(_);g.push(C);for(var I=0;I<f.reactantsTable.length;++I)""===(O=f.reactantsTable[I])?g.push(" ("+S.reactants[O.row].qty+")"):g.push(parseInt(O.value)===S.reactants[O.row].qty?O.value:O.value+" ("+S.reactants[O.row].qty+")");for(I=0;I<f.productsTable.length;++I){var O;""===(O=f.productsTable[I])?g.push(" ("+S.products[O.row].qty+")"):g.push(parseInt(O.value)===S.products[O.row].qty?O.value:O.value+" ("+S.products[O.row].qty+")")}var A={"case-sensitive":"no",tabledata:p(S.reactants,v(o.SubType)),"scoring-weight":"1"},E={"case-sensitive":"no",tabledata:p(S.products,m(o.SubType)),"scoring-weight":"1"};k="<br>"+t.questionIf[l].formattedEquation+"<br><br>"+t.translate("Reactants")+": "+t.questionIf[l].reactantsTable.getEmailTable(i,d.check.FillInTable(A,t.questionIf[l].reactantsTable.getCheckInput()))+"<br><br>"+t.translate("Products")+": "+t.questionIf[l].productsTable.getEmailTable(i,d.check.FillInTable(E,t.questionIf[l].productsTable.getCheckInput()))+"<br>"+C;break;case"type3":w=b({Equation:o.Equation,SubType:"type1"}),g=f,y={"font-size":"20px"},u=t.questionIf[l].reportQuestion}var q={question:u,answer:g,annotatedtable:k,check_input:f,correctness:h.correctness,score:h.score,outof:h.outof,canonicalAnswer:w,canonicalAnswerCSS:y};return t.questionIf[l].reportQuestion&&(q["report-question"]=t.questionIf[l].reportQuestion),q}},u})},function(e,t,n){var r,o,a,i,s;e.exports=(n(1),r=n(87),o=n(4),a=n(3),i=n(0),n(138),s=n(5),function(e,t){var n={},c=[{ion:"H",charge:1,pattern:[{atom:"H",qty:1}]},{ion:"K",charge:1,pattern:[{atom:"K",qty:1}]},{ion:"Cu",charge:1,pattern:[{atom:"Cu",qty:1}]},{ion:"Ag",charge:1,pattern:[{atom:"Ag",qty:1}]},{ion:"Na",charge:1,pattern:[{atom:"Na",qty:1}]},{ion:"NH4",charge:1,pattern:[{atom:"N",qty:1},{atom:"H",qty:4}]},{ion:"Ba",charge:2,pattern:[{atom:"Ba",qty:1}]},{ion:"Mg",charge:2,pattern:[{atom:"Mg",qty:1}]},{ion:"Cu",charge:2,pattern:[{atom:"Cu",qty:1}]},{ion:"Pb",charge:2,pattern:[{atom:"Pb",qty:1}]},{ion:"Fe",charge:2,pattern:[{atom:"Fe",qty:1}]},{ion:"Zn",charge:2,pattern:[{atom:"Zn",qty:1}]},{ion:"Ca",charge:2,pattern:[{atom:"Ca",qty:1}]},{ion:"Al",charge:3,pattern:[{atom:"Al",qty:1}]},{ion:"Fe",charge:3,pattern:[{atom:"Fe",qty:1}]},{ion:"I",charge:-1,pattern:[{atom:"I",qty:1}]},{ion:"Cl",charge:-1,pattern:[{atom:"Cl",qty:1}]},{ion:"F",charge:-1,pattern:[{atom:"F",qty:1}]},{ion:"NO3",charge:-1,pattern:[{atom:"N",qty:1},{atom:"O",qty:3}]},{ion:"OH",charge:-1,pattern:[{atom:"O",qty:1},{atom:"H",qty:1}]},{ion:"HCO3",charge:-1,pattern:[{atom:"H",qty:1},{atom:"C",qty:1},{atom:"O",qty:3}]},{ion:"CH3COO",charge:-1,pattern:[{atom:"C",qty:1},{atom:"H",qty:3},{atom:"C",qty:1},{atom:"O",qty:1},{atom:"O",qty:1}]},{ion:"CO3",charge:-2,pattern:[{atom:"C",qty:1},{atom:"O",qty:3}]},{ion:"SO4",charge:-2,pattern:[{atom:"S",qty:1},{atom:"O",qty:4}]},{ion:"O",charge:-2,pattern:[{atom:"O",qty:1}]},{ion:"S",charge:-2,pattern:[{atom:"S",qty:1}]},{ion:"PO4",charge:-3,pattern:[{atom:"P",qty:1},{atom:"O",qty:4}]}];function l(e){var t=[];return e.find("li").each(function(e,n){var r=i(n).attr("data-ion-index");t.push(c[r])}),t}function d(e,n,a,i){var s,c,d,u=(s=l(e),c=l(n),d=s.concat(c),{parsedFormula:r.joinIonsToFormula(d),totalCharge:r.totalCharge(d)}),p=r.formatFormula(u.parsedFormula);a.html(o.prepare("$$"+p+"$$")),o.process(a.children()),t.createCorrectWrongMarker().appendTo(a),p?i.text(t.translate("Sum of charges:")+" "+u.totalCharge):i.text("")}var u,p,f={},h={},g=e.getScrollObject()[0];function v(e,t,n,a,s,c,l){var d=i(document.createElement("li"));d.addClass("wordwrapper"),d.html(o.prepare("$$"+r.formatIon(e)+"$$")),d.attr("data-ion-index",t),e.charge>0?n.append(d):a.append(d),l&&d.draggable({helper:"clone",scope:e.charge>0?"pos":"neg",revert:"invalid",start:function(e,t){f={top:i(g).offset().top+50,bottom:i(g).offset().top+i(g).height()-50,scrollTop:g.scrollTop},u=!1,p=!0},drag:function(e,t){var n=i(".ui-draggable-dragging");function r(){n.setTranslate(0,g.scrollTop-f.scrollTop)}h.up=f.top-e.clientY,h.down=e.clientY-f.bottom,(h.up>0||h.down>0)&&!u?(function e(t){h.down>0&&(g.scrollTop=g.scrollTop+(h.down>>1)),h.up>0&&(g.scrollTop=g.scrollTop-(h.up>>1)),(h.up>0||h.down>0)&&t()&&setTimeout(e.bind(null,t),100)}(function(){return r(),p}),u=!0):(r(),u=!1,p=!1)},stop:function(e,t){u=!1}})}return n.IonicCompoundBuilder={save:function(e){var t=i(e),n=t.find("#pos-drop-target"),r=t.find("#neg-drop-target"),o=[];return n.find("li").each(function(e,t){var n=i(t).attr("data-ion-index");o.push(n)}),r.find("li").each(function(e,t){var n=i(t).attr("data-ion-index");o.push(n)}),JSON.stringify(o)},load:function(e,t){for(var n=i(e),r=n.find("#pos-drop-target"),a=n.find("#neg-drop-target"),s=JSON.parse(t),l=0;l<s.length;++l){var u=s[l];u<c.length?v(c[u],u,r,a,0,0,!1):console.error("Saved ion doesn't exist anymore: ",u)}o.process(r.find("li").children()),o.process(a.find("li").children()),d(r,a,n.find(".composed-formula"),n.find(".total-charge")),this.check(n)},clear:function(e){var t=i(e),n=t.find("#pos-drop-target"),r=t.find("#neg-drop-target");n.find("li").remove(),r.find("li").remove(),d(n,r,t.find(".composed-formula"),t.find(".total-charge")),this.check(t)},render:function(n,s,l,u){var p="QC"+s,f=(u=u||i("#"+p)).attr("qindex"),h={};t.questionIf[p]=h;var g=this;h.loadCorrect=function(e){var t=u.find("#pos-drop-target"),n=u.find("#neg-drop-target");t.find("li").remove(),n.find("li").remove();for(var a=r.splitFormulaInIons(e.Valid,c),i=0;i<a.length;++i)for(var s=0;s<c.length;++s){var l=c[s];if(l.ion===a[i].ion)for(var p=0;p<a[i].qty;++p)v(l,s,t,n,0,0,!1)}o.process(t.find("li").children()),o.process(n.find("li").children()),d(t,n,u.find(".composed-formula"),u.find(".total-charge"))};var m=e.getQuestionImageDivs(u,n.imgsize,n.img,n.imgpos);t.addNarrowScreenPadding(u);var w=t.getNumbering(n,f);u.attr("numbering",w),u.attr("scoring-weight",n["scoring-weight"]),i("<"+e.MH+" class='the-question'>"+e.getIndexPrefix(w)+o.prepare(n.Question)+"</"+e.MH+">").appendTo(m.questdiv),n.audio&&""!==n.audio&&a.createPlayer(n.audio,"quiz"===e.getWidgetType()).appendTo(m.audiodiv);var b=i("<div class='icb-cover'></div>").appendTo(m.answerdiv);t.data(b,"valid-answer",n.Valid);var y=i(document.createElement("div")).addClass("bw-row").appendTo(b),k=i(document.createElement("div")).addClass("bw-col-1-2").appendTo(y),C=i(document.createElement("ul")).addClass("drag-source").appendTo(k),T=i(document.createElement("div")).addClass("bw-col-1-2").appendTo(y),x=i(document.createElement("ul")).addClass("drag-source").appendTo(T),_=i(document.createElement("div")).addClass("bw-row").appendTo(b),S=i(document.createElement("div")).addClass("bw-col-1-2 ddboxwrapper").css("position","relative").appendTo(_),I=i(document.createElement("ul")).addClass("drop-target ddbox").attr("id","pos-drop-target").appendTo(S);i(document.createElement("div")).addClass("ddboxbg").appendTo(I),i(document.createElement("div")).addClass("sign").text("+").appendTo(S);var O=i(document.createElement("div")).addClass("trash-button bw-icon-small bw-icon-trash bw-smalliconbutton").appendTo(S),A=i(document.createElement("div")).addClass("bw-col-1-2 ddboxwrapper").css("position","relative").appendTo(_),E=i(document.createElement("ul")).addClass("drop-target ddbox").attr("id","neg-drop-target").appendTo(A);i(document.createElement("div")).addClass("ddboxbg").appendTo(E),i(document.createElement("div")).addClass("sign").text("-").appendTo(A);var q=i(document.createElement("div")).addClass("trash-button bw-icon-small bw-icon-trash bw-smalliconbutton").appendTo(A);i(document.createElement("div")).css("clear","both").appendTo(b);var P=i(document.createElement("div")).addClass("composed-formula").appendTo(b),D=i(document.createElement("div")).addClass("total-charge").appendTo(b);t.createHint(n,m.hintdiv),m.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,m.imgdiv);for(var R={},N=0;N<n.KnownIons.length;++N)R[n.KnownIons[N]]=!0;var M=[];for(N=0;N<c.length;++N)c[N].ionIndex=N,c[N].ion in R&&M.push(c[N]);for(N=0;N<M.length;++N){var L=M[N];v(L,L.ionIndex,C,x,0,0,!0)}function B(e,t){e.droppable({scope:t,drop:function(e,t){t.draggable.parent()[0]!==this&&t.draggable.clone().appendTo(i(this)),i(this).sortable("refresh"),d(I,E,P,D),g.check(u),l&&l()}})}return I.add(E).sortable({placeholder:"sortable-placeholder",stop:function(){d(I,E,P,D),g.check(u),l&&l()}}),B(I,"pos"),B(E,"neg"),O.add(q).tapOrClick(function(){i(this).parent().find("li").each(function(e,t){i(t).remove()}),d(I,E,P,D),g.check(u),l&&l()}),t.processEmbeddedElements(u),u},getCheckInput:function(e){var t=e.find("#pos-drop-target"),n=e.find("#neg-drop-target");return{posIons:l(t),negIons:l(n)}},check:function(e){var n;try{n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}var r=this.getCheckInput(e),o=s.check.IonicCompoundBuilder(n,r),a=e.find(".composed-formula");switch(o.correctness){case-1:t.clearTag(a,"wrong"),t.clearTag(a,"correct");break;case 0:t.setTag(a,"wrong"),t.clearTag(a,"correct");break;case 1:t.clearTag(a,"wrong"),t.setTag(a,"correct")}},prepareCorrection:function(e,n){var r={Valid:n.Valid,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(r));var a="<div class='the-answer' >"+t.translate("The answer:")+'</br><div class="answer">'+o.prepare("$$"+n.Valid+"$$")+"</div></div>";return t.createRationale(n,e.find(".rationalediv"),a),{extrarationale:a}},getAnswer:function(t,n,o){var a=i(t),c=a.find(e.MH).html(),l=this.getCheckInput(a),d=s.check.IonicCompoundBuilder(o,l),u=l.posIons.concat(l.negIons),p=r.joinIonsToFormula(u),f=r.parseFormula(o.Valid);return{question:c,answer:"$$"+r.formatFormula(p)+"$$",check_input:l,correctness:d.correctness,score:d.score,outof:d.outof,canonicalAnswer:"$$"+r.formatFormula(f)+"$$"}},allSupportedIons:c},n})},function(e,t,n){var r;e.exports=(r=n(391),function(e,t){return{CorrectSentence:t.wrapTypeConstructor(r(t),e)}})},function(e,t,n){var r,o;e.exports=(r=n(0),o=n(5),function(e){return function(t,n,a,i,s){var c=e.QuestionTypeBasic(t,n,a,i,s);return c.getCheckInput=function(){var e=[];return this.question.find(".cs-input").each(function(){e.push(r(this).val().trim())}),e},c.check=function(){if(this.hasOwnProperty("questionconfig")){var t=this.questionconfig,n=this.getCheckInput(),a=o.check.CorrectSentence(t,n),i=this.question.find(".cs-input"),s=0;i.each(function(){var t=r(this).parent(),n=a.correctness[s++];0===n||-1===n?(e.clearTag(t,"cs-correct"),e.setTag(t,"cs-wrong")):1===n&&(e.setTag(t,"cs-correct"),e.clearTag(t,"cs-wrong"))})}},c.processInputSentence=function(t){var n=r(document.createElement("div")).addClass("cs-sentence"),a=this;return o.processCorrectSentence(t,"yes"===a.data["all-words-editable"],function(e){"\n"===e?n.append("<br>"):n.append(e)},function(e){return r(document.createElement("span")).addClass("cs-word").text(e).appendTo(n)},function(t,o){var i=r(document.createElement("span")).append(r(document.createElement("span")).addClass("text").text(t)).addClass("cs-word").attr("original",t).appendTo(n),s=r(document.createElement("input")).attr("tabindex","-1").addClass("cs-input").val(t).appendTo(i);e.addSpellCheckAttrib(s),e.createCorrectWrongMarker().appendTo(i),e.data(i,"cs-correct-val","true"),s.bind("keyup",function(e){13===(void 0!==e?e:event).keyCode&&r(this).blur()}),s.focus(function(){s.addClass("editing")}),s.blur(function(){var e=r(this),t=r(this).parent(),n=e.val().trim();""===n?(t.addClass("empty"),t.find(".text").text(t.attr("original"))):(t.removeClass("empty"),t.find(".text").text(n)),t.addClass("cs-changed"),c.check(),null!==a.changeCB&&a.changeCB(),e.removeClass("editing")})}),n},c.renderTypeSpecificPart=function(){this.processInputSentence(this.data.Sentence).appendTo(this.divs.answerdiv);var t=this;"yes"!==t.data["all-words-editable"]&&this.divs.answerdiv.find(".cs-word").tapOrClick(function(){var n=r(this);e.data(n,"cs-correct-val")||function(e,t,n,o){var a=e.offset();a.top-=30,t.find(".cs-hint").remove();var i=r(document.createElement("div")).addClass("cs-hint").text(n).appendTo(t).offset(a);setTimeout(i.remove.bind(i),o)}(n,t.question,e.translate("This word is correct."),2e3)}),this.check()},c.save=function(){var e=this.divs.answerdiv.find(".cs-input"),t=[];return e.each(function(){var e=r(this);if(e.parent().hasClass("cs-changed")){var n=e.val();t.push(""===n?" ":n)}else t.push("")}),JSON.stringify({answers:t})},c.load=function(e){var t;try{var n=JSON.parse(e);t=n.answers;var o=this.divs.answerdiv.find(".cs-input"),a=0;o.each(function(){var e=r(this),n=e.parent();if(""!==t[a]){var o=n.find(".text");" "===t[a]?(e.val(""),o.text(n.attr("original")),n.addClass("empty")):(e.val(t[a]),o.text(t[a])),n.addClass("cs-changed")}++a}),this.check()}catch(t){return void console.error("Could not load correct sentence question data",e)}},c.loadCorrect=function(e){var t=this.question.find(".cs-input"),n=0;o.processCorrectSentence(e.Sentence,"yes"===e["all-words-editable"],function(){},function(){},function(e,o){var a=r(t[n++]),i=a.parent();a.val(o),""===o?(i.addClass("empty"),i.find(".text").text(e)):(i.removeClass("empty"),i.find(".text").text(o)),i.addClass("cs-changed")})},c.clear=function(){var e=this.question.find(".cs-input"),t=0,n=this.data;o.processCorrectSentence(n.Sentence,"yes"===n["all-words-editable"],function(){},function(){},function(n,o){var a=r(e[t++]),i=a.parent();a.val(n),i.find(".text").text(n),i.removeClass("cs-changed"),i.removeClass("empty")}),this.check()},c.getCorrectAnswerString=function(e){var t=[];return o.processCorrectSentence(e.Sentence,"yes"===e["all-words-editable"],function(e){t.push(e)},function(e){t.push(e)},function(e,n){t.push('<span class="answer">'+n+"</span>")}),t.join("")},c.getAnswerString=function(e,t,n,r){var a=[],i=0,s="yes"===t["all-words-editable"];return o.processCorrectSentence(t.Sentence,s,function(e){a.push(e)},function(e){a.push(e)},function(t,o){var c=n[i],l=r.correctness[i++];e?s&&t===o?c===t?a.push(c):""==c?a.push("<span style='color: red; text-decoration: line-through ; opacity: 0.7'>"+t+"</span>"):a.push("<span style='color: red'>"+c+"</span>"):1===l?""==c?a.push("<span style='color: green; text-decoration: line-through ; opacity: 0.7'>"+t+"</span>"):a.push("<span style='color: green'>"+c+"</span>"):""==c?a.push("<span style='color: red; text-decoration: line-through ; opacity: 0.7'>"+t+"</span>"):a.push("<span style='color: red'>"+c+"</span>"):a.push("<i>"+c+"</i>")}),a.join("")},c.prepareCorrection=function(t){this.questionconfig={Sentence:t.Sentence,policy:t.policy,"all-words-editable":t["all-words-editable"],"scoring-weight":t["scoring-weight"]};var n="<div class='the-answer' >"+e.translate("The answer:")+"<br><br>"+this.getCorrectAnswerString(t)+"</div>";return e.createRationale(t,this.divs.rationalediv,n),{extrarationale:n}},c.getAnswer=function(e,t,n){var r=this.question.find(i.MH).html(),a=this.getCheckInput(),s=o.check.CorrectSentence(t,a);return{question:r,annotatedtable:this.getAnswerString(n,t,a,s),answer:s.answers,correctness:s.correctness,check_input:a,score:s.score,outof:s.outof}},c}})},function(e,t,n){var r;e.exports=(r=n(393),function(e,t){return{MarkSentence:t.wrapTypeConstructor(r(t),e)}})},function(e,t,n){var r,o,a;e.exports=(r=n(0),o=n(5),a=n(7),function(e){return function(t,n,i,s,c){var l=e.QuestionTypeBasic(t,n,i,s,c);return l.getCheckInput=function(){var e=this,t=[];return this.divs.answerdiv.find(".mas-word").each(function(){t.push(e.categories[parseInt(r(this).attr("marker")||"0")].id)}),t},l.check=function(){if(this.hasOwnProperty("questionconfig")){var t=this.questionconfig,n=this.getCheckInput(),a=o.check.MarkSentence(t,n),i=0,s=this.divs.answerdiv.find(".mas-word");o.processMarkSentence(t.Sentence,function(){},function(){c(r(s[i]),a.correctness[i],!1),++i},function(){c(r(s[i]),a.correctness[i],!0),++i})}function c(t,r,o){var a=n[i];1===r&&""!==a||0===r||-1===r&&o?0===t.find(".cr-marker").length&&e.createCorrectWrongMarker().appendTo(t):t.find(".cr-marker").remove(),1===r?t.addClass("mas-correct").removeClass("mas-wrong"):-2===r?t.removeClass("mas-correct").removeClass("mas-wrong"):t.removeClass("mas-correct").addClass("mas-wrong")}},l.processInputSentence=function(e){var t=0,n=r(document.createElement("div")).addClass("mas-sentence");return o.processMarkSentence(e,function(e){n.append("\n"===e?"<br>":e)},function(e){return r(document.createElement("span")).attr("nr",++t).addClass("mas-word").text(e).appendTo(n)},function(e){return r(document.createElement("span")).attr("nr",++t).addClass("mas-word").text(e.word).appendTo(n)}),n},l.htmlToString=function(e){for(var t=[],n=this.data.Sentence.split("<br>"),o=0;o<n.length;++o)t.push(r(document.createElement("div")).html(n[o]).text());return t.join("\n")},l.parseCategories=function(e,t){this.categorymap={},this.categorymap[""]=0,this.categories=[{name:a("CLEAR"),id:""}];var n=0;if(e)for(n=0;n<e.length;++n){var r=e[n].split("##"),i=r[0],s=r.length>1?r[1]:r[0];this.categories.push({name:i,id:s}),this.categorymap[s]=n+1}var c=this;o.processMarkSentence(t,function(){},function(){},function(e){c.categorymap.hasOwnProperty(e.type)||(c.categories.push({name:e.type,id:e.type}),c.categorymap[e.type]=++n)})},l.renderTypeSpecificPart=function(){this.parseCategories(this.data.categories,this.data.Sentence);for(var e=r(document.createElement("div")).addClass("mas-categories").appendTo(this.divs.answerdiv),t=0;t<this.categories.length;++t){var n=r(document.createElement("div")).addClass("mas-category-wrapper").attr("marker",t).appendTo(e);r(document.createElement("div")).addClass("mas-category").text(this.categories[t].name).appendTo(n)}this.processInputSentence(this.data.Sentence).appendTo(this.divs.answerdiv);var o=this;function a(t){e.find(".selected").removeClass("selected"),r(e.find(".mas-category-wrapper")[t]).addClass("selected"),o.question.attr("mas-selected",t)}function i(e,t){if(e>t){var n=e;e=t,t=n}o.divs.answerdiv.find(".mas-word").each(function(){var n=r(this),o=parseInt(n.attr("nr"));r(this).toggleClass("selected",o>=e&&o<=t)})}function s(){o.divs.answerdiv.find(".mas-word").removeClass("selected")}a(1),e.find(".mas-category-wrapper").tapOrClick(function(){a(r(this).attr("marker"))});var c=null;function l(){o.divs.answerdiv.find(".mas-word.selection-start").removeClass("selection-start"),c=null}function d(){s(),l(),r("body").off("mouseup",d)}this.divs.answerdiv.find(".mas-word").on("mousedown",function(){var e=r(this);c=parseInt(e.attr("nr")),e.addClass("selection-start"),i(c,c),r("body").on("mouseup",d)}).on("mouseenter",function(){if(null!==c){var e=r(this);i(c,parseInt(e.attr("nr")))}}).on("mouseleave",function(){null!==c&&s()}).on("mouseup",function(t){if(t.stopPropagation(),null!==c){var n=r(this);!function(e,t,n){if(e>t){var a=e;e=t,t=a}o.divs.answerdiv.find(".mas-word").each(function(){var o=r(this),a=parseInt(o.attr("nr"));a>=e&&a<=t&&r(this).attr("marker",n)}),o.check()}(c,parseInt(n.attr("nr")),parseInt(e.find(".mas-category-wrapper.selected").attr("marker"))),null!==o.changeCB&&o.changeCB(),s(),l()}}),this.check()},l.save=function(){var e=this.getCheckInput();return JSON.stringify({answers:e})},l.load=function(e){this.clear();var t=this.divs.answerdiv.find(".mas-word");try{var n=JSON.parse(e).answers;if(n.length===t.length)for(var o=0;o<n.length;++o)r(t[o]).attr("marker",this.categorymap[n[o]]||0);else console.error("Could not load mark sentence question data, wrong count")}catch(t){console.error("Could not load mark sentence question data",e)}this.check()},l.loadCorrect=function(e){var t=[];o.processMarkSentence(e.Sentence,function(){},function(){t.push("")},function(e){t.push(e.type)}),this.load(JSON.stringify({answers:t}))},l.clear=function(){this.divs.answerdiv.find(".mas-word").attr("marker",null),this.check()},l.getCorrectAnswerString=function(e){var t=r(document.createElement("div")).addClass("mas-sentence"),n=this;return n=this,o.processMarkSentence(e.Sentence,function(e){"\n"===e?t.append("<br>"):t.append(e)},function(e){t.append(e)},function(e){r(document.createElement("span")).addClass("mas-word").text(e.word).attr("marker",n.categorymap[e.type]).appendTo(t)}),t.append("<br><br>"),t.html()},l.prepareCorrection=function(t){this.questionconfig={Sentence:t.Sentence,categories:t.Categories,policy:t.policy,"all-words-editable":t["all-words-editable"],"scoring-weight":t["scoring-weight"]};var n="<div class='the-answer' >"+e.translate("The answer:")+"<br><br>"+this.getCorrectAnswerString(t)+"</div>";return e.createRationale(t,this.divs.rationalediv,n),{extrarationale:n}},l.getAnswer=function(e,t,n){var r=this.question.find(s.MH).html();t.sentenceAsString=this.htmlToString(this.data.Sentence);var a=this.getCheckInput(),i=o.check.MarkSentence(t,a);return{question:r,answer:a,check_input:a,correctness:i.correctness,score:i.score,outof:i.outof}},l}})},function(e,t,n){var r;e.exports=(r=n(395),function(e,t){return{DragWordsInSentence:t.wrapTypeConstructor(r(t),e)}})},function(e,t,n){var r,o,a;e.exports=(r=n(0),o=n(5),a=n(26),function(e){return function(t,n,i,s,c){var l=e.QuestionTypeBasic(t,n,i,s,c);return l.getCheckInput=function(){var e=[];return this.question.find(".dwis-box").each(function(){var t=r(this).find(".dwis-word");e.push(t.length>0?t.attr("save").trim():"")}),e},l.check=function(){if(this.hasOwnProperty("questionconfig")){var t=this.questionconfig,n=this.getCheckInput(),a=o.check.DragWordsInSentence(t,n),i=this.question.find(".dwis-box"),s=0;i.each(function(){var t=r(this),n=a.correctness[s++];0===n||-1===n?(e.clearTag(t,"dwis-correct"),e.setTag(t,"dwis-wrong")):1===n?(e.setTag(t,"dwis-correct"),e.clearTag(t,"dwis-wrong")):(e.clearTag(t,"dwis-correct"),e.clearTag(t,"dwis-wrong"))})}},l.createTextDiv=function(t){var n=r(document.createElement("div")).addClass("dwis-text");return o.processDragWordsInSentence(t,function(t,o,a){if(n.append(t),o&&""!==o){var i=r(document.createElement("div")).addClass("dwis-box").appendTo(n);e.createCorrectWrongMarker().appendTo(i)}}),n},l.getWords=function(e){var t=[];return o.processDragWordsInSentence(e,function(e,n,r){n&&""!==n&&t.push(n)}),t},l.createWordsDiv=function(e,t){var n=this.getWords(e);if(t)for(var o=0;o<t.length;++o)n.push(t[o]);n=a.shuffleArray(n);var i=r(document.createElement("div")).addClass("dwis-words");for(o=0;o<n.length;++o)r(document.createElement("div")).html(n[o]).attr("save",n[o]).addClass("dwis-word").appendTo(i);return i},l.htmlToString=function(e){for(var t=[],n=e.split("<br>"),o=0;o<n.length;++o)t.push(r(document.createElement("div")).html(n[o]).text());return t.join("\n")},l.renderTypeSpecificPart=function(){this.divs.answerdiv.addClass("dwis-cover"),this.createWordsDiv(this.data.Sentence,this.data.distractors).appendTo(this.divs.answerdiv),this.createTextDiv(this.data.Sentence).appendTo(this.divs.answerdiv);var e=this,t=this.question.attr("id");this.divs.answerdiv.find(".dwis-words, .dwis-box").droppable({drop:function(t,n){var o=r(n.draggable),a=r(this);a.find(".dwis-word").appendTo(e.question.find(".dwis-words")),o.prependTo(a),e.check()},tolerance:"intersect",scope:t,hoverClass:"dwis-hover"});var n,o,a={},c={},l=s.getScrollObject()[0],d=s.getScrollObject()[0];this.divs.answerdiv.find(".dwis-word").draggable({scope:t,helper:"clone",appendTo:e.divs.answerdiv,start:function(e,t){r(this).addClass("drag_placeholder"),a={top:r(d).offset().top+50,bottom:r(d).offset().top+r(d).height()-50,left:r(l).offset().left+50,right:r(l).offset().left+r(l).width()-50,scrollTop:d.scrollTop},n=!1,o=!0},drag:function(e,t){var i=r(".ui-draggable-dragging");function s(){i.setTranslate(0,d.scrollTop-a.scrollTop)}c.up=a.top-e.clientY,c.down=e.clientY-a.bottom,c.left=a.left-e.clientX,c.right=e.clientX-a.right,(c.up>0||c.down>0||c.left>0||c.right>0)&&!n?(function e(t){c.down>0&&(d.scrollTop=d.scrollTop+(c.down>>1)),c.up>0&&(d.scrollTop=d.scrollTop-(c.up>>1)),c.left>0&&(l.scrollLeft=l.scrollLeft-(c.left>>1)),c.right>0&&(l.scrollLeft=l.scrollLeft+(c.right>>1)),(c.up>0||c.down>0||c.left>0||c.right>0)&&t()&&setTimeout(e.bind(null,t),100)}(function(){return s(),o}),n=!0):(s(),n=!1)},stop:function(e,t){n=!1,o=!1;var a=r(this);a.removeClass("drag_placeholder"),a.css("position","relative"),a.offset(r(t.helper).offset()),a.animate({top:0,left:0},function(){null!=i&&i()})}})},l.save=function(){var e=this.getCheckInput();return JSON.stringify({answers:e})},l.load=function(e){this.clear();try{var t=JSON.parse(e).answers,n=0,o=this.question.find(".dwis-box"),a=this.divs.answerdiv.find(".dwis-words .dwis-word");o.each(function(){var e=r(this);if(""!==t[n])for(var o=0;o<a.length;++o){var i=r(a[o]);if(i.attr("save").trim()===t[n].trim()){i.prependTo(e),a.splice(o,1);break}}++n})}catch(e){console.error("Could not load drag words in sentence data")}this.check()},l.loadCorrect=function(e){this.load(JSON.stringify({answers:this.getWords(e.Sentence)}))},l.clear=function(){this.divs.answerdiv.find(".dwis-box .dwis-word").appendTo(this.divs.answerdiv.find(".dwis-words")),this.check()},l.getCorrectAnswerString=function(e){var t=[];return o.processDragWordsInSentence(e.Sentence,function(e,n,r){t.push(e),n&&""!==n&&t.push("<span class='dwis-inserted'>"+n+"</span>")}),t.join("")},l.setReadOnly=function(e){this.divs.answerdiv.find(".dwis-word").draggable(e?"disable":"enable")},l.prepareCorrection=function(t){this.questionconfig={Sentence:t.Sentence,distractors:t.distractors,policy:t.policy,"scoring-weight":t["scoring-weight"]},this.check();var n="<div class='the-answer' >"+e.translate("The answer:")+"<br><br>"+this.getCorrectAnswerString(t)+"<br><br></div>";return e.createRationale(t,this.divs.rationalediv,n),{extrarationale:n}},l.getAnswer=function(e,t,n){var r=this.question.find(s.MH).html(),a=this.getCheckInput(),i=o.check.DragWordsInSentence(t,a);return{question:r,answer:a,check_input:a,correctness:i.correctness,score:i.score,outof:i.outof}},l}})},function(e,t,n){var r;e.exports=(r=n(397),function(e,t){return{Group:t.wrapTypeConstructor(r(t),e)}})},function(e,t,n){var r,o,a,i,s,c=n(21),l=c.map,d=c.each,u=c.filter,p=n(136);e.exports=(r=n(0),o=n(5),a=n(26),i=n(33),s=n(3),function(e){return function(t,n,c,f,h){var g=e.QuestionTypeBasic(t,n,c,f,h);function v(e){return l(e.groups||[],function(e){return e.elements||[]})}function m(e){return[].concat.apply([],v(e))}function w(e){return l(m(e),function(e){return[e]})}function b(e){if("Word"===e.Type)return r(document.createElement("div")).text(e.word);if("Image"===e.Type)return i.create({img:e.image});if("Audio"===e.Type){var t=r(document.createElement("div")).addClass("bw-button audiobutton toolbutton").append(r(document.createElement("div")).addClass("bw-icon-large bw-icon-music-play-2")),n=s.addElement(e.audio,"body");return t.tapOrClick(n.toggle.bind(n))}return r()}return g.getCheckInput=function(){var e=this.divs.answerdiv;return l(e.find(".ge-box"),function(e){return l(r(e).find(".ge-element"),function(e){return JSON.parse(r(e).attr("element"))})})},g.check=function(){if(this.hasOwnProperty("questionconfig")){var t=this.questionconfig,n=this.getCheckInput(),a=o.check.Group(t,n),i=this.question.find(".ge-box"),s=0;i.each(function(){var t=r(this),n=a.answerCorrectness[s++];0===n||-1===n?(e.clearTag(t,"ge-correct"),e.setTag(t,"ge-wrong")):1===n?(e.setTag(t,"ge-correct"),e.clearTag(t,"ge-wrong")):(e.clearTag(t,"ge-correct"),e.clearTag(t,"ge-wrong"))})}},g.makeElementsDraggable=function(){var e,t,n=this,o=this.question.attr("id"),a={},i={},s=f.getScrollObject()[0],l=f.getScrollObject()[0],d=this.divs.answerdiv;d.find(".ge-element").draggable({scope:o,helper:"clone",appendTo:n.divs.answerdiv,start:function(n,o){r(this).addClass("drag_placeholder"),a={top:r(l).offset().top+50,bottom:r(l).offset().top+r(l).height()-50,left:r(s).offset().left+50,right:r(s).offset().left+r(s).width()-50,scrollTop:l.scrollTop},e=!1,t=!0},drag:function(n,o){var c=r(".ui-draggable-dragging");function d(){c.setTranslate(0,l.scrollTop-a.scrollTop)}i.up=a.top-n.clientY,i.down=n.clientY-a.bottom,i.left=a.left-n.clientX,i.right=n.clientX-a.right,(i.up>0||i.down>0||i.left>0||i.right>0)&&!e?(function e(t){i.down>0&&(l.scrollTop=l.scrollTop+(i.down>>1)),i.up>0&&(l.scrollTop=l.scrollTop-(i.up>>1)),i.left>0&&(s.scrollLeft=s.scrollLeft-(i.left>>1)),i.right>0&&(s.scrollLeft=s.scrollLeft+(i.right>>1)),(i.up>0||i.down>0||i.left>0||i.right>0)&&t()&&setTimeout(e.bind(null,t),100)}(function(){return d(),t}),e=!0):(d(),e=!1)},stop:function(o,a){var i=r(a.helper.context);i.parent().find(".ge-element").length>1&&!a.helper.data("dropped")&&(n.makeBox().append(i).appendTo(d),n.check());var s=r(this);e=!1,t=!1,s.removeClass("drag_placeholder"),s.css("position","relative"),s.offset(r(a.helper).offset()),s.animate({top:0,left:0},function(){null!=c&&c()})}})},g.makeBox=function(){var t=this,n=this.question.attr("id");return r(document.createElement("div")).addClass("ge-box").append(e.createCorrectWrongMarker()).droppable({drop:function(e,n){n.helper.data("dropped",!0);var o=r(n.draggable),a=o.parent(),i=r(this);o.appendTo(i),0===a.find(".ge-element").length&&a.remove(),t.check()},tolerance:"intersect",scope:n,hoverClass:"ge-hover"})},g.setGroups=function(e){var t=this,n=this.divs.answerdiv;n.empty(),d(e,function(e){var r=t.makeBox().appendTo(n);d(e,function(e){b(e).addClass("ge-element").attr("element",JSON.stringify(e)).appendTo(r)})}),this.makeElementsDraggable(n)},g.renderTypeSpecificPart=function(){this.setGroups(a.shuffleArray(w(this.data)))},g.save=function(){var e=this.getCheckInput();return JSON.stringify({answers:e})},g.sanitize=function(e){var t=l(m(this.data),function(e){return p(e)}),n=u(l(e,function(e){return u(e,function(e){var n=t.indexOf(p(e));return-1!==n&&(t.splice(n,1),!0)})}),function(e){return e.length>0});return d(t,function(e){n.push([JSON.parse(e)])}),n},g.load=function(e){this.clear();try{var t=JSON.parse(e).answers;this.setGroups(this.sanitize(t))}catch(e){console.error("Could not load groups",e)}this.check()},g.loadCorrect=function(e){this.setGroups(v(e))},g.clear=function(){this.setGroups(a.shuffleArray(w(this.data)))},g.setReadOnly=function(e){this.divs.answerdiv.find(".ge-element").draggable(e?"disable":"enable")},g.prepareCorrection=function(t){this.questionconfig={groups:t.groups||[],policy:t.policy,"scoring-weight":t["scoring-weight"]},this.check();var n=r(document.createElement("div")).addClass("the-answer").text(e.translate("The answer:")).append(document.createElement("br")).append(document.createElement("br")).append(function(e){var t=r(document.createElement("div"));return d(v(e),function(e){var n=r(document.createElement("div")).addClass("ge-box").appendTo(t);d(e,function(e){b(e).addClass("ge-element").appendTo(n)})}),t}(t)).append(document.createElement("br")).append(document.createElement("br"));return e.createRationale(t,this.divs.rationalediv,n),{extrarationale:n.html()}},g.getAnswer=function(e,t,n){var r=this.question.find(f.MH).html(),a=this.getCheckInput(),i=o.check.Group(t,a);return{question:r,answer:a,check_input:a,correctness:i.correctness,score:i.score,outof:i.outof}},g}})},function(e,t,n){e.exports=function(e){"use strict";return function(t,n){return{AudioRecording:n.wrapTypeConstructor(e(n),t,!0)}}}(n(399))},function(e,t,n){e.exports=function(e,t,n,r){"use strict";return function(o){return function(a,i,s,c){var l=o.QuestionTypeBasic(a,i,s,c);return l.check=function(){},l.renderTypeSpecificPart=function(){var e=this;this.divs.answerdiv.addClass("audiorecorder"),this.recorder=t(this.divs.answerdiv,function(t){e.recorded=t.uri,e.mimetype=t.mimetype,s&&s()})},l.save=function(){return this.recorded?{url:this.recorded,mimetype:this.mimetype}:null},l.load=function(e){try{this.recorder.setDataURIToLoad(e.url,e.mimetype),this.recorded=e.url,this.mimetype=e.mimetype}catch(t){return console.error("Could not load audiorecording question data",e),void console.error(t)}},l.preprocessSaveData=function(t,o){var a=this,i=e.Deferred(),s=this.question.attr("savedresource");return s&&""!==s&&(t.clearImage(s),this.question.attr("savedresource",null)),t.registerImage(o.url).done(function(e){a.question.attr("savedresource",e);var t={url:e,mimetype:o.mimetype};i.resolve(JSON.stringify(t))}).fail(function(){r.showAlert(n("Could not store picture"),n("Error using picture"))}),i},l.preprocessLoadData=function(t,n){var r=this,o=JSON.parse(n),a=e.Deferred(),i=o.url,s=o.mimetype;return t.getImageUrl(o.url).then(function(e){r.question.attr("savedresource",i),a.resolve(r.question[0],{url:e,mimetype:s})},function(){console.log("Could not get image url for",o),a.reject()}),a},l.freeResources=function(t){var n=e.Deferred(),r=this.question.attr("savedresource");return r&&""!==r?(t.clearImage(r).then(function(){n.resolve()},function(){n.reject()}),this.question.attr("savedresource",null)):n.resolve(),n},l.loadCorrect=function(){this.recorder.clear(),this.recorded=null,this.mimetype=""},l.clear=function(){this.recorder.clear(),this.recorded=null,this.mimetype=""},l.setReadOnly=function(e){this.recorder.setReadOnly(e)},l.fetchAsset=function(){this.url=null;var e=this.recorded,t=this.mimetype;return e?{data:e,mimetype:t}:void 0},l.assetUploadCompleteCB=function(e){this.url=e},l.getAnswer=function(e){var t=this.question.find(c.MH).html(),n=parseFloat(this.data["scoring-weight"]);return{question:t,answer:this.url||"",correctness:this.recorded?-2:-1,score:0,outof:n}},l}}}(n(0),n(400),n(7),n(9))},function(e,t,n){n(401);var r=n(402),o="<circle cx='25' cy='25' r='15' />",a="<line x1='13' y1='13' x2='37' y2='37' /><line x1='13' y1='37' x2='37' y2='13' />",i="<polygon points='10,10 40,25 10,40'/>",s="<rect x='13' y='13' width='24' height='24'/>",c="<rect x='10' y='10' width='11' height='30'/><rect x='29' y='10' width='11' height='30'/>";function l(e){return'<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" version="1.1">'+e+"</svg>"}e.exports=function(e,t,n,d,u,p,f,h,g){"use strict";var v,m,w=null;return"ibw-platform-ipad-bookwidgets"===n.getPlatform()&&n.supportsAppFeature("audiorecording")?v=!0:(console.log("Using native recording"),v=!1),function(n,b){console.log("Initialising bwAudioRecorder "),v&&null==m&&(console.log("Using audio bridge"),m=d(),console.log("creating bridge"));var y=g(document.createElement("div")).addClass("bw-audio-recorder").attr("state","stopped").appendTo(n),k=g(document.createElement("div")).addClass("bw-audio-recorder-button bw-audio-record").append(l(o)).makeButton(t("record")).appendTo(y),C=g(document.createElement("div")).addClass("bw-audio-record-not-supported").append(l(a)).appendTo(k),T=g(document.createElement("div")).addClass("bw-audio-recorder-button bw-audio-play").append(l(i)).makeButton(t("play")).appendTo(y),x=g(document.createElement("div")).addClass("bw-audio-recorder-button bw-audio-pause").append(l(c)).makeButton(t("pause")).appendTo(y),_=g(document.createElement("div")).addClass("bw-audio-recorder-button bw-audio-stop").append(l(s)).makeButton(t("stop")).appendTo(y),S=g(document.createElement("div")).addClass("bw-audio-recorder-time bw-audio-recorder-playtime").html("__:__").appendTo(y);g("<span> / </span>").addClass("bw-audio-recorder-time  bw-audio-recorder-slash").appendTo(y);var I=g(document.createElement("div")).addClass("bw-audio-recorder-time bw-audio-recorder-recordedtime").html("__:__").appendTo(y);g(document.createElement("div")).addClass("bw-encoding-msg").appendTo(y),C.tapOrClick(function(){var n=t("This environment does not support audio recording. To record use a browser with audio recording support (e.g. Chrome, Firefox)."),r=y.attr("errormsg");r&&(n=t("Could not start audio recording. ")+r),e.showAlert(n,t("Recording not supported"))}),console.log("Creating player");var O=v?f(m.execute.bind(m)):p({parent:n});function A(e,t){O.setAudioData(e,t),e&&y.addClass("play-initialized")}var E=0,q=null,P=null,D="";function R(){var e=E%60,t=parseInt(E/60);(e+="").length<2&&(e="0"+e),(t+="").length<2&&(t="0"+t),I.html(t+":"+e)}function N(){++E,R()}function M(){q=setInterval(N,1e3)}function L(){clearInterval(q),q=null}var B=0,W=null;function F(){var e=B%60,t=parseInt(B/60);(e+="").length<2&&(e="0"+e),(t+="").length<2&&(t="0"+t),S.html(t+":"+e)}function U(){++B,F()}function z(){W||(W=setInterval(U,1e3))}function j(){clearInterval(W),W=null}k.tapOrClick(function(){var e=y.attr("state");"inactive"!==e&&(y.addClass("active"),"stopped"===e?w.start():"recording_paused"===e&&w.resume())}),x.tapOrClick(function(){var e=y.attr("state");"inactive"!==e&&("recording"===e?w.pause():"playing"===e&&O.pause())}),T.click(function(){var e=y.attr("state");"inactive"!==e&&("stopped"===e&&y.hasClass("play-initialized")?(B=0,F(),O.play()):"playing_paused"===e&&O.resume())}),_.tapOrClick(function(){var e=y.attr("state");"inactive"!==e&&("recording"===e||"recording_paused"===e?w.stop():"playing"!==e&&"playing_paused"!==e||(O.stop(),y.attr("state","stopped"),y.removeClass("active"),j(),B=0,F()))});try{if(!w){var Q={monitorGain:0,numberOfChannels:1,bitRate:16e3,encoderSampleRate:48e3,workerDir:h.getRoot()+"/external/web-audio-recorder/WebAudioRecorderMp3.min.js"};v?(console.log("Using bridge recorder"),w=new r(Q,m.execute.bind(m))):(console.log("Using normal recorder"),w=u(Q))}P&&A(P,D),w.addEventListener("start",function(e){y.hasClass("active")?(E=0,R(),y.attr("state","recording"),M()):y.attr("state","inactive")}),w.addEventListener("stop",function(e){if(y.hasClass("active")){var t=e.detail;null!=t&&y.find(".bw-encoding-msg").text(t.msg),y.attr("state","encoding"),L()}}),w.addEventListener("pause",function(e){y.hasClass("active")&&(y.attr("state","recording_paused"),L())}),w.addEventListener("resume",function(e){y.hasClass("active")&&(y.attr("state","recording"),M())}),w.addEventListener("streamError",function(e){console.error("Error encountered: "),console.error(e),y.addClass("recording-not-supported"),e&&e.error&&(e.error.message||e.error.name)&&y.attr("errormsg",e.error.message||e.error.name)}),w.addEventListener("dataAvailable",function(e){if("inactive"!==y.attr("state")){console.log("dataAvailable event handler");var t=e.detail;if(y.attr("state","stopped"),t.hasOwnProperty("blob")){A((window.URL||window.webkitURL).createObjectURL(t.blob),t.mimetype);var n=new FileReader;n.onload=function(){b({uri:n.result,mimetype:t.mimetype})},n.onerror=function(){console.log("An error occured while reading datablob")},b&&n.readAsDataURL(t.blob)}else t.hasOwnProperty("uri")&&(A(t.uri,t.mimetype),b({uri:t.uri,mimetype:t.mimetype}));y.removeClass("active"),setTimeout(function(){w.initStream()})}}),w.addEventListener("streamReady",function(e){console.log("streamReady received"),y.addClass("recorder-initialized"),"inactive"===y.attr("state")&&y.attr("state","stopped")}),w.initStream()}catch(e){console.error("Got error initializing recorder... recording not supported"),console.error(e),y.addClass("recording-not-supported")}return O.addEventListener("play",function(e){y.attr("state","playing"),z()}),O.addEventListener("durationchange",function(e){"stopped"===y.attr("state")&&(E=O.getDuration(),R())}),O.addEventListener("ended",function(e){y.attr("state","stopped"),j(),B=0,F(),y.removeClass("active")}),O.addEventListener("pause",function(e){y.attr("state","playing_paused"),j()}),O.addEventListener("playing",function(e){y.attr("state","playing"),z()}),{setDataURIToLoad:function(e,t){console.log("setDataURIToLoad"),e&&(D=t,A(P=e,t))},clear:function(){y.removeClass("play-initialized"),"recording"===y.attr("state")&&w.stop(),O.clear(),I.html("__:__"),S.html("__:__")},setReadOnly:function(e){y.toggleClass("readonly")}}}}(n(9),n(7),n(2),n(403),n(404),n(406),n(407),n(34),n(0))},function(e,t,n){},function(e,t,n){(function(n){var r;function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(n){"use strict";var o=function(e,t){this.state="inactive",this.eventTarget=n.document.createDocumentFragment(),this.sendBridgeCommand=t,this.config=e=e||{},this.config.command="init"};o.prototype.addEventListener=function(e,t,n){this.eventTarget.addEventListener(e,t,n)},o.prototype.initStream=function(){var e=this;this.sendBridgeCommand("init",function(){e.state="initialized",e.eventTarget.dispatchEvent(new n.Event("streamReady"))},function(t){e.eventTarget.dispatchEvent(new n.ErrorEvent("streamError",{error:t}))})},o.prototype.pause=function(){var e=this;"recording"===this.state&&(this.state="paused",this.sendBridgeCommand("pause",function(){e.eventTarget.dispatchEvent(new n.Event("pause"))}))},o.prototype.removeEventListener=function(e,t,n){this.eventTarget.removeEventListener(e,t,n)},o.prototype.resume=function(){var e=this;"paused"===this.state&&(this.state="recording",this.sendBridgeCommand("resume",function(){e.eventTarget.dispatchEvent(new n.Event("pause"))}))},o.prototype.start=function(){if("initialized"===this.state){var e=this;this.state="recording",this.sendBridgeCommand("start",function(){e.eventTarget.dispatchEvent(new n.Event("start"))},function(t){e.eventTarget.dispatchEvent(new n.Event("streamError"),{error:t})})}},o.prototype.stop=function(){if("inactive"!==this.state&&"encoding"!==this.state){var e=this;this.state="encoding",this.sendBridgeCommand("stop",function(t){e.eventTarget.dispatchEvent(new n.Event("stop"));var r=function(e){for(var t=atob(e),n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return new Blob([n],{type:"audio/mp4"})}(getRecordedAudio()),o=new FileReader;o.onload=function(){e.state="inactive",e.eventTarget.dispatchEvent(new n.CustomEvent("dataAvailable",{detail:{uri:o.result,mimetype:"audio/mp4"}}))},o.onerror=function(t){console.log("An error occured while reading datablob"),e.state="inactive",e.eventTarget.dispatchEvent(new n.ErrorEvent("streamError",{error:t}))},o.readAsDataURL(r)})}},n.BridgeRecorder=o,void 0===(r=function(){return o}.apply(t,[]))||(e.exports=r)}("object"===("undefined"==typeof self?"undefined":o(self))&&self.self===self&&self||"object"===(void 0===n?"undefined":o(n))&&n.global===n&&n||this)}).call(this,n(54))},function(e,t,n){var r=n(88);e.exports=function(e){"use strict";var t=new(n(64));t.startListening();return function(e){e=e||function(e){var t=document.createElement("IFRAME");t.setAttribute("src",e),t.setAttribute("height","1px"),t.setAttribute("width","1px"),document.documentElement.appendChild(t),t.parentNode.removeChild(t)};var n={resultForCallback:function(e,n){t.processCallback(e,n)},runningInIframe:function(){try{return window.self!==window.top}catch(e){return!0}},callObjC:function(o,a,i,s){var c=r.url(o,a),l=t.registerCallbacks(i,s),d="'"+l.ok+"'",u="'"+l.error+"'",p="AudioBridge.resultForCallback";n.runningInIframe()&&(p="function AudioBridge_callback_wrapper(callbackID, arg) { window.postMessage({ 'command': callbackID, 'arg': arg, 'to': '_widget' }, '*'); }; AudioBridge_callback_wrapper"),e(c+"&okCallbackId="+d+"&errorCallbackId="+u+"&callbackFunc="+p)},execute:function(e,t,r){n.callObjC("audioRecording",{command:e},t,r)},initialize:function(){console.log("Initializing AudioBridge"),this.execute("initBridge",function(){console.log("AudioBridge initialized")},function(){console.log("AudioBridge initialization failed")})}};return n.initialize(),window.AudioBridge=n,n}}()},function(e,t,n){n(405);var r=window.AudioContext||window.webkitAudioContext;e.exports=function(e){return{callbacks:{start:[],stop:[],pause:[],resume:[],streamReady:[],streamError:[],dataAvailable:[],progress:[]},start:function(){var t=this;navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(n){t.audioContext=new r,t.audioContext?(t.gumStream=n,t.input=t.audioContext.createMediaStreamSource(t.gumStream),t.recorder=new WebAudioRecorder(t.input,{workerDir:e.workerDir,encoding:"mp3",numChannels:2,onEncoderLoading:function(e,t){console.log("Loading "+t+" encoder...")},onEncoderLoaded:function(e,t){console.log(t+" encoder loaded")}}),t.recorder.onComplete=function(e,n){t.executeCallbacks("dataAvailable",{detail:{blob:n,mimetype:"audio/mpeg"}}),t.state="done"},t.callbacks.progress.length>0&&(t.recorder.onEncodingProgress=function(e,t){console.log("Progress: ",t),this.executeCallbacks("progress",t)}),t.recorder.setOptions({timeLimit:600,encodeAfterRecord:!0,mp3:{bitRate:160}}),delete t.audioelem,t.recorder.startRecording(),t.executeCallbacks("start")):t.executeCallbacks("streamError","ERROR")}).catch(function(e){console.error("Could not get input for recording"),console.error(e),t.executeCallbacks("streamError",e)})},resume:function(){this.recorder.resume(),this.executeCallbacks("resume")},pause:function(){this.recorder.pause(),this.executeCallbacks("pause")},stop:function(){this.gumStream.getAudioTracks()[0].stop(),this.recorder&&this.recorder.finishRecording(),this.executeCallbacks("stop",{detail:{msg:"Encoding using LAME"}})},initStream:function(){var e=this;"initialized"!==this.state&&(this.state="initialized",null!=r&&null!=navigator.mediaDevices?setTimeout(function(){e.executeCallbacks("streamReady")}):setTimeout(function(){e.executeCallbacks("streamError","ERROR")}))},addEventListener:function(e,t){this.callbacks[e].push(t)},executeCallbacks:function(){for(var e=arguments[0],t=[],n=1;n<arguments.length;++n)t.push(arguments[n]);for(var r=0;r<this.callbacks[e].length;++r)this.callbacks[e][r].apply(null,t)}}}},,function(e,t,n){var r=n(0);e.exports=function(e){var t=r(document.createElement("audio")).addClass("bw-audio-recorder-player no-audio-wrap").attr("controls","false").appendTo(e.parent);return{player:t,setAudioData:function(e,n){e&&t.attr({url:e,type:n,src:null})},pause:function(){t[0].pause()},resume:function(){t[0].play()},play:function(){t.attr("src",t.attr("url")),t[0].play()},stop:function(){t.attr("src",null)},getDuration:function(){return parseInt(t[0].duration)},clear:function(){t.attr({url:"",src:"",type:""})},addEventListener:function(e,n){t[0].addEventListener(e,n)}}}},function(e,t,n){var r=0,o=n(0);e.exports=function(e){var t={play:[],durationchange:[],ended:[],pause:[],playing:[]},n=null,a=0,i=null;function s(){for(var e=arguments[0],n=[],r=1;r<arguments.length;++r)n.push(arguments[r]);for(var o=0;o<t[e].length;++o)t[e][o].apply(null,n)}function c(t,r){var a,i,c=o.Deferred();return a=function(e){null!=r&&s(r),c.resolve(e)},i=function(){console.error("Error player command ",t,n),c.reject()},e("player/"+[t,n].join("/"),a,i),c}function l(){i=null,c("playing",null).then(function(e){"true"!==e.playing?s("ended"):i=setTimeout(l,1e3)})}function d(){i=setTimeout(l,1e3)}function u(){i&&(clearTimeout(i),i=0)}return n=++r+"",{setAudioData:function(e,t){null!=n&&setPlayerData(n,e)},pause:function(){c("pause","pause").then(u)},resume:function(){c("resume","playing").then(d)},play:function(){c("play","play").then(function(e){d(),a=parseInt(e.duration),s("durationChanged")})},stop:function(){c("stop","ended").then(u)},clear:function(){a=0,u(),c("clear")},getDuration:function(){return a},addEventListener:function(e,n){t[e].push(n)}}}},function(e,t,n){var r,o,a,i,s,c,l,d,u,p,f,h,g,v,m,w,b,y,k,C,T=n(409).mergeSecureConfig;e.exports=(r=n(1),n(145),o=n(140).o,a=n(410),i=n(4),s=n(412),c=n(34),l=n(413),d=n(0),u=n(9),p=n(7),f=n(61),h=n(11),g=n(63),v=n(6),m=n(85),w=n(3),b=n(414),y=n(415),k=n(416),C=n(2),function(e,t,n){var x=r.getConfigSync();d(function(){function _(){for(var e in t.questionIf)t.questionIf[e].repaint&&t.questionIf[e].repaint()}function S(){"yes"==x.submit_answers?d("#sendbutton").show():"yes"==x.show_answers?d("#checkbutton").show():"Score only"!=x.show_score&&"Score vs maximum"!=x.show_score||(t.localize("#submit-button","Submit"),d("#checkbutton").show())}function I(){return"yes"==x.submit_answers&&"yes"==x.examination_mode}d(".quizwidget").on("resized",function(){c.centerTitle(!0),function(){for(var e in t.questionIf)t.questionIf[e].onResize&&t.questionIf[e].onResize()}(),_()}),t.addImageLoadedCallback(_),t.localize("#refresh-button","Clear answers and start over"),t.localize("#wrongpwd","Wrong password..."),t.localize("#start_code_label","Password"),t.localize("#startcode-dialog .ui-btn-text","OK"),S(),"yes"===x.color_correct_answers&&d("#question-content").addClass("color-correct-answers"),"Scientific"===x.provide_calculator&&d("#calcbutton").show();var O=!1;function A(){s.reset(),s.start(),o.write({"start_time.number":s.getStartTime()})}function E(e){d("body").removeClass("pwd-mode"),_(),d("#startcode-dialog").dialog("close"),d("#startcode-dialog").hide(),!1===t.checkMode&&I()&&s.isInitialized()&&(null!=s.getStartTime()?s.start():A()),O=!1}function q(e){if(""==x.startup_password)d("#startcode-dialog").hide();else{if(O=!0,d("body").addClass("pwd-mode"),d("#startcode-dialog").dialog({dialogClass:"bw-dialog no-close start-code-dlg",width:350,title:t.translate("Please enter password"),buttons:[{text:t.translate("OK"),click:function(){d("#startcode-dialog #start_code").val()==x.startup_password?(o.write({"startup_password_entered.text":x.startup_password}),E(d(this))):d("#wrongpwd").show("fast").delay(1e3).hide("fast")}}]}),"Always"==x.require_password)return;console.log("Reading startup pwd");var n="startup_password_entered.text";e.hasOwnProperty(n)&&e[n]==x.startup_password&&(console.log("Startup password value OK"),E(d(this)))}}var P=null,D=null;function R(){return null!=P||x.hasOwnProperty("sec")}function N(){if(null!=D)return D;var e=x.questions,t=null!=P?P:null!=x.sec?x.sec:null;if(t)try{var n=JSON.parse(t);n.hasOwnProperty("questions")&&(e=T(x.questions,n.questions))}catch(e){console.log("Could not parse sec piece"),console.log(e)}return D=e,e}function M(){R()||console.log("Can't set question scores, no correction info available");var e=N(),t=0;d("#question-content .content").each(function(){var r=d(this);if("true"!==r.attr("noquestion")){var o=r.attr("question-type"),a=parseInt(r.attr("cindex")),i=e[a];try{var s=n.questionTypes[o].getAnswer(this,!0,i),c=function(e){if(e.correctness.constructor===Array){for(var t=0;t<e.correctness.length;++t)if(-2===e.correctness[t])return!0;return!1}return-2===e.correctness}(s)?"_":s.score;r.find(".scored-points").html(c),t+=parseFloat(s.score)||0}catch(e){console.error("Could not get answer for question: ",a),console.error(e)}}}),d(".submitpage .question-points .scored-points").html(t)}function L(e){var r=N(),o=e.attr("question-type"),a=parseInt(e.attr("cindex")),i=r[a];try{var s=n.questionTypes[o].getAnswer(e,!0,i);return t.getStateFromAnswer(s)}catch(e){return console.error("Could not get answer for question: ",a),console.error(e),{answered:!1,correct:!1,wrong:!1,manual:!1,allunanswered:!1,score:0,outof:0}}}e.setGetQuestionState&&e.setGetQuestionState(L);var B=new function(){var e=b(),n={},r=!1;this.clear=function(){n={},e.restart()},this.init=function(){d("#question-content .content").each(function(){var e=d(this);"true"!==e.attr("noquestion")&&(n[e.attr("cindex")]={state:null,logger:null})})},this.setLoadedAnswersState=function(){var e=this;d("#question-content .content").each(function(){"true"!==d(this).attr("noquestion")&&e.questionChanged(this,!0)}),this.setProgress(!1)},this.disable=function(){r=!1},this.enable=function(){r=!0},this.questionChanged=function(t,o){if(r){var a=d(t),i=a.attr("cindex"),s=L(a);n[i].state=s,s.answered&&!s.manual&&(null===n[i].logger?(n[i].logger=e.registerBinary(i,i,"passFail",s.correct),o||this.setProgress(!1)):(n[i].logger.update(s.correct),o||this.setProgress(!1)))}},this.setFinalQuestionState=function(t){var r=d(t),o=r.attr("cindex");if(null===n[o].state||!n[o].state.answered){n[o].logger=e.registerBinary(o,o,"passFail",!1);var a=L(r);n[o].state=a}};var o=null,a=null,i=null;this.setProgress=function(t){var r=0,o=0;for(var a in n)n.hasOwnProperty(a)&&(++r,n[a].state&&n[a].state.answered&&++o);e.setProgress(t?r:o,r)},this.setScore=function(){var r=0,s=0,c=0,l=0,d=0;for(var u in n)n.hasOwnProperty(u)?(r+=n[u].state.score,s+=n[u].state.outof,n[u].state.correct&&++c,n[u].state.wrong&&++l,n[u].state.allunanswered&&++d):++d;e.registerScore("score",t.translate("Score"),s,r,!0),a?a.update(c):a=e.registerQuantity("correctcount",p("Correct answers"),c),o?o.update(l):o=e.registerQuantity("wrongcount",p("Wrong answers"),l),i?i.update(d):i=e.registerQuantity("unansweredcount",p("Unanswered"),d)},this.setDone=function(e){var t=this;d("#question-content .content").each(function(){"true"!==d(this).attr("noquestion")&&t.setFinalQuestionState(this)}),this.setProgress(!0),e&&this.setScore()}};function W(){for(var e in console.log("switchToEditMode"),t.checkMode=!1,o.write({"mode.quizmode":"entry"}),d("#question-content").removeClass("readonly-mode check-mode").addClass("entry-mode"),t.hideRationales(d("#question-content")),t.questionIf)t.questionIf[e].setReadOnly&&t.questionIf[e].setReadOnly(!1);d("#editbutton").unbind("click").hide(),S(),d("#question-content .content").each(function(){var e=d(this);"true"!==e.attr("noquestion")&&e.find(".scored-points").html("&nbsp;&nbsp;")}),c.centerTitle(!0)}function F(){if(R())for(var t=N(),r=0;r<e.questionCount();++r){var o=d("#question-content .content[cindex='"+r+"']");if(0!==o.length){var a=o.attr("question-type");if(n.questionTypes[a].prepareCorrection)try{n.questionTypes[a].prepareCorrection(o,t[parseInt(o.attr("cindex"))])}catch(e){console.error("Could not prepare correction for question: ",r),console.error(e)}}else console.error("Could not find question")}else console.log("Can't show correction, no correction info available")}function U(){var e=N(),t=0,r=0;return d("#question-content .content").each(function(){var o=d(this);if("true"!==o.attr("noquestion")){var a=o.attr("question-type"),i=parseInt(o.attr("cindex")),s=e[i];try{var c=n.questionTypes[a].getAnswer(this,!0,s);t+=parseFloat(c.score)||0,r+=parseFloat(c.outof)||0}catch(e){console.error("Could not get answer for question: ",i),console.error(e)}}}),{score:t,max:r}}function z(){return"Score only"===x.show_score||"Score vs maximum"===x.show_score}function j(){return x.feedback&&x.feedback.length>0}function Q(e){if(!j())return null;try{x.feedback.sort(function(e,t){return parseFloat(e.percentage)-parseFloat(t.percentage)});for(var t=100*parseFloat(e.score)/e.max,n=0;n<x.feedback.length;++n)if(t<=parseFloat(x.feedback[n].percentage))return x.feedback[n].text}catch(e){console.error("Problem processing feedback"),console.error(e)}return console.log("no feedback msg",e),null}function H(e){v.processRichTextWidgetPlayLinks(e,!1),e.find(".rtlink").each(function(){d(this).css("position","relative"),g(this,d(this).attr("href").replace(/&amp;/g,"&"))}),m.resolveYoutubePlaceholders(e),w.processAudioTags(e)}function J(){var e=function(){var e=U(),n="",r="";z()&&(r=t.translate("Score"),n='<span class="scoretext">'+t.translate("Your score is")+"</span><br><br>",n+='<span class="score">',n+=e.score,"Score vs maximum"===x.show_score&&(n+=" / "+e.max),n+="</span><br>");var o=Q(e);return null!=o&&(r=t.translate("Feedback"),n+="<br><div>"+o+"</div>"),{title:r,message:n}}();H(u.showAlert(e.message,e.title))}function Y(){(z()||j())&&(""!==x.show_password?J():e.moveToSubmitSection&&e.moveToSubmitSection())}function V(n){for(var r in d("#question-content").removeClass("entry-mode").addClass("readonly-mode"),t.questionIf)t.questionIf[r].setReadOnly&&t.questionIf[r].setReadOnly(!0);if(t.checkMode=!0,(!0===n||"yes"===x.show_answers||z()||j())&&("no"===x.color_correct_answers&&!0===n||"yes"===x.show_answers)&&F(),!0===n||"yes"===x.show_answers){for(var r in d("#question-content").addClass("check-mode"),t.questionIf)if(t.questionIf[r].check)try{t.questionIf[r].check()}catch(e){console.error("Error checking answer for question: ",r),console.error(e)}t.syncDomWithTags(d("#question-content")),t.showRationales(d("#question-content"))}(z()||j())&&M(),(z()||j())&&function(){var e=d(".post-submit").find(".feedback").empty();d(document.createElement("div")).addClass("textdescriptiontitle").text(j()?t.translate("Feedback"):t.translate("Score")).appendTo(e);var n=U();if(z()){var r="Score vs maximum"===x.show_score?n.score+" / "+n.max:n.score;d(document.createElement("p")).html(t.translate("Your score is")+": "+r).appendTo(e)}var o=Q(n);null!=o&&H(d(document.createElement("p")).html(o).appendTo(e))}(),e.moveToStart&&e.moveToStart(),"yes"===x.allow_edit_after_check_or_send&&d("#editbutton").makeButton(p("Switch to edit mode")).click(W).show()}function $(){I()&&s.stop(),o.write({"saved.bool":"true","mode.quizmode":"check"}),"yes"===x.submit_answers&&""!==x.show_password?(d("body").addClass("pwd-mode"),d("#startcode-dialog #start_code").val(""),d("#startcode-dialog").dialog({dialogClass:"bw-dialog no-close view-results-dlg",width:350,title:t.translate("Please enter password"),buttons:[{text:t.translate("OK"),click:function(){d("#startcode-dialog #start_code").val()===x.show_password?(d("body").removeClass("pwd-mode"),_(),d(this).dialog("close"),V(!1)):d("#wrongpwd").show("fast").delay(1e3).hide("fast")}}]})):V(!1)}function K(){"OpenMind"!==x.servertype&&(d("#sendbutton, #checkbutton").hide(),c.centerTitle(!0))}function G(r){for(var o=N(),a=[],i=0,s=0;s<e.questionCount();++s){var c=d("#question-content .content[cindex='"+s+"']");if(0!=c.length){var l="true"!==c.attr("noquestion")||"yes"===x.info_numbering;l&&++i;var u=c.attr("question-type"),p=o[parseInt(c.attr("cindex"))],f=n.questionTypes[u].getAnswer(c,!0,p,r);if(f){f.config=p;var h=t.getNumbering(f.config,i);f.config.number=l?h+"":"";var g=l?h+". ":"";f.hasOwnProperty("report-question")?(f.question=g+f["report-question"],delete f["report-question"]):f.question=g+(f.config.hasOwnProperty("Question")?f.config.Question:f.config.Title),a.push(f)}}else console.log("Could not find question")}return a}function X(e){var t=a.createStudentWorkSubmitter(x.id,x.book_title,x.uuid2,x.WA);return t.setCompanyInfo(x.company_name,x.company_address,x.company_phone,x.company_website),d("#question-content .content").each(function(){if("true"!==d(this).attr("noquestion")){var e=d(this).attr("question-type");n.questionTypes[e].fetchAsset&&n.questionTypes[e].assetUploadCompleteCB&&t.scheduleAssetUpload(n.questionTypes[e].fetchAsset,n.questionTypes[e].assetUploadCompleteCB,this)}}),t.setAnswersComposer(function(){return G(e)}),t.on(t.EVT_AFTER_SEND,function(){void 0!==window.checkScrollPosition&&window.checkScrollPosition()}),t}function Z(){var e=X("yes"===x.email_should_have_grading),t=h.getParameters().submit_url;return e.setEndpoint(t||x.action),e.setIncludeGrading("yes"===x.email_should_have_grading),e.on(e.EVT_SUBMIT_SUCCEEDED,function(){window.gPostResponse=e.getLastServerResponse();var t=e.getLastServerData();(P=t&&t.hasOwnProperty("secureconfig")?t.secureconfig:null)&&(P=JSON.stringify(r.fixResourcePaths(JSON.parse(P))),D=null,console.log("secure config received, storing"),o.write({"secureconfig.json":P})),K(),$(),B.setDone(R()),Y()}),e}function ee(){var e=X(!0===t.checkMode&&"points"===x.download_includes_correction);e.setEndpoint(x.download_action),e.setIncludeGrading(!0===t.checkMode&&"points"===x.download_includes_correction),e.showDownloadDialog(p("Enter your name and click 'Generate' to generate the PDF."))}function te(r){var a=d.Deferred(),i={"saved.bool":!1};return x.save_answers="no",d("#question-content .content").each(function(){var e=d(this);if("true"!==e.attr("noquestion")){var t=e.attr("question-type");i[e.attr("sindex")+"."+t]=null}}),i["mode.quizmode"]="entry",i["start_time.number"]=null,i["question_order_seed.text"]=null,i["secureconfig.json"]=null,P=null,D=null,o.write(i),o.sync(function(){!function(r){B.disable(),d("#question-content .content").each(function(){var e=d(this).attr("question-type");n.questionTypes[e].clear?n.questionTypes[e].clear(this):console.error("No clear function for question type: ",e)}),B.clear(),B.init(),B.enable(),I()&&(r||t.checkMode)&&(console.log("Restart countdown timer"),A()),t.checkMode&&W(),e.moveToStart&&e.moveToStart()}(r),window.BWINITIALIZED=!0,a.resolve()}),a}function ne(e){var t=d.Deferred();return u.showConfirmationDialog(p("The answers will be permanently deleted and cannot be recovered. Are you sure?"),p("Clear the answers and start over?"),function(){var r;console.log("Clearing answers"),window.BWINITIALIZED=!1,(r=[],d("#question-content .content").each(function(){var e=d(this).attr("question-type");n.questionTypes[e].hasOwnProperty("freeResources")&&r.push(n.questionTypes[e].freeResources(this,o))}),d.when.apply(null,r)).always(function(){te(e).then(function(){t.resolve()})})},null,p("Yes, clear"),p("No, keep")),t}function re(e,n){"OpenMind"===x.servertype?function(){var e=l.getLoginData(x.course_id);if(e){var n=Z();n.configureFormField(n.FLD_STUDENT_NAME,!0,!1,e.fullname),n.configureFormField(n.FLD_STUDENT_ID,!1,!1,""),n.configureFormField(n.FLD_STUDENT_EMAIL,!1,!1,""),n.configureFormField(n.FLD_STUDENT_CLASS_ID,!1,!1,""),n.configureFormField(n.FLD_TEACHER_EMAIL,!1,!1,"no_reply@openmind-bookwidgets.appspotmail.com"),x.includeInfoQuestionsWhenSendingToServer=!0,n.addExtraData({accesstoken:e.accesstoken,widget_sequence_number:x.widget_sequence_number}),n.on(n.EVT_SUBMIT_FAILED,function(){var e=t.translate("Unable to send quiz results. Make sure you're connected to the internet.");u.showAlert(e,t.translate("Send Failed"))}),n.showSendDialog()}else u.showAlert("You need to log in to the course before you can send your data! Use the Sign In widget at the start of this book to do so.","Error")}():function(e,n){var r=Z(),a="";I()&&!0===e&&("no"!==x.exam_mode_submit_dialog_clear&&r.addButtonBeforeDefaultButtons(t.translate("Clear answers and start over"),function(){var e=this;ne(!0).then(function(){d(e).dialog("close")})}),a=t.translate("The time allowed for this test has expired.  You can no longer change your answers."),r.addDialogOptions({dialogClass:"no-close bw-dialog bw-student-work-submitter",closeOnEscape:!1})),r.on(r.EVT_BEFORE_SEND,function(){I()&&(s.stop(),o.write({"start_time.number":0}),r.setElapsedTime(s.elapsedFormatted()))}),r.on(r.EVT_SUBMIT_FAILED,r.afterSubmitFailed.bind(r,t.translate("Quiz results not accepted."),t.translate("Unable to send quiz results. Make sure you're connected to the internet."))),r.showSendDialog(a,n)}(e,n)}function oe(){d("#startcode-dialog #start_pwd").val(""),d("#startcode-dialog").dialog({dialogClass:"bw-dialog answer-keys-dlg",width:350,title:t.translate("Answer keys"),buttons:[{text:t.translate("OK"),click:function(){d("#startcode-dialog #start_pwd").val()===x.answer_keys_password?(d(this).dialog("close"),function(){var e=N();for(var n in t.questionIf)if(t.questionIf[n].loadCorrect){var r=e[parseInt(d("#"+n).attr("cindex"))];try{t.questionIf[n].loadCorrect(r)}catch(e){console.error("Could not load correct answer for question:",n),console.error(e)}}}(),V(!0),_(),d("#downloadbutton").makeButton(p("Download")).show().click(ee)):d("#wrongpwd").show("fast").delay(1e3).hide("fast")}}]})}function ae(e){re(!1,e)}function ie(){function e(){K(),$(),B.setDone(),Y()}""!==x.show_password?(d("body").addClass("pwd-mode"),d("#startcode-dialog").dialog({dialogClass:"bw-dialog no-close",width:350,title:t.translate("Please enter password"),buttons:[{text:t.translate("OK"),click:function(){d("#startcode-dialog #start_code").val()===x.show_password?(d("body").removeClass("pwd-mode"),_(),d(this).dialog("close"),e()):d("#wrongpwd").show("fast").delay(1e3).hide("fast")}},{text:t.translate("Cancel"),click:function(){d("body").removeClass("pwd-mode"),_(),d(this).dialog("close")}}]})):"yes"===x.show_answers?u.showConfirmationDialog(p("Are you done and do you want to show the answers?"),p("Show answers"),e,null,p("Yes"),p("No")):u.showConfirmationDialog(p("Are you done and do you want to show your score?"),p("Show score"),e,null,p("Yes"),p("No"))}""===x.id&&(x.id="Quiz"),d(function(){d("#clearbutton").makeButton(p("Clear and restart")),x.answer_keys_password&&""!==x.answers_keys_password?d("#clearbutton").clickOrHold(ne.bind(null,!1),oe):d("#clearbutton").tapOrClick(ne.bind(null,!1)),d("#sendbutton").makeButton(p("Send")).tapOrClick(function(){ae()}),d("#checkbutton").makeButton(p("Check answers")).tapOrClick(ie)}),"yes"===x.allow_sharing&&d("#sharebutton").makeButton("Share").show().click(function(){var e=X(!1);e.setEndpoint(x.share_action),e.setIncludeGrading(!1),e.on(e.EVT_SUBMIT_FAILED,function(){u.showAlert(t.translate("Unable to send quiz. Make sure you're connected to the internet."),t.translate("Send Failed"))}),e.showShareDialog(t.translate("Share the quiz by email."))}),"yes"===x.allow_download&&d("#downloadbutton").show().makeButton("Download").click(ee),d(".linkbutton").on("touchstart mousedown",function(){d(this).addClass("pressed")}),d(".linkbutton").on("touchend mouseout mouseup",function(){d(this).removeClass("pressed")});var se=!0;function ce(t){if(se?se=!1:window.location.reload(!1),d("#question-content").html(""),q(t),I()&&(x.save_answers="yes"),P=null,D=null,t.hasOwnProperty("secureconfig.json")){console.log("secure config was saved, restoring");try{P=t["secureconfig.json"]}catch(e){console.error("Could not parse secure config")}}e.createQuestions(function(t){function n(t){var n=k(t),r=[],o=[],a=0;function i(e){for(var t=e.length;t;){var r=Math.floor(n()*t),o=e[--t];e[t]=e[r],e[r]=o}return e}for(;a<e.questionCount();)"true"===x.questions[a].noquestion?(o.length>0&&(o=i(o),Array.prototype.push.apply(r,o),o=[]),r.push(a)):o.push(a),++a;return o=i(o),Array.prototype.push.apply(r,o),r}if("yes"===x.random_order){var r="question_order_seed.text";if(t.hasOwnProperty(r))return console.log("found seed"),n(t[r]);console.log("no seed stored");var a=Math.random().toString();return o.write({"question_order_seed.text":a}),n(a)}for(var i=[],s=0;s<e.questionCount();++s)i[s]=s;return i}(t),x.questions,function(e){return function(){!function(e){var t={"saved.bool":"true"},r=d(e),a=r.attr("sindex"),i=r.attr("question-type"),s=r.is(":empty")?r.attr("save_data"):n.questionTypes[i].save(r[0]);if(null!=s){if(n.questionTypes[i].hasOwnProperty("preprocessSaveData"))return void n.questionTypes[i].preprocessSaveData(e,o,s).done(function(e,n){t[e+"."+i]=n,o.write(t)}.bind(null,a+""));t[a+"."+i]=s}else t[a+"."+i]=null;o.write(t)}(e),B.questionChanged(e)}}),B.init(),"yes"===x.color_correct_answers&&F(),d("#big-submit-button").makeButton().click(function(){ae(!0)}),d("#big-check-button").makeButton().click(ie),f.addAllDesignInfo(),y.notifyLoaded(),"yes"===x.save_answers?function(e){function t(){if(I()){var t={timeoutCB:function(){console.log("Timer callback: submitting to server"),re(!0,!1)},time:60*parseInt(x.countdown_time)},n="start_time.number";if(e.hasOwnProperty(n)){var r=e[n];t.starttime=r,s.init(t),!1===O&&s.start()}else s.init(t),!1===O&&A()}}e&&e.hasOwnProperty("saved.bool")&&"true"===e["saved.bool"]?(d("#question-content .content").each(function(){var t=d(this);if("true"!==t.attr("noquestion")){var r=t.attr("question-type"),a=t.attr("sindex")+"."+r;if(e.hasOwnProperty(a)){var i=e[a];if(null!=i)try{n.questionTypes[r].hasOwnProperty("preprocessLoadData")?n.questionTypes[r].preprocessLoadData(this,o,i).done(n.questionTypes[r].load):n.questionTypes[r].load(this,i)}catch(e){console.error("Error: exception loading question of type "+r+" ",e)}}}}),t(),e.hasOwnProperty("mode.quizmode")&&"check"===e["mode.quizmode"]?(K(),$(),B.disable()):(B.enable(),B.setLoadedAnswersState())):(t(),B.enable())}(t):B.enable(),e.postCreateInit(),i.redraw(d(".bwmathquill")),_(),setTimeout(_,250),i.schedule(_),window.BWINITIALIZED=!0}C.isPreview()&&(window.createPostMessage=function(e){"use strict";var t=!1;e&&"undefined"==typeof bwshortcode&&(window.bwshortcode="ABC123",t=!0);var n={answers:G(!0)};return t&&delete window.bwshortcode,JSON.stringify(n)}),c.makeWidget({layout:"title_toolbar_layout",title:""===x.id||"Quiz"===x.id?e.getWidgetType():x.id}),window.BwUseManualWidgetLoadedNotification(),"right-to-left"==x.direction&&(d("body").addClass("right-to-left"),d(".question-content").css("direction","rtl")),e.preLoadInit(),window.addEventListener("message",function e(t){var n=t.data;n.hasOwnProperty("msg")&&"requestlogin"===n.msg&&(y.notifyLoaded(),window.removeEventListener("message",e))}),o.init({type:function(){return"quiz"},group:""==x.book_title?"-":x.book_title,name:x.id,id:x.uuid2,updateCallback:ce,singleKey:!1})})})},function(e,t,n){"use strict";n.r(t),n.d(t,"mergeSecureConfig",function(){return o});var r=n(21);function o(e,t){if(r.isArray(t)){if(0===t.length)return e;for(var n=[],a=0;a<t.length;++a)n.push(o(e[a],t[a]));return n}var i=r.cloneDeep(e);for(var s in t)s.startsWith("_")?i[s.substring(1)]=t[s]:i[s]=o(e[s],t[s]);return i}},function(e,t,n){e.exports=function(e,t,n,r,o,a,i,s){var c=e.getConfigSync(),l=i.getParameters();function d(e){return!e||0===e.length}function u(e){return e.indexOf("bookwidgets.com")>=0||e.indexOf("localhost")>=0?{"Bookwidgets-Platform":n.getPlatform()}:{}}function p(){return l.teacher_id}return{createStudentWorkSubmitter:function(e,f,h,g){var v={FLD_STUDENT_NAME:"#student",FLD_STUDENT_ACCOUNT:"#student_account",FLD_STUDENT_EMAIL:"#student_email",FLD_STUDENT_ID:"#student_id",FLD_STUDENT_CLASS_ID:"#student_class_id",FLD_TEACHER_EMAIL:"#email",FLD_YOUR_NAME:"#you",FLD_YOUR_EMAIL:"#your_email",FLD_TO_EMAIL:"#to_email"},m={};m[v.FLD_STUDENT_NAME]="student_name",m[v.FLD_STUDENT_EMAIL]="student_email",m[v.FLD_STUDENT_ID]="student_id",m[v.FLD_STUDENT_CLASS_ID]="student_class_id",m[v.FLD_TEACHER_EMAIL]="teacher_email",m[v.FLD_YOUR_NAME]="student_name",m[v.FLD_YOUR_EMAIL]="student_email",m[v.FLD_TO_EMAIL]="to_email";var w,b,y,k,C=p();v._postdata={test_name:e,uuid2:h,WA:g,book_title:f,submit_timestamp:(new Date).toISOString(),submit_date:(w=new Date,b=w.getDate(),y=w.getMonth()+1,k=w.getYear(),k<1900&&(k+=1900),(1==y?"January":2==y?"February":3==y?"March":4==y?"April":5==y?"May":6==y?"June":7==y?"July":8==y?"August":9==y?"September":10==y?"October":11==y?"November":"December")+" "+b+", "+k),tzoffset:(new Date).getTimezoneOffset()/60*-1,include_grading:!0,submitted_via_shortcode:window.bwshortcode,answers:[]},"wv"in l&&(v._postdata.wv=l.wv),v._extradata={},v._answersComposer=void 0,v._assetUploadAgenda=[],v._eventCallbacks={},v._lastServerResponse="",v._lastServerData=null,v._leftButtons=[],v._rightButtons=[],v._dialogOptions={},v._endpoint="",v._fieldSettings={},v.setCompanyInfo=function(e,t,n,r){v._postdata.company_name=e,v._postdata.company_address=t,v._postdata.company_phone=n,v._postdata.company_website=r},v.setIncludeGrading=function(e){v._postdata.include_grading=e?"yes":"no"},v.setElapsedTime=function(e){v._postdata.time=e},v.setEndpoint=function(e){v._endpoint=e},v._storeField=function(e,n){var r=v._fieldSettings[e].isVisible,o=v._fieldSettings[e].isEditable;if(r&&o){var a=m[e];t.set(a,n)}},v._setStudentInfo=function(e,n,r,o){v._postdata.student_name=e,v._postdata.student_id=n,v._postdata.student_email=r,v._postdata.student_class_id=o,t.hasStudentAccount()&&(v._postdata.student_userid=t.getStudentAccountUserId(),v._postdata.student_name=t.getStudentAccountUserName(),v._postdata.student_email=t.getStudentAccountEmail(),v._postdata.student_id=t.getStudentAccountProviderHumanId(),v._postdata.student_token=t.getStudentAccountToken());var a=l.context_id;a&&(v._postdata.context_id=a),C&&(v._postdata.teacher_id=C),l.course_id&&(v._postdata.course_id=l.course_id),v._storeField(v.FLD_STUDENT_NAME,e),v._storeField(v.FLD_STUDENT_ID,n),v._storeField(v.FLD_STUDENT_EMAIL,r),v._storeField(v.FLD_STUDENT_CLASS_ID,o)},v._setTeacherEmail=function(e){v._postdata.teacher_email=e,v._storeField(v.FLD_TEACHER_EMAIL,e)},v._setShareInfo=function(e,t,n,r){v._postdata.student_name=e,v._postdata.student_email=t,v._postdata.to_email=n,v._postdata.message=r,v._storeField(v.FLD_YOUR_NAME,e),v._storeField(v.FLD_YOUR_EMAIL,t),v._storeField(v.FLD_TO_EMAIL,n)},v._setDownloadInfo=function(e,t,n,r){v._postdata.student_name=e,v._storeField(v.FLD_YOUR_NAME,e)},v.setAnswersComposer=function(e){v._answersComposer=e},v.addExtraData=function(e){for(var t in e)v._extradata[t]=e[t]},v.scheduleAssetUpload=function(e,t,n){v._assetUploadAgenda.push({assetFetcherCB:e,assetUploadCompleteCB:t,userdata:n})},v.configureFormField=function(e,t,n,r){v._fieldSettings[e]={isVisible:t,isEditable:n,defaultValue:r}},v.configureFormField(v.FLD_STUDENT_ACCOUNT,!0===t.hasStudentAccount(),!1,t.getStudentAccountUserName()||""),v.configureFormField(v.FLD_STUDENT_NAME,!1===t.hasStudentAccount()&&"yes"==c.student_name_isVisible,"yes"==c.student_name_isEditable,c.student_name_defaultValue),v.configureFormField(v.FLD_STUDENT_EMAIL,!1===t.hasStudentAccount()&&"yes"==c.student_email_isVisible,"yes"==c.student_email_isEditable,c.student_email_defaultValue),v.configureFormField(v.FLD_STUDENT_ID,!1===t.hasStudentAccount()&&"yes"==c.student_id_isVisible,"yes"==c.student_id_isEditable,c.student_id_defaultValue);var T=d(l.student_class_id)?d(t.getStudentAccountClassName())?void 0:t.getStudentAccountClassName():l.student_class_id,x="yes"==c.student_class_id_isEditable&&!T;function _(e,t,n,o){var a,i=r(document.createElement("label"));i.attr("for",t),i.attr("id",t+"_label"),i.text(e),o.append(i),"textarea"==n?(a=r(document.createElement("textarea"))).attr("rows",5):((a=r(document.createElement("input"))).attr("type",n),a.attr("onfocus","this.value = this.value;")),a.attr("name",t),a.attr("id",t),a.attr("value",""),o.append(a)}function S(e){return e.split(",").length>1}function I(e,t){var r={content:"",ibw_platform:n.getPlatform()};for(var o in v._extradata)r[o]=v._extradata[o];void 0===v._submitPreparer&&(v._submitPreparer=function(e){e()}),v.showProgressDialog(t),setTimeout(function(){v._submitPreparer(function(){v.uploadAssets(function(){console.log("All assets uploaded, now sending answers"),v.composeAllAnswers(),r.content=JSON.stringify(v._postdata),e(r),v.trigger(v.EVT_AFTER_SEND),console.log("Submit complete")},function(){console.log("Asset upload failed, aborting"),v.closeProgressDialog(),v.trigger(v.EVT_SUBMIT_FAILED),v.trigger(v.EVT_AFTER_SEND)})},function(e){console.log("Aborted by client: "+e),v.closeProgressDialog(),v._lastServerResponse=void 0,v.trigger(v.EVT_SUBMIT_FAILED),v.trigger(v.EVT_AFTER_SEND)})},100)}function O(){I(v.sendResults.bind(v),a("Sending, please wait..."))}function A(){var e=r(this),n=e.find("#student").val(),i=e.find("#student_id").val(),s=e.find("#student_email").val(),c=e.find("#student_class_id").val(),l=e.find("#email").val();if(!1!==t.hasStudentAccount()||""!==n){if(!C){if(""===l)return void o.showAlert(a("This field is required:")+" "+a("Teacher Email"),a("Send Failed"));if(S(l))return void o.showAlert(a("You can't specify multiple addresses for field:")+" "+a("Teacher Email"),a("Send Failed"))}e.dialog("close"),e.remove(),v.trigger(v.EVT_BEFORE_SEND),v._setStudentInfo(n,i,s,c),v._setTeacherEmail(l),O()}else o.showAlert(a("This field is required:")+" "+a("Student Name"),a("Send Failed"))}function E(){var e=r(this),t=e.find("#you").val(),n=e.find("#your_email").val(),i=e.find("#to_email").val(),s=e.find("#message").val();""!==t?""!==i?(e.dialog("close"),e.remove(),v.trigger(v.EVT_BEFORE_SEND),v._setShareInfo(t,n,i,s),O()):o.showAlert(a("This field is required:")+" "+a("To Email"),a("Send Failed")):o.showAlert(a("This field is required:")+" "+a("Your Name"),a("Send Failed"))}function q(){var e=r(this),t=e.find("#you").val();""!==t?(e.dialog("close"),e.remove(),v.trigger(v.EVT_BEFORE_SEND),v._setDownloadInfo(t),I(v.generate.bind(v),a("Generating PDF, please wait..."))):o.showAlert(a("This field is required:")+" "+a("Your Name"),a("Download Failed"))}return v.configureFormField(v.FLD_STUDENT_CLASS_ID,"yes"==c.student_class_id_isVisible,x,d(T)?d(c.student_class_id_defaultValue)?"":c.student_class_id_defaultValue:T),v.configureFormField(v.FLD_TEACHER_EMAIL,"yes"==c.teacher_email_isVisible&&!C,"yes"==c.teacher_email_isEditable,l.teacher_email||c.teacher_email_defaultValue),v.configureFormField(v.FLD_YOUR_NAME,!0,!0,""),v.configureFormField(v.FLD_YOUR_EMAIL,!0,!0,""),v.configureFormField(v.FLD_TO_EMAIL,!0,!0,""),v.addButtonBeforeDefaultButtons=function(e,t){v._leftButtons.push({text:e,click:t})},v.addButtonAfterDefaultButtons=function(e,t){v._rightButtons.push({text:e,click:t})},v.addDialogOptions=function(e){for(var t in e)v._dialogOptions[t]=e[t]},v.setAsyncSubmitPreparer=function(e){v._submitPreparer=e},v.EVT_BEFORE_SHOW="beforeShow",v.EVT_BEFORE_SEND="beforeSend",v.EVT_AFTER_SEND="afterSend",v.EVT_SUBMIT_SUCCEEDED="submitSucceeded",v.EVT_SUBMIT_FAILED="submitFailed",v.on=function(e,t){v._eventCallbacks[e]?v._eventCallbacks[e].push(t):(v._eventCallbacks[e]=[],v._eventCallbacks[e].push(t))},v.trigger=function(e){if(v._eventCallbacks[e])for(var t=0;t<v._eventCallbacks[e].length;++t)v._eventCallbacks[e][t]()},v._applyFormFieldSettings=function(e){if(0!=(u=r(e)).length){var n,o,a,i,s=r(e+"_label"),c=v._fieldSettings[e].isVisible,l=v._fieldSettings[e].isEditable,d=v._fieldSettings[e].defaultValue;S(d)&&(c&&l?(n=e,o=function(e){for(var t=e.split(","),n=[],r=0;r<t.length;++r)n.push(t[r].trim());return n}(d),a=r(n),i=r("<select><option>"+o.join("</option><option>")+"</option></select>").attr({id:a.attr("id"),name:a.attr("name")}),a.replaceWith(i),a.remove()):d=d.split(",")[0]);var u=r(e);if(s=r(e+"_label"),!1===c&&(u.hide(),s.hide()),!1===l&&u.attr("disabled","true"),u.val(d),c&&l){var p=m[e];t.get(p,function(e){null!=e&&""!==e&&u.val(e)})}}},v.showSendDialog=function(e,n){t.initialized().done(function(){if(t.isCoAccount())o.showAlert(a("Submit is disabled because you're not logged in with a student account. e.g. a parent account."),a("Can't submit"));else{var c=function(){r("#student-work-submitter-dialog").remove();var e=r(document.createElement("div"));e.attr("id","student-work-submitter-dialog"),e.css("display","none");var t=r(document.createElement("div"));return t.attr("id","student-work-submitter-dialog-info"),e.append(t),_("","student_account","text",e),_(a("Student Name"),"student","text",e),_(a("Student ID"),"student_id","text",e),_(a("Student Email"),"student_email","email",e),_(a("Class ID"),"student_class_id","text",e),_(a("Teacher Email"),"email","email",e),r("body").append(e),e}(),l=!1;for(var d in v._fieldSettings)v._applyFormFieldSettings(d),l=l||v._fieldSettings[d].isVisible&&v._fieldSettings[d].isEditable&&r(d).length>0;e?(r("#student-work-submitter-dialog-info").html(e),r("#student-work-submitter-dialog-info").removeClass("hidden")):r("#student-work-submitter-dialog-info").addClass("hidden");for(var u=[],p=0;p<v._leftButtons.length;++p)u.push(v._leftButtons[p]);for(u.push({text:a("Send"),click:A}),p=0;p<v._rightButtons.length;++p)u.push(v._rightButtons[p]);var f={dialogClass:"bw-dialog bw-student-work-submitter",modal:!0,title:a("Send Answer"),width:"450px",buttons:u};for(var h in v._dialogOptions)f[h]=v._dialogOptions[h];c.dialog(f);var g=i.getQueryParams(window.location.search).toplevel;l||1!==u.length||!n||!s.isLTI()||g||A.call(c)}})},v.showShareDialog=function(e){console.log("showShare"),t.initialized().done(function(){var t=function(){r("#student-work-share-dialog").remove();var e=r(document.createElement("div"));e.attr("id","student-work-share-dialog"),e.css("display","none");var t=r(document.createElement("div"));return t.attr("id","student-work-share-dialog-info"),e.append(t),_(a("Your Name"),"you","text",e),_(a("Your Email"),"your_email","email",e),_(a("To Email"),"to_email","email",e),_(a("Optional Message"),"message","textarea",e),r("body").append(e),e}();for(var n in v._fieldSettings)v._applyFormFieldSettings(n);e?(r("#student-work-share-dialog-info").html(e),r("#student-work-share-dialog-info").removeClass("hidden")):r("#student-work-share-dialog-info").addClass("hidden");for(var o=[],i=0;i<v._leftButtons.length;++i)o.push(v._leftButtons[i]);for(o.push({text:a("Send"),click:E}),i=0;i<v._rightButtons.length;++i)o.push(v._rightButtons[i]);var s={dialogClass:"bw-dialog bw-student-work-submitter",modal:!0,title:a("Share"),width:"450px",buttons:o};for(var c in v._dialogOptions)s[c]=v._dialogOptions[c];t.dialog(s)})},v.showDownloadDialog=function(e){console.log("showDownload"),t.initialized().done(function(){var t=function(){r("#student-work-download-dialog").remove();var e=r(document.createElement("div"));e.attr("id","student-work-download-dialog"),e.css("display","none");var t=r(document.createElement("div"));return t.attr("id","student-work-download-dialog-info"),e.append(t),_(a("Your Name"),"you","text",e),r("body").append(e),e}();for(var n in v._fieldSettings)v._applyFormFieldSettings(n);e?(r("#student-work-download-dialog-info").html(e+"<br>"),r("#student-work-download-dialog-info").removeClass("hidden")):r("#student-work-download-dialog-info").addClass("hidden");for(var o=[],i=0;i<v._leftButtons.length;++i)o.push(v._leftButtons[i]);for(o.push({text:a("Generate"),click:q}),i=0;i<v._rightButtons.length;++i)o.push(v._rightButtons[i]);var s={dialogClass:"bw-student-work-submitter",modal:!0,title:a("Download as PDF"),width:"450px",buttons:o};for(var c in v._dialogOptions)s[c]=v._dialogOptions[c];t.dialog(s)})},v.showProgressDialog=function(e){(function(){var e="student-work-submitter-progress-dialog";r("#"+e).remove();var t=r(document.createElement("div"));t.attr("id",e),t.css("display","none");var n=r(document.createElement("div"));n.addClass("spinner"),t.append(n);var o=r(document.createElement("div"));return o.addClass("progress-message"),o.text(a("Uploading your answers...")),t.append(o),r("body").append(t),t})().dialog({modal:!0,dialogClass:"no-close bw-dialog",title:e})},v.updateProgressMessage=function(e){r(".progress-message").text(e)},v.closeProgressDialog=function(){r("#student-work-submitter-progress-dialog").remove()},v.uploadAssets=function(e,t){var n=v._assetUploadAgenda,r=null,o=0,i=n.length;(r=function(){if(n.length>0){var s=n.shift(),c=s.assetFetcherCB(s.userdata);++o,c?(v.updateProgressMessage(("audio/mpeg"===c.mimetype?a("Uploading audio"):a("Uploading image"))+" "+o+" / "+i),v.sendAsset(c,function(e){s.assetUploadCompleteCB(e,s.userdata),r()},function(){v._lastServerResponse=void 0,t()})):r()}else v.updateProgressMessage(a("Uploading your answers...")),e()})()},v.sendAssetAjax=function(e,t,n){var o={content:JSON.stringify({is_asset:!0,asset_data:e.data,asset_mimetype:e.mimetype})};for(var a in v._extradata)o[a]=v._extradata[a];r.ajax({type:"POST",headers:u(v._endpoint),url:v._endpoint,data:o,success:function(e){t(e)},error:function(){n()}})},v.genRandomString=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t},v.sendAsset=v.sendAssetAjax,v.composeAllAnswers=function(){v._postdata.answers=v._answersComposer()},v.sendAudioPacket=function(e,t,n,o,a){var i=v._endpoint+".m4a?t="+e+"&d="+t+"&p="+n,s=new Audio;r(s).on("loadedmetadata",function(){var e=Math.floor(10*r(this)[0].duration);o(e)}),r(s).on("error",function(){console.log("Audio package load failure: "+s.error.code),a("Network or server problem")}),s.src=i},v.getPacket=function(e){for(var t=0,n=e.length,r=0,o="",a="";;){var i=n-t;if(0===i)break;var s=e.substr(t,100),c=encodeURIComponent(s),l=c.length;if(r+l>1900){a=e.substr(t);break}t+=i<100?i:100,o+=c,r+=l}return{packet:o,remaining:a}},v.sendAudio=function(e,t,n,r,o){void 0===r&&(r=v.genRandomString(20)),void 0===o&&(o=1);var a,i=v.getPacket(e);""===i.remaining?(a=t,o=0):a=function(e,t,n){return function(a){0===a?v.sendAudio(e,t,n,r,o+1):n("Wrong server response")}}(i.remaining,t,n),v.sendAudioPacket(r,i.packet,o,a,n)},v.sendResultsAudio=function(e){v.sendAudio(JSON.stringify(e),function(e){switch(console.log("sendAudio success handler called"),v.closeProgressDialog(),e){case 0:console.error("Oops, server expected another packet..."),v._lastServerResponse=void 0,v.trigger(v.EVT_SUBMIT_FAILED);break;case 1:console.log("That's a success!"),v.trigger(v.EVT_SUBMIT_SUCCEEDED);break;case 2:console.error("Network or server error"),v._lastServerResponse="NEWUSER",v.trigger(v.EVT_SUBMIT_FAILED);break;case 3:console.error("Network or server error"),v._lastServerResponse="USERNOTACTIVE",v.trigger(v.EVT_SUBMIT_FAILED);break;case 4:console.error("Network or server error"),v._lastServerResponse="INVALIDUSER",v.trigger(v.EVT_SUBMIT_FAILED);break;case 5:console.error("Network or server error"),v._lastServerResponse="STUDENTNOTAUTHORIZED",v.trigger(v.EVT_SUBMIT_FAILED);break;default:console.error("Unexpected server return value"),v._lastServerResponse=void 0,v.trigger(v.EVT_SUBMIT_FAILED)}},function(e){console.error("sendAudio error handler called: "+e),v.closeProgressDialog(),v._lastServerResponse=void 0,v.trigger(v.EVT_SUBMIT_FAILED)})},v.sendResultsAjax=function(e){e.accept_json_response=!0,c.hasOwnProperty("widget_language")&&""!=c.widget_language&&(e.lang=c.widget_language),r.ajax({type:"POST",headers:u(v._endpoint),url:v._endpoint,data:e,success:function(e,t,n){console.log("Submit OK"),v.closeProgressDialog();var r=n.getResponseHeader("Content-Type");switch(v._lastServerResponse=e,v._lastServerMessage=null,v._lastServerData=null,r){case"application/json":e.hasOwnProperty("status")&&"OK"===e.status?(console.log("That's a success!"),v._lastServerData=e.data,v.trigger(v.EVT_SUBMIT_SUCCEEDED)):e.hasOwnProperty("code")?(console.log("That's a failure!",e),v._lastServerResponse=e.code,v._lastServerMessage=e.message,v.trigger(v.EVT_SUBMIT_FAILED)):(console.log("That's a success!"),v.trigger(v.EVT_SUBMIT_SUCCEEDED));break;case"text/html":console.log("That's a success!"),v.trigger(v.EVT_SUBMIT_SUCCEEDED);break;default:"OK"==e?(console.log("That's a success!"),v.trigger(v.EVT_SUBMIT_SUCCEEDED)):(console.log("That's a failure!"),v.trigger(v.EVT_SUBMIT_FAILED))}},error:function(e){console.error("AJAX error handler called");try{var t=JSON.parse(e.responseText);v._lastServerResponse=null,v._lastServerData=null,v._lastServerMessage=t.message}catch(e){console.error("Error msg not json"),v._lastServerResponse=void 0}v.closeProgressDialog(),v.trigger(v.EVT_SUBMIT_FAILED)}})},v.generate=function(e){r.ajax({type:"POST",headers:u(v._endpoint),url:v._endpoint,data:e,success:function(e,t,n){var r,i,s;console.log("AJAX success handler called"),v.closeProgressDialog(),"application/json"==n.getResponseHeader("Content-Type")?(console.log("That's a success!"),v._lastServerResponse=e,r=e.url,i=e.filename,s='<a href="'+r+'" download="'+i+'">'+a("Click here to download your PDF")+"</a>",o.showAlert(s,a("PDF generated"))):(console.log("That's a failure!"),v._lastServerResponse=e,o.showAlert(a("Could not generate PDF.  Please try again later."),a("Generate PDF failed")))},error:function(){console.log("AJAX error handler called"),v.closeProgressDialog(),v._lastServerResponse=void 0,o.showAlert(a("Could not generate PDF.  Please try again later."),a("Generate PDF failed"))}})},v.sendResults="ibw-platform-ipad-ibooks-epub"==n.getPlatform()?v.sendResultsAudio:v.sendResultsAjax,v.getLastServerResponse=function(){return v._lastServerResponse},v.getLastServerMessage=function(){return v._lastServerMessage},v.getLastServerData=function(){return v._lastServerData},v.afterSubmitFailed=function(e,t){var n="",r=this.getLastServerResponse();if(r)if(n=e+"<br><br>","NEWUSER"==r)n+=a("The email address you provided has not been registered.")+"<br><br>",n+=a("To prevent abuse, results can only be sent to registered email addresses.")+" ",n+=a("Activate by clicking on the link in the email which was sent to the address provided.")+" ",n+=a("You can also register at www.bookwidgets.com.")+"<br>";else if("USERNOTACTIVE"==r)n+=a("The email address you provided has not been activated.")+"<br><br>",n+=a("To prevent abuse, results can only be sent to registered email addresses.")+" ",n+=a("Activate by clicking on the link in the email which was sent to the address provided.")+" ",n+=a("You can also register at www.bookwidgets.com.")+"<br>";else{var i;n+=(i=this.getLastServerMessage())?i+"<br>":a("Unknown error")+"<br>"}else(i=this.getLastServerMessage())?n+=i+"<br>":n=t;o.showAlert(n,a("Send Failed"))},v},isTeacherEmailRequired:function(){return!p()}}}(n(1),n(411).o,n(2),n(0),n(9),n(7),n(11),n(62))},function(e,t,n){var r=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n(1),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n(41).o,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n(90).o,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n(161).o,s={},c=e.Deferred();s.initialized=function(){return c};var l=t.getParameters(),d=l.hasOwnProperty("teacher_id")?l.teacher_id:"",u=l.hasOwnProperty("school_id")?l.school_id:"";return r.getConfig().then(function(t){var n="no"!==t.save_answers;function r(e){return"student_name"==e||"student_email"==e||"student_id"==e}var l=null,p=-1;function f(r){if(c.resolve(),r==p)return console.log("Warning: setting identical storage state, ignoring"),e.when();var s=t.book_title&&""!==t.book_title?t.book_title:"_no_name_";switch(r){case o.ANONYMOUS:l=a.createInfoStorage(s,"",n);break;case o.OFFLINE:l=a.createInfoStorage(s,o.getUserId(),n);break;case o.ONLINE:l=i.createInfoStorage(s,d,u)}return p=r,e.when()}s.get=function(e,t){if(p!=o.ANONYMOUS&&o.hasProperty(e))t(o.getProperty(e));else if(n){var a=function(n){t(n[e])};r(e)?l.getCommonProperties(a):l.getGroupProperties(a)}else t(null)},s.set=function(e,t){if(p!=o.ANONYMOUS&&o.hasProperty(e))console.log("Request setting read-only property... skipping");else if(n){var a={};a[e]=t,r(e)?l.setCommonProperties(a):l.setGroupProperties(a)}},s.hasStudentAccount=function(){return p==o.OFFLINE||p==o.ONLINE},s.getStudentAccountUserId=function(){return o.getUserId()},s.getStudentAccountUserName=function(){return o.getUserName()},s.getStudentAccountEmail=function(){return o.getEmail()},s.getStudentAccountProviderId=function(){return o.getProviderId()},s.getStudentAccountProviderHumanId=function(){return o.getProviderHumanId()},s.getStudentAccountToken=function(){return o.getUserToken()},s.getStudentAccountClassName=function(){return o.getUserClassName()},s.isCoAccount=function(){return o.isCoAccount()},o.initialized().then(function(){f(o.getState()),o.registerStateChangeCallback(f)},function(){f(o.ANONYMOUS)})}),s}.bind(null,n(0),n(11));e.exports={f:r,o:r()}},function(e,t,n){var r;e.exports=(r=n(0),{show:function(){var e=r("#bwcountdown");0==e.length&&(e=r('<div id="bwcountdown"><label id="bwhours">00:</label><label id="bwminutes">00</label>:<label id="bwseconds">00</label></div>')).prependTo("#title-toolbar"),e.show()},hide:function(){r("#bwcountdown").hide()},starttime:null,countdowntime:0,running:!1,initialized:!1,pad:function(e){return e>9?e:"0"+e},timeLeft:function(){var e;if(0==this.countdowntime&&console.log("getting time left but  no countdown time set"),null==this.starttime)console.log("getting time left but no starttime set"),e=this.countdowntime;else{var t=new Date;(e=this.countdowntime-(t.getTime()-this.starttime.getTime())/1e3)<0&&(e=0)}return parseInt(e)},elapsed:function(){return this.countdowntime-this.timeLeft()},updateDisplay:function(){var e=this.timeLeft(),t=e%60,n=parseInt(e/60%60),o=parseInt(e/3600);r("#bwcountdown #bwseconds").html(this.pad(t)),r("#bwcountdown #bwminutes").html(this.pad(n)),r("#bwcountdown #bwhours").html(this.pad(o)+":"),0==o?r("#bwcountdown #bwhours").css("display","none"):r("#bwcountdown #bwhours").css("display","initial")},setStartTime:function(e){console.log("Set start time to "+e),this.starttime=new Date(e),this.updateDisplay()},getStartTime:function(e){return null==this.starttime?null:this.starttime.getTime()},isInitialized:function(){return this.initialized},reset:function(){this.starttime=null},start:function(){if(console.log("Starting countdown timer"),this.running)console.log("Error: start called twice");else{if(null==this.starttime){var e=new Date;this.setStartTime(e.getTime())}this.timerid=setInterval(this.update.bind(this),1e3),this.running=!0,this.show(),this.updateDisplay()}},init:function(e){console.log("Initializing countdown timer"),!0===this.running&&this.stop(),e.hasOwnProperty("time")&&(this.countdowntime=e.time||60),e.hasOwnProperty("timeoutCB")&&(this.callback=e.timeoutCB),e.hasOwnProperty("starttime")&&this.setStartTime(parseInt(e.starttime)),this.initialized=!0},stop:function(){this.running=!1,clearInterval(this.timerid),this.updateDisplay()},elapsedFormatted:function(){var e=this.elapsed();return this.pad(parseInt(e/60))+":"+this.pad(e%60)},update:function(){0==this.timeLeft()&&(this.stop(),null!=this.callback&&this.callback()),this.updateDisplay()}})},function(e,t,n){e.exports=function(e){var t={};function n(e,t){return"credentials/"+e+"/"+t}return t.setLoggedIn=function(t,r,o,a,i){e.setItem(n(t,"username"),r),e.setItem(n(t,"fullname"),o),e.setItem(n(t,"email"),a),e.setItem(n(t,"accesstoken"),i)},t.setLoggedOut=function(t){e.removeItem(n(t,"username")),e.removeItem(n(t,"fullname")),e.removeItem(n(t,"email")),e.removeItem(n(t,"accesstoken"))},t.getLoginData=function(t){var r=e.getItem(n(t,"username")),o=e.getItem(n(t,"fullname")),a=e.getItem(n(t,"email")),i=e.getItem(n(t,"accesstoken"));return r&&i?{username:r,fullname:o,email:a,accesstoken:i}:null},t}(n(146).o)},function(e,t,n){var r=n(21).extend,o=n(88);e.exports=function(e,t,a){var i=n(22).createLogger("ProgressLogger"),s=new e;s.startListening();return function(e){var n=void 0!==e||"ibw-platform-ipad-bookwidgets"===t.getPlatform();e=e||function(e){var t=document.createElement("IFRAME");t.setAttribute("src",e),t.setAttribute("height","1px"),t.setAttribute("width","1px"),document.documentElement.appendChild(t),t.parentNode.removeChild(t),t=null};var a={};function c(e,t){a.callObjC("progress",r({cmd:e},t),function(){i.error("ProgressLogger: OK for:"+e)},function(){i.error("ProgressLogger: ERROR for:",e)})}a.resultForCallback=function(e,t){s.processCallback(e,t)},a.runningInIframe=function(){try{return window.self!==window.top}catch(e){return!0}},a.callObjC=function(t,n,r,i){var c=o.url(t,n),l=s.registerCallbacks(r,i),d="'"+l.ok+"'",u="'"+l.error+"'",p="ProgressLogger.resultForCallback";a.runningInIframe()&&(p="function ProgressLogger_callback_wrapper(callbackID, arg) { window.postMessage({ 'command': callbackID, 'arg': arg, 'to': '_widget' }, '*'); }; ProgressLogger_callback_wrapper"),e(c+"&okCallbackId="+d+"&errorCallbackId="+u+"&callbackFunc="+p)},a.restart=function(){n&&c("restart")},a.registerScore=function(e,t,r,o,a){return n?(c("registerScore",{identifier:e,title:t,score:o,maxScore:r,primary:!0===a}),{lastval:o,update:function(n){return n!==this.lastval&&(c("updateScore",{identifier:e,title:t,score:n,maxScore:r,primary:!0===a}),this.lastval=n,!0)}}):{update:function(){return!1}}},a.registerBinary=function(e,t,n,r,o){return{update:function(){return!1}}},a.registerQuantity=function(e,t,r,o){return n?(c("registerQuantity",{identifier:e,title:t,quantity:r,primary:!0===o}),{lastval:r,update:function(n){return n!==this.lastval&&(c("updateQuantity",{identifier:e,title:t,quantity:n,primary:!0===o}),this.lastval=n,!0)}}):{update:function(){return!1}}};var l=0;return a.setProgress=function(e,t){if(n){var r=Math.max(0,Math.min(1,e/t));r!==l&&(c("setProgress",{progress:r}),l=r)}},a.registerSet=function(e,t,r,o){if(!n)return{registerAccess:function(){return!1}};var a=this;return{elements:[],accesscount:0,accessedcount:0,accessedLogger:this.registerQuantity(e+"accessed",t,0),accessesLogger:this.registerQuantity(e+"accesses",r,0),registerAccess:function(e){return this.accessesLogger.update(++this.accesscount),this.elements.hasOwnProperty(e)||(this.elements[e]=!0,this.accessedLogger.update(++this.accessedcount),a.setProgress(this.accessedcount,o)),!0}}},window.ProgressLogger=a,a}}(n(64),n(2))},function(e,t,n){e.exports=(n(1),{useManualNotify:window.BwUseManualWidgetLoadedNotification,notifyLoaded:window.BwNotifyWidgetLoaded})},,,,,,,,,function(e,t){},function(e,t,n){var r,o;e.exports=(r=n(1),o=n(426),n(0),void r.getConfig().then(function(e){e.hasOwnProperty("modules")&&-1!==e.modules.indexOf("MathJs")&&o.loadJS("js/math.min.js","head"),e.hasOwnProperty("modules")&&-1!==e.modules.indexOf("scientific")&&o.loadJS("js/scientificcalculator_init.js","head")}))},function(e,t,n){e.exports=function(e){return{loadJS:function(t,n,r){var o=e.Deferred(),a=document.createElement("script");if(a.setAttribute("type","text/javascript"),r)for(var i in r)r.hasOwnProperty(i)&&a.setAttribute(i,r[i]);return a.setAttribute("src",t),a.onload=function(){o.resolve()},a.onerror=function(){o.reject()},void 0!==a&&document.getElementsByTagName(n)[0].appendChild(a),o}}}(n(0))}]);